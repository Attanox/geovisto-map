{"version":3,"sources":["model/object/abstract/AbstractMapObjectDefaults.js","model/object/abstract/AbstractMapObject.js","model/event/abstract/AbstractEvent.js","model/event/abstract/AbstractObjectEvent.js","model/event/generic/GenericObjectEvent.js","model/event/basic/DataChangeEvent.js","model/object/abstract/AbstractMapObjectState.js","model/tool/abstract/AbstractToolState.js","model/tool/abstract/AbstractToolDefaults.js","model/tool/abstract/AbstractTool.js","model/object/abstract/AbstractMapObjectsManager.js","model/tool/abstract/AbstractToolsManager.js","model/tool/generic/ToolsManager.js","tools/sidebar/SidebarToolDefaults.js","tools/sidebar/SidebarToolState.js","tools/sidebar/SidebarTool.js","util/TabDOMUtil.js","inputs/AbstractSidebarInput.js","inputs/input/AutocompleteSidebarInput.js","inputs/filter/FilterAutocompleteSidebarInput.js","inputs/input/TextSidebarInput.js","inputs/input/LabeledTextAreaSidebarInput.js","inputs/input/LabeledTextSidebarInput.js","inputs/select/SelectSidebarInput.js","inputs/select/LabeledSelectSidebarInput.js","inputs/filter/FilterSelectSidebarInput.js","inputs/SidebarInputFactory.js","tools/sidebar/model/control/AbstractTabControlDefaults.js","tools/filters/sidebar/FiltersToolTabControlDefaults.js","tools/sidebar/model/control/AbstractTabControlState.js","tools/filters/sidebar/FiltersToolTabControlState.js","tools/sidebar/model/control/AbstractTabControl.js","tools/filters/sidebar/FiltersToolTabControl.js","tools/filters/model/abstract/AbstractFilterOperation.js","tools/filters/model/abstract/AbstractFiltersManager.js","tools/filters/model/abstract/AbstractFilterRule.js","tools/filters/model/generic/FilterRule.js","model/data/AbstractMapDataDomain.js","model/data/AbstractMapData.js","tools/filters/model/generic/FiltersManager.js","tools/filters/model/basic/EqFilterOperation.js","tools/filters/model/basic/NeqFilterOperation.js","tools/filters/model/basic/RegFilterOperation.js","tools/filters/FiltersToolDefaults.js","tools/filters/FiltersToolState.js","tools/filters/FiltersTool.js","tools/settings/sidebar/SettingsToolTabControlDefaults.js","tools/settings/sidebar/SettingsToolTabControlState.js","tools/settings/sidebar/SettingsToolTabControl.js","tools/settings/SettingsToolDefaults.js","tools/selection/model/item/generic/MapSelection.js","tools/selection/model/item/abstract/AbstractMapSelection.js","tools/selection/SelectionToolState.js","tools/selection/model/event/SelectionToolEvent.js","tools/sidebar/model/fragment/AbstractTabFragmentState.js","tools/sidebar/model/fragment/AbstractTabFragmentDefaults.js","tools/sidebar/model/fragment/AbstractTabFragment.js","tools/selection/sidebar/SelectionToolTabFragmentDefaults.js","tools/selection/sidebar/SelectionToolTabFragmentState.js","tools/selection/sidebar/SelectionToolTabFragment.js","tools/selection/SelectionTool.js","tools/selection/SelectionToolDefaults.js","tools/settings/SettingsToolState.js","tools/settings/SettingsTool.js","model/config/basic/BasicMapConfig.js","tools/layers/abstract/sidebar/AbstractLayerToolTabControlDefaults.js","tools/layers/abstract/sidebar/AbstractLayerToolTabControlState.js","tools/layers/abstract/sidebar/AbstractLayerToolTabControl.js","tools/layers/abstract/AbstractLayerToolState.js","tools/layers/abstract/AbstractLayerTool.js","tools/layers/abstract/AbstractLayerToolDefaults.js","tools/layers/map/MapLayerToolDefaults.js","tools/layers/map/MapLayerToolState.js","tools/layers/map/sidebar/MapLayerToolTabControlDefaults.js","tools/layers/map/sidebar/MapLayerToolTabControlState.js","tools/layers/map/sidebar/MapLayerToolTabControl.js","tools/themes/model/event/ThemesToolEvent.js","tools/layers/map/MapLayerTool.js","tools/layers/choropleth/ChoroplethLayerToolDefaults.js","tools/layers/choropleth/ChoroplethLayerToolState.js","tools/layers/choropleth/sidebar/ChoroplethLayerToolTabControlDefaults.js","tools/layers/choropleth/sidebar/ChoroplethLayerToolTabControlState.js","tools/layers/choropleth/sidebar/ChoroplethLayerToolTabControl.js","tools/layers/choropleth/ChoroplethLayerTool.js","tools/layers/marker/sidebar/MarkerLayerToolTabControlDefaults.js","tools/layers/marker/sidebar/MarkerLayerToolTabControlState.js","tools/layers/marker/sidebar/MarkerLayerToolTabControl.js","tools/layers/marker/MarkerLayerToolDefaults.js","tools/layers/marker/MarkerLayerToolState.js","tools/layers/marker/MarkerLayerTool.js","tools/layers/connection/sidebar/ConnectionLayerToolTabControlDefaults.js","tools/layers/connection/sidebar/ConnectionLayerToolTabControlState.js","tools/layers/connection/sidebar/ConnectionLayerToolTabControl.js","tools/layers/connection/ConnectionLayerToolDefaults.js","tools/layers/connection/ConnectionLayerToolState.js","tools/layers/connection/util/D3PathForceSimulator.js","tools/layers/connection/util/ProjectionUtil.js","tools/layers/connection/ConnectionLayerTool.js","tools/themes/model/theme/abstract/AbstractTheme.js","tools/themes/model/theme/generic/ThemesManager.js","tools/themes/model/theme/abstract/AbstractThemesManager.js","tools/themes/model/theme/basic/light1/Light1Theme.js","tools/themes/model/theme/basic/light2/Light2Theme.js","tools/themes/model/theme/basic/light3/Light3Theme.js","tools/themes/model/theme/basic/dark1/Dark1Theme.js","tools/themes/model/theme/basic/dark2/Dark2Theme.js","tools/themes/model/theme/basic/dark3/Dark3Theme.js","tools/themes/ThemesToolDefaults.js","tools/themes/ThemesToolState.js","tools/themes/sidebar/ThemesToolTabFragmentDefaults.js","tools/themes/sidebar/ThemesToolTabFragmentState.js","tools/themes/sidebar/ThemesToolTabFragment.js","tools/themes/ThemesTool.js","tools/layers/drawing/components/paintPoly.js","tools/layers/drawing/util/Marker.js","tools/layers/drawing/util/functionUtils.js","tools/layers/drawing/components/inputs.js","tools/layers/drawing/sidebar/DrawingLayerToolTabControlState.js","tools/layers/drawing/components/Knife.js","tools/layers/drawing/util/Poly.js","tools/layers/drawing/DrawingLayerToolState.js","tools/layers/drawing/util/constants.js","tools/layers/drawing/DrawingLayerToolDefaults.js","tools/layers/drawing/sidebar/DrawingLayerToolTabControlDefaults.js","tools/layers/drawing/sidebar/DrawingLayerToolTabControl.js","tools/layers/drawing/components/useDrawingToolbar.js","tools/layers/drawing/DrawingLayerTool.js","map/GeovistoMapDefaults.js","map/GeovistoMapState.js","map/GeovistoMap.js","react/ReactGeovistoMap.js","model/data/basic/FlattenedMapDataDomain.js","model/data/basic/FlattenedMapData.js","demo/Demo.js","index.js"],"names":["AbstractMapObjectDefaults","mapObject","this","undefined","id","getType","AbstractMapObject","props","defaults","createDefaults","console","log","initialize","state","createState","AbstractMapObjectState","getProps","getId","AbstractEvent","AbstractObjectEvent","GenericObjectEvent","type","source","object","DataChangeEvent","data","TYPE","setType","setId","reset","config","AbstractToolState","setEnabled","enabled","isEnabled","resetMapVariables","getMap","getDefaults","map","AbstractToolDefaults","AbstractTool","isSingleton","getState","setMap","deserialize","getConfig","event","AbstractMapObjectsManager","getObjects","length","types","objects","i","push","resultObjects","AbstractToolsManager","AbstractMapManager","ToolsManager","tools","toolsCopy","copy","tool","filter","item","SidebarToolDefaults","SidebarTool","SidebarToolState","tabs","tabsDecriptions","serialize","sidebar","tab","index","array","indexOf","splice","createSidebar","createTabs","L","control","getSidebarStructure","addTo","getLeafletMap","setSidebar","autopan","closeButton","position","getTabs","getTabsDescriptions","tabConfig","tabsConfigs","getTools","getById","createSidebarTab","getSidebarTabControl","sidebarTabControl","getSidebar","create","addTab","TabDOMUtil","label","action","options","div","document","createElement","appendChild","createTextNode","createSelect","className","select","setAttribute","classList","add","onchange","appendOptions","option","innerHTML","size","input","btn","onclick","heading","element","keyArray","valueArray","AbstractSidebarInput","settings","disabled","removeAttribute","value","ID","COMPONENT_COMPLETION_ACTIVE_ITEM_CLASS","AutocompleteSidebarInput","setData","placeholder","inputValue","formDiv","inputDiv","completionListDiv","selectedCompletionItem","newOptions","redrawMenu","matchArray","notMatchArray","String","includes","match","other","createForm","createListeners","labelDiv","setAttributes","_this","addEventListener","e","createMenu","completionItems","children","remove","keyCode","preventDefault","textContent","dispatchEvent","Event","target","createCompletionItem","completionItemDiv","parentElement","currentOptions","getCurrentOptions","forEach","FilterAutocompleteSidebarInput","dataModel","opModel","ops","valModel","vals","dataInput","opInput","valInput","getValue","op","val","setValue","TextSidebarInput","LabeledTextAreaSidebarInput","LabeledTextSidebarInput","SelectSidebarInput","selected","Boolean","LabeledSelectSidebarInput","FilterSelectSidebarInput","createInputElement","createSelectElement","SidebarInputFactory","AbstractTabControlDefaults","FiltersToolTabControlDefaults","getMapObject","AbstractTabControlState","setTool","setName","name","getName","setIcon","icon","getIcon","setCheckButton","checkButton","getCheckButton","tabControl","deserializeFragments","fragment","fragments","fragmentConfig","getTool","getSidebarTabFragment","isChild","setTabFragments","tabPane","FiltersToolTabControlState","C_sidebar_header_class","C_sidebar_tab_content_class","C_enabled_class","AbstractTabControl","JSON","parse","stringify","addPanel","getTabStructure","postCreate","pane","title","tabElement","getElementById","tabContent","getElementsByClassName","getTabContent","tabFragments","getTabFragments","tabHeader","hasCheckButton","tabEnableBtn","setChecked","checked","insertBefore","firstChild","d3","selectAll","attr","sidebarTab","classed","setTabContentChecked","FiltersToolTabControl","mapData","getMapData","getData","dataDomainLabels","getDataDomainLabels","filterManager","getFiltersManager","operationLabels","getOperationLabels","btnGroup","inputs","counter","createButton","addSelectItem","inputChangedAction","setFilterRules","getFilterRules","filterRules","getDataDomain","filterRule","createRule","container","toString","getFilterOperation","getPattern","getFilterRuleElementClass","minusButton","removeSelectItem","createSidebarInput","closest","dataDomain","setDisabled","values","getValues","changeOptions","currentData","inputItem","AbstractFilterOperation","pattern","AbstractFiltersManager","operations","getOperations","labels","operation","AbstractFilterRule","FilterRule","AbstractMapDataDomain","domainDescription","AbstractMapData","dataDomains","getDataDomains","FiltersManager","filterOperations","getOperation","doFilter","resultData","matchFunctions","patterns","j","getItemValues","EqFilterOperation","NeqFilterOperation","RegFilterOperation","RegExp","FiltersToolDefaults","FiltersTool","FiltersToolState","setFiltersManager","manager","rules","configFilterRule","dimension","domain","createSidebarTabControl","updateData","filterData","SettingsToolTabControlDefaults","SettingsToolTabControlState","SettingsTabControl","SettingsToolDefaults","SettingsTool","MapSelection","srcIds","allIds","x","srcElement","selection","getSrcIds","srcIds2","ids","newIds","SelectionToolState","setSelection","getSelection","SelectionToolEvent","selectionTool","AbstractTabFragmentState","content","AbstractTabFragmentDefaults","AbstractTabFragment","setTabControl","SelectionToolTabFragmentDefaults","SelectionToolTabFragmentState","SelectionToolTabFragment","createTabContent","SelectionTool","tabFragment","SelectionToolDefaults","createSidebarTabFragment","EMPTY_SELECTION","SettingsToolState","SettingsToolTabControl","BasicMapConfig","toolId","Array","isArray","find","mapConfig","AbstractLayerToolTabControlDefaults","getLayerName","getDataMappingModel","AbstractLayerToolTabControlState","AbstractLayerToolTabControl","dataMapping","AbstractLayerToolState","setLayerName","setDataMapping","getDataMapping","layerName","AbstractLayerTool","LayerTool","LayerToolDefaults","LayerToolState","LayerTabControl","showLayerItems","hideLayerItems","layerItems","getLayerItems","postCreateLayerItems","removeLayer","createLayerItems","onlyStyle","redraw","AbstractLayerToolDefaults","MapLayerToolDefaults","MapLayerTool","MapLayerToolState","setBaseMap","baseMap","getBaseMap","layer","MapLayerToolTabControlDefaults","MapLayerToolTabControlState","MapLayerToolTabControl","ThemesToolEvent","themesTool","theme","createTileLayer","setLayer","tileID","tileLayer","attribution","subdomains","maxZoom","minZoom","onThemeChange","getObject","getLayer","_url","INPUT_ID_PREFIX","MAPPING_MODEL","country","aggregation","color","ChoroplethLayerToolDefaults","ChoroplethLayerTool","dataMappingModel","implicitDataDomainLabel","getPolygons","ChoroplethLayerToolState","setZIndex","getZIndex","setPolygons","polygons","popup","polys","features","hoveredItem","zindex","ChoroplethLayerToolTabControlDefaults","ChoroplethLayerToolTabControlState","ChoropolethLayerToolTabControl","model","inputCountry","inputAggregation","changeDimensionAction","updateDataMapping","getInputValues","elem","setInputValues","COLOR_orange","COLOR_red","COLOR_blue","SCALE","getByType","thousands_separator","num","num_parts","split","replace","join","mouseOver","layerItem","setHoveredItem","feature","updateItemStyle","bindTooltip","sticky","openTooltip","Browser","ie","opera","edge","bringToFront","mouseOut","getLayerPopup","update","bringToBack","click","getSelectionTool","equals","updatePolygons","paneId","createPane","style","zIndex","geoJSON","onEachFeature","on","mouseover","mouseout","layerPopup","onAdd","_div","DomUtil","setLayerPopup","geoCountry","foundCountries","foundValues","getCurrentData","dataLen","countryDataDomain","valueDataDomain","updateStyle","colors","getColors","scale","getScale","getHoveredItem","weight","opacity","dashArray","fillOpacity","fillColor","getIds","computeColor","computeColorClass","selectedIds","_path","computeStyleClasses","eachLayer","MarkerLayerToolTabControlDefaults","MarkerLayerToolTabControlState","MarkerLayerToolTabControl","category","inputCategory","MarkerLayerToolDefaults","MarkerLayerTool","getCentroids","MarkerLayerToolState","setMarkers","setCentroids","centroids","markers","CountryIcon","DivIcon","extend","_LEVEL","_SUFFIX","_COLOR","levels","Infinity","sizeBasic","sizeGroup","sizeDonut","subvalues","active","mitigated","finished","isGroup","useDonut","round","align","Math","formatValue","level","getColor","getLevel","createIcon","oldIcon","tagName","iconSize","iconAnchor","rCircle","center","divContent","svg","append","html","values_ready","d","pie","Object","entries","enter","innerRadius","outerRadius","bgPos","point","backgroundPosition","y","_setIconStyles","markerClusterGroup","iconCreateFunction","cluster","getAllChildMarkers","key","countryName","getMarkers","actResultItem","foundCategories","workData","categoryDataDomain","highlightedIds","createMarker","addLayer","centroid","popupMsg","marker","lat","long","bindPopup","deleteLayerItems","prepareMapData","createMarkers","ConnectionLayerToolTabControlDefaults","ConnectionLayerToolTabControlState","ConnectionLayerToolTabControl","from","inputFrom","to","inputTo","ConnectionLayerToolDefaults","ConnectionLayerTool","ConnectionLayerToolState","D3PathForceSimulator","segmentLength","getDefaultSegmentLength","paths","createPaths","connections","createPath","connection","path","sqrt","numberOfSegments","dx","dy","numberOfPoints","onTickAction","onEndAction","getSimulation","getForceProps","getNodes","force","strength","charge","distanceMin","distanceMax","links","getLinks","link","distance","alphaDecay","forceProps","createDefaultForceProps","nodes","createNodes","node","endNodes","fx","fy","getPaths","createLinks","ProjectionUtil","zoom","coords","project","LatLng","curve","latLngToLayerPoint","unproject","Point","_container","layerElement","childNodes","removeChild","lastChild","geoFrom","geoTo","actFrom","actTo","actConnection","foundFrom","foundTo","projectPoint","getDataProjectionFunction","getProjectionZoom","fromDataDomain","toDataDomain","clone","rfdc","count","setWorkData","g","_map","getPanes","overlayPane","getWorkData","d3ForceSimulator","projectionPathFunction","getPathProjectionFunction","updatePaths","onSelectionUpdate","run","selectionSrcIds","affectedIds","each","addIds","AbstractTheme","ThemesManager","themes","getThemes","Light1Theme","Light2Theme","Light3Theme","Dark1Theme","Dark2Theme","Dark3Theme","ThemesToolDefaults","ThemesTool","getThemesManager","getDefault","ThemesToolState","setThemesManager","setTheme","getTheme","themesManager","ThemesToolTabFragmentDefaults","ThemesToolTabFragmentState","ThemesToolTabFragment","themeInput","getThemeLabels","newTheme","DEFAULT_COLOR","ERASER_COLOR","PaintPoly","getMouseDown","_mouseDown","getBrushSize","_circleRadius","getBrushSizeConstraints","maxBrushSize","_maxCircleRadius","minBrushSize","_minCircleRadius","resizeBrush","_circle","setRadius","stop","_action","_removeMouseListener","startPaint","_addMouseListener","circleMarker","_latlng","window","startErase","clearPaintedPolys","kIdx","_shapeLayers","_accumulatedShapes","clearAllAccumulated","keys","updatePaintedPolys","toGeoJSON","properties","convertOptionsToProperties","_pixelsToMeters","metersPerPixel","abs","cos","PI","pow","getZoom","drawCircle","erase","brushColor","tabState","getSelectedColor","brushStroke","getSelectedStroke","STROKES","turfCircle","circle","lng","steps","units","keyIndex","union","fill","_redrawShapes","selectedLayer","getToolState","simplifyFeature","geometry","coordinates","depth","latlngs","GeoJSON","coordsToLatLngs","styles","highlightStyles","normalStyles","opts","draggable","transform","result","polygon","dragging","disable","_fireCreatedShapes","layerState","found","getLayerByIdx","layerType","fire","Draw","CREATED","_onMouseMove","_onMouseDown","_onMouseUp","off","enable","_setLatLng","latlng","setLatLng","clickDraw","enablePaint","DomEvent","_active","enableErase","isActive","ExtendedMarker","Marker","setIconOptions","iconOpts","iconStarter","shadowUrl","iconOptions","markerCreate","connectClick","additionalOpts","iconUrl","getSelectedIcon","Icon","guideLayers","repeatMode","snapVertices","setEnabledEl","geoSearch","featureGroup","a","query","provider","OpenStreetMapProvider","search","results","isEmpty","obj","getIntervalStep","n","after","allZeros","Number","createIntervalInput","min","max","onChange","step","controlWrapper","display","justifyContent","alignItems","inputWrapper","displayAmount","innerText","createCheck","onCheck","prefix","check","checkLabel","for","ICON_SRCS","COLORS","ADMIN_LEVELS","DrawingLayerToolTabControlState","increaseFilters","filtersAmount","filtersKeys","filtersValues","decreaseFilters","pop","changeColorAction","selectedEl","_getSelected","setSelectedColor","setStyle","_getExtraSelected","changeWeightAction","setSelectedStroke","changeIconOpts","iconOpt","enabledEl","_marker","oldIconOptions","newIconOptions","markerIcon","highlightElement","changeIconAction","setSelectedIcon","redrawTabContent","changeIconAnchor","coordinate","changeDescriptionAction","changeDesc","inputText","modInputText","convertDescToPopText","popup1","getPopup","setContent","closeOnClick","autoClose","popupContent","callIdentifierChange","haveToCheckFilters","changeIdentifierAction","identifier","filteredData","idx","idType","identifierType","popupText","changeWhichIdUseAction","setIdentifierType","searchAction","setSearchOpts","inputSearch","opt","onInputOptClick","searchOpts","connectActivated","latLng","raw","Touch","putMarkerOnMap","applyEventListeners","applyTopologyMarkerListeners","appendToIconSrcs","plotTopology","addIconAction","fetchAreas","countryCode","adminLevel","highQuality","toolState","querySelector","cursor","searchForAreasBtn","fetch","then","response","json","gJSON","osmtogeojson","selectedColor","feat","errorMsg","catch","err","error","finally","searchForAreaAction","setCountryCode","pickAdminLevelAction","setAdminLevel","strokes","selectedStroke","iconSrcs","Set","selectedIcon","intersectActivated","paintPoly","pather","Pather","strokeWidth","smoothFactor","moduleClass","pathColour","patherActive","countries","require","c","extraSelected","Slice","Polyline","statics","touch","touchIcon","drawError","message","drawLocal","draw","handlers","polyline","Util","Feature","prototype","call","_calculateFinishDistance","potentialLatLng","lastPtDistance","_markers","finishMarker","Polygon","lastMarkerPoint","latLngToContainerPoint","getLatLng","potentialMarker","zIndexOffset","potentialMarkerPint","distanceTo","getGeoJSONFeatureFromLayer","geoFeature","getFeatFromLayer","drawnGeoJSON","isFeaturePoly","f","pixels","tolerance","customTolerance","turf","isLayerPoly","morphFeatureToPolygon","simplify","simplified","DrawingLayerToolState","clearExtraSelected","normalizeElement","isInExtraSelected","layerId","el","_leaflet_id","areSameType","addExtraSelected","chosenLayersMaxed","chosenLayers","pushChosenLayer","shift","deselectChosenLayers","chosen","clearChosenLayers","pushJoinedToChosenLayers","joined","isConnectMarker","selectedLayerIsConnectMarker","canPushToChosen","acceptableType","firstChosen","chosenLayersArePolys","chosenLayersAreMarkers","pushVertice","vertice","createdVertices","removeGivenVertice","lId","idsOfVerticesToRemove","removeMappedVertices","v","mappedMarkersToVertices","newMapped","vertObj","vert","has","removeMarkersMappedVertices","markerVertices","addMappedVertices","mappedVertices","mappedProperty","initMappedMarkersToVertices","lType","markerId","verticesKeyArr","vertLeafId","mappedVerticeId","verticesObj","vertKey","spreadable","currEl","FeatureGroup","activeIndex","selecting","layersObj","_layers","is","l","geo","geojson","sidebarState","sort","b","sortReverseAlpha","convertPropertiesToOptions","getLeafletTypeFromFeature","featureCoordinates","reverse","featureToLeafletCoordinates","snapediting","Handler","MarkerSnap","pushGuideLayer","exportSettings","pushPolygon","extra","_latlngs","pushMarker","layerToAdd","poly","idKey","description","strokeThickness","searchForArea","dataFilterKey","dataFilterValue","DrawingLayerToolDefaults","DrawingLayerTool","DrawingLayerToolTabControlDefaults","POLYS","DrawingLayerToolTabControl","createBrushSizeControl","brushControl","customToleranceCheck","createCustomToleranceCheck","customToleranceInput","createIdentifierInput","getIdentifierType","idOpts","createPickIdentifier","k","descText","replaceAll","convertDescfromPopText","popText","createConnectCheck","setConnectActivated","createIntersectionCheck","setIntersectActivated","createHighQualityCheck","setHighQuality","createChangeConnectCheck","isConnect","toleranceChange","interval","setGlobalSimplificationTolerance","createIconAnchorSlider","toUpperCase","createXAnchorSlider","createYAnchorSlider","addHeading","headingTag","renderSearchInputs","inputConnect","inputSearchForArea","getSelectCountries","inputAdminLevel","hqCheck","renderDataInputs","disableTextFields","inputPickIdentifier","inputId","inputDesc","getContent","renderDataFilters","filtersKey","getFiltersKey","keyEl","setFiltersKey","setDataKey","valueOpts","valueEl","setFiltersValue","setDataValue","getFiltersValue","renderFilterInputs","wrapper","width","addFilterBtn","removeFilterBtn","renderPolyInputs","thicknessOpts","inputThickness","inputColor","createColorPicker","renderIconInputs","inputIcon","createIconPalette","inputUrl","changeConnect","activeIdx","changeAction","img","inputPalette","gridTemplateColumns","boxSizing","background","backgroundRepeat","backgroundSize","height","border","colorPicker","activeColor","createPalette","iconsSet","activeIcon","iconsArr","paintPolyControl","clearFilters","inputIntersect","useDrawingToolbar","Control","DrawingToolbar","drawingBtns","setOptions","createUi","topContainer","toolContainer","lineBtn","createToolbarBtn","markerBtn","polygonBtn","deselectBtn","transformBtn","editBtn","joinBtn","sliceBtn","divideBtn","connectBtn","searchBtn","paintBtn","eraserBtn","removeBtn","addEventListeners","disableClickPropagation","onRemove","_disableTransform","_disableNodeEdit","toggleExtra","withExtra","extraBtn","nextSibling","toggle","_disableDrawing","initCreatePolyline","stopPropagation","initCreateMarker","initCreatePolygon","initTransform","initNodeEdit","initSlicePoly","initDividePoly","deselect","initJoin","initConnect","initSearch","initPainting","initErasing","initRemove","evt","init","initSelecting","redrawSidebar","removeElement","shapeOptions","polylineCreate","allowIntersection","snapDistance","polygonCreate","patherStatus","setPatherStatus","slicePoly","dividePoly","getSelectedEl","editing","_enabled","clearSelectedLayer","getEnabledEl","btnContainer","returnBtn","role","redrawSidebarTabControl","drawingToolbar","d33","include","Evented","SnapMixin","addInitHook","_snap_initialize","DRAWING_TOOL_LAYER_TYPE","operateOnSelectedAndCurrectLayer","eKeyIndex","selectNew","isFeatPoly","summedFeature","selectedFeatures","selectedFeature","removeSelectedLayer","setSelectedLayer","createdListener","polyIntersect","polyJoin","polyDiff","polySlice","createdPath","removePath","knifeBtn","getSummedFeature","joinChosen","drawObject","chosenFeatures","first","second","resultFeature","initChangeStyle","getSelecting","originalEvent","ctrlKey","fgLayers","_","setSelecting","divideEqual","polygonFeat","polygonBbox","hightlightOnHover","normalizeOnHover","intersect","layerFeature","isCurrentLayerPoly","createdIsEraser","replaceLayer","replacement","replacedLayer","replacementCoords","diffLayers","layerIsNotSelected","diffFeature","difference","isMultiPoly","isJustPoly","coord","newLatLngs","lineFeat","offsetLine","polyCoords","thickLineString","thickLinePolygon","current","getLatLngs","layerArr","allConnected","firstMarker","secondMarker","fLat","fLng","sLat","sLng","haveSameVertice","mapMarkersToVertices","mapped","spread","setVerticesToMarker","oldlatlng","markerID","m","setVerticesCoordinates","splitKey","latLngs","LatLngUtil","cloneLatLngs","setLatLngs","oldLatLng","changeVerticesLocation","addControl","getCenter","_icon","addClass","removeClass","rotation","scaling","GeovistoMapDefaults","GeovistoMap","getToolTemplates","FlattenedMapData","countryPolygons","countryCentroids","mapCenter","getMapCenter","mapStructure","getMapStructure","maxBounds","GeovistoMapState","templates","getTemplates","setToolTemplates","setTools","setMapData","globals","getGlobals","setInitialZoom","setInitialMapCenter","setInitialMapStructure","deserializeGeoJSON","t","serializeToGeoJSON","toolTemplates","setCurrentData","mapContainer","setMapConfig","toolsManager","getToolConfig","toolsConfigs","getToolsConfigs","toolConfig","toolTemplatesManager","getMapConfig","export","serializeGeoJSON","createMapContainer","createMap","createTools","getContainerId","getContainerClass","getInitialMapStructure","setView","getInitialMapCenter","getInitialZoom","attributionControl","addAttribution","getMapAttribution","setLeafletMap","handleEvent","ReactGeovistoMap","getDefaultId","getDefaultClass","Component","FlattenedMapDataDomain","flattenedData","createDataDomains","flattenArrays","getDataValues","actResult","processDataDomainDescription","getDomainDescription","actKeys","processDataDomain","actValue","dataDomainCopy","newMapDataDomain","dataDomainLabel","contains","transformObject","transformedChild","transformedChildren","concat","newResults","dataDomainPart","C_ID_select_data","C_ID_check_data","C_ID_input_data","C_ID_check_config","C_ID_input_config","C_ID_check_geojson","C_ID_input_geojson","C_ID_check_choropleth","C_ID_input_choropleth","C_ID_input_import","C_ID_input_export","Demo","exportGeoJSON","encodeURIComponent","body","Polygons","Centroids","jsonData","JsonDataDemo1","jsonConfig","JsonConfig","geojsonConfig","GeojsonConfig","React","createRef","enableInput","pathSubmitted","file","reader","FileReader","onload","ex","readAsText","files","fileName","JsonDataDemo2","VaccinationData","FloorPlanData","NetworkData","setState","accept","onClick","ref","ReactDOM","render"],"mappings":"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","file":"static/js/main.c6732629.chunk.js","sourcesContent":["/**\n * This class provide functions which return the default state values.\n * \n * @author Jiri Hynek\n */\nclass AbstractMapObjectDefaults {\n\n    /**\n     * It creates map object defaults.\n     */\n    constructor() {\n    }\n\n    /**\n     * It initializes the map object defaults.\n     * \n     * @param {*} object \n     */\n    initialize(mapObject) {\n        this.mapObject = mapObject;\n    }\n\n    /**\n     * It returns the map object which works with the defaults.\n     */\n    getMapObject() {\n        return this.mapObject;\n    }\n\n    /**\n     * It returns default props if no props are given.\n     */\n    getProps() {\n        return {};\n    }\n\n    /**\n     * It returns a unique type string of the tool.\n     */\n    getType() {\n        return \"geovisto-object-abstract\";\n    }\n\n    /**\n     * It returns identifier which is used when no identifier is specified.\n     */\n    getId() {\n        if(AbstractMapObjectDefaults.id == undefined) {\n            AbstractMapObjectDefaults.id = 0;\n        }\n        AbstractMapObjectDefaults.id++;\n        return this.getType() + \"-\" + AbstractMapObjectDefaults.id;\n    }\n}\nexport default AbstractMapObjectDefaults;","import AbstractMapObjectDefaults from \"./AbstractMapObjectDefaults\";\n\n/**\n * This class provide functions for using map object which can be identified by uniquie string.\n * \n * @author Jiri Hynek\n */\nclass AbstractMapObject {\n\n    /**\n     * It creates a map object.\n     */\n    constructor(props) {\n        // get defaults of the object\n        this.defaults = props != undefined && props.defaults != undefined ? props.defaults : this.createDefaults();\n        console.log(\"new object:\", this.defaults.getType());\n\n        // initialize defaults\n        this.defaults.initialize(this);\n\n        // create state of the object\n        this.state = props != undefined && props.state != undefined ? props.state : this.createState(props, this.defaults);\n\n        // initialize state\n        this.state.initialize(props, this.defaults);\n    }\n\n    /**\n     * It returns default values of the state properties.\n     * \n     * This function should not be overriden.\n     */\n    getDefaults() {\n        return this.defaults;\n    }\n\n    /**\n     * It creates new defaults of the object.\n     * \n     * This function can be overriden.\n     */\n    createDefaults() {\n        return new AbstractMapObjectDefaults();\n    }\n\n    /**\n     * It returns the tool state.\n     * \n     * This function should not be overriden.\n     */\n    getState() {\n        return this.state;\n    }\n\n    /**\n     * It creates new state if the object.\n     * \n     * This function can be overriden.\n     */\n    createState() {\n        return new AbstractMapObjectState();\n    }\n\n    /**\n     * Help function which returns the props given by the programmer.\n     * \n     * This function should not be overriden.\n     */\n    getProps() {\n        return this.state.getProps();\n    }\n\n    /**\n     * Help function which returns the type of the object.\n     */\n    getType() {\n        return this.state.getType();\n    }\n\n    /**\n     * Help function which returns the id of the object.\n     */\n    getId() {\n        return this.state.getId();\n    }\n}\nexport default AbstractMapObject;","/**\n * This class provides abstract event class.\n * \n * @author Jiri Hynek\n */\nclass AbstractEvent {\n\n    /**\n     * It initializes event.\n     */\n    constructor() {\n    }\n\n    /**\n     * Returns string which identifies the event.\n     */\n    getType() {\n        return undefined;\n    }\n\n    /**\n     * Return source object of the event.\n     */\n    getSource() {\n        return undefined;\n    }\n}\nexport default AbstractEvent;","import AbstractEvent from \"./AbstractEvent\";\n\n/**\n * This class provides abstract event class which .\n * \n * @author Jiri Hynek\n */\nclass AbstractObjectEvent extends AbstractEvent {\n\n    /**\n     * It initializes event.\n     */\n    constructor() {\n        super();\n    }\n\n    /**\n     * Return the changed object.\n     */\n    getObject() {\n        return undefined;\n    }\n}\nexport default AbstractObjectEvent;","import AbstractObjectEvent from \"../abstract/AbstractObjectEvent\";\n\n/**\n * This class provides generic event object.\n * \n * @author Jiri Hynek\n */\nclass GenericObjectEvent extends AbstractObjectEvent {\n\n    /**\n     * It initializes event.\n     */\n    constructor(type, source, object) {\n        super(type, source);\n        this.type = type;\n        this.source = source;\n        this.object = object;\n    }\n\n    /**\n     * Returns string which identifies the event.\n     */\n    getType() {\n        return this.type;\n    }\n\n    /**\n     * Return source object of the event.\n     */\n    getSource() {\n        return this.source;\n    }\n\n    /**\n     * Return the changed object.\n     */\n    getObject() {\n        return this.object;\n    }\n}\nexport default GenericObjectEvent;","import GenericObjectEvent from \"../generic/GenericObjectEvent\";\n\n\n/**\n * This class provides the theme change event.\n * \n * @author Jiri Hynek\n */\nclass DataChangeEvent extends GenericObjectEvent {\n\n    /**\n     * It initializes event.\n     */\n    constructor(source, data) {\n        super(DataChangeEvent.TYPE(), source, data);\n    }\n\n    /**\n     * Type of the event.\n     */\n    static TYPE() {\n        return \"data-change-event\";\n    }\n}\nexport default DataChangeEvent;","/**\n * This class manages state of the tool.\n * It wraps the state since the tool can work with state objects which needs to be explicitly serialized.\n * \n * @author Jiri Hynek\n */\nclass AbstractMapObjectState {\n\n    /**\n     * It creates a map object state.\n     */\n    constructor() {\n    }\n\n    /**\n     * It initializes the state using the initial props. Optionally, defaults can be set if property is undefined.\n     * \n     * @param {*} props \n     * @param {*} defaults \n     */\n    initialize(props, defaults) {\n        \n        // get default props if undefined\n        this.props = props != undefined ? props : defaults.getProps();\n        \n        // sets the type of the object (can be set only once in constructor)\n        this.setType(defaults.getType());\n\n        // set the id of the object (can be set only once in constructor)\n        this.setId(this.props.id == undefined && defaults ? defaults.getId() : this.props.id);\n\n        // resets the state\n        this.reset(defaults);\n    }\n\n    /**\n     * It resets the state to the initial props. Optionally, defaults can be set if property is undefined.\n     * \n     * @param {*} defaults \n     */\n    reset(defaults) {\n    }\n\n    /**\n     * It returns the props given by the programmer.\n     * \n     * This function should not be overriden.\n     */\n    getProps() {\n        return this.props;\n    }\n\n    /**\n     * The metod takes config and desrializes the values.\n     * \n     * @param {*} config \n     */\n    deserialize(config) {\n        if(config.id != undefined) this.setId(config.id);\n    }\n\n    /**\n     * The method serializes the tool state. Optionally, a serialed value can be let undefined if it equals the default value.\n     * \n     * @param {*} defaults \n     */\n    serialize(defaults) {\n        return {\n            type: this.getType(),\n            id: this.getId(),\n        }\n    }\n\n    /**\n     * It return props given by the programmer.\n     * \n     * This function should not be overriden.\n     */\n    getProps() {\n        return this.props;\n    }\n\n    /**\n     * It returns the type property of the tool state.\n     */\n    getType() {\n        return this.type;\n    }\n\n    /**\n     * It sets the type property of the tool state.\n     * It can be set only once.\n     * \n     * @param {*} type \n     */\n    setType(type) {\n       this.type = (this.type == undefined) ? type : this.type;\n    }\n\n    /**\n     * It returns the id property of the tool state.\n     */\n    getId() {\n        return this.id;\n    }\n\n    /**\n     * It sets the id property of the tool state.\n     * It can be set only once.\n     * \n     * @param {*} id \n     */\n    setId(id) {\n       this.id = (this.id == undefined) ? id : this.id;\n    }\n\n}\nexport default AbstractMapObjectState;\n","import AbstractMapObjectState from '../../object/abstract/AbstractMapObjectState';\r\n\r\n/**\r\n * This class manages state of the tool.\r\n * It wraps the state since the tool can work with state objects which needs to be explicitly serialized.\r\n * \r\n * @author Jiri Hynek\r\n */\r\nclass AbstractToolState extends AbstractMapObjectState {\r\n\r\n    /**\r\n     * It creates a map object state.\r\n     */\r\n    constructor() {\r\n        super();\r\n    }\r\n\r\n    /**\r\n     * Help function which reset state with respect to initial props. Optionally, defaults can be set if property is undefined.\r\n     * \r\n     * @param {*} defaults \r\n     */\r\n    reset(defaults) {\r\n        super.reset(defaults);\r\n\r\n        // set the enabled property \r\n        this.setEnabled(this.getProps().enabled == undefined && defaults ? defaults.isEnabled() : this.getProps().enabled);\r\n\r\n        // if map is set reset map variables \r\n        this.resetMapVariables(this.getMap(), defaults);\r\n    }\r\n\r\n    /**\r\n     * Help function which resets the state properties realated with map if not defined.\r\n     */\r\n    resetMapVariables(defaults) {\r\n    }\r\n\r\n    /**\r\n     * The metod takes config and desrializes the values.\r\n     * \r\n     * @param {*} config \r\n     */\r\n    deserialize(config) {\r\n        super.deserialize(config);\r\n\r\n        // tools properties\r\n        if(config.enabled != undefined) this.setEnabled(config.enabled);\r\n    }\r\n\r\n    /**\r\n     * The method serializes the tool state. Optionally, a serialed value can be let undefined if it equals the default value.\r\n     * \r\n     * @param {*} defaults \r\n     */\r\n    serialize(defaults) {\r\n        let config = super.serialize(defaults);\r\n\r\n        // tools properties\r\n        config.enabled = defaults && this.isEnabled() == this.getDefaults().isEnabled() ? undefined : this.isEnabled();\r\n        \r\n        return config;\r\n    }\r\n\r\n    /**\r\n     * It returns the enabled property of the tool state.\r\n     */\r\n    isEnabled() {\r\n        return this.enabled;\r\n    }\r\n\r\n    /**\r\n     * It sets the enabled property of tool state.\r\n     * \r\n     * @param {*} enabled \r\n     */\r\n    setEnabled(enabled) {\r\n       this.enabled = enabled;\r\n    }\r\n\r\n    /**\r\n     * It returns the map property of the tool state.\r\n     */\r\n    getMap() {\r\n        return this.map;\r\n    }\r\n\r\n    /**\r\n     * It sets the map property of the tool state.\r\n     * The map can be set only once.\r\n     * \r\n     * @param {*} map  \r\n     */\r\n    setMap(map) {\r\n       this.map = (this.map == undefined) ? map : this.map;\r\n    }\r\n}\r\nexport default AbstractToolState;","import AbstractMapObjectDefaults from \"../../object/abstract/AbstractMapObjectDefaults\";\n\n/**\n * This class provide functions which return the default state values.\n * \n * @author Jiri Hynek\n */\nclass AbstractToolDefaults extends AbstractMapObjectDefaults {\n\n    /**\n     * It creates tool defaults.\n     */\n    constructor() {\n        super();\n    }\n\n    /**\n     * It returns a logical value whether the tool type is singleton.\n     */\n    isSingleton() {\n       return false; \n    }\n\n    /**\n     * By default, the tool is enabled.\n     * \n     * @param {boolean} enabled \n     */\n    isEnabled() {\n        return true;\n    }\n\n    /**\n     * It returns default config if no config is given.\n     */\n    getConfig() {\n        return {};\n    }\n}\nexport default AbstractToolDefaults;","import AbstractToolState from \"./AbstractToolState\";\r\nimport AbstractEvent from \"../../event/abstract/AbstractEvent\";\r\nimport AbstractMapObject from \"../../object/abstract/AbstractMapObject\";\r\nimport AbstractToolDefaults from \"./AbstractToolDefaults\";\r\n\r\n/**\r\n * This class provides basic tools API.\r\n * \r\n * @author Jiri Hynek\r\n */\r\nclass AbstractTool extends AbstractMapObject {\r\n\r\n    /**\r\n     * It initializes the tool.\r\n     */\r\n    constructor(props) {\r\n        super(props);\r\n    }\r\n\r\n    /**\r\n     * It creates copy of the uninitialized tool.\r\n     * \r\n     * Override this function.\r\n     */\r\n    copy() {\r\n        return new AbstractTool(this.getProps());\r\n    }\r\n\r\n    /**\r\n     * It creates new defaults of the tool.\r\n     */\r\n    createDefaults() {\r\n        return new AbstractToolDefaults();\r\n    }\r\n\r\n    /**\r\n     * It returns default state of the tool which is used when no state is specified.\r\n     */\r\n    createState() {\r\n        return new AbstractToolState();\r\n    }\r\n\r\n    /**\r\n     * Help getter which returns a logtical value whether the tool type is singleton.\r\n     */\r\n    isSingleton() {\r\n       return this.getDefaults().isSingleton(); \r\n    }\r\n\r\n    /**\r\n     * Help getter which returns enabled property of state.\r\n     * \r\n     * Do not override this function. Use the state class instead.\r\n     */\r\n    isEnabled() {\r\n        return this.getState().isEnabled();\r\n    }\r\n\r\n    /**\r\n     * It initializes the tool before it is created.\r\n     * It processes the serialized config and sets the Geovisto map which manages the tools.\r\n     * \r\n     * This cannot be done in the tool constructor\r\n     * since the tool can be created before the Geovisto map is created.\r\n     * \r\n     * This cannot be done in the tool create function\r\n     * since there can be possible dependencies between the tools\r\n     * (the tool might depend on other tools which needs to be initialized).\r\n     * \r\n     * @param {GeovistoMap} map \r\n     * @param {any} config \r\n     */\r\n    initialize(map, config) {\r\n        // the map should not be undefined (this function is called only by GeovistoMap)\r\n        this.getState().setMap(map);\r\n\r\n        // it initializes map-related variables\r\n        this.getState().resetMapVariables(map, this.getDefaults());\r\n        \r\n        // override state by Geovisto config if specified in argument - this can happen only if:\r\n        // 1) the config of the same id was found\r\n        // 2) the tool was created as a copy of the generic tool (generic config)\r\n        this.getState().deserialize(config != undefined ? config : this.getDefaults().getConfig());\r\n    }\r\n\r\n    /**\r\n     * Help function returns map which uses this tool.\r\n     * \r\n     * Do not override this function. Use the state class instead.\r\n     * \r\n     * @returns {CombinedMap}\r\n     */\r\n    getMap() {\r\n        return this.getState().getMap();\r\n    }\r\n\r\n    /**\r\n     * It creates a tool.\r\n     * \r\n     * Override this function.\r\n     */\r\n    create() {\r\n    }\r\n\r\n    /**\r\n     * Some tools might be dynamicaly enabled/disabled.\r\n     * This function is called externally when the tool is enabled/disabled.\r\n     * \r\n     * Override this function, if needed.\r\n     * \r\n     * @param {boolean} enabled \r\n     */\r\n    setEnabled(enabled) {\r\n        if(this.isEnabled() != enabled) {\r\n            this.getState().setEnabled(enabled);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Help function which switches enabled state (enabled/disabled).\r\n     * \r\n     * Do not override this function. Use set enabled instead.\r\n     */\r\n    switchEnabled() {\r\n        // update settings\r\n        this.setEnabled(!this.enabled);\r\n    }\r\n\r\n    /**\r\n     * This function is called when a custom event is invoked.\r\n     * \r\n     * Override this function, if needed.\r\n     * \r\n     * @param {AbstractEvent} event\r\n     */\r\n    handleEvent(event) {\r\n    }\r\n}\r\nexport default AbstractTool;","import AbstractMapObject from \"./AbstractMapObject\";\n\n/**\n * This class provide functions for using map objects which can be identified by uniquie string.\n * \n * @author Jiri Hynek\n */\nclass AbstractMapObjectsManager {\n\n    /**\n     * It initializes a map objects manager.\n     */\n    constructor() {\n    }\n\n    /**\n     * The function returns available map objects.\n     * \n     * Override this function.\n     */\n    getObjects() {\n        return [];\n    }\n\n    /**\n     * The function returns the number of objects.\n     */\n    size() {\n        return this.getObjects().length;\n    }\n\n    /**\n     * The function returns true if size() is 0.\n     */\n    isEmpty() {\n        return this.getObjects().length == 0;\n    }\n\n    /**\n     * It adds object to the list of objects.\n     * \n     * Override this function.\n     * \n     * @param {AbstractMapObject} object \n     */\n    add(object) {\n    }\n\n    /**\n     * It removes object from the list of objects.\n     * \n     * Override this function.\n     * \n     * @param {AbstractMapObject} object \n     */\n    remove(object) {\n    }\n\n    /**\n     * It removes object from the list of objects.\n     * \n     * Override this function.\n     * \n     * @param {string} id \n     */\n    removeById(id) {\n    }\n\n    /**\n     * Help function which returns the list of object string labels (object types).\n     */\n    getTypes() {\n        let types = [];\n        let objects = this.getObjects();\n        if(objects != undefined) {\n            for(let i = 0; i < objects.length; i++) {\n                types.push(objects[i].getType());\n            }\n        }\n        return types;\n    }\n\n    /**\n     * Help function which returns the list of object string labels (object types).\n     */\n    getIds() {\n        let types = [];\n        let objects = this.getObjects();\n        if(objects != undefined) {\n            for(let i = 0; i < objects.length; i++) {\n                types.push(objects[i].getId());\n            }\n        }\n        return types;\n    }\n\n    /**\n     * The function returns map objects of given type.\n     * \n     * @param {string} type\n     */\n    getByType(type) {\n        let objects = this.getObjects();\n        let resultObjects = [];\n        if(objects != undefined) {\n            for(let i = 0; i < objects.length; i++) {\n                if(objects[i].getType() == type) {\n                    resultObjects.push(objects[i]);\n                }\n            }\n        }\n        return resultObjects;\n    }\n\n    /**\n     * The function returns map object of given unique identifier.\n     * \n     * @param {string} id\n     */\n    getById(id) {\n        let objects = this.getObjects();\n        if(objects != undefined) {\n            for(let i = 0; i < objects.length; i++) {\n                if(objects[i].getId() == id) {\n                    return objects[i];\n                }\n            }\n        }\n        return undefined;\n    }\n}\nexport default AbstractMapObjectsManager;","import AbstractMapManager from \"../../object/abstract/AbstractMapObjectsManager\";\n\n/**\n * This class provide functions for using tools.\n * \n * @author Jiri Hynek\n */\nclass AbstractToolsManager extends AbstractMapManager {\n\n    /**\n     * It initializes the tools manager.\n     */\n    constructor() {\n        super();\n    }\n\n    /**\n     * It returns copy of the tools manager with copies of tools.\n     */\n    copy() {\n        return new AbstractToolsManager();\n    }\n}\nexport default AbstractToolsManager;","import AbstractTool from \"../abstract/AbstractTool\";\nimport AbstractToolsManager from \"../abstract/AbstractToolsManager\";\n\n/**\n * This class provide functions for using tools.\n * \n * @author Jiri Hynek\n */\nclass ToolsManager extends AbstractToolsManager {\n\n    constructor(tools) {\n        super();\n        this.tools = tools;\n    }\n\n    /**\n     * The function returns available tools.\n     */\n    getObjects() {\n        return this.tools;\n    }\n\n    /**\n     * It returns copy of the tools manager with copies of tools.\n     */\n    copy() {\n        // we use copies of predefined tools due to later multiple imports of configs\n        let toolsCopy = [];\n        let tools = this.getObjects();\n        for(let i = 0; i < tools.length; i++) {\n            toolsCopy.push(tools[i].copy());\n        }\n        return new ToolsManager(toolsCopy);\n    }\n\n    /**\n     * It adds tool to the list of tools.\n     * \n     * @param {AbstractTool} tool \n     */\n    add(tool) {\n        this.tools.push(tool);\n    }\n\n    /**\n     * It removes tool from the list of tools.\n     * \n     * @param {AbstractTool} tool \n     */\n    remove(tool) {\n        this.tools = this.tools.filter(item => item != tool);\n    }\n\n    /**\n     * It removes tool from the list of tools.\n     * \n     * @param {string} id \n     */\n    removeById(id) {\n        this.tools = this.tools.filter(item => item.getId() != id);\n    }\n}\nexport default ToolsManager;","import SidebarTool from \"./SidebarTool\";\nimport AbstractToolDefaults from \"../../model/tool/abstract/AbstractToolDefaults\";\n\n/**\n * This class provide functions which return the default state values.\n * \n * @author Jiri Hynek\n */\nclass SidebarToolDefaults extends AbstractToolDefaults {\n\n    /**\n     * It creates a tool defaults.\n     */\n    constructor() {\n        super();\n    }\n\n    /**\n     * Only one sidebar tool should be present in the Geovisto map.\n     */\n    isSingleton() {\n       return true; \n    }\n\n    /**\n     * It returns a unique string of the tool type.\n     */\n    getType() {\n        return SidebarTool.TYPE();\n    }\n}\nexport default SidebarToolDefaults;","import SidebarToolDefaults from \"./SidebarToolDefaults\";\nimport AbstractToolState from \"../../model/tool/abstract/AbstractToolState\";\n\n/**\n * This class provide sidebar tool model.\n * \n * @author Jiri Hynek\n */\nclass SidebarToolState extends AbstractToolState {\n\n    /**\n     * It creates a tool state.\n     */\n    constructor() {\n        super();\n    }\n\n    /**\n     * It resets state with respect to initial props. Optionally, defaults can be set if property is undefined.\n     * \n     * @param {SidebarToolDefaults} defaults \n     */\n    reset(defaults) {\n        super.reset(defaults);\n\n        // tabs will be added by using addTab function.\n        this.tabs = [];\n    }\n\n    /**\n     * The metod takes config and desrializes the values.\n     * \n     * @param {*} config \n     */\n    deserialize(config) {\n        super.deserialize(config);\n\n        // original tabs desriptions are needed during tool creation.\n        this.tabsDecriptions = config.tabs;\n    }\n\n    /**\n     * The method serializes the tool configuration. Optionally, defaults can be set if property is undefined.\n     * \n     * @param {SidebarToolDefaults} defaults\n     */\n    serialize(defaults) {\n        let config = super.serialize(defaults);\n\n        // serialize sidebar tabs\n        config.tabs = [];\n        for(let i = 0; i < this.tabs.length; i++) {\n            config.tabs.push(this.tabs[i].getState().serialize())\n        }\n\n        return config;\n    }\n\n    /**\n     * It returns the tabs descriptions.\n     */\n    getTabsDescriptions() {\n        return this.tabsDecriptions;\n    }\n\n    /**\n     * It returns the sidebar.\n     */\n    getSidebar() {\n        return this.sidebar;\n    }\n\n    /**\n     * It sets sidebar.\n     * \n     * @param {*} sidebar \n     */\n    setSidebar(sidebar) {\n        this.sidebar = sidebar;\n    }\n\n    /**\n     * It returns the tabs controls.\n     */\n    getTabs() {\n        return this.tabs;\n    }\n\n    /**\n     * It sets the tabs property of the tool state.\n     * \n     * @param {*} tab\n     */\n    addTab(tab) {\n        this.tabs.push(tab)\n    }\n\n    /**\n     * It removes tab from the list of tabs.\n     * \n     * @param {*} tab \n     */\n    removeTab(tab) {\n        const index = array.indexOf(tab);\n        if (index > -1) {\n            array.splice(index, 1);\n        }\n    }\n}\nexport default SidebarToolState;","// external libs\nimport L from 'leaflet';\nimport \"leaflet-sidebar-v2\";\nimport \"leaflet-sidebar-v2/css/leaflet-sidebar.min.css\";\n\n// styles\nimport \"./styles/style.scss\";\n\nimport SidebarToolState from \"./SidebarToolState\";\nimport SidebarToolDefaults from \"./SidebarToolDefaults\";\nimport AbstractTool from \"../../model/tool/abstract/AbstractTool\";\n\n/**\n * This class provides the sidebar tool.\n *\n * @author Jiri Hynek\n */\nclass SidebarTool extends AbstractTool {\n\n    /**\n     * It creates a new tool with respect to the props.\n     *\n     * @param {*} props\n     */\n    constructor(props) {\n        super(props);\n    }\n\n    /**\n     * A unique string of the tool type.\n     */\n    static TYPE() {\n        return \"geovisto-tool-sidebar\";\n    }\n\n    /**\n     * It creates a copy of the uninitialized tool.\n     */\n    copy() {\n        return new SidebarTool(this.getProps());\n    }\n\n    /**\n     * It creates new defaults of the tool.\n     */\n    createDefaults() {\n        return new SidebarToolDefaults();\n    }\n\n    /**\n     * It returns default tool state.\n     */\n    createState() {\n        return new SidebarToolState();\n    }\n\n    /**\n     * It creates sidebar.\n     */\n    create() {\n        super.create();\n        this.createSidebar();\n        this.createTabs();\n        return this;\n    }\n\n    createSidebar() {\n        if(this.isEnabled()) {\n            let sidebar = undefined;\n            // create sidebar control and add it to the map\n            sidebar = L.control.sidebar(this.getSidebarStructure()).addTo(this.getMap().getState().getLeafletMap());\n            // update state\n            this.getState().setSidebar(sidebar);\n        }\n    }\n\n    /**\n     * It returns structure of sidebar defined with respect to the leaflet-sidebar-v2 plugin specification.\n     *\n     * See: https://github.com/noerw/leaflet-sidebar-v2\n     */\n    getSidebarStructure() {\n        return {\n            autopan: false,\n            closeButton: true,\n            //container: 'sidebar'\n            position: 'left',\n        };\n    }\n\n    /**\n     * It returns sidebar tabs.\n     */\n    getTabs() {\n        let tabs = this.getState().getTabs();\n        if(tabs == undefined) {\n            this.createTabs();\n        }\n\n        return tabs;\n    }\n\n    /**\n     * It returns sidebar tabs.\n     */\n    createTabs() {\n        // import tabs\n        if(this.getState().getTabsDescriptions() != undefined) {\n            let tabsConfigs = this.getState().getTabsDescriptions();\n            // based on config\n            let tabConfig, tool;\n            for(let i = 0; i < tabsConfigs.length; i++) {\n                tabConfig = tabsConfigs[i];\n                tool = this.getMap().getState().getTools().getById(tabConfig.tool);\n                this.createSidebarTab(tool, tabConfig);\n            }\n        } else {\n            // based on the implicit order of the tools in the list of the tools\n            let tools = this.getMap().getState().getTools().getObjects();\n            for(let i = 0; i < tools.length; i++) {\n                this.createSidebarTab(tools[i], undefined);\n            }\n        }\n    }\n\n    /**\n     * Help function which initializes and creates sidebar tab for a tool with respect to a given config.\n     *\n     * @param {*} tool\n     * @param {*} config\n     */\n    createSidebarTab(tool, config) {\n        if(tool != undefined && tool.getSidebarTabControl) {\n            // the tool implements the getSidebarTab function\n            let sidebarTabControl = tool.getSidebarTabControl();\n            if(sidebarTabControl != undefined) {\n                // render sidebar\n                sidebarTabControl.initialize(this.getState().getSidebar(), config);\n                sidebarTabControl.create();\n                // update state\n                this.getState().addTab(sidebarTabControl);\n            }\n        }\n    }\n\n}\nexport default SidebarTool;\n","/**\n * Class wraps help static function which generates DOM nodes.\n * \n * @author Jiri Hynek\n */\nclass TabDOMUtil {\n\n    /**\n     * Function generates select div node.\n     * \n     * @param {*} label \n     * @param {*} id \n     * @param {*} action \n     * @param {*} options \n     */\n    static createSelectDiv(label, id, action, options) {\n        let div = document.createElement('div');\n        if(label != null) {\n            div.appendChild(document.createTextNode(label + \": \"))\n        }\n        div.appendChild(TabDOMUtil.createSelect(id, action, options));\n        return div;\n    }\n\n    /**\n     * Function generates select node.\n     * \n     * @param {*} id \n     * @param {*} action \n     * @param {*} options \n     * @param {*} className \n     */\n    static createSelect(id, action, options, className) {\n        let select = document.createElement('select');\n        select.setAttribute(\"id\", id);\n        if(className) {\n            select.classList.add(className);\n        }\n        select.onchange = action;\n        TabDOMUtil.appendOptions(select, options);\n        return select;\n    }\n\n    /**\n     * Function genearates option nodes.\n     * \n     * @param {*} select \n     * @param {*} options \n     */\n    static appendOptions(select, options) {\n        let option;\n        for(let i = 0; i < options.length; i++) {\n            option = select.appendChild(document.createElement(\"option\"));\n            option.setAttribute(\"value\", options[i]);\n            option.innerHTML = options[i];\n        }\n    }\n\n    /**\n     * Function generates input text node.\n     * \n     * @param {*} size \n     * @param {*} className \n     */\n    static createTextInput(size, className) {\n        let input = document.createElement('input');\n        input.setAttribute(\"type\", \"text\");\n        if(size) {\n            input.setAttribute(\"size\", size);\n        }\n        if(className) {\n            input.classList.add(className);\n        }\n        return input;\n    }\n\n    /**\n     * Function generates button node.\n     * \n     * @param {*} label \n     * @param {*} action \n     */\n    static createButton(label, action, id) {\n        let btn = document.createElement('button');\n        btn.setAttribute(\"type\", \"button\");\n        btn.setAttribute(\"id\", id);\n        btn.innerHTML = label;\n        btn.onclick = action;\n        return btn;\n    }\n\n    /**\n     * Function generates label heading node.\n     * \n     * @param {*} label \n     */\n    static createSidebarHeading(label) {\n        let heading = document.createElement('strong');\n        heading.innerHTML = label;\n        return heading;\n    }\n\n\n    /*\n     * Sets multiple element attributes\n     */\n    static setAttributes(element, keyArray, valueArray){\n        if (keyArray.length == valueArray.length) {\n            for (var i = keyArray.length - 1; i >= 0; i--) {\n                element.setAttribute(keyArray[i], valueArray[i]);\n            }\n        }\n    }\n}\n\nexport default TabDOMUtil;","const ID = 'geovisto-input';\n\n/**\n * This class represents abstract sidebar input.\n *\n * This class is intended to be extended.\n *\n * @author Jiri Hynek\n */\nclass AbstractSidebarInput {\n  constructor(settings) {\n    this.action = settings.action;\n    this.input = undefined;\n  }\n\n  /**\n   * Static function returns identifier of the input type.\n   */\n  static ID() {\n    return ID;\n  }\n\n  /**\n   * It returns input element.\n   *\n   * This function is intended to be extended.\n   */\n  create() {\n    if (this.input == undefined) {\n      this.input = document.createElement('span');\n    }\n    return this.input;\n  }\n\n  /*\n   * Sets/removes attribute 'disabled' from input box.\n   */\n  setDisabled(disabled) {\n    if (this.input === undefined) return;\n    if (disabled == true) {\n      this.input.setAttribute('disabled', true);\n    }\n    if (disabled == false) {\n      this.input.removeAttribute('disabled');\n    }\n  }\n\n  /**\n   * It returns value of the input element.\n   */\n  getValue() {\n    return this.input.value;\n  }\n\n  /**\n   * It sets value of the input element.\n   *\n   * @param {*} value\n   */\n  setValue(value) {\n    this.input.value = value;\n  }\n}\nexport default AbstractSidebarInput;\n","import AbstractSidebarInput from '../AbstractSidebarInput';\r\nimport TabDOMUtil from '../../util/TabDOMUtil';\r\n\r\nconst ID = 'geovisto-input-autocomplete';\r\n\r\nconst COMPONENT_DIV_LABEL_CLASS = ID + '-label';\r\n\r\nconst COMPONENT_DIV_INPUT_CLASS = ID + '-component';\r\n\r\nconst COMPONENT_INPUT_CLASS = ID + '-value';\r\n\r\nconst COMPONENT_COMPLETION_LIST_CLASS = ID + '-popup';\r\n\r\nconst COMPONENT_COMPLETION_ITEM_CLASS = ID + '-option-m';\r\n\r\nconst COMPONENT_COMPLETION_NOT_IN_CLASS = ID + '-option-n';\r\n\r\nconst COMPONENT_COMPLETION_ACTIVE_ITEM_CLASS = ID + '-option-a';\r\n\r\n/**\r\n * This class represents labeled text sidebar input with autocomplete.\r\n *\r\n * @author Jakub Kachlik\r\n * @author Jiri Hynek (refactoring, code review)\r\n */\r\nclass AutocompleteSidebarInput extends AbstractSidebarInput {\r\n  constructor(settings) {\r\n    super(settings);\r\n\r\n    // settings\r\n    this.options = settings.options;\r\n    this.label = settings.label;\r\n    this.setData = settings.setData;\r\n\r\n    this.placeholder = settings.placeholder;\r\n    this.inputValue = settings.value;\r\n\r\n    // div elements\r\n    this.formDiv = undefined;\r\n    this.inputDiv = undefined;\r\n    this.completionListDiv = undefined;\r\n\r\n    // index of selected item in the completion list\r\n    this.selectedCompletionItem = -1;\r\n  }\r\n\r\n  /**\r\n   * Static function returns identifier of the input type.\r\n   */\r\n  static ID() {\r\n    return ID;\r\n  }\r\n\r\n  /*\r\n   * Sets/removes attribute 'disabled' from input box.\r\n   */\r\n  setDisabled(disabled) {\r\n    if (disabled == true) {\r\n      this.input.setAttribute('disabled', true);\r\n    }\r\n    if (disabled == false) {\r\n      this.input.removeAttribute('disabled');\r\n    }\r\n  }\r\n\r\n  /*\r\n   * Changes options for the completion list.\r\n   */\r\n  changeOptions(newOptions) {\r\n    this.options = newOptions;\r\n    this.redrawMenu();\r\n  }\r\n\r\n  /*\r\n   * Divides options into the two groups (matched and not matched values) with respect to the currently selected input.\r\n   */\r\n  getCurrentOptions() {\r\n    let matchArray = [];\r\n    let notMatchArray = [];\r\n    for (let i = 0; i < this.options.length; i++) {\r\n      if (new String(this.options[i]).includes(this.input.value)) {\r\n        matchArray.push(this.options[i]);\r\n      } else {\r\n        notMatchArray.push(this.options[i]);\r\n      }\r\n    }\r\n    return { match: matchArray, other: notMatchArray };\r\n  }\r\n\r\n  /*\r\n   * Creates whole autocomplete element including autocomplete box description and listeners.\r\n   */\r\n  create() {\r\n    // create form\r\n    this.createForm();\r\n\r\n    // create listeners\r\n    this.createListeners();\r\n\r\n    return this.formDiv;\r\n  }\r\n\r\n  /*\r\n   * Creates input elements.\r\n   */\r\n  createForm() {\r\n    // div for the whole autocomplete component\r\n    this.formDiv = document.createElement('div');\r\n    this.formDiv.classList.add(ID);\r\n\r\n    // label div\r\n    let labelDiv = document.createElement('div');\r\n    labelDiv.classList.add(COMPONENT_DIV_LABEL_CLASS);\r\n    labelDiv.innerHTML = this.label;\r\n\r\n    // input div\r\n    this.inputDiv = document.createElement('div');\r\n    this.inputDiv.classList.add(COMPONENT_DIV_INPUT_CLASS);\r\n\r\n    // input\r\n    this.input = document.createElement('input');\r\n    TabDOMUtil.setAttributes(\r\n      this.input,\r\n      ['class', 'type', 'placeholder', 'type', 'value'],\r\n      [\r\n        COMPONENT_INPUT_CLASS,\r\n        'text',\r\n        this.placeholder || 'choose dimension: ',\r\n        'hidden',\r\n        this.inputValue || '',\r\n      ],\r\n    );\r\n\r\n    // construct elements\r\n    this.formDiv.appendChild(labelDiv);\r\n    this.formDiv.appendChild(this.inputDiv);\r\n    this.inputDiv.appendChild(this.input);\r\n  }\r\n\r\n  /**\r\n   * Creates event listeners and creates/removes\r\n   */\r\n  createListeners() {\r\n    var _this = this;\r\n\r\n    // when input changed, notify listeners\r\n    this.input.onchange = this.action;\r\n\r\n    // input change listener: create autocomplete and find\r\n    this.input.addEventListener('input', function (e) {\r\n      _this.createMenu();\r\n    });\r\n\r\n    // focus-in listener: create autocomplete\r\n    this.input.addEventListener('focusin', function (e) {\r\n      _this.createMenu();\r\n    });\r\n\r\n    // key-up/down listener\r\n    this.input.addEventListener(\r\n      'keydown',\r\n      function (e) {\r\n        if (_this.completionListDiv != undefined) {\r\n          let completionItems = _this.completionListDiv.children;\r\n\r\n          // remove active completion item\r\n          if (\r\n            _this.selectedCompletionItem != -1 &&\r\n            completionItems[_this.selectedCompletionItem] != undefined\r\n          ) {\r\n            completionItems[_this.selectedCompletionItem].classList.remove(\r\n              COMPONENT_COMPLETION_ACTIVE_ITEM_CLASS,\r\n            );\r\n          }\r\n\r\n          // process key codes\r\n          if (e.keyCode == 40) {\r\n            // key Arrow down -> next item (checks array overflow)\r\n            _this.selectedCompletionItem =\r\n              (_this.selectedCompletionItem + 1) % completionItems.length;\r\n            e.preventDefault();\r\n          } else if (e.keyCode == 38) {\r\n            // key Arrow up -> previous item (checks array overflow)\r\n            if (_this.selectedCompletionItem == -1) {\r\n              _this.selectedCompletionItem = 0; // initial move\r\n            }\r\n            _this.selectedCompletionItem =\r\n              (_this.selectedCompletionItem + completionItems.length - 1) % completionItems.length;\r\n            e.preventDefault();\r\n          } else if (e.keyCode == 13 && _this.selectedCompletionItem != -1) {\r\n            // key Enter\r\n            this.value = completionItems[_this.selectedCompletionItem].textContent;\r\n            _this.completionListDiv.remove();\r\n            _this.selectedCompletionItem != -1;\r\n            if (_this.setData) {\r\n              _this.setData(this.value);\r\n            } else {\r\n              // input on change event needs to be invoked manualy in this case\r\n              this.dispatchEvent(new Event('change'));\r\n            }\r\n          } else if (e.keyCode == 27 || e.keyCode == 9) {\r\n            // key Escape or Tab\r\n            _this.completionListDiv.remove();\r\n            _this.selectedCompletionItem != -1;\r\n          }\r\n\r\n          // set new active item\r\n          if (completionItems[_this.selectedCompletionItem] != undefined) {\r\n            completionItems[_this.selectedCompletionItem].classList.add(\r\n              COMPONENT_COMPLETION_ACTIVE_ITEM_CLASS,\r\n            );\r\n          }\r\n\r\n          return false;\r\n        }\r\n      },\r\n      false,\r\n    );\r\n\r\n    // click litener: click outside the input\r\n    document.addEventListener('click', function (e) {\r\n      // note: there is one listener for every input\r\n      if (_this.completionListDiv != undefined && e.target != _this.input) {\r\n        _this.completionListDiv.remove();\r\n        _this.selectedCompletionItem != -1;\r\n      }\r\n    });\r\n  }\r\n\r\n  redrawMenu() {\r\n    this.createMenu();\r\n  }\r\n\r\n  /*\r\n   * Creates and open MatchItems in PopUpList and set value according chosen input.\r\n   */\r\n  createMenu() {\r\n    var _this = this;\r\n\r\n    // if PopUpList already exist delete old one\r\n    if (this.completionListDiv != undefined) {\r\n      this.completionListDiv.remove();\r\n    }\r\n\r\n    // create completion list\r\n    this.completionListDiv = document.createElement('div');\r\n    this.completionListDiv.classList.add(COMPONENT_COMPLETION_LIST_CLASS);\r\n\r\n    // help function which creates completion item\r\n    let createCompletionItem = function (label, className) {\r\n      // create item\r\n      let completionItemDiv = document.createElement('div');\r\n      completionItemDiv.innerHTML = label;\r\n      completionItemDiv.classList.add(className);\r\n\r\n      // add it to completion list div\r\n      _this.completionListDiv.appendChild(completionItemDiv);\r\n\r\n      // on click listener: the item has been selected\r\n      completionItemDiv.addEventListener('click', function (e) {\r\n        _this.input.value = completionItemDiv.textContent;\r\n        completionItemDiv.parentElement.remove();\r\n        if (_this.setData) {\r\n          _this.setData(completionItemDiv.textContent);\r\n        } else {\r\n          // input on change event needs to be invoked manualy in this case\r\n          _this.input.dispatchEvent(new Event('change'));\r\n        }\r\n      });\r\n    };\r\n\r\n    // create new completion item for every matched and not matched path\r\n    var currentOptions = this.getCurrentOptions();\r\n    currentOptions.match.forEach((element) =>\r\n      createCompletionItem(element, COMPONENT_COMPLETION_ITEM_CLASS),\r\n    );\r\n    currentOptions.other.forEach((element) =>\r\n      createCompletionItem(element, COMPONENT_COMPLETION_NOT_IN_CLASS),\r\n    );\r\n\r\n    // append completion list\r\n    this.inputDiv.appendChild(this.completionListDiv);\r\n\r\n    // reset selection\r\n    _this.selectedCompletionItem = -1;\r\n  }\r\n}\r\nexport default AutocompleteSidebarInput;\r\n","import AbstractSidebarInput from \"../AbstractSidebarInput\";\nimport AutocompleteSidebarInput from \"../input/AutocompleteSidebarInput\";\n\nconst ID = \"geovisto-input-filter-autocomplete\";\n\nconst COMPONENT_DIV_CLASS = ID;\n/**\n * This class represents sidebar input composed of three autocomplete inputs used for filters.\n * \n * @author Jakub Kachlik\n * @author Jiri Hynek (refactoring, code review)\n */\nclass FilterAutocompleteSidebarInput extends AbstractSidebarInput {\n\n    constructor(settings) {\n        super(settings);\n\n        // model\n        this.dataModel = settings.data;\n        this.opModel = settings.ops;\n        this.valModel = settings.vals;\n\n        // inputs\n        this.dataInput = undefined;\n        this.opInput = undefined;\n        this.valInput = undefined;\n    } \n\n    static ID(){\n        return ID;\n    }\n\n    create() {\n        if(this.input == undefined) {\n            // create parent div\n            this.input = document.createElement(\"div\");\n            this.input.classList.add(COMPONENT_DIV_CLASS);\n\n            // initialize filter inputs\n            this.valInput = new AutocompleteSidebarInput({ label: \"Value\", options: [], action: this.valModel.action });\n            this.opInput = new AutocompleteSidebarInput({ label: \"Operation\", options: this.opModel.options, action: this.opModel.action });                        \n            this.dataInput = new AutocompleteSidebarInput({ label: \"Data\", options: this.dataModel.options, action: this.dataModel.action });\n\n            // create elements of filter inputs and add them to parent div\n            this.input.appendChild(this.dataInput.create());\n            this.input.appendChild(this.opInput.create());\n            this.input.appendChild(this.valInput.create());\n        }\n\n        return this.input;\n    }\n\n    /**\n     * It returns values of the inputs.\n     */\n    getValue() {\n        return {\n            data: this.dataInput.getValue(),\n            op: this.opInput.getValue(),\n            val: this.valInput.getValue(),\n        };\n    }\n\n    /**\n     * It sets values of the inputs.\n     * \n     * @param {*} value \n     */\n    setValue(value) {\n        this.dataInput.setValue(value.data);\n        this.opInput.setValue(value.op);\n        this.valInput.setValue(value.val);\n    }\n}\nexport default FilterAutocompleteSidebarInput","import AbstractSidebarInput from '../AbstractSidebarInput';\n\nconst ID = 'geovisto-input-text';\n\n/**\n * This class represents basic text sidebar input.\n *\n * @author Jiri Hynek\n */\nclass TextSidebarInput extends AbstractSidebarInput {\n  constructor(settings) {\n    super(settings);\n    this.value = settings.value;\n  }\n\n  /**\n   * Static function returns identifier of the input type.\n   */\n  static ID() {\n    return ID;\n  }\n\n  /**\n   * It returns input element.\n   */\n  create() {\n    if (this.input == undefined) {\n      this.input = document.createElement('input');\n      this.input.setAttribute('type', 'text');\n      this.input.onchange = this.action;\n      if (this.value) this.input.value = this.value;\n    }\n    return this.input;\n  }\n\n  /**\n   * It returns value of the input element.\n   */\n  getValue() {\n    return this.input.value;\n  }\n\n  /**\n   * It sets value of the input element.\n   *\n   * @param {*} value\n   */\n  setValue(value) {\n    this.input.value = value;\n  }\n}\nexport default TextSidebarInput;\n","import AbstractSidebarInput from '../AbstractSidebarInput';\r\n\r\nconst ID = 'geovisto-input-text-area-labeled';\r\n\r\n/**\r\n * This class represents basic text sidebar input.\r\n *\r\n * @author Andrej Tlcina\r\n */\r\nclass LabeledTextAreaSidebarInput extends AbstractSidebarInput {\r\n  constructor(settings) {\r\n    super(settings);\r\n    this.label = settings.label;\r\n    this.value = settings.value;\r\n    this.div = undefined;\r\n  }\r\n\r\n  /**\r\n   * Static function returns identifier of the input type.\r\n   */\r\n  static ID() {\r\n    return ID;\r\n  }\r\n\r\n  /**\r\n   * It returns input element.\r\n   */\r\n  create() {\r\n    if (this.div == undefined) {\r\n      this.input = document.createElement('textarea');\r\n      // create div block\r\n      this.div = document.createElement('div');\r\n      // append label\r\n      if (this.label != undefined) {\r\n        this.div.appendChild(document.createTextNode(this.label + ': '));\r\n      }\r\n\r\n      if (this.value) {\r\n        this.input.value = this.value;\r\n      }\r\n\r\n      // append input element\r\n      this.div.appendChild(this.input);\r\n\r\n      this.input.onchange = this.action;\r\n    }\r\n    return this.div;\r\n  }\r\n\r\n  /**\r\n   * It returns value of the input element.\r\n   */\r\n  getValue() {\r\n    return this.input.value;\r\n  }\r\n\r\n  /**\r\n   * It sets value of the input element.\r\n   *\r\n   * @param {*} value\r\n   */\r\n  setValue(value) {\r\n    this.input.value = value;\r\n  }\r\n}\r\nexport default LabeledTextAreaSidebarInput;\r\n","import TextSidebarInput from \"./TextSidebarInput\";\n\nconst ID = \"geovisto-input-text-labeled\";\n\n/**\n * This class represents labeled text sidebar input.\n * \n * @author Jiri Hynek\n */\nclass LabeledTextSidebarInput extends TextSidebarInput {\n\n    constructor(settings) {\n        super(settings);\n        this.label = settings.label;\n        this.div = undefined;\n    }\n\n    /**\n     * Static function returns identifier of the input type.\n     */\n    static ID() {\n        return ID;\n    }\n\n    /**\n     * It returns input element.\n     */\n    create() {\n        if(this.div == undefined) {\n            // create input element\n            super.create();\n\n            // create div block\n            this.div = document.createElement(\"div\");\n\n            // append label\n            if(this.label != undefined) {\n                this.div.appendChild(document.createTextNode(this.label + \": \"))\n            }\n\n            // append input element\n            this.div.appendChild(this.input);\n        }\n        \n        return this.div;\n    }\n\n}\nexport default LabeledTextSidebarInput;","import AbstractSidebarInput from '../input/TextSidebarInput';\n\nconst ID = 'geovisto-input-select';\n\n/**\n * This class represents basic select sidebar input composed of options.\n *\n * @author Jiri Hynek\n */\nclass SelectSidebarInput extends AbstractSidebarInput {\n  constructor(settings) {\n    super(settings);\n    this.options = settings.options;\n    this.value = settings.value;\n  }\n\n  /**\n   * Static function returns identifier of the input type\n   */\n  static ID() {\n    return ID;\n  }\n\n  /**\n   * It returns select element.\n   */\n  create() {\n    if (this.element == undefined) {\n      // create select element\n      this.element = document.createElement('select');\n      this.element.onchange = this.action;\n      // append options\n      let option;\n      for (let i = 0; i < this.options.length; i++) {\n        option = this.element.appendChild(document.createElement('option'));\n        if (typeof this.options[i] === 'object' && this.options[i] !== null) {\n          option.setAttribute('value', this.options[i].value);\n          option.innerHTML = this.options[i].label;\n          option.selected = Boolean(this.options[i].selected);\n        } else {\n          option.setAttribute('value', this.options[i]);\n          option.innerHTML = this.options[i];\n        }\n      }\n      if (this.value) this.element.value = this.value;\n    }\n    return this.element;\n  }\n\n  /*\n   * Sets/removes attribute 'disabled' from input box.\n   */\n  setDisabled(disabled) {\n    if (this.element === undefined) return;\n    if (disabled == true) {\n      this.element.setAttribute('disabled', true);\n    }\n    if (disabled == false) {\n      this.element.removeAttribute('disabled');\n    }\n  }\n\n  /**\n   * It returns value of the select element.\n   */\n  getValue() {\n    return this.element.value;\n  }\n\n  /**\n   * It sets value of the select element.\n   *\n   * @param {*} value\n   */\n  setValue(value) {\n    this.element.value = value;\n  }\n}\nexport default SelectSidebarInput;\n","import SelectSidebarInput from \"./SelectSidebarInput\";\n\nconst ID = \"geovisto-input-select-labeled\";\n\n/**\n * This class represents basic select sidebar input composed of options.\n * \n * @author Jiri Hynek\n */\nclass LabeledSelectSidebarInput extends SelectSidebarInput {\n\n    constructor(settings) {\n        super(settings);\n        this.label = settings.label;\n        this.div = undefined;\n    }\n    \n    /**\n     * Static function returns identifier of the input type\n     */\n    static ID() {\n        return ID;\n    }\n\n    /**\n     * It returns select element.\n     */\n    create() {\n        if(this.div == undefined) {\n            // create select element\n            super.create();\n\n            // create div block\n            this.div = document.createElement(\"div\");\n\n            // append label\n            if(this.label != undefined) {\n                this.div.appendChild(document.createTextNode(this.label + \": \"))\n            }\n\n            // append select element\n            this.div.appendChild(this.element);\n        }\n        \n        return this.div;\n    }\n}\nexport default LabeledSelectSidebarInput;","import AbstractSidebarInput from \"../AbstractSidebarInput\";\n\nconst ID = \"geovisto-input-filter-select\";\n\nconst COMPONENT_DIV_CLASS = ID;\n\n/**\n * This class represents sidebar input composed of three selects used for filters.\n * \n * @author Jiri Hynek\n */\nclass FilterSelectSidebarInput extends AbstractSidebarInput {\n\n    constructor(settings) {\n        super(settings);\n\n        // model\n        this.dataModel = settings.data;\n        this.opModel = settings.ops;\n\n        // inputs\n        this.dataInput = undefined;\n        this.opInput = undefined;\n        this.valInput = undefined;\n    }\n    \n    /**\n     * Static function returns identifier of the input type\n     */\n    static ID() {\n        return ID;\n    }\n\n    /**\n     * It returns select element.\n     */\n    create() {\n        if(this.input == undefined) {\n            // create inline container\n            this.input = document.createElement(\"div\");\n            this.input.classList.add(COMPONENT_DIV_CLASS);\n            this.valInput = this.createInputElement();\n            this.opInput = this.createSelectElement(function() { /* do nothing */ }, this.opModel.options);\n            this.dataInput = this.createSelectElement(function(){ /* TODO: update options of other inputs */}, this.dataModel.options);\n\n            // data select element\n            this.input.appendChild(this.dataInput);\n\n            // data op element\n            this.input.appendChild(this.opInput);\n\n            // data val element\n            this.input.appendChild(this.valInput);\n        }\n        return this.input;\n    }\n    \n    /**\n     * Help static function which creates select element.\n     * \n     * @param {*} action \n     * @param {*} options \n     */\n    createSelectElement(action, options) {\n        // create select element\n        let select = document.createElement('select');\n        select.onchange = action;\n        // append options\n        let option;\n        for(let i = 0; i < options.length; i++) {\n            option = select.appendChild(document.createElement(\"option\"));\n            option.setAttribute(\"value\", options[i]);\n            option.innerHTML = options[i];\n        }\n        return select;\n    }\n\n    /**\n     * Help static function which creates select element.\n     * \n     * @param {*} action \n     * @param {*} options \n     */\n    createInputElement() {\n        // create input element\n        let input = document.createElement('input');\n        input.setAttribute(\"type\", \"text\");\n        input.setAttribute(\"size\", 10);\n        return input\n    }\n\n    /**\n     * It returns values of the inputs.\n     */\n    getValue() {\n        return {\n            data: this.dataInput.value,\n            op: this.opInput.value,\n            val: this.valInput.value,\n        };\n    }\n\n    /**\n     * It sets values of the inputs.\n     * \n     * @param {*} value \n     */\n    setValue(value) {\n        this.dataInput.value = value.data;\n        this.opInput.value = value.op;\n        this.valInput.value = value.val;\n    }\n}\nexport default FilterSelectSidebarInput;","import AbstractSidebarInput from './AbstractSidebarInput';\nimport TextSidebarInput from './input/TextSidebarInput';\nimport LabeledTextAreaSidebarInput from './input/LabeledTextAreaSidebarInput';\nimport LabeledTextSidebarInput from './input/LabeledTextSidebarInput';\nimport SelectSidebarInput from './select/SelectSidebarInput';\nimport LabeledSelectSidebarInput from './select/LabeledSelectSidebarInput';\nimport FilterSelectSidebarInput from './filter/FilterSelectSidebarInput';\nimport FilterAutocompleteSidebarInput from './filter/FilterAutocompleteSidebarInput';\nimport AutocompleteSidebarInput from './input/AutocompleteSidebarInput';\n/**\n * Factory for sidebar inputs.\n *\n * @author Jiri Hynek\n */\nclass SidebarInputFactory {\n  /**\n   * Static function creates new sidebar input of given identifier.\n   *\n   * @param {*} id\n   */\n  static createSidebarInput(id, settings) {\n    let element = null;\n    if (id == TextSidebarInput.ID()) {\n      element = new TextSidebarInput(settings);\n    } else if (id == LabeledTextSidebarInput.ID()) {\n      element = new LabeledTextSidebarInput(settings);\n    } else if (id == LabeledTextAreaSidebarInput.ID()) {\n      element = new LabeledTextAreaSidebarInput(settings);\n    } else if (id == SelectSidebarInput.ID()) {\n      element = new SelectSidebarInput(settings);\n    } else if (id == LabeledSelectSidebarInput.ID()) {\n      element = new LabeledSelectSidebarInput(settings);\n    } else if (id == FilterSelectSidebarInput.ID()) {\n      element = new FilterSelectSidebarInput(settings);\n    } else if (id == AutocompleteSidebarInput.ID()) {\n      element = new AutocompleteSidebarInput(settings);\n    } else if (id == FilterAutocompleteSidebarInput.ID()) {\n      element = new FilterAutocompleteSidebarInput(settings);\n    } else {\n      element = new AbstractSidebarInput(settings);\n    }\n    return element;\n  }\n}\n\nexport default SidebarInputFactory;\n","import AbstractMapObjectDefaults from \"../../../../model/object/abstract/AbstractMapObjectDefaults\";\n\n/**\n * This class provide functions which return the default state values.\n * \n * @author Jiri Hynek\n */\nclass AbstractTabControlDefaults extends AbstractMapObjectDefaults {\n\n    /**\n     * It creates map defaults.\n     */\n    constructor() {\n        super();\n    }\n\n    /**\n     * It returns a unique type string of the tool.\n     */\n    getType() {\n        return \"geovisto-sidebar-tab\";\n    }\n\n    /**\n     * It returns whether the tab control is enabled.\n     */\n    isEnabled() {\n        return true;\n    }\n\n    /**\n     * It returns name of tab pane.\n     */\n    getName() {\n        return \"Custom tab\";\n    }\n\n    /**\n     * It returns the icon of tab pane.\n     */\n    getIcon() {\n        return '<i class=\"fa fa-file\"></i>';\n    }\n\n    /**\n     * It returns whether the tab control contains a check button used to enable/disable the tool.\n     */\n    getCheckButton() {\n        return true;\n    }\n\n    /**\n     * It returns the default config.\n     */\n    getConfig() {\n        return {};\n    }\n}\nexport default AbstractTabControlDefaults;","import AbstractTabControlDefaults from \"../../sidebar/model/control/AbstractTabControlDefaults\";\n\n/**\n * This class provide functions which return the default state values.\n * \n * @author Jiri Hynek\n */\nclass FiltersToolTabControlDefaults extends AbstractTabControlDefaults {\n\n    /**\n     * It initializes sidebar tab control defaults.\n     */\n    constructor() {\n        super();\n    }\n\n    /**\n     * It returns name of tab pane.\n     */\n    getName() {\n        return \"Filters\";\n    }\n\n    /**\n     * It returns the icon of the tab pane.\n     */\n    getIcon() {\n        return '<i class=\"fa fa-filter\"></i>';\n    }\n\n    /**\n     * It returns the element class.\n     */\n    getFilterRuleElementClass() {\n        return this.getMapObject().getType() + \"-filter\";\n    }\n}\nexport default FiltersToolTabControlDefaults;\n","import AbstractMapObjectState from \"../../../../model/object/abstract/AbstractMapObjectState\";\nimport AbstractTabControlDefaults from \"./AbstractTabControlDefaults\";\n\n/**\n * This class manages the state of the sidebar tab.\n * It wraps the state since the sidebar tab can work with state objects which needs to be explicitly serialized.\n * \n * @author Jiri Hynek\n */\nclass AbstractTabControlState extends AbstractMapObjectState {\n\n    /**\n     * It creates a tab control state.\n     */\n    constructor() {\n        super();\n    }\n\n    /**\n     * It initializes the state using the initial props. Optionally, defaults can be set if property is undefined.\n     * \n     * @param {*} props \n     * @param {*} defaults \n     */\n    initialize(props, defaults) {\n        // store the tool which provides this sidebar tab\n        // props.tool should not be undefined\n        this.setTool(props.tool);\n\n        super.initialize(props, defaults);\n    }\n\n    /**\n     * It resets state with respect to initial props. Optionally, defaults can be set if property is undefined.\n     * \n     * @param {AbstractTabControlDefaults} defaults \n     */\n    reset(defaults) {\n        super.reset(defaults);\n        \n        let props = this.getProps();\n\n        // set remaining properties if not set\n        this.setName(props.name == undefined && defaults ? defaults.getName() : props.name);\n        this.setIcon(props.icon == undefined && defaults ? defaults.getIcon() : props.icon);\n        this.setCheckButton(props.checkButton == undefined && defaults ? defaults.getCheckButton() : props.checkButton);\n        this.setEnabled(props.enabled == undefined && defaults ? defaults.isEnabled() : props.enabled);\n    }\n\n    /**\n     * The function takes config and desrializes the values.\n     * \n     * @param {*} tabControl \n     * @param {*} config \n     */\n    deserialize(tabControl, config) {\n        if(config.enabled != undefined) this.setEnabled(config.enabled);\n        if(config.name != undefined) this.setName(config.name);\n        if(config.icon != undefined) this.setIcon(config.icon);\n        if(config.checkButton != undefined) this.setCheckButton(config.checkButton);\n\n        this.deserializeFragments(tabControl, config);\n    }\n\n    /**\n     * The function takes config and deserializes the tab fragments.\n     * \n     * @param {AbstractTabControl} tabControl \n     * @param {*} config \n     */\n    deserializeFragments(tabControl, config) {\n        let fragments = [];\n        let fragment;\n        let tool;\n        // process tab fragments\n        if(config.fragments) {\n            let fragmentConfig;\n            for(let i = 0; i != config.fragments.length; i++) {\n                fragmentConfig = config.fragments[i];\n                if(fragmentConfig.tool) {\n                    tool = this.getTool().getMap().getState().getTools().getById(fragmentConfig.tool);\n                    if(tool && tool.getSidebarTabFragment) {\n                        fragment = tool.getSidebarTabFragment();\n                        if(fragment && fragment.isChild(tabControl)) {\n                            fragment.initialize(tabControl, fragmentConfig);\n                            fragments.push(fragment);\n                        }\n                    }\n                }\n            }\n        } else {\n            // try to look for fragments if not specified in config\n            let tools = this.getTool().getMap().getState().getTools().getObjects();\n            for(let i = 0; i < tools.length; i++) {\n                if(tools[i].getSidebarTabFragment) {\n                    fragment = tools[i].getSidebarTabFragment();\n                    if(fragment && fragment.isChild(tabControl)) {\n                        fragment.initialize(tabControl, undefined);\n                        fragments.push(fragment);\n                    }\n                }\n            }\n        }\n\n        this.setTabFragments(fragments.length > 0 ? fragments : undefined);\n    }\n\n    /**\n     * The method serializes the sidebar tab control configuration.\n     * Optionally, a serialed value can be let undefined if it equals the default value.\n     * \n     * @param {*} defaults \n     */\n    serialize(defaults) {\n        // do not serialize id and type - it is not necessary for deserialization\n\n        let config = {\n            tool: this.getTool().getId(),\n            enabled: defaults && this.enabled == defaults.isEnabled() ? undefined : this.enabled,\n            name: defaults && this.name == defaults.isEnabled() ? undefined : this.name,\n            icon: defaults && this.icon == defaults.isEnabled() ? undefined : this.icon,\n            checkButton: defaults && this.checkButton == defaults.isEnabled() ? undefined : this.checkButton\n        };\n\n        // serialize tab fragments\n        if(this.fragments != undefined) {\n            config.fragments = [];\n            for(let i = 0; i != this.fragments.length; i++) {\n                config.fragments.push(this.fragments[i].getState().serialize(this.fragments[i].getDefaults()));\n            }\n        }\n\n        return config;\n    }\n\n    /**\n     * It returns the tool property of the sidebar tab control state.\n     */\n    getTool() {\n        return this.tool;\n    }\n\n    /**\n     * It sets the tool property of the sidebar tab control state.\n     * It can be set only once.\n     * \n     * @param {*} tool \n     */\n    setTool(tool) {\n       this.tool = (this.tool == undefined) ? tool : this.tool;\n    }\n\n    /**\n     * It returns the enabled property of the sidebar tab control state.\n     */\n    isEnabled() {\n        return this.enabled;\n    }\n\n    /**\n     * It sets the enabled property of the sidebar tab control state.\n     * \n     * @param {*} enabled \n     */\n    setEnabled(enabled) {\n       this.enabled = enabled;\n    }\n\n    /**\n     * It returns the name property of the sidebar tab control state.\n     */\n    getName() {\n        return this.name;\n    }\n\n    /**\n     * It sets the name property of the sidebar tab control state.\n     * \n     * @param {*} name \n     */\n    setName(name) {\n       this.name = name;\n    }\n\n    /**\n     * It returns the icon property of the sidebar tab control state.\n     */\n    getIcon() {\n        return this.icon;\n    }\n\n    /**\n     * It sets the icon property of the sidebar tab control state.\n     * \n     * @param {*} icon\n     */\n    setIcon(icon) {\n       this.icon = icon;\n    }\n\n    /**\n     * It returns the checkButton property of the sidebar tab control state.\n     */\n    hasCheckButton() {\n        return this.checkButton;\n    }\n\n    /**\n     * It sets the checkButton property of the sidebar tab control state.\n     * \n     * @param {*} checkButton \n     */\n    setCheckButton(checkButton) {\n       this.checkButton = checkButton;\n    }\n\n    /**\n     * It returns the sidebar property of the sidebar tab control state.\n     */\n    getSidebar() {\n        return this.sidebar;\n    }\n\n    /**\n     * It sets the sidebar property of the sidebar tab control state.\n     * It can be set only once.\n     * \n     * @param {*} sidebar \n     */\n    setSidebar(sidebar) {\n        this.sidebar = (this.sidebar == undefined) ? sidebar : this.sidebar;\n    }\n\n    /**\n     * It returns the tabPane property of the sidebar tab control state.\n     */\n    getTabPane() {\n        return this.tabPane;\n    }\n\n    /**\n     * It sets the tabPane property of the sidebar tab control state.\n     * It can be set only once.\n     * \n     * @param {*} tabPane \n     */\n    setTabPane(tabPane) {\n       this.tabPane = (this.tabPane == undefined) ? tabPane : this.tabPane;\n    }\n\n    /**\n     * It returns the fragments property of the tool state.\n     */\n    getTabFragments() {\n        return this.fragments;\n    }\n\n    /**\n     * It sets the fragments property of the tool state.\n     * \n     * @param {*} fragments \n     */\n    setTabFragments(fragments) {\n        this.fragments = fragments;\n    }\n}\nexport default AbstractTabControlState;","import AbstractTabControlState from \"../../sidebar/model/control/AbstractTabControlState\";\n\n/**\n * This class manages the state of the sidebar tab.\n * It wraps the state since the sidebar tab can work with state objects which needs to be explicitly serialized.\n * \n * @author Jiri Hynek\n */\nclass FiltersToolTabControlState extends AbstractTabControlState {\n\n    /**\n     * It creates a tab control state.\n     */\n    constructor() {\n        super();\n    }\n}\nexport default FiltersToolTabControlState;","import * as d3 from \"d3\";\nimport AbstractMapObject from \"../../../../model/object/abstract/AbstractMapObject\";\nimport AbstractTabControlState from \"./AbstractTabControlState\";\nimport AbstractTabControlDefaults from \"./AbstractTabControlDefaults\";\n\nconst C_sidebar_header_class = \"leaflet-sidebar-header\";\nconst C_sidebar_tab_content_class = \"leaflet-sidebar-tab-content\";\nconst C_enabled_class = \"enabled\";\nconst C_checked_class = \"checked\";\n\n/**\n * This class provides controls for sidebar tabs.\n * It contains enable button which enables the sidebar and tool.\n *\n * This class is intended to be extended.\n *\n * @author Jiri Hynek\n */\nclass AbstractTabControl extends AbstractMapObject {\n\n    constructor(props) {\n        super(props);\n    }\n\n    /**\n     * It creates new defaults of the tab control.\n     */\n    createDefaults() {\n        return new AbstractTabControlDefaults();\n    }\n\n    /**\n     * It creates the tab control state.\n     */\n    createState() {\n        return new AbstractTabControlState();\n    }\n\n    /**\n     * Help function which returns the tool.\n     */\n    getTool() {\n        return this.getState().getTool();\n    }\n\n    /**\n     * It initializes the tab control.\n     *\n     * @param {*} sidebar\n     * @param {*} config\n     */\n    initialize(sidebar, config) {\n        // the sidebar which stores the tab\n        // the sidebar should not be undefined (this function is called only by sidebar)\n        this.getState().setSidebar(sidebar);\n\n        // copy existing config if exists or use the default one\n        this.getState().deserialize(this, config != undefined ? JSON.parse(JSON.stringify(config)) : this.getDefaults().getConfig());\n\n        return this;\n    }\n\n    /**\n     * Creates sidebar tab.\n     *\n     */\n    create() {\n        let state = this.getState();\n        if(state.getSidebar() != undefined && state.isEnabled()) {\n            // render sidebar tab pane\n            state.getSidebar().addPanel(this.getTabStructure());\n\n            // arrange DOM elements after they are rendered\n            this.postCreate();\n        }\n        return this;\n    }\n\n    /**\n     * It returns the sidebar tab structure defined with respect to the leaflet-sidebar-v2 plug-in.\n     *\n     * See: https://github.com/noerw/leaflet-sidebar-v2\n     *\n     * This function can be extended.\n     */\n    getTabStructure() {\n        return {\n            id: this.getState().getId(),\n            tab: this.getState().getIcon(),\n            // the content of the pane needs to added after the render since it can contain event listeners\n            pane: '<div class=\"' + C_sidebar_tab_content_class + '\"></div>',\n            title: ' ' + this.getState().getName(),\n            position: 'top'\n        };\n    }\n\n    postCreate() {\n        // get rendered sidebar tab\n        let tabElement = document.getElementById(this.getState().getId());\n\n        // create sidebar tab content\n        let tabContent = tabElement.getElementsByClassName(C_sidebar_tab_content_class)[0];\n        tabContent.appendChild(this.getTabContent());\n\n        // append tab fragments if defined\n        let tabFragments = this.getState().getTabFragments();\n        if(tabFragments) {\n            for(let i = 0; i < tabFragments.length; i++) {\n                tabContent.appendChild(tabFragments[i].getTabContent());\n            }\n        }\n\n        // enable/disable button\n        let tabHeader = tabElement.getElementsByClassName(C_sidebar_header_class)[0];\n        if(this.getState().hasCheckButton()) {\n            // create enable button in sidebar tab header\n            let tabEnableBtn = document.createElement(\"input\");\n            tabEnableBtn.setAttribute(\"type\", \"checkbox\");\n            tabEnableBtn.setAttribute(\"id\", this.getState().getId() + '-enable-btn');\n            var _this = this;\n            tabEnableBtn.onclick = function() {\n                // onclick event handler enables/disables its items\n                _this.setChecked(this.checked);\n            }\n            tabHeader.insertBefore(tabEnableBtn, tabHeader.firstChild);\n\n            if(this.getState().getTool().isEnabled()) {\n                tabEnableBtn.setAttribute(C_checked_class, \"true\");\n            }\n        }\n\n        //  initial state\n        if(this.getState().getTool().isEnabled()) {\n            tabHeader.classList.add(C_enabled_class);\n            tabElement.classList.add(C_enabled_class);\n        } else {\n            // disable inputs\n            d3.select(tabContent).selectAll(\"input\").attr(\"disabled\", \"true\");\n            d3.select(tabContent).selectAll(\"select\").attr(\"disabled\", \"true\");\n            d3.select(tabContent).selectAll(\"button\").attr(\"disabled\", \"true\");\n        }\n    }\n\n    /**\n     * It returns tab pane which will be placed in sidebar tab.\n     *\n     * This function can be extended.\n     */\n    getTabContent() {\n        return document.createTextNode(\"This is tab content\");\n    }\n\n    /**\n     * Functions changes layer state to enabled/disabled.\n     *\n     * @param {*} checked\n     */\n    setChecked(checked) {\n        let tool = this.getState().getTool();\n        if(checked != tool.isEnabled()) {\n            // enable/disable sidebar tab\n            let sidebarTab = d3.select(\"#\" + this.getState().getId());\n            if(sidebarTab != undefined) {\n                // emhasize tab\n                sidebarTab.classed(C_enabled_class, checked);\n                sidebarTab.select(\".\" + C_sidebar_header_class).classed(C_enabled_class, checked);\n                // enable sidebar inputs\n                sidebarTab.select(\".\" + C_sidebar_tab_content_class).selectAll(\"input\").attr(\"disabled\", checked ? null : \"true\");\n                sidebarTab.select(\".\" + C_sidebar_tab_content_class).selectAll(\"select\").attr(\"disabled\", checked ? null : \"true\");\n                sidebarTab.select(\".\" + C_sidebar_tab_content_class).selectAll(\"button\").attr(\"disabled\", checked ? null : \"true\");\n            }\n\n            // switch state\n            this.setTabContentChecked(checked);\n\n            // update the tool state\n            tool.setEnabled(checked);\n        }\n    }\n\n    /**\n     * Changes the state of the tool which is controled by this sidebar tab.\n     *\n     * This function can be extended.\n     *\n     * @param {*} checked\n     */\n    setTabContentChecked(checked) {\n    }\n\n}\nexport default AbstractTabControl;\n","// styles\nimport \"./styles/style.scss\";\n\nimport TabDOMUtil from \"../../../util/TabDOMUtil\";\n//import FilterSelectSidebarInput from \"../../inputs/filter/FilterSelectSidebarInput\";\nimport FilterAutocompleteSidebarInput from \"../../../inputs/filter/FilterAutocompleteSidebarInput\";\nimport SidebarInputFactory from \"../../../inputs/SidebarInputFactory\";\nimport FiltersToolTabControlDefaults from \"./FiltersToolTabControlDefaults\";\nimport FiltersToolTabControlState from \"./FiltersToolTabControlState\";\nimport AbstractTabControl from \"../../sidebar/model/control/AbstractTabControl\";\n\n/**\n * This class provides controls for management of filters sidebar tabs.\n * \n * TODO: exclude defaults and state variables\n * \n * @author Jiri Hynek\n */\nclass FiltersToolTabControl extends AbstractTabControl {\n\n    constructor(props) {\n        super(props);\n        \n        // help variables (TODO: move to the tab control state)\n        this.mapData = this.getTool().getMap().getState().getMapData();\n        this.data = this.mapData.getData();\n        this.dataDomainLabels = this.mapData.getDataDomainLabels();\n        \n        this.filterManager = this.getTool().getState().getFiltersManager();\n        this.operationLabels = this.filterManager.getOperationLabels();\n\n        this.tabContent = undefined;\n        this.btnGroup = undefined;\n        this.inputs = [];\n        this.counter = 0;\n    }\n\n    /**\n     * It creates new defaults of the tab control.\n     */\n    createDefaults() {\n        return new FiltersToolTabControlDefaults();\n    }\n\n    /**\n     * It creates new state of the tab control.\n     */\n    createState() {\n        return new FiltersToolTabControlState();\n    }\n\n    /**\n     * It returns tab content.\n     * \n     */\n    getTabContent() {\n        if(this.tabContent == undefined) {\n            // tab pane\n            this.tabContent = document.createElement('div');\n\n            // btn group\n            this.btnGroup = this.tabContent.appendChild(document.createElement('div'));\n            this.btnGroup.setAttribute(\"class\", \"filterButtons\");\n\n            // append add button\n            var _this = this;\n            this.btnGroup.appendChild(TabDOMUtil.createButton(\"<i class=\\\"fa fa-plus-circle\\\"></i>\", function() { FiltersToolTabControl.addSelectItem(_this) }, \"plusBtn\" ));\n\n            // append apply button\n            this.btnGroup.appendChild(TabDOMUtil.createButton(\"Apply\", function() {\n                _this.inputChangedAction()\n            },\"applyBtn\"));\n\n            // import inputs according to configuration\n            this.setFilterRules(this.getTool().getState().getFilterRules());\n        }\n\n        return this.tabContent;\n    }\n\n    /**\n     * Help static function which adds new select item to the filter sidebar tab.\n     * \n     * @param {*} _this \n     */\n    static addSelectItem(_this) {\n        // div container\n        let div = _this.tabContent.insertBefore(document.createElement('div'), _this.btnGroup);\n        div.classList.add(_this.getDefaults().getFilterRuleElementClass());\n        \n        var minusButton = TabDOMUtil.createButton(\"<i class=\\\"fa fa-minus-circle\\\"></i>\", function(e) { FiltersToolTabControl.removeSelectItem(e, _this) }, \"minusBtn\");        \n        div.appendChild(minusButton);\n\n        /**\n         * Help function which is invoked when the data domain input is changed.\n         * It changes possible options of the operation and value inputs.\n         * \n         * @param {*} e \n         */\n        let updateValueOptions = function(e) {\n            // find the input item\n            let input = undefined\n            let div = e.target.closest(\".\" + _this.getDefaults().getFilterRuleElementClass());\n            for(let i = 0; i < _this.inputs.length; i++) {\n                if(_this.inputs[i].container == div) {\n                    input = _this.inputs[i].input;\n                    break;\n                }\n            }\n\n            // get selected value of the data domain input\n            let dataDomain = e.target.value;\n            \n            // test if defined\n            if(dataDomain != undefined && dataDomain != \"\") {\n                if(input != undefined) {\n                    // enable operation and value inputs\n                    input.opInput.setDisabled(false);\n                    input.valInput.setDisabled(false);\n                    \n                    // find possible values of selected data domain\n                    let values = _this.mapData.getValues(_this.mapData.getDataDomain(dataDomain));\n\n                    // update options of the value input\n                    input.valInput.changeOptions(values);\n                }\n            } else {\n                // disable operation and value inputs\n                input.opInput.setDisabled(true);\n                input.opInput.setValue(\"\");\n                input.valInput.setDisabled(true);\n                input.valInput.setValue(\"\");   \n            }\n        }\n\n        // inputs\n        let input = SidebarInputFactory.createSidebarInput(FilterAutocompleteSidebarInput.ID(), {\n            data: {\n                options: _this.dataDomainLabels,\n                action: updateValueOptions\n            },\n            ops: {\n                options: _this.operationLabels,\n                action: function() { /* do nothing; TODO: update operators with respect to the data domain */ }\n            },\n            vals: {\n                currentData: _this.mapData.getValues(_this.mapData.getDataDomain(_this.dataDomainLabels[0])),\n                action: function() { /* do nothing */ }\n            }\n        });\n\n        div.appendChild(input.create());\n\n        // help input item\n        let inputItem = {\n            container: div,\n            input: input\n        };\n\n        // list of input items\n        _this.inputs.push(inputItem);\n\n        return inputItem;\n    }\n\n    /**\n     * Help static function which removes item from the filter sidebar tab.\n     * \n     * @param {*} _this \n     */\n    static removeSelectItem(e, _this) {\n        // get div\n        let div = e.target.closest(\"div\");\n\n        // find input item and remove it from DOM and list of input items\n        for(let i = 0; i < _this.inputs.length; i++) {\n            if(_this.inputs[i].container == div) {\n                div.remove();\n                _this.inputs.splice(i, 1);\n                break;\n            }\n        }\n    }\n\n    /**\n     * It changes state to enabled/disabled.\n     * \n     * @param {*} enabled\n     */\n    setContentState(enabled) {\n        this.getTool().setEnabled(enabled);\n    }\n\n    /**\n     * It updates rules according to the input values.\n     */\n    inputChangedAction() {\n        this.getTool().setFilterRules(this.getFilterRules());\n    }\n\n    /**\n     * It updates input values according to the selection.\n     */\n    dimensionInputChangedAction() {\n        // TODO\n    }\n\n    /**\n     * It returns selected values from input fields and constructs filter rules.\n     */\n    getFilterRules() {\n        let filterRules = [];\n        let value;\n        let dataDomain;\n        for(let i = 0; i < this.inputs.length; i++) {\n            value = this.inputs[i].input.getValue();\n\n            // get data domain\n            dataDomain = this.mapData.getDataDomain(value.data);\n\n            if(dataDomain != undefined) {\n                // new filter rule\n                let filterRule = this.filterManager.createRule(this.mapData.getDataDomain(value.data), value.op, value.val);\n                if(filterRule != undefined) {\n                    filterRules.push(filterRule);\n                }\n            }\n        }\n        return filterRules;\n    }\n\n    /**\n     * It updates input fileds according to the given filter rules.\n     * \n     * @param {*} filterRules \n     */\n    setFilterRules(filterRules) {\n        // clear inputs\n        for(let i = 0; i < this.inputs.length; i++) {\n            this.inputs[i].container.remove();\n        }\n        this.inputs = [];\n\n        if(filterRules == undefined || filterRules.length == 0) {\n            // if filter rules are empty, initialize one empty input item\n            FiltersToolTabControl.addSelectItem(this);\n        } else {\n            // import inputs according to given filter rules\n            for(let i = 0; i < filterRules.length; i++) {\n                // create input for given filter rule\n                FiltersToolTabControl.addSelectItem(this).input.setValue({\n                    data: filterRules[i].getDataDomain().toString(),\n                    op: filterRules[i].getFilterOperation().toString(),\n                    val: filterRules[i].getPattern()});\n            }\n        }\n    }\n}\nexport default FiltersToolTabControl","/**\n * This class wraps a filter operation.\n * \n * @author Jiri Hynek\n */\nclass AbstractFilterOperation {\n\n    /**\n     * It initializes the filter operation.\n     */\n    constructor() {\n    }\n\n    /**\n     * It returns the string label of the filter representing operator.\n     */\n    toString() {\n        return this.label;\n    }\n\n    /**\n     * It performs the filter operation which compare a value with a pattern.\n     * \n     * @param {any} value \n     * @param {any} pattern \n     */\n    match(value, pattern) {\n        return false;\n    }\n}\nexport default AbstractFilterOperation;","/**\n * This class provide functions for using filters.\n * \n * @author Jiri Hynek\n */\nclass AbstractFiltersManager {\n\n    /**\n     * It initializes the filter manager.\n     */\n    constructor() {\n    }\n\n    /**\n     * It returns available filter operations\n     */\n    getOperations() {\n        return [];\n    }\n\n    /**\n     * It returns available filter operations\n     */\n    getOperation(label) {\n        let operations = this.getOperations();\n        let resultObjects = [];\n        if(operations != undefined) {\n            for(let i = 0; i < operations.length; i++) {\n                if(operations[i].toString() == label) {\n                    resultObjects.push(operations[i]);\n                }\n            }\n        }\n        return resultObjects;\n    }\n\n    /**\n     * The function returns available filter operations.\n     */\n    getOperationLabels() {\n        let labels = [];\n        let operations = this.getOperations();\n        if(operations != undefined) {\n            for(let i = 0; i < operations.length; i++) {\n                labels.push(operations[i].toString());\n            }\n        }\n        return labels;\n    }\n\n    /**\n     * The function creates a new filter rule using given operation label.\n     * \n     * @param {*} dataDomain \n     * @param {*} label \n     * @param {*} pattern \n     */\n    createRule(dataDomain, operation, pattern) {\n        return undefined;\n    }\n\n    /**\n     * Takes a list of data and applies the given filter rules.\n     * Returns a new list of the references to filtered data items.\n     * \n     * @param {[FilterRule]} filterRules \n     */\n    filterData(data, filterRules) {\n    }\n\n\n}\nexport default AbstractFiltersManager;","/**\n * This class wraps dataDomain, filterOperation, pattern which represents a filter rule.\n * \n * @author Jiri Hynek\n */\nclass AbstractFilterRule {\n\n    /**\n     * It initializes the filter manager.\n     */\n    constructor() {\n    }\n\n    /**\n     * It returns the the data domain which should be analyzed.\n     */\n    getDataDomain() {\n        return undefined;\n    }\n\n    /**\n     * It returns the filter operation used for the filtering.\n     */\n    getFilterOperation() {\n        return undefined;\n    }\n\n    /**\n     * It returns the string label of the filter representing operator given by the parameter of constructor.\n     */\n    getPattern() {\n        return undefined;\n    }\n}\nexport default AbstractFilterRule;","import AbstractFilterRule from \"../abstract/AbstractFilterRule\";\n\n/**\n * This class wraps dataDomain, filterOperation, pattern which represents a filter rule.\n * \n * @author Jiri Hynek\n */\nclass FilterRule extends AbstractFilterRule {\n\n    /**\n     * \n     * @param {*} dataDomain \n     * @param {*} operation \n     * @param {*} pattern \n     */\n    constructor(dataDomain, operation, pattern) {\n        super();\n        this.dataDomain = dataDomain;\n        this.operation = operation;\n        this.pattern = pattern;\n    }\n\n    /**\n     * It returns the the data domain which should be analyzed.\n     */\n    getDataDomain() {\n        return this.dataDomain;\n    }\n\n    /**\n     * It returns the filter operation used for the filtering.\n     */\n    getFilterOperation() {\n        return this.operation;\n    }\n\n    /**\n     * It returns the string label of the filter representing operator given by the parameter of constructor.\n     */\n    getPattern() {\n        return this.pattern;\n    }\n}\nexport default FilterRule;","/**\n * The class wraps meta data path used to find data.\n * \n * @author Jiri Hynek\n */\nclass AbstractMapDataDomain {\n\n    /**\n     *  It initializes the data domain wrapper providing a basic API.\n     * \n     * @param {any} domainDescription \n     */\n    constructor(domainDescription) {\n        this.domainDescription = domainDescription;\n    }\n\n    getDomainDescription() {\n        return this.domainDescription;\n    }\n\n    /**\n     * The function returns the string representation of the map data domain\n     * which is *unique* among the labels of other data domains.\n     * \n     * @returns {string}\n     */\n    toString() {\n        return \"\";\n    }\n}\nexport default AbstractMapDataDomain;","import AbstractMapDataDomain from \"./AbstractMapDataDomain\";\n\n/**\n * The class wraps data used by the map, its metadata and functions to acquire data items.\n * \n * @author Jiri Hynek\n */\nclass AbstractMapData {\n\n    /**\n     * It initializes the data wrapper providing a basic API.\n     * \n     * @param {any} data \n     */\n    constructor(data) {\n        this.data = data;\n    }\n\n    /**\n     * It returns the original input data.\n     */\n    getOriginalData() {\n        return this.data;\n    }\n\n    /**\n     * It returns list of items of the type: AbstractMapDataDomain.\n     * \n     * This function is intended to be overriden.\n     * \n     * @returns {[AbstractMapDataDomain]}\n     */\n    getDataDomains() {\n        return [];\n    }\n\n    /**\n     * Help function which returns the list of data domain labels.\n     * \n     * @param {string} label \n     */\n    getDataDomainLabels() {\n        let labels = [];\n        let dataDomains = this.getDataDomains();\n        for(let i = 0; i < dataDomains.length; i++) {\n            labels.push(dataDomains[i].toString());\n        }\n        return labels;\n    }\n\n    /**\n     * It returns the data domain which corresponds to the given string\n     * or creates a new one.\n     * \n     * @param {string} label \n     */\n    getDataDomain(label) {\n        return new AbstractMapDataDomain(label);\n    }\n\n    /**\n     * It returns the preprocessed data as a list of items of the *same* [any] type.\n     * \n     * This function is intended to be overriden.\n     * \n     * @returns {[any]}\n     */\n    getData() {\n        return [];\n    }\n\n    /**\n     * It returns list of all values of the selected data domain.\n     * \n     * @param {AbstractMapDataDomain} dataDomain \n     * @returns {[String]}\n     */\n    getValues(dataDomain) {\n        return [];\n    }\n\n    /**\n     * It returns list of all values of the selected data domain\n     * for the given subset of data.\n     * \n     * @param {AbstractMapDataDomain} dataDomain \n     * @param {any} data \n     * @returns {[String]}\n     */\n    getDataValues(dataDomain, data) {\n        return [];\n    }\n\n    /**\n     * It returns values stored in the given item of the selected data domain.\n     * \n     * @param {AbstractMapDataDomain} dataDomain \n     * @param {any} item \n     * @returns {[String]}\n     */\n    getItemValues(dataDomain, item) {\n        // if the data is not flattened, multiple values can be returned.\n        // note that, currently, all of the Geovisto map tools works only with the valeus[0].\n        // -> **the data should be flattened**\n        return [];\n    }\n}\nexport default AbstractMapData;","import AbstractFilterOperation from \"../abstract/AbstractFilterOperation\";\nimport AbstractFiltersManager from \"../abstract/AbstractFiltersManager\";\nimport FilterRule from \"./FilterRule\";\nimport AbstractMapData from \"../../../../model/data/AbstractMapData\";\n\n/**\n * This class provide functions for using filters.\n * \n * @author Jiri Hynek\n */\nclass FiltersManager extends AbstractFiltersManager {\n\n    constructor(filterOperations) {\n        super();\n        this.filterOperations = filterOperations;\n    }\n\n    /**\n     * The function returns available filter operations.\n     */\n    getOperations() {\n        return this.filterOperations;\n    }\n\n    /**\n     * The function creates a new filter rule using given operation label.\n     * \n     * @param {*} dataDomain \n     * @param {*} label \n     * @param {*} pattern \n     */\n    createRule(dataDomain, label, pattern) {\n        let operation = this.getOperation(label);\n        if(operation && operation.length > 0) {\n            return new FilterRule(dataDomain, operation[0], pattern);\n        } \n        return new FilterRule(dataDomain, new AbstractFilterOperation(), pattern);\n    }\n\n    /**\n     * Takes a list of data and applies the given filter rules.\n     * Returns a new list of the references to filtered data items.\n     * \n     * @param {AbstractMapData} mapData\n     * @param {*} data \n     * @param {[FilterRule]} filterRules \n     */\n    filterData(mapData, data, filterRules) {\n        let resultData = [];\n\n        // prepare arrays to save computation time\n        let dataDomains = [];\n        let matchFunctions = [];\n        let patterns = [];\n        for(let i = 0; i < filterRules.length; i++) {\n            dataDomains.push(filterRules[i].getDataDomain());\n            matchFunctions.push(filterRules[i].getFilterOperation().match);\n            patterns.push(filterRules[i].getPattern());\n        }\n\n        // go through data\n        let doFilter;\n        let values;\n        for(let i = 0; i < data.length; i++) {\n            doFilter = false;\n            for(let j = 0; j < filterRules.length; j++) {\n                values = mapData.getItemValues(dataDomains[j], data[i]);\n                if(values.length == 1) {\n                    if(!matchFunctions[j](values[0], patterns[j])) {\n                        doFilter = true;\n                        break;\n                    }\n                }\n            }\n            if(!doFilter) {\n                // data item is accepted by all filter rules\n                resultData.push(data[i]);\n            }\n        }\n\n        return resultData;\n    }\n}\nexport default FiltersManager;","import AbstractFilterOperation from \"../abstract/AbstractFilterOperation\";\n\n/**\n * This class wraps the equals filter operation.\n * \n * @author Jiri Hynek\n */\nclass EqFilterOperation extends AbstractFilterOperation {\n\n    constructor() {\n        super();\n    }\n\n    /**\n     * It returns the string label of the filter representing operator.\n     */\n    toString() {\n        return \"==\";\n    }\n\n    /**\n     * It checks if value equals pattern.\n     * \n     * @param {any} value \n     * @param {any} pattern \n     */\n    match(value, pattern) {\n        return value == pattern;\n    }\n}\nexport default EqFilterOperation;","import AbstractFilterOperation from \"../abstract/AbstractFilterOperation\";\n\n/**\n * This class wraps the not-equals filter operation.\n * \n * @author Jiri Hynek\n */\nclass NeqFilterOperation extends AbstractFilterOperation {\n\n    constructor() {\n        super();\n    }\n\n    /**\n     * It returns the string label of the filter representing operator.\n     */\n    toString() {\n        return \"!=\";\n    }\n\n    /**\n     * It checks if value does not equal pattern.\n     * \n     * @param {any} value \n     * @param {any} pattern \n     */\n    match(value, pattern) {\n        return value != pattern;\n    }\n}\nexport default NeqFilterOperation;","import AbstractFilterOperation from \"../abstract/AbstractFilterOperation\";\n\n/**\n * This class wraps the regex filter operation.\n * \n * @author Jiri Hynek\n */\nclass RegFilterOperation extends AbstractFilterOperation {\n\n    constructor() {\n        super();\n    }\n\n    /**\n     * It returns the string label of the filter representing operator.\n     */\n    toString() {\n        return \"reg\";\n    }\n\n    /**\n     * It checks if a value match a regular expression pattern.\n     * \n     * @param {any} value \n     * @param {any} pattern \n     */\n    match(value, pattern) {\n        return value.match(new RegExp(pattern, 'g'));\n    }\n}\nexport default RegFilterOperation;","import FiltersManager from \"./model/generic/FiltersManager\";\nimport EqFilterOperation from \"./model/basic/EqFilterOperation\";\nimport NeqFilterOperation from \"./model/basic/NeqFilterOperation\";\nimport RegFilterOperation from \"./model/basic/RegFilterOperation\";\nimport AbstractToolDefaults from \"../../model/tool/abstract/AbstractToolDefaults\";\nimport FiltersTool from \"./FiltersTool\";\n\n/**\n * This class provide functions which return the default state values.\n * \n * @author Jiri Hynek\n */\nclass FiltersToolDefaults extends AbstractToolDefaults {\n\n    /**\n     * It creates tool defaults.\n     */\n    constructor() {\n        super();\n    }\n\n    /**\n     * Only one filter tool should be present in the Geovisto map.\n     */\n    isSingleton() {\n       return true; \n    }\n\n    /**\n     * It returns a unique string of the tool type.\n     */\n    getType() {\n        return FiltersTool.TYPE();\n    }\n\n    /**\n     * It returns default filters manager.\n     */\n    getFiltersManager() {\n        return new FiltersManager([\n            new EqFilterOperation(),\n            new NeqFilterOperation(),\n            new RegFilterOperation()\n        ]);\n    }\n\n    /**\n     * It returns default filter rules.\n     */\n    getFilterRules() {\n        return [];\n    }\n}\nexport default FiltersToolDefaults;","import AbstractToolState from \"../../model/tool/abstract/AbstractToolState\";\nimport FiltersToolDefaults from \"./FiltersToolDefaults\";\nimport AbstractFiltersManager from \"./model/abstract/AbstractFiltersManager\";\nimport AbstractFilterRule from \"./model/abstract/AbstractFilterRule\";\n\n/**\n * This class provide functions for using filters.\n * \n * @author Jiri Hynek\n */\nclass FiltersToolState extends AbstractToolState {\n\n    /**\n     * It creates a tool state.\n     */\n    constructor() {\n        super();\n    }\n\n    /**\n     * It resets state with respect to initial props. Optionally, defaults can be set if property is undefined.\n     * \n     * @param {FiltersToolDefaults} defaults \n     */\n    reset(defaults) {\n        super.reset(defaults);\n\n        let props = this.getProps();\n\n        // set filter manager, which manages filter operations\n        this.setFiltersManager(props.manager == undefined && defaults ? defaults.getFiltersManager() : props.manager);\n\n        // set filter rules if specified in props explicitly\n        this.setFilterRules(props.rules == undefined && defaults ? defaults.getFilterRules() : props.rules);\n    }\n\n    /**\n     * The metod takes config and desrializes the values.\n     * \n     * @param {*} config \n     */\n    deserialize(config) {\n        super.deserialize(config);\n\n        // deserialize filter rules\n        if(config.filterRules != undefined) {\n            // get filter and data manegers which are need for proper deserialization of filter rules\n            let filterManager = this.getFiltersManager();\n            let mapData = this.getMap().getState().getMapData();\n            if(filterManager != undefined && mapData != undefined) {\n                let filterRules = [];\n                let configFilterRule;\n                if(config.filterRules != undefined) {\n                    for(let i = 0; i < config.filterRules.length; i++) {\n                        configFilterRule = config.filterRules[i];\n\n                        let dimension = mapData.getDataDomain(configFilterRule.domain);\n                        let operation = filterManager.getOperation(configFilterRule.operation);\n\n                        if(dimension != undefined && operation != undefined) {\n                            filterRules.push(filterManager.createRule(dimension, operation, configFilterRule.pattern));\n                        }\n                    }\n                }\n                this.setFilterRules(filterRules);\n            }\n        }\n    }\n\n    /**\n     * The method serializes the tool state. Optionally, defaults can be set if property is undefined.\n     * \n     * @param {FiltersToolDefaults} defaults \n     */\n    serialize(defaults) {\n        let config = super.serialize(defaults);\n\n        // serialize filter filters\n        if(this.filterRules != undefined) {\n            config.filterRules = [];\n            let filterRule;\n            for(let i = 0; i < this.filterRules.length; i++) {\n                filterRule = this.filterRules[i];\n                config.filterRules.push({\n                    domain: filterRule.getDataDomain().toString(),\n                    operation: filterRule.getFilterOperation().toString(),\n                    pattern: filterRule.getPattern()\n                })\n            }\n        }\n\n        return config;\n    }\n\n    /**\n     * It updates filter manager.\n     * \n     * @param {AbstractFiltersManager} manager \n     */\n    setFiltersManager(manager) {\n        this.manager = manager;\n    }\n\n    /**\n     * It returns filter manager\n     */\n    getFiltersManager() {\n        return this.manager;\n    }\n\n    /**\n     * It returns the filterRules property of the tool state.\n     */\n    getFilterRules() {\n        return this.filterRules;\n    }\n\n    /**\n     * It sets the filterRules property of the tool state.\n     * \n     * @param {[AbstractFilterRule]} filterRules \n     */\n    setFilterRules(filterRules) {\n        this.filterRules = filterRules;\n    }\n}\nexport default FiltersToolState;","import AbstractTool from \"../../model/tool/abstract/AbstractTool\";\nimport FiltersToolTabControl from \"./sidebar/FiltersToolTabControl\";\nimport FiltersToolDefaults from \"./FiltersToolDefaults\";\nimport FiltersToolState from \"./FiltersToolState\";\n\n/**\n * This class wraps filters, sidebar tab and state. It provides methods for filters management.\n * \n * @author Jiri Hynek\n */\nclass FiltersTool extends AbstractTool {\n\n    /**\n     * It creates a new tool with respect to the props.\n     * \n     * @param {*} props \n     */\n    constructor(props) {\n        super(props);\n\n        // the tab control for a sidebar will be created only if needed\n        this.tabControl = undefined;\n    }\n\n    /**\n     * A unique string of the tool type.\n     */\n    static TYPE() {\n        return \"geovisto-tool-filters\";\n    }\n\n    /**\n     * It creates a copy of the uninitialized tool.\n     */\n    copy() {\n        return new FiltersTool(this.getProps());\n    }\n\n    /**\n     * It creates new defaults of the tool.\n     */\n    createDefaults() {\n        return new FiltersToolDefaults();\n    }\n\n    /**\n     * It returns default tool state.\n     */\n    createState() {\n        return new FiltersToolState();\n    }\n\n    /**\n     * It creates new filter tool.\n     */\n    create() {\n        // set filter rules\n        this.setFilterRules(this.getState().getFilterRules());\n    }\n\n    /**\n     * It returns a tab control.\n     */\n    getSidebarTabControl() {\n        if(this.tabControl == undefined) {\n            this.tabControl = this.createSidebarTabControl();\n        }\n        return this.tabControl;\n    }\n\n    /**\n     * It creates new tab control.\n     */\n    createSidebarTabControl() {\n        return new FiltersToolTabControl({ tool: this });\n    }\n\n    /**\n     * \n     * @param {*} filterRules \n     */\n    setFilterRules(filterRules) {\n        if(filterRules != undefined) {\n            // if the filter tool is enabled, update map data\n            if(this.isEnabled()) {\n                let mapData = this.getMap().getState().getMapData();\n                this.getMap().updateData(this.getState().getFiltersManager().filterData(mapData, mapData.getData(), filterRules));\n            }\n\n            // update filter rules\n            this.getState().setFilterRules(filterRules);\n        }\n    }\n\n    /**\n     * It changes filters state to enabled/disabled.\n     * \n     * @param {*} enabled\n     */\n    setEnabled(enabled) {\n        if(enabled != this.isEnabled()) {\n            // update state\n            this.getState().setEnabled(enabled);\n\n            // the Geovisto map stores the current data and works as the event dispatcher\n            let map = this.getMap();\n\n            // apply filter rules if enabled, else use empty list of filters (use the initial data)\n            if(enabled) {\n                let mapData = this.getMap().getState().getMapData();\n                map.updateData(this.getState().getFiltersManager().filterData(mapData, mapData.getData(), this.getState().getFilterRules()));\n            } else {\n                map.updateData(map.getState().getMapData().getData());\n            }\n        }\n    }\n}\nexport default FiltersTool;","import AbstractTabControlDefaults from \"../../sidebar/model/control/AbstractTabControlDefaults\";\n\n/**\n * This class provide functions which return the default state values.\n * \n * @author Jiri Hynek\n */\nclass SettingsToolTabControlDefaults extends AbstractTabControlDefaults {\n\n    /**\n     * It creates tab control defaults.\n     */\n    constructor() {\n        super();\n    }\n\n    /**\n     * It returns name of tab pane.\n     */\n    getName() {\n        return \"General settings\";\n    }\n\n    /**\n     * It returns the icon of the tab pane.\n     */\n    getIcon() {\n        return '<i class=\"fa fa-gear\"></i>';\n    }\n\n    /**\n     * The settings tab control does not contain a check button used to enable/disable the tool.\n     */\n    getCheckButton() {\n        return false;\n    }\n}\nexport default SettingsToolTabControlDefaults;","import AbstractTabControlState from \"../../sidebar/model/control/AbstractTabControlState\";\n\n/**\n * This class manages the state of the sidebar tab.\n * It wraps the state since the sidebar tab can work with state objects which needs to be explicitly serialized.\n * \n * @author Jiri Hynek\n */\nclass SettingsToolTabControlState extends AbstractTabControlState {\n\n    /**\n     * It creates a tab control state.\n     */\n    constructor() {\n        super();\n    }\n}\nexport default SettingsToolTabControlState;","import AbstractTabControl from \"../../sidebar/model/control/AbstractTabControl\";\nimport SettingsToolTabControlDefaults from \"./SettingsToolTabControlDefaults\";\nimport SettingsToolTabControlState from \"./SettingsToolTabControlState\";\n\n/**\n * This class provides controls for management of the settings sidebar tab.\n * \n * @author Jiri Hynek\n */\nclass SettingsTabControl extends AbstractTabControl {\n\n    constructor(props) {\n        super(props);\n\n        this.tabContent = undefined;\n    }\n\n    /**\n     * It creates new defaults of the tab control.\n     */\n    createDefaults() {\n        return new SettingsToolTabControlDefaults();\n    }\n\n    /**\n     * It creates new state of the tab control.\n     */\n    createState(props, defaults) {\n        return new SettingsToolTabControlState(props, defaults);\n    }\n\n    /**\n     * It returns generic layer tab pane.\n     */\n    getTabContent() {\n        if(this.tabContent == undefined) {\n            // tab pane contains empty div element\n            this.tabContent = document.createElement('div');\n\n            // it provides control with empty tab - tab fragments can be appended\n        }\n\n        return this.tabContent; \n    }\n\n}\nexport default SettingsTabControl;","import SettingsTool from \"./SettingsTool\";\nimport AbstractToolDefaults from \"../../model/tool/abstract/AbstractToolDefaults\";\n\n/**\n * This class provide functions which return the default state values.\n * \n * @author Jiri Hynek\n */\nclass SettingsToolDefaults extends AbstractToolDefaults {\n\n    /**\n     * It creates tool defaults.\n     */\n    constructor() {\n        super();\n    }\n\n    /**\n     * Only one settings tool should be present in the Geovisto map.\n     */\n    isSingleton() {\n       return true; \n    }\n\n    /**\n     * It returns a unique string of the tool type.\n     */\n    getType() {\n        return SettingsTool.TYPE();\n    }\n}\nexport default SettingsToolDefaults;","import AbstractMapSelection from \"../abstract/AbstractMapSelection\";\n\n/**\n * The class provides API for the selection of map elements.\n * It wraps reference to the source element and list of identifiers of geographic items.\n * \n * @author Jiri Hynek\n */\nclass MapSelection extends AbstractMapSelection {\n\n    constructor(tool, srcIds) {\n        super();\n        this.tool = tool;\n        this.srcIds = srcIds;\n        this.allIds = srcIds.map((x) => x);\n    }\n\n    /**\n     * It returns the source element of the selection.\n     */\n    getSrcElement() {\n        return this.srcElement;\n    }\n\n    /**\n     * It returns the tool of the selected element.\n     */\n    getTool() {\n        return this.tool;\n    }\n\n    /**\n     * It returns identifiers of geographical items which were selected.\n     */\n    getSrcIds() {\n        return this.srcIds;\n    }\n\n    /**\n     * It returns identifiers of geographical items which were selected or affected by this selection.\n     */\n    getIds() {\n        return this.allIds;\n    }\n\n    /**\n     * It compares two map selections.\n     * \n     * @param {AbstractSelection} selection \n     */\n    equals(selection) {\n        if(selection) {\n            let srcIds = this.getSrcIds();\n            let srcIds2 = selection.getSrcIds();\n            if(this.getTool() == selection.getTool() && srcIds.length == srcIds2.length) {\n                for (let i = 0; i < srcIds.length; i++) {\n                    if(this.srcIds[i] != srcIds2[i]) {\n                        return false;\n                    }\n                    return true;\n                }\n            }\n        }\n\n        return false;\n    }\n\n    /**\n     * It adds geographical items.\n     * \n     * @param {*} ids \n     */\n    addIds(ids) {\n        let newIds = [];\n        for(let i = 0; i < ids.length; i++) {\n            if(!this.allIds.includes(ids[i])) {\n                this.allIds.push(ids[i]);\n                newIds.push(ids[i]);\n            }\n        }\n        return newIds;\n    }\n}\nexport default MapSelection;","/**\n * The class provides API for the selection of map elements.\n * \n * The selection can affect multiple geographical items identified by some id (e.g., ISO 3166-1 alpha-3 - CZE, SVK, ...).\n * \n * @author Jiri Hynek\n */\nclass AbstractMapSelection {\n\n    constructor() {\n    }\n\n    /**\n     * It returns the tool of the selected element.\n     */\n    getTool() {\n        return this.tool;\n    }\n\n    /**\n     * It returns identifiers of geographical items which were selected.\n     */\n    getSrcIds() {\n        return undefined;\n    }\n\n    /**\n     * It returns identifiers of geographical items which were selected or affected by this selection.\n     */\n    getIds() {\n        return undefined;\n    }\n\n    /**\n     * It compares two selections.\n     * \n     * @param {AbstractSelection} selection \n     */\n    equals(selection) {\n        return false;\n    }\n\n    /**\n     * It adds geographical items.\n     * \n     * @param {*} ids \n     */\n    addIds(ids) {\n        return undefined;\n    }\n}\nexport default AbstractMapSelection;","import AbstractToolState from \"../../model/tool/abstract/AbstractToolState\";\nimport AbstractMapSelection from \"./model/item/abstract/AbstractMapSelection\";\nimport SelectionToolDefaults from \"./SelectionToolDefaults\";\nimport MapSelection from \"./model/item/generic/MapSelection\";\n\n/**\n * This class provide functions for using selections.\n * \n * @author Jiri Hynek\n */\nclass SelectionToolState extends AbstractToolState {\n\n    /**\n     * It creates a tool state.\n     */\n    constructor() {\n        super();\n    }\n\n    /**\n     * It resets state with respect to initial props. Optionally, defaults can be set if property is undefined.\n     * \n     * @param {SelectionToolDefaults} defaults \n     */\n    reset(defaults) {\n        super.reset(defaults);\n\n        // set selection\n        this.setSelection(this.getProps().selection == undefined && defaults ? defaults.getSelection() : this.getProps().selection);\n    }\n\n    /**\n     * The metod takes config and desrializes the values.\n     * \n     * @param {*} config \n     */\n    deserialize(config) {\n        super.deserialize(config);\n\n        // deserialize selection\n        if(config.selection) {\n            let tool = this.getMap().getState().getTools().getById(config.selection.tool);\n            if(tool) {\n                this.setSelection(new MapSelection(tool, config.selection.ids));\n            }\n        }\n    }\n\n    /**\n     * The method serializes the tool state. Optionally, defaults can be set if property is undefined.\n     * \n     * @param {SelectionToolDefaults} defaults\n     */\n    serialize(defaults) {\n        let config = super.serialize(defaults);\n\n        // serialize the selection\n        let selection = this.getSelection();\n        if(selection && selection.getSrcIds().length > 0) {\n            config.selection = {\n                tool: selection.getTool().getId(),\n                ids: selection.getSrcIds()\n            };\n        }\n\n        return config;\n    }\n\n    /**\n     * It returns the selection property of the tool state.\n     */\n    getSelection() {\n        return this.selection;\n    }\n\n    /**\n     * It sets the selection property of the tool state.\n     * \n     * @param {AbstractMapSelection} selection\n     */\n    setSelection(selection) {\n       this.selection = selection;\n    }\n}\nexport default SelectionToolState;","import GenericObjectEvent from \"../../../../model/event/generic/GenericObjectEvent\";\n\n/**\n * This class provides the map selection change event.\n * \n * @author Jiri Hynek\n */\nclass SelectionToolEvent extends GenericObjectEvent {\n\n    /**\n     * It initializes event.\n     */\n    constructor(selectionTool, selection) {\n        super(SelectionToolEvent.TYPE(), selectionTool, selection);\n        this.selection = selection;\n    }\n\n    /**\n     * Type of the event.\n     */\n    static TYPE() {\n        return \"selection-tool-event\";\n    }\n}\nexport default SelectionToolEvent;","import AbstractMapObjectState from \"../../../../model/object/abstract/AbstractMapObjectState\";\n\n/**\n * This class manages the state of the sidebar fragment.\n * It wraps the state since the sidebar fragment can work with state objects which needs to be explicitly serialized.\n * \n * @author Jiri Hynek\n */\nclass AbstractTabFragmentState extends AbstractMapObjectState {\n\n    constructor() {\n        super();\n    }\n\n    /**\n     * It initializes the state using the initial props. Optionally, defaults can be set if property is undefined.\n     * \n     * @param {*} props \n     * @param {*} defaults \n     */\n    initialize(props, defaults) {\n        // store the tool which provides this sidebar fragment\n        // props.tool should not be undefined\n        this.setTool(props.tool);\n\n        super.initialize(props, defaults);\n    }\n\n    /**\n     * It resets state with respect to initial props. Optionally, defaults can be set if property is undefined.\n     * \n     * @param {AbstractTabControlDefaults} defaults \n     */\n    reset(defaults) {\n        super.reset(defaults);\n\n        let props = this.getProps();\n\n        // set remaining properties if not set\n        this.setEnabled(props.enabled == undefined && defaults ? defaults.isEnabled() : props.enabled);\n    }\n\n    /**\n     * The metod takes config and desrializes the values.\n     * \n     * @param {*} config \n     */\n    deserialize(config) {\n        if(config.enabled != undefined) this.setEnabled(config.enabled);\n    }\n\n    /**\n     * The method serializes the sidebar tab fragment configuration.\n     * Optionally, a serialed value can be let undefined if it equals the default value.\n     * \n     * @param {*} defaults \n     */\n    serialize(defaults) {\n        return {\n            tool: this.getTool().getId(),\n            enabled: defaults && this.isEnabled == defaults.isEnabled() ? undefined : this.isEnabled(),\n        }\n    }\n\n    /**\n     * It returns the tool property of the sidebar tab fragment state.\n     */\n    getTool() {\n        return this.tool;\n    }\n\n    /**\n     * It sets the tool property of the sidebar tab fragment state.\n     * It can be set only once.\n     * \n     * @param {*} tool \n     */\n    setTool(tool) {\n       this.tool = (this.tool == undefined) ? tool : this.tool;\n    }\n\n    /**\n     * It returns the enabled property of the sidebar tab fragment state.\n     */\n    isEnabled() {\n        return this.enabled;\n    }\n\n    /**\n     * It sets the enabled property of the sidebar tab fragment state.\n     * \n     * @param {*} enabled \n     */\n    setEnabled(enabled) {\n       this.enabled = enabled;\n    }\n\n    /**\n     * It returns the tab control property of the sidebar fragment control state.\n     */\n    getTabControl() {\n        return this.tabControl;\n    }\n\n    /**\n     * It sets the tab control property of the sidebar tab contrfragmentol state.\n     * It can be set only once.\n     * \n     * @param {*} tabControl \n     */\n    setTabControl(tabControl) {\n       this.tabControl = (this.tabControl == undefined) ? tabControl : this.tabControl;\n    }\n\n    /**\n     * It returns the content property of the sidebar tab framgent state.\n     */\n    getContent() {\n        return this.content;\n    }\n\n    /**\n     * It sets the content property of the sidebar tab control state.\n     * It can be set only once.\n     * \n     * @param {*} content \n     */\n    setContent(content) {\n       this.content = (this.content == undefined) ? content : this.content;\n    }\n}\nexport default AbstractTabFragmentState;","import AbstractMapObjectDefaults from \"../../../../model/object/abstract/AbstractMapObjectDefaults\";\n\n/**\n * This class provide functions which return the default state values.\n * \n * @author Jiri Hynek\n */\nclass AbstractTabFragmentDefaults extends AbstractMapObjectDefaults {\n\n    /**\n     * It initializes a map defaults.\n     */\n    constructor() {\n        super();\n    }\n\n    /**\n     * It returns a unique type string of the sidebar fragment.\n     */\n    getType() {\n        return \"geovisto-sidebar-fragment\";\n    }\n\n    /**\n     * It returns whether the tab control is enabled.\n     */\n    isEnabled() {\n        return true;\n    }\n\n    /**\n     * It returns the default config.\n     */\n    getConfig() {\n        return {};\n    }\n}\nexport default AbstractTabFragmentDefaults;","import AbstractMapObject from \"../../../../model/object/abstract/AbstractMapObject\";\nimport AbstractTabFragmentState from \"./AbstractTabFragmentState\";\nimport AbstractTabFragmentDefaults from \"./AbstractTabFragmentDefaults\";\n\n/**\n * This class provides tab fragment for sidebar tab control.\n * \n * This class is intended to be extended.\n * \n * @author Jiri Hynek\n */\nclass AbstractTabFragment extends AbstractMapObject {\n\n    constructor(props) {\n        super(props);\n    }\n\n    /**\n     * It creates new defaults of the tab control.\n     */\n    createDefaults() {\n        return new AbstractTabFragmentDefaults();\n    }\n\n    /**\n     * It creates the tab control state.\n     */\n    createState() {\n        return new AbstractTabFragmentState();\n    }\n\n    /**\n     * The function returns true if the tab fragment should be included in the tab control.\n     * \n     * @param {*} tabControl \n     */\n    isChild(tabControl) {\n        return false;\n    }\n\n    /**\n     * It initializes the tab control.\n     * \n     * @param {*} tabControl \n     * @param {*} config \n     */\n    initialize(tabControl, config) {\n        // the tab control which stores the tab fragment\n        // the tab control should not be undefined (this function is called only by tab control)\n        this.getState().setTabControl(tabControl);\n\n        // copy existing config if exists or use the default one\n        this.getState().deserialize(this, config != undefined ? JSON.parse(JSON.stringify(config)) : this.getDefaults().getConfig());\n        \n        return this;\n    }\n\n    /**\n     * It returns fragment of tab pane which will be placed in sidebar tab.\n     * \n     * This function can be extended.\n     */\n    getTabContent() {\n        return document.createTextNode(\"This is tab content\"); \n    }\n\n    /**\n     * This function is called after the sidebar tab is rendered in sidebar.\n     * \n     * This function can be extended.\n     */\n    postCreate() {\n    }\n\n    /**\n     * Changes the state of the tool which is controled by this sidebar tab.\n     * \n     * This function can be extended.\n     * \n     * @param {*} checked \n     */\n    setFragmentContentChecked(checked) {\n    }\n\n}\nexport default AbstractTabFragment;","import AbstractTabFragmentDefaults from \"../../sidebar/model/fragment/AbstractTabFragmentDefaults\";\n\n/**\n * This class provide functions which return the default state values.\n * \n * @author Jiri Hynek\n */\nclass SelectionToolTabFragmentDefaults extends AbstractTabFragmentDefaults {\n\n    /**\n     * It creates tab fragment defaults.\n     */\n    constructor() {\n        super();\n    }\n}\nexport default SelectionToolTabFragmentDefaults;","import AbstractTabFragmentState from \"../../sidebar/model/fragment/AbstractTabFragmentState\";\n\n/**\n * This class manages the state of the sidebar fragment.\n * It wraps the state since the sidebar fragment can work with state objects which needs to be explicitly serialized.\n * \n * @author Jiri Hynek\n */\nclass SelectionToolTabFragmentState extends AbstractTabFragmentState {\n\n    /**\n     * It creates a tab fragment state.\n     */\n    constructor() {\n        super();\n    }\n}\nexport default SelectionToolTabFragmentState;","import AbstractTabFragment from '../../sidebar/model/fragment/AbstractTabFragment';\nimport SettingsTool from '../../settings/SettingsTool';\nimport SelectionToolTabFragmentDefaults from './SelectionToolTabFragmentDefaults';\nimport SelectionToolTabFragmentState from './SelectionToolTabFragmentState';\n\n/**\n * This class represents tab fragment for Themes tool.\n * \n * @author Jiri Hynek\n */\nclass SelectionToolTabFragment extends AbstractTabFragment {\n\n    constructor(props) {\n        super(props);\n\n        // tab content\n        this.tabContent = undefined;\n    }\n\n    /**\n     * It creates new defaults of the tab fragment.\n     */\n    createDefaults() {\n        return new SelectionToolTabFragmentDefaults();\n    }\n\n    /**\n     * It creates new state of the tab fragment.\n     */\n    createState() {\n        return new SelectionToolTabFragmentState();\n    }\n\n    /**\n     * The function returns true if the tab fragment should be included in the tab control.\n     * \n     * @param {*} tabControl \n     */\n    isChild(tabControl) {\n        return tabControl.getState().getTool().getType() == SettingsTool.TYPE();\n    }\n\n    /**\n     * It returns fragment of tab pane which will be placed in sidebar tab.\n     * \n     * This function can be extended.\n     */\n    getTabContent() {\n        if(this.tabContent == undefined) {\n            this.createTabContent();\n        }\n        return this.tabContent;\n    }\n\n    /**\n     * Help function which creates tab content.\n     */\n    createTabContent() {\n        // tab pane\n        this.tabContent = document.createElement('div');\n\n        // TODO ... (selection settings)\n    }\n\n}\nexport default SelectionToolTabFragment;","import AbstractTool from \"../../model/tool/abstract/AbstractTool\";\nimport SelectionToolState from \"./SelectionToolState\";\nimport SelectionToolEvent from \"./model/event/SelectionToolEvent\";\nimport SelectionToolDefaults from \"./SelectionToolDefaults\";\nimport MapSelection from \"./model/item/generic/MapSelection\";\nimport SelectionToolTabFragment from \"./sidebar/SelectionToolTabFragment\";\n\n/**\n * This class provides the selection tool.\n * \n * TODO: exclude defaults and state variables\n * \n * @author Jiri Hynek\n */\nclass SelectionTool extends AbstractTool {\n\n    /**\n     * It creates a new tool with respect to the props.\n     * \n     * @param {*} props \n     */\n    constructor(props) {\n        super(props);\n\n        // the tab fragment for a sidebar tab will be created only if needed\n        this.tabFragment = undefined\n    }\n\n    /**\n     * A unique string of the tool type.\n     */\n    static TYPE() {\n        return \"geovisto-tool-selection\";\n    }\n\n    /**\n     * \n     */\n    static EMPTY_SELECTION() {\n        return new MapSelection(undefined, []);\n    }\n\n    /**\n     * It creates a copy of the uninitialized tool.\n     */\n    copy() {\n        return new SelectionTool(this.getProps());\n    }\n\n    /**\n     * It creates new defaults of the tool.\n     */\n    createDefaults() {\n        return new SelectionToolDefaults();\n    }\n\n    /**\n     * It creates the tool state.\n     */\n    createState() {\n        return new SelectionToolState();\n    }\n\n    /**\n     * It creates new filter tool.\n     */\n    create() {\n        // set selection\n        // not necessary\n        //this.setSelection(this.getState().getSelection());\n    }\n\n    /**\n     * \n     * @param {*} selection \n     */\n    setSelection(selection) {\n        if(selection != undefined) {\n            // if the selection tool is enabled, update map selection\n            if(this.isEnabled()) {\n                // update tool state\n                this.getState().setSelection(selection);\n\n                // dispatch event\n                this.getMap().dispatchEvent(new SelectionToolEvent(this, selection));\n            }\n        }\n    }\n\n    /**\n     * It returns a tab fragment.\n     */\n    getSidebarTabFragment() {\n        if(this.tabFragment == undefined) {\n            this.tabFragment = this.createSidebarTabFragment();\n        }\n        return this.tabFragment;\n    }\n\n    /**\n     * It creates new tab control.\n     * \n     * This function can be extended.\n     */\n    createSidebarTabFragment() {\n        return new SelectionToolTabFragment({ tool: this});\n    }\n}\nexport default SelectionTool;","import SelectionTool from \"./SelectionTool\";\nimport AbstractToolDefaults from \"../../model/tool/abstract/AbstractToolDefaults\";\n\n/**\n * This class provide functions which return the default state values.\n * \n * @author Jiri Hynek\n */\nclass SelectionToolDefaults extends AbstractToolDefaults {\n\n    /**\n     * It creates tool defaults.\n     */\n    constructor() {\n        super();\n    }\n\n    /**\n     * Only one selection tool should be present in the Geovisto map.\n     */\n    isSingleton() {\n       return true; \n    }\n\n    /**\n     * It returns a unique string of the tool type.\n     */\n    getType() {\n        return SelectionTool.TYPE();\n    }\n\n    /**\n     * It returns default map selection.\n     * \n     * This function can be overriden;\n     */\n    getSelection() {\n        return SelectionTool.EMPTY_SELECTION();\n    }\n}\nexport default SelectionToolDefaults;","import AbstractToolState from \"../../model/tool/abstract/AbstractToolState\";\nimport SelectionToolDefaults from \"../selection/SelectionToolDefaults\";\n\n/**\n * This class provide functions for using selections.\n * \n * @author Jiri Hynek\n */\nclass SettingsToolState extends AbstractToolState {\n\n    /**\n     * It creates a tool state.\n     */\n    constructor() {\n        super();\n    }\n\n    /**\n     * It resets state with respect to initial props. Optionally, defaults can be set if property is undefined.\n     * \n     * @param {SelectionToolDefaults} defaults \n     */\n    reset(defaults) {\n        super.reset(defaults);\n    }\n\n    /**\n     * The metod takes config and desrializes the values.\n     * \n     * @param {*} config \n     */\n    deserialize(config) {\n        super.deserialize(config);\n    }\n\n    /**\n     * The method serializes the tool state. Optionally, defaults can be set if property is undefined.\n     * \n     * @param {SelectionToolDefaults} defaults\n     */\n    serialize(defaults) {\n        return super.serialize(defaults);\n    }\n}\nexport default SettingsToolState;","import AbstractTool from '../../model/tool/abstract/AbstractTool';\nimport SettingsToolTabControl from \"./sidebar/SettingsToolTabControl\";\nimport SettingsToolDefaults from './SettingsToolDefaults';\nimport SettingsToolState from './SettingsToolState';\n\n/**\n * This class represents settings tools. It provides empty sidebar which can be used be other tools via tab fragments.\n * \n * TODO: exclude defaults and state variables\n * \n * @author Jiri Hynek\n */\nclass SettingsTool extends AbstractTool {\n\n    /**\n     * It creates a new tool with respect to the props.\n     * \n     * @param {*} props \n     */\n    constructor(props) {\n        super(props);\n\n        console.log(\"create settings tool\");\n        // the tab control for a sidebar will be created only if needed\n        this.tabControl = undefined;\n    }\n\n    /**\n     * A unique string of the tool type.\n     */\n    static TYPE() {\n        return \"geovisto-tool-settings\";\n    }\n\n    /**\n     * It creates a copy of the uninitialized tool.\n     */\n    copy() {\n        return new SettingsTool(this.getProps());\n    }\n\n    /**\n     * It creates new defaults of the tool.\n     */\n    createDefaults() {\n        return new SettingsToolDefaults();\n    }\n\n    /**\n     * It creates the tool state.\n     */\n    createState() {\n        return new SettingsToolState();\n    }\n\n    /**\n     * It returns tab control with respect to the configuration.\n     */\n    getSidebarTabControl() {\n        if(this.tabControl == undefined) {\n            this.tabControl = this.createSidebarTabControl();\n        }\n        return this.tabControl;\n    }\n\n    /**\n     * It creates new tab control.\n     * \n     * This function can be extended.\n     */\n    createSidebarTabControl() {\n        return new SettingsToolTabControl({ tool: this });\n    }\n}\nexport default SettingsTool;","/**\n * The class wraps config used by the map and functions to acquire config items.\n * \n * @author Jiri Hynek\n */\nclass BasicMapConfig {\n\n    /**\n     * It initializes the config wrapper providing a basic API.\n     * It expects a config represented by the implicict Geovisto map structure.\n     * \n     * @param {any} config \n     */\n    constructor(config) {\n        this.config = config;\n    }\n\n    /**\n     * It returns original map config.\n     */\n    getOriginalConfig() {\n        return super.getOriginalConfig();\n    }\n\n    /**\n     * It returns original map config since it is represented in the implicit geovisto map structure.\n     */\n    getConfig() {\n        return this.config;\n    }\n\n    /**\n     * It returns the list of all config records for the tools.\n     */\n    getToolsConfigs() {\n        return this.config.tools;\n    }\n\n    /**\n     * It returns the config record for the tool identified by the given tool identifier.\n     * \n     * @param {string} toolId \n     */\n    getToolConfig(toolId) {\n        let tools = this.config.tools\n        let tool = undefined;\n        if(tools != undefined && Array.isArray(tools)) {\n            tool = tools.find(x => x.id == toolId);\n        }\n        return tool;\n    }\n\n    /**\n     * It returns map config of the implicit structure.\n     * \n     * @param {*} mapConfing \n     */\n    export(mapConfig) {\n        return mapConfig;\n    }\n\n}\nexport default BasicMapConfig;","import AbstractTabControlDefaults from \"../../../sidebar/model/control/AbstractTabControlDefaults\";\n\n/**\n * This class provide functions which return the default state values.\n * \n * @author Jiri Hynek\n */\nclass AbstractLayerToolTabControlDefaults extends AbstractTabControlDefaults {\n\n    /**\n     * It creates tab control defaults.\n     */\n    constructor() {\n        super();\n    }\n\n    /**\n     * It returns name of tab pane.\n     */\n    getName() {\n        return this.getMapObject().getState().getTool().getState().getLayerName() + \" settings\";\n    }\n\n    /**\n     * It returns the icon of the tab pane.\n     */\n    getIcon() {\n        return '<i class=\"fa fa-file\"></i>';\n    }\n\n    /**\n     * It returns the data mapping model.\n     */\n    getDataMappingModel() {\n        return this.getMapObject().getTool().getDefaults().getDataMappingModel();\n    }\n}\nexport default AbstractLayerToolTabControlDefaults;","import AbstractTabControlState from \"../../../sidebar/model/control/AbstractTabControlState\";\n\n/**\n * This class manages the state of the sidebar tab.\n * It wraps the state since the sidebar tab can work with state objects which needs to be explicitly serialized.\n * \n * @author Jiri Hynek\n */\nclass AbstractLayerToolTabControlState extends AbstractTabControlState {\n\n    /**\n     * It creates a tab control state.\n     */\n    constructor() {\n        super();\n    }\n}\nexport default AbstractLayerToolTabControlState;","import AbstractTabControl from \"../../../sidebar/model/control/AbstractTabControl\";\nimport AbstractLayerToolTabControlDefaults from \"./AbstractLayerToolTabControlDefaults\";\nimport AbstractLayerToolTabControlState from \"./AbstractLayerToolTabControlState\";\n\n/**\n * This class provides controls for management of the layer sidebar tab.\n * \n * @author Jiri Hynek\n */\nclass AbstractLayerToolTabControl extends AbstractTabControl {\n\n    constructor(tool) {\n        super(tool);\n\n        this.tabContent = undefined;\n    }\n\n    /**\n     * It creates new defaults of the tab control.\n     */\n    createDefaults() {\n        return new AbstractLayerToolTabControlDefaults();\n    }\n\n    /**\n     * It creates new state of the tab control.\n     */\n    createState() {\n        return new AbstractLayerToolTabControlState();\n    }\n\n    /**\n     * It returns generic layer tab pane.\n     */\n    getTabContent() {\n        if(this.tabContent == undefined) {\n            // tab pane contains empty div element\n            this.tabContent = document.createElement('div');\n        }\n\n        return this.tabContent; \n    }\n\n    /**\n     * It acquire selected data mapping from input values.\n     * \n     * This function is intended to be extended.\n     */\n    getInputValues() {\n        return {};\n    }\n\n    /**\n     * It updates selected items according to the given selection.\n     * \n     * This function is intended to be extended.\n     * \n     * @param {*} dataMapping \n     */\n    setInputValues(dataMapping) {\n    }\n}\nexport default AbstractLayerToolTabControl;","import AbstractToolState from \"../../../model/tool/abstract/AbstractToolState\";\nimport LayerToolDefaults from \"./AbstractLayerToolDefaults\";\n\n/**\n * This class provide functions for using the state of the layer tool.\n * \n * @author Jiri Hynek\n */\nclass AbstractLayerToolState extends AbstractToolState {\n\n    /**\n     * It creates a tool state.\n     */\n    constructor() {\n        super();\n    }\n\n    /**\n     * It resets state with respect to initial props. Optionally, defaults can be set if property is undefined.\n     * \n     * @param {LayerToolDefaults} defaults \n     */\n    reset(defaults) {\n        super.reset(defaults);\n\n        let props = this.getProps();\n\n        // the layer tool properties\n        this.setLayerName(props.name == undefined && defaults ? defaults.getLayerName() : props.name);\n    }\n\n    /**\n     * Help function which resets the state properties realated with map if not defined.\n     */\n    resetMapVariables(map, defaults) {\n        super.resetMapVariables(map, defaults);\n\n        let props = this.getProps();\n        this.setDataMapping(props.data == undefined && defaults && map ? defaults.getDataMapping() : props.data);\n    }\n\n    /**\n     * The metod takes config and desrializes the values.\n     * \n     * @param {*} config \n     */\n    deserialize(config) {\n        super.deserialize(config);\n\n        // the layer tool config\n        if(config.name != undefined) this.setLayerName(config.name);\n        if(config.data != undefined) this.setDataMapping(config.data);\n        // TODO data mapping deserialization\n    }\n\n    /**\n     * The method serializes the tool state. Optionally, defaults can be set if property is undefined.\n     * \n     * @param {LayerToolDefaults} defaults\n     */\n    serialize(defaults) {\n        let config = super.serialize(defaults);\n\n        // serialize the layer tool properties\n        config.layerName = defaults && this.getLayerName() == defaults.getLayerName() ? undefined : this.getLayerName();\n        config.data = this.getDataMapping(); // do not use defaults\n        // TODO data mapping serialization\n\n        return config;\n    }\n\n    /**\n     * It returns the layer name property of the tool state.\n     */\n    getLayerName() {\n        return this.layerName;\n    }\n\n    /**\n     * It sets the layer name property of the tool state.\n     * \n     * @param {string} layerName \n     */\n    setLayerName(layerName) {\n       this.layerName = layerName;\n    }\n\n    /**\n     * It returns the data mapping property of the tool state.\n     */\n    getDataMapping() {\n        return this.dataMapping;\n    }\n\n    /**\n     * It sets the data mapping property of tool state.\n     * \n     * @param {*} dataMapping \n     */\n    setDataMapping(dataMapping) {\n       this.dataMapping = dataMapping;\n    }\n}\nexport default AbstractLayerToolState;","import AbstractEvent from \"../../../model/event/abstract/AbstractEvent\";\nimport AbstractTool from \"../../../model/tool/abstract/AbstractTool\";\nimport LayerTabControl from \"./sidebar/AbstractLayerToolTabControl\";\nimport LayerToolDefaults from \"./AbstractLayerToolDefaults\";\nimport LayerToolState from \"./AbstractLayerToolState\";\n\n/**\n * This class wraps filter tool. It provides methods for layer management.\n * \n * @author Jiri Hynek\n */\nclass AbstractLayerTool extends AbstractTool {\n\n    /**\n     * It creates a new tool with respect to the props.\n     * \n     * @param {*} props \n     */\n    constructor(props) {\n        super(props);\n\n        // the tab control for a sidebar will be created only if needed\n        this.tabControl = undefined;\n    }\n\n    /**\n     * A unique string of the tool type.\n     */\n    static TYPE() {\n        return \"geovisto-tool-layer-abstract\";\n    }\n\n    /**\n     * It creates a copy of the uninitialized tool.\n     */\n    copy() {\n        return new LayerTool(this.getProps());\n    }\n\n    /**\n     * It creates new defaults of the tool.\n     */\n    createDefaults() {\n        return new LayerToolDefaults();\n    }\n\n    /**\n     * It returns default tool state.\n     */\n    createState() {\n        return new LayerToolState();\n    }\n\n    /**\n     * It returns tab control with respect to the configuration\n     */\n    getSidebarTabControl() {\n        if(this.tabControl == undefined) {\n            this.tabControl = this.createSidebarTabControl();\n        }\n        return this.tabControl;\n    }\n\n    /**\n     * It creates new tab control.\n     * \n     * This function can be extended.\n     */\n    createSidebarTabControl() {\n        return new LayerTabControl({ tool: this });\n    }\n\n    /**\n     * It creates new layer with respect to configuration\n     */\n    create() {\n        if(this.isEnabled()) {\n            this.showLayerItems();\n        }\n    }\n\n    /**\n     * It changes layer state to enabled/disabled.\n     * \n     * @param {*} enabled\n     */\n    setEnabled(enabled) {\n        if(enabled != this.isEnabled()) {\n            // update state\n            this.getState().setEnabled(enabled);\n\n            // show ot hide the layer\n            if(enabled) {\n                this.showLayerItems();\n            } else {\n                this.hideLayerItems();\n            }\n        }\n    }\n\n    /**\n     * Help function which shows layer items.\n     * \n     * This function is meant to be private.\n     */\n    showLayerItems() {\n        // get/create items\n        let layerItems = this.getLayerItems();\n\n        // render/remove items\n        for(let j = 0; j < layerItems.length; j++) {\n            layerItems[j].addTo(this.getMap().getState().getLeafletMap());\n        }\n\n        // post create items\n        this.postCreateLayerItems();\n    }\n\n    /**\n     * Help function which hides layer items\n     * \n     * This function is meant to be private.\n     */\n    hideLayerItems() {\n        // get/create items\n        let layerItems = this.getLayerItems();\n\n        // render/remove items\n        for(let j = 0; j < layerItems.length; j++) {\n            this.getMap().getState().getLeafletMap().removeLayer(layerItems[j]);\n        }\n    }\n\n    /**\n     * It returns layer items which should be rendered.\n     */\n    getLayerItems() {\n        if(this.layerItems == undefined) {\n            this.layerItems = this.createLayerItems();\n        }\n        return this.layerItems;\n    }\n\n    /**\n     * It creates layer items.\n     * \n     * Override this function.\n     */\n    createLayerItems() {\n        return [];\n    }\n\n    /**\n     * This function is called when layer items are rendered.\n     * \n     * Override this function if needed.\n     */\n    postCreateLayerItems() {\n    }\n\n    /**\n     * It updates data mapping and redraws the layer.\n     * It can be used by the layer tab providers when input values are changed.\n     * \n     * @param {*} dataMapping \n     */\n    updateDataMapping(dataMapping, onlyStyle) {\n        // update state\n        this.getState().setDataMapping(dataMapping);\n\n        // redraw the layer items\n        this.redraw(onlyStyle);\n    }\n\n    /**\n     * It reloads data and redraw the layer.\n     * \n     * Override this function.\n     * \n     * @param {*} onlyStyle \n     */\n    redraw(onlyStyle) {\n    }\n\n    /**\n     * This function is called when a custom event is invoked.\n     * \n     * Override this function if needed.\n     * \n     * @param {AbstractEvent} event \n     */\n    handleEvent(event) {\n    }\n}\nexport default AbstractLayerTool;","import AbstractToolDefaults from \"../../../model/tool/abstract/AbstractToolDefaults\";\nimport AbstractLayerTool from \"./AbstractLayerTool\";\n\n/**\n * This class provide functions which return the default state values.\n * \n * @author Jiri Hynek\n */\nclass AbstractLayerToolDefaults extends AbstractToolDefaults {\n\n    /**\n     * It initializes tool defaults.\n     */\n    constructor() {\n        super();\n    }\n\n    /**\n     * It returns a unique type string of the tool which is based on the layer it wraps.\n     */\n    getType() {\n        return AbstractLayerTool.TYPE();\n    }\n\n    /**\n     * It returns the layer name.\n     */\n    getLayerName() {\n        return \"Abstract layer\";\n    }\n\n    /**\n     * It returns the default mapping of data domains to chart dimensions.\n     */\n    getDataMapping() {\n        return undefined;\n    }\n\n    /**\n     * It returns the data mapping model.\n     */\n    getDataMappingModel() {\n        return undefined;\n    }\n}\nexport default AbstractLayerToolDefaults;","import MapLayerTool from \"./MapLayerTool\";\nimport AbstractLayerToolDefaults from \"../abstract/AbstractLayerToolDefaults\";\n\n/**\n * This class provide functions which return the default state values.\n * \n * @author Jiri Hynek\n */\nclass MapLayerToolDefaults extends AbstractLayerToolDefaults {\n\n    /**\n     * It initializes tool defaults.\n     */\n    constructor() {\n        super();\n    }\n\n    /**\n     * It returns a unique type string of the tool which is based on the layer it wraps.\n     */\n    getType() {\n        return MapLayerTool.TYPE();\n    }\n\n    /**\n     * It returns the layer name.\n     */\n    getLayerName() {\n        return \"Map layer\";\n    }\n\n    /**\n     * It returns the preferred base map.\n     */\n    getBaseMap() {\n        return 'https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png';\n    }\n}\nexport default MapLayerToolDefaults;","import AbstractLayerToolState from \"../abstract/AbstractLayerToolState\";\nimport MapLayerToolDefaults from \"./MapLayerToolDefaults\";\n\n/**\n * This class provide functions for using the state of the layer tool.\n * \n * @author Jiri Hynek\n */\nclass MapLayerToolState extends AbstractLayerToolState {\n\n    /**\n     * It creates a tool state.\n     */\n    constructor() {\n        super();\n    }\n\n    /**\n     * It resets state with respect to initial props. Optionally, defaults can be set if property is undefined.\n     * \n     * @param {MapLayerToolDefaults} defaults \n     */\n    reset(defaults) {\n        super.reset(defaults);\n\n        let props = this.getProps();\n\n        // the map layer tool properties\n        this.setBaseMap(props.baseMap == undefined && defaults ? defaults.getBaseMap() : props.baseMap);\n        // TODO\n    }\n\n    /**\n     * The metod takes config and desrializes the values.\n     * \n     * @param {*} config \n     */\n    deserialize(config) {\n        super.deserialize(config);\n\n        // the map layer tool config\n        // TODO\n    }\n\n    /**\n     * The method serializes the tool state. Optionally, defaults can be set if property is undefined.\n     * \n     * @param {MapLayerToolDefaults} defaults\n     */\n    serialize(defaults) {\n        let config = super.serialize(defaults);\n\n        // serialize the map layer tool properties\n        // TODO\n\n        return config;\n    }\n\n    /**\n     * It returns a Leaflet tile layer.\n     */\n    getLayer() {\n        return this.layer;\n    }\n\n    /**\n     * It sets a Leaflet tile layer.\n     * \n     * @param {L.TileLayer} layer \n     */\n    setLayer(layer) {\n        this.layer = layer;\n    }\n\n    /**\n     * It returns a base map ID.\n     */\n    getBaseMap() {\n        return this.baseMap;\n    }\n\n    /**\n     * It sets a base map ID.\n     * \n     * @param {string} baseMap\n     */\n    setBaseMap(baseMap) {\n        this.baseMap = baseMap;\n    }\n\n    // TODO\n}\nexport default MapLayerToolState;","import AbstractLayerToolTabControlDefaults from \"../../abstract/sidebar/AbstractLayerToolTabControlDefaults\";\n\n\n/**\n * This class provide functions which return the default state values.\n * \n * @author Jiri Hynek\n */\nclass MapLayerToolTabControlDefaults extends AbstractLayerToolTabControlDefaults {\n\n    /**\n     * It creates tab control defaults.\n     */\n    constructor() {\n        super();\n    }\n\n    /**\n     * It returns the icon of the tab pane.\n     */\n    getIcon() {\n        return '<i class=\"fa fa-globe\"></i>';\n    }\n}\nexport default MapLayerToolTabControlDefaults;","import AbstractLayerToolTabControlState from \"../../abstract/sidebar/AbstractLayerToolTabControlState\";\n\n/**\n * This class manages the state of the sidebar tab.\n * It wraps the state since the sidebar tab can work with state objects which needs to be explicitly serialized.\n * \n * @author Jiri Hynek\n */\nclass MapLayerToolTabControlState extends AbstractLayerToolTabControlState {\n\n    /**\n     * It creates a tab control state.\n     */\n    constructor() {\n        super();\n    }\n}\nexport default MapLayerToolTabControlState;","import MapLayerToolTabControlDefaults from \"./MapLayerToolTabControlDefaults\";\nimport MapLayerToolTabControlState from \"./MapLayerToolTabControlState\";\nimport AbstractLayerToolTabControl from \"../../abstract/sidebar/AbstractLayerToolTabControl\";\n\n/**\n * This class provides controls for management of the layer sidebar tab.\n * \n * @author Jiri Hynek\n */\nclass MapLayerToolTabControl extends AbstractLayerToolTabControl {\n\n    constructor(tool) {\n        super(tool);\n    }\n\n    /**\n     * It creates new defaults of the tab control.\n     */\n    createDefaults() {\n        return new MapLayerToolTabControlDefaults();\n    }\n\n    /**\n     * It creates new state of the tab control.\n     */\n    createState() {\n        return new MapLayerToolTabControlState();\n    }\n\n    // TODO: This class should be modified in future to provide settings for Map layer (e.g., different tile layers).\n\n}\nexport default MapLayerToolTabControl;","import GenericObjectEvent from \"../../../../model/event/generic/GenericObjectEvent\";\n\n\n/**\n * This class provides the theme change event.\n * \n * @author Jiri Hynek\n */\nclass ThemesToolEvent extends GenericObjectEvent {\n\n    /**\n     * It initializes event.\n     */\n    constructor(themesTool, theme) {\n        super(ThemesToolEvent.TYPE(), themesTool, theme);\n        this.theme = theme;\n    }\n\n    /**\n     * Type of the event.\n     */\n    static TYPE() {\n        return \"themes-tool-event\";\n    }\n}\nexport default ThemesToolEvent;","import L from 'leaflet';\r\nimport 'leaflet/dist/leaflet.css';\r\nimport MapLayerToolDefaults from './MapLayerToolDefaults';\r\nimport MapLayerToolState from './MapLayerToolState';\r\nimport MapLayerToolTabControl from './sidebar/MapLayerToolTabControl';\r\nimport AbstractLayerTool from '../abstract/AbstractLayerTool';\r\nimport ThemesToolEvent from '../../themes/model/event/ThemesToolEvent';\r\n\r\n/**\r\n * This class represents Map layer tool. It use tile layer and OSM maps.\r\n * \r\n * @author Jiri Hynek\r\n */\r\nclass MapLayerTool extends AbstractLayerTool {\r\n\r\n    /**\r\n     * It creates a new tool with respect to the props.\r\n     * \r\n     * @param {*} props \r\n     */\r\n    constructor(props) {\r\n        super(props);\r\n    }\r\n\r\n    /**\r\n     * A unique string of the tool type.\r\n     */\r\n    static TYPE() {\r\n        return \"geovisto-tool-layer-map\"; \r\n    }\r\n\r\n    /**\r\n     * It creates a copy of the uninitialized tool.\r\n     */\r\n    copy() {\r\n        return new MapLayerTool(this.getProps());\r\n    }\r\n\r\n    /**\r\n     * It creates new defaults of the tool.\r\n     */\r\n    createDefaults() {\r\n        return new MapLayerToolDefaults();\r\n    }\r\n\r\n    /**\r\n     * It returns default tool state.\r\n     */\r\n    createState() {\r\n        return new MapLayerToolState();\r\n    }\r\n\r\n    /**\r\n     * It creates new tab control.\r\n     */\r\n    createSidebarTabControl() {\r\n        return new MapLayerToolTabControl({ tool: this });\r\n    }\r\n\r\n    /**\r\n     * It creates layer items.\r\n     */\r\n    createLayerItems() {\r\n        // create a tile layer\r\n        let layer = this.createTileLayer(this.getState().getBaseMap());\r\n\r\n        // update state\r\n        this.getState().setLayer(layer);\r\n\r\n        return [ layer ];\r\n    }\r\n\r\n    /**\r\n     * Creates new tile layer\r\n     * \r\n     * @param {*} tileID \r\n     */\r\n    createTileLayer(tileID) {\r\n        // ----------------- TODO: refactorization needed\r\n        let layer = L.tileLayer(tileID, {    \r\n            attribution: '&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors &copy; <a href=\"https://carto.com/attributions\">CARTO</a>',\r\n            subdomains: 'abcd',\r\n            maxZoom: 19,\r\n            minZoom: 1,\r\n        });\r\n        return layer;\r\n    }\r\n\r\n    /**\r\n     * This function is called when a custom event is invoked.\r\n     * \r\n     * @param {AbstractEvent} event \r\n     */\r\n    handleEvent(event) {\r\n        if(event.getType() == ThemesToolEvent.TYPE()) {\r\n            this.onThemeChange(event.getObject())\r\n        }\r\n    }\r\n\r\n    /**\r\n     * This function updates theme used in the tool.\r\n     */\r\n    onThemeChange(theme) {\r\n        // update base map\r\n        this.getState().setBaseMap(theme.getBaseMap());\r\n\r\n        let layer = this.getState().getLayer();\r\n        if(layer && layer._url != theme.getBaseMap()) {\r\n            // remove the old layer\r\n            this.getMap().getState().getLeafletMap().removeLayer(layer);\r\n\r\n            // create a new tile layer\r\n            layer = this.createTileLayer(this.getState().getBaseMap());\r\n\r\n            // update state\r\n            this.getState().setLayer(layer);\r\n\r\n            // add the new layer to the leaflet map\r\n            layer.addTo(this.getMap().getState().getLeafletMap());\r\n        } else {\r\n            \r\n        }\r\n    }\r\n}\r\n\r\nexport default MapLayerTool;","import ChoroplethLayerTool from \"./ChoroplethLayerTool\";\nimport AbstractLayerToolDefaults from \"../abstract/AbstractLayerToolDefaults\";\nimport AutocompleteSidebarInput from \"../../../inputs/input/AutocompleteSidebarInput\";\n\n/**\n * TODO: refactorization needed!\n */\nconst TYPE = 'choropleth';\n\nconst INPUT_ID_PREFIX = \"geovisto-input-\" + TYPE;\n\n/**\n * Data mapping model which can be used in the sidebar form.\n */\nconst MAPPING_MODEL = {\n    country: {\n        id: INPUT_ID_PREFIX + \"-country\",\n        name: \"country\",\n        label: \"Country\",\n        input: AutocompleteSidebarInput.ID()\n    },\n    value: {\n        id: INPUT_ID_PREFIX + \"-value\",\n        name: \"value\",\n        label: \"Value\",\n        input: AutocompleteSidebarInput.ID()\n    },\n    aggregation: {\n        id: INPUT_ID_PREFIX + \"-aggregation\",\n        name: \"aggregation\",\n        label: \"Agregation\",\n        options: [ \"count\", \"sum\" ],\n        input: AutocompleteSidebarInput.ID()\n    },\n    color: {\n        id: INPUT_ID_PREFIX + \"-color\",\n        name: \"color\",\n        label: \"Color\",\n        options: [ \"orange\", \"blue\", \"red\" ],\n        input: AutocompleteSidebarInput.ID()\n    }\n}\n\n/**\n * This class provide functions which return the default state values.\n * \n * @author Jiri Hynek\n */\nclass ChoroplethLayerToolDefaults extends AbstractLayerToolDefaults {\n\n    /**\n     * It initializes tool defaults.\n     */\n    constructor() {\n        super();\n    }\n\n    /**\n     * It returns a unique type string of the tool which is based on the layer it wraps.\n     */\n    getType() {\n        return ChoroplethLayerTool.TYPE();\n    }\n\n    /**\n     * It returns the layer name.\n     */\n    getLayerName() {\n        return \"Choropleth layer\";\n    }\n\n    /**\n     * It returns the default mapping of data domains to chart dimensions.\n     */\n    getDataMapping() {\n        let dataMapping = {};\n        \n        let dataMappingModel = this.getDataMappingModel();\n        let implicitDataDomainLabel = this.getMapObject().getMap().getState().getMapData().getDataDomainLabels()[0];\n        \n        dataMapping[dataMappingModel.country.name] = implicitDataDomainLabel;\n        dataMapping[dataMappingModel.value.name] = implicitDataDomainLabel;\n        dataMapping[dataMappingModel.aggregation.name] = dataMappingModel.aggregation.options[0];\n        dataMapping[dataMappingModel.color.name] = dataMappingModel.color.options[0];\n\n        return dataMapping;\n    }\n\n    /**\n     * It returns the data mapping model.\n     */\n    getDataMappingModel() {\n        return MAPPING_MODEL;\n    }\n    \n    /**\n     * It returns default centroids.\n     */\n    getPolygons() {\n        return this.getMapObject().getMap().getState().getPolygons();\n    }\n\n    /**\n     * It returns preferred z index for the choropoleth layer\n     */\n    getZIndex() {\n        return 350;\n    }\n}\nexport default ChoroplethLayerToolDefaults;","import AbstractLayerToolState from \"../abstract/AbstractLayerToolState\";\nimport ChoroplethLayerToolDefaults from \"./ChoroplethLayerToolDefaults\";\n\n/**\n * This class provide functions for using the state of the layer tool.\n * \n * @author Jiri Hynek\n */\nclass ChoroplethLayerToolState extends AbstractLayerToolState {\n\n    /**\n     * It creates a tool state.\n     */\n    constructor() {\n        super();\n    }\n\n    /**\n     * It resets state with respect to initial props. Optionally, defaults can be set if property is undefined.\n     * \n     * @param {ChoroplethLayerToolDefaults} defaults \n     */\n    reset(defaults) {\n        super.reset(defaults);\n\n        // the layer tool properties\n        this.setZIndex(defaults ? defaults.getZIndex() : 350);\n        // TODO\n    }\n\n    /**\n     * Help function which resets the state properties realated with map if not defined.\n     */\n    resetMapVariables(map, defaults) {\n        super.resetMapVariables(map, defaults);\n        \n        let props = this.getProps();\n        this.setPolygons(props.polygons == undefined && defaults && map ? defaults.getPolygons() : props.polygons);\n    }\n\n    /**\n     * The metod takes config and desrializes the values.\n     * \n     * @param {*} config \n     */\n    deserialize(config) {\n        super.deserialize(config);\n\n        // the layer tool config\n        // TODO\n    }\n\n    /**\n     * The method serializes the tool state. Optionally, defaults can be set if property is undefined.\n     * \n     * @param {ChoroplethLayerToolDefaults} defaults\n     */\n    serialize(defaults) {\n        let config = super.serialize(defaults);\n\n        // serialize the layer tool properties\n        // TODO\n\n        return config;\n    }\n\n    /**\n     * It returns a Leaflet geoJSON layer.\n     */\n    getLayer() {\n        return this.layer;\n    }\n\n    /**\n     * It sets a Leaflet geoJSON layer.\n     * \n     * @param {L.svg} layer \n     */\n    setLayer(layer) {\n        this.layer = layer;\n    }\n\n    /**\n     * It returns a Leaflet popup control.\n     */\n    getLayerPopup() {\n        return this.popup;\n    }\n\n    /**\n     * It sets a Leaflet popup control.\n     * \n     * @param {L.control} popup \n     */\n    setLayerPopup(popup) {\n        this.popup = popup;\n    }\n\n    /**\n     * It returns the polygons.\n     */\n    getPolygons() {\n        return this.polygons;\n    }\n\n    /**\n     * It sets the polygons.\n     * \n     * @param {*} polygons \n     */\n    setPolygons(polygons) {\n        let polys = [];\n        if (Array.isArray(polygons)) polys = polygons;\n        if (polygons?.features) polys = polygons.features;\n        return (this.polygons = polys);\n    }\n\n    /**\n     * It returns the hovered item.\n     */\n    getHoveredItem() {\n        return this.hoveredItem;\n    }\n\n    /**\n     * It sets the hovered item.\n     * \n     * @param {*} hoveredItem \n     */\n    setHoveredItem(hoveredItem) {\n        this.hoveredItem = hoveredItem;\n    }\n\n    /**\n     * It returns the z index.\n     */\n    getZIndex() {\n        return this.zindex;\n    }\n\n    /**\n     * It sets the z index.\n     * \n     * @param {*} zindex \n     */\n    setZIndex(zindex) {\n        this.zindex = zindex;\n    }\n\n    // TODO\n}\nexport default ChoroplethLayerToolState;","import AbstractLayerToolTabControlDefaults from \"../../abstract/sidebar/AbstractLayerToolTabControlDefaults\";\n\n/**\n * This class provide functions which return the default state values.\n * \n * @author Jiri Hynek\n */\nclass ChoroplethLayerToolTabControlDefaults extends AbstractLayerToolTabControlDefaults {\n\n    /**\n     * It creates tab control defaults.\n     */\n    constructor() {\n        super();\n    }\n\n    /**\n     * It returns the icon of the tab pane.\n     */\n    getIcon() {\n        return '<i class=\"fa fa-th-large\"></i>';\n    }\n}\nexport default ChoroplethLayerToolTabControlDefaults;","import AbstractLayerToolTabControlState from \"../../abstract/sidebar/AbstractLayerToolTabControlState\";\n\n/**\n * This class manages the state of the sidebar tab.\n * It wraps the state since the sidebar tab can work with state objects which needs to be explicitly serialized.\n * \n * @author Jiri Hynek\n */\nclass ChoroplethLayerToolTabControlState extends AbstractLayerToolTabControlState {\n\n    /**\n     * It creates a tab control state.\n     */\n    constructor() {\n        super();\n    }\n}\nexport default ChoroplethLayerToolTabControlState;","import ChoroplethLayerToolTabControlDefaults from \"./ChoroplethLayerToolTabControlDefaults\";\nimport ChoroplethLayerToolTabControlState from \"./ChoroplethLayerToolTabControlState\";\nimport AbstractLayerToolTabControl from \"../../abstract/sidebar/AbstractLayerToolTabControl\";\nimport SidebarInputFactory from \"../../../../inputs/SidebarInputFactory\";\n\n/**\n * This class provides controls for management of the layer sidebar tab.\n * \n * @author Jiri Hynek\n */\nclass ChoropolethLayerToolTabControl extends AbstractLayerToolTabControl {\n\n    constructor(tool) {\n        super(tool);\n\n        this.tabContent = undefined;\n    }\n\n    /**\n     * It creates new defaults of the tab control.\n     */\n    createDefaults() {\n        return new ChoroplethLayerToolTabControlDefaults();\n    }\n\n    /**\n     * It creates new state of the tab control.\n     */\n    createState() {\n        return new ChoroplethLayerToolTabControlState();\n    }\n\n    /**\n     * It acquire selected data mapping from input values.\n     */\n    getInputValues() {\n        // get data mapping model\n        let model = this.getDefaults().getDataMappingModel();\n        \n        // create new selection\n        let dataMapping = {};\n\n        // get selected data domains values\n        dataMapping[model.country.name] = this.inputCountry.getValue();\n        dataMapping[model.value.name] = this.inputValue.getValue();\n        dataMapping[model.aggregation.name] = this.inputAggregation.getValue();\n        // deprecated\n        // dataMapping[model.color.name] = this.inputColor.getValue();\n\n        return dataMapping;\n    }\n\n    /**\n     * It updates selected input values according to the given data mapping.\n     * \n     * @param {*} dataMapping \n     */\n    setInputValues(dataMapping) {\n        // get data model\n        let model = this.getDefaults().getDataMappingModel();\n\n        // update inputs\n        this.inputCountry.setValue(dataMapping[model.country.name]);\n        this.inputValue.setValue(dataMapping[model.value.name]);\n        this.inputAggregation.setValue(dataMapping[model.aggregation.name]);\n        // deprecated\n        //this.inputColor.setValue(dataMapping[model.color.name]);\n    }\n\n    /**\n     * It returns the sidebar tab pane.\n     */\n    getTabContent() {\n        var _this = this;\n\n        // event handler: change color action\n        let changeColorAction = function(e) {\n           // get selected values and update layer's data mapping\n           _this.getTool().updateDataMapping(_this.getInputValues(), true);\n        }\n\n        // event handler: change dimension action\n        let changeDimensionAction = function(e) {\n            // get selected values and update layer's data mapping\n            _this.getTool().updateDataMapping(_this.getInputValues());\n        }\n        \n        // tab content\n        let tab = document.createElement('div');\n        let elem = tab.appendChild(document.createElement('div'));\n\n        // get data mapping model\n        let model = this.getDefaults().getDataMappingModel();\n        let dataDomainLabels = this.getTool().getMap().getState().getMapData().getDataDomainLabels();\n\n        // select country\n        this.inputCountry = SidebarInputFactory.createSidebarInput(model.country.input, { label: model.country.label , options: dataDomainLabels, action: changeDimensionAction });\n        elem.appendChild(this.inputCountry.create());\n\n        // select value\n        this.inputValue = SidebarInputFactory.createSidebarInput(model.value.input, { label: model.value.label , options: dataDomainLabels, action: changeDimensionAction });\n        elem.appendChild(this.inputValue.create());\n\n        // select aggregation\n        this.inputAggregation = SidebarInputFactory.createSidebarInput(model.aggregation.input, { label: model.aggregation.label, options: model.aggregation.options, action: changeDimensionAction });\n        elem.appendChild(this.inputAggregation.create());\n\n        // select color scheme\n        // deprecated\n        /*this.inputColor = SidebarInputFactory.createSidebarInput(model.color.input, { label: model.color.label, options: model.color.options, action: changeColorAction });\n        elem.appendChild(this.inputColor.create());*/\n\n        this.setInputValues(this.getTool().getState().getDataMapping());\n        \n        return tab;\n    }\n\n}\nexport default ChoropolethLayerToolTabControl;","import L from 'leaflet';\nimport 'leaflet/dist/leaflet.css';\nimport './style/choroplethLayer.scss'\nimport AbstractLayerTool from '../abstract/AbstractLayerTool';\nimport ChoroplethLayerToolState from './ChoroplethLayerToolState';\nimport ChoroplethLayerToolDefaults from './ChoroplethLayerToolDefaults';\nimport ChoropolethLayerToolTabControl from './sidebar/ChoroplethLayerToolTabControl';\nimport ThemesToolEvent from '../../themes/model/event/ThemesToolEvent';\nimport SelectionToolEvent from '../../selection/model/event/SelectionToolEvent';\nimport DataChangeEvent from '../../../model/event/basic/DataChangeEvent';\nimport MapSelection from '../../selection/model/item/generic/MapSelection';\nimport SelectionTool from '../../selection/SelectionTool';\n\n// TODO: move to defaults\nconst COLOR_orange = ['#8c8c8c','#ffffcc','#ffff99','#ffcc99','#ff9966','#ff6600','#ff0000','#cc0000'];\nconst COLOR_red = ['#8c8c8c','#FED976','#FEB24C','#FD8D3C','#FC4E2A','#E31A1C','#BD0026','#800026'];\nconst COLOR_blue = ['#8c8c8c','#edf8b1','#c7e9b4','#7fcdbb','#41b6c4','#1d91c0','#225ea8','#0c2c84'];\n\nconst SCALE = [1, 100, 1000, 10000, 100000, 1000000, 10000000];\n\n/**\n * This class represents Choropleth layer tool. It works with geojson polygons representing countries.\n * \n * @author Jiri Hynek\n */\nclass ChoroplethLayerTool extends AbstractLayerTool {\n\n    /**\n     * It creates a new tool with respect to the props.\n     * \n     * @param {*} props \n     */\n    constructor(props) {\n        super(props);\n    }\n\n    /**\n     * A unique string of the tool type.\n     */\n    static TYPE() {\n        return \"geovisto-tool-layer-choropleth\"; \n    }\n\n    /**\n     * It creates a copy of the uninitialized tool.\n     */\n    copy() {\n        return new ChoroplethLayerTool(this.getProps());\n    }\n\n    /**\n     * It creates new defaults of the tool.\n     */\n    createDefaults() {\n        return new ChoroplethLayerToolDefaults();\n    }\n\n    /**\n     * It returns default tool state.\n     */\n    createState() {\n        return new ChoroplethLayerToolState();\n    }\n\n    /**\n     * Help function which acquires and returns the selection tool if available.\n     */\n    getSelectionTool() {\n        if(this.selectionTool == undefined) {\n            let tools = this.getMap().getState().getTools().getByType(SelectionTool.TYPE());\n            if(tools.length > 0) {\n                this.selectionTool = tools[0];\n            }\n        }\n        return this.selectionTool;\n    }\n\n    /**\n     * It creates new tab control.\n     */\n    createSidebarTabControl() {\n        return new ChoropolethLayerToolTabControl({ tool: this });\n    }\n\n    /**\n     * It creates layer items.\n     */\n    createLayerItems() {\n        var _this = this;\n\n        // ----------------- TODO: refactorization needed\n\n        function thousands_separator(num) {\n            var num_parts = num.toString().split(\".\");\n            num_parts[0] = num_parts[0].replace(/\\B(?=(\\d{3})+(?!\\d))/g, \" \");\n            return num_parts.join(\".\");\n        }\n       \n        let mouseOver = function(e) {\n            let layerItem = e.target;\n            _this.getState().setHoveredItem(layerItem.feature.id);\n            _this.updateItemStyle(layerItem);\n            var popup = \"<b>\" + e.target.feature.name + \"</b>\";\n            if(e.target.feature.value != undefined){\n                popup += \"<br>\";\n                if (_this.getState().getDataMapping()[_this.getDefaults().getDataMappingModel().aggregation.name] == \"sum\") {\n                    popup+= \"sum: \";\n                    popup+=thousands_separator(e.target.feature.value);\n\n                } else {\n                    popup+=thousands_separator(e.target.feature.value);\n                    if (e.target.feature.value>1){\n                        popup+= \" records\";\n                    } else {\n                        popup+= \" record\";\n                    }\n                }\n            }\n            e.target.bindTooltip(popup,{className: 'leaflet-popup-content', sticky: true}).openTooltip();\n        \n            if (!L.Browser.ie && !L.Browser.opera && !L.Browser.edge) {\n                layerItem.bringToFront();\n            }\n        }\n    \n        let mouseOut = function(e) {\n            let layerItem = e.target;\n            _this.getState().setHoveredItem(undefined);\n            _this.updateItemStyle(layerItem);\n            _this.getState().getLayerPopup().update();\n\n            if (!L.Browser.ie && !L.Browser.opera && !L.Browser.edge) {\n                layerItem.bringToBack();\n            }\n        }\n    \n        let click = function(e) {\n            //_this.getMap().getState().getLeafletMap().fitBounds(e.target.getBounds());\n            //console.log(\"fire click event\");\n            // notify selection tool\n            let selectionTool = _this.getSelectionTool();\n            if(selectionTool) {\n                let selection = new MapSelection(_this, [ e.target.feature.id ]);\n                //console.log(\"select:\", selection, selection.equals(selectionTool.getState().getSelection()));\n                if(selection.equals(selectionTool.getState().getSelection())) {\n                    _this.getSelectionTool().setSelection(SelectionTool.EMPTY_SELECTION());\n                } else {\n                    _this.getSelectionTool().setSelection(selection);\n                }\n            }\n        }\n    \n        let onEachFeature = function(feature, layer) {\n            layer.on({\n                mouseover: mouseOver,\n                mouseout: mouseOut,\n                click: click\n            });\n        }\n    \n        // combine geo with data\n        this.updatePolygons(this);\n    \n        var paneId = this.getId();\n        let pane = this.getMap().getState().getLeafletMap().createPane(paneId);\n        pane.style.zIndex = this.getState().getZIndex();\n        // create Choropleth layer\n        let layer = L.geoJSON(this.getState().getPolygons(), {\n            onEachFeature: onEachFeature,\n            pane: paneId\n        });\n        //layer._layerComponent = this;\n    \n        // create info control that shows country info on hover\n        let layerPopup = L.control();\n    \n        layerPopup.onAdd = function (map) {\n            this._div = L.DomUtil.create('div', 'info');\n            this.update();\n            return this._div;\n        };\n    \n        layerPopup.update = function (props) {\n            this.innerHTML =  (props ?\n                '<b>' + props.name + '</b><br />' + props.value + '</sup>'\n                : 'Hover over a state');\n        };\n\n        // update state\n        this.getState().setLayer(layer);\n        this.getState().setLayerPopup(layerPopup);\n    \n        return [ layer, layerPopup ];\n    }\n\n    /**\n     * It updates polygons so they represent current data.\n     */\n    updatePolygons() {\n        //console.log(\"updating map data\", this);\n\n        // delete the 'value' property of every geo feature object if defined\n        let polygons = this.getState().getPolygons();\n        // TODO create new map and do not modify polygons structure\n        for (var i = 0; i < polygons.length; i++) {\n            polygons[i].value = undefined;\n        }\n\n        // set a new value of the 'value' property of every geo feature\n        let geoCountry;\n        let data = this.getMap().getState().getCurrentData();\n        let dataLen = data.length;\n        let mapData = this.getMap().getState().getMapData();\n        let dataMappingModel = this.getDefaults().getDataMappingModel();\n        let dataMapping = this.getState().getDataMapping();\n        let countryDataDomain = mapData.getDataDomain(dataMapping[dataMappingModel.country.name]);\n        let valueDataDomain = mapData.getDataDomain(dataMapping[dataMappingModel.value.name]);\n        //console.log(countryDataDomain, valueDataDomain);\n        let foundCountries, foundValues;\n        //console.log(data);\n        for (let i = 0; i < dataLen; i++) {\n            // find the 'country' properties\n            foundCountries = mapData.getItemValues(countryDataDomain,  data[i]);\n            //console.log(\"search: \", countryDataDomain, data[i], foundCountries);\n            //console.log(\"search: \", foundCountries);\n            // find the 'value' properties\n            foundValues = mapData.getItemValues(valueDataDomain, data[i]);\n            //console.log(\"search: \", foundValues);\n\n            // since the data are flattened we can expect max one found item\n            if(foundCountries.length == 1) {\n                geoCountry = polygons.find(x => x.id == foundCountries[0]);\n                // test if country exists in the map\n                if(geoCountry != undefined) {\n                    // initilizace map country value property\n                    if(geoCountry.value == undefined) {\n                        geoCountry.value = 0;\n                    }\n                    // set value with respect to the aggregation function\n                    if(dataMapping[dataMappingModel.aggregation.name] == \"sum\") {\n                        if(foundValues.length == 1 && foundValues[0] != null && typeof foundValues[0] === 'number') {\n                            geoCountry.value += foundValues[0];\n                        }\n                    } else {\n                        // count\n                        geoCountry.value++;\n                    }\n                }\n            }   \n        }\n    }\n\n    /**\n     * This function is called when layer items are rendered.\n     */\n    postCreateLayerItems() {\n        if(this.getState().getLayer()) {\n            this.updateStyle();\n        }\n    }\n\n    /**\n     * It reloads data and redraw the layer.\n     */\n    redraw(onlyStyle) {\n        if(!onlyStyle) {\n            // combine geo with data\n            this.updatePolygons();\n        }\n\n        // update style\n        this.updateStyle();\n    }\n\n    /**\n     * This function is called when a custom event is invoked.\n     * \n     * @param {AbstractEvent} event \n     */\n    handleEvent(event) {\n        if(event.getType() == DataChangeEvent.TYPE()) {\n            // data change\n            this.redraw();\n        } else if(event.getType() == SelectionToolEvent.TYPE()) {\n            // selection change\n            this.redraw(true);\n        } else if(event.getType() == ThemesToolEvent.TYPE()) {\n            // theme change\n            this.redraw(true);\n        }\n    }\n\n    // ----------------- TODO: refactorization needed\n\n    /**\n     * It returns scale.\n     */\n    getScale() {\n        return SCALE;\n    }\n\n    /**\n     * It returns color style for the current template.\n     * \n     * @deprecated\n     */\n    getColors() {\n        let dataMappingModel = this.getDefaults().getDataMappingModel();\n        let dataMapping = this.getState().getDataMapping();\n        if(dataMapping[dataMappingModel.color.name] == 'red') {\n            return COLOR_red;\n        } else if(dataMapping[dataMappingModel.color.name] == 'blue') {\n            return COLOR_blue;\n        }\n            return COLOR_orange;\n    }\n\n    /**\n     * It returns color value for the current template and given value.\n     * \n     * @deprecated\n     */\n    computeColor(val) {\n        let colors = this.getColors();\n        let scale = this.getScale();\n        return val > scale[6] ? colors[7] :\n                val > scale[5] ? colors[6] :\n                val > scale[4] ? colors[5] :\n                val > scale[3] ? colors[4] :\n                val > scale[2] ? colors[3] :\n                val > scale[1] ? colors[2] :\n                val > scale[0] ? colors[1] :\n                colors[0];\n    }\n\n    /**\n     * It returns color class for the current template and given value.\n     */\n    computeColorClass(val) {\n        let scale = this.getScale();\n        return val > scale[6] ? \"leaflet-choropleth-item-clr8\" :\n                val > scale[5] ? \"leaflet-choropleth-item-clr7\" :\n                val > scale[4] ? \"leaflet-choropleth-item-clr6\" :\n                val > scale[3] ? \"leaflet-choropleth-item-clr5\" :\n                val > scale[2] ? \"leaflet-choropleth-item-clr4\" :\n                val > scale[1] ? \"leaflet-choropleth-item-clr3\" :\n                val > scale[0] ? \"leaflet-choropleth-item-clr2\" :\n                \"leaflet-choropleth-item-clr1\";\n    }\n\n    /**\n     * It returns style for the current template and given feature.\n     * \n     * @deprecated\n     */\n    computeStyle(item) {       \n        let feature = item.feature;\n        let hoveredItem = this.getState().getHoveredItem();\n        let selection = this.getSelectionTool() ? this.getSelectionTool().getState().getSelection() : undefined;\n        return {\n            weight: hoveredItem == feature.id ? 4 : 2,\n            opacity: 0.7,\n            color: hoveredItem == feature.id ? \"yellow\":\"white\",\n            dashArray: hoveredItem == feature.id ? '' : '1',\n            fillOpacity: hoveredItem == feature.id ? 0.9 : 0.8,\n            fillColor: selection != null ?\n                        (selection.getTool() == this && selection.getSrcIds().includes(feature.id) ? 'orange' :\n                        (selection.getIds().includes(feature.id) ? 'yellow' : '#8c8c8c'))\n                        : this.computeColor(feature.value)\n        };\n    }\n\n    /**\n     * It returns style classes for the current template and given feature.\n     */\n    computeStyleClasses(item) {\n        let classList = [ \"leaflet-interactive\", \"leaflet-choropleth-item-basic\" ];\n\n        let feature = item.feature;\n\n        // compute color level\n        classList.push(this.computeColorClass(feature.value));\n\n        // hovered\n        if(this.getState().getHoveredItem() == feature.id) {\n            classList.push(\"leaflet-choropleth-item-hover\")\n        }\n\n        // selected / highlighted\n        let selection = this.getSelectionTool() ? this.getSelectionTool().getState().getSelection() : undefined;\n        let selectedIds = selection.getIds();\n        if(selection && selectedIds.length > 0) {\n            if(selectedIds.includes(feature.id)) {\n                if(selection.getTool() == this && selection.getSrcIds().includes(feature.id)) {\n                    // selected\n                    classList.push(\"leaflet-choropleth-item-select\")\n                } else {\n                    // affected, highlighted\n                    classList.push(\"leaflet-choropleth-item-highlight\")\n                }\n            } else {\n                // de-emphasize others\n                classList.push(\"leaflet-choropleth-item-deempasize\")\n            }\n        }\n\n        return classList;\n    }\n\n    /**\n     * It updates style of the given feature using the current template.\n     */\n    updateItemStyle(item) {\n        //item.setStyle(this.computeStyle(item));\n        if(item._path != undefined) {\n            // modify classes\n            item._path.classList.value = this.computeStyleClasses(item).join(\" \");\n        }\n    }\n\n    /**\n     * It updates style of all layer features using the current template.\n     */\n    updateStyle() {\n        if(this.getState().getLayer()) {\n            var _this = this;\n            this.getState().getLayer().eachLayer(function(item) {\n                _this.updateItemStyle(item);\n            });\n        }\n    }\n\n}\n\nexport default ChoroplethLayerTool;\n","import AbstractLayerToolTabControlDefaults from \"../../abstract/sidebar/AbstractLayerToolTabControlDefaults\";\n\n\n/**\n * This class provide functions which return the default state values.\n * \n * @author Jiri Hynek\n */\nclass MarkerLayerToolTabControlDefaults extends AbstractLayerToolTabControlDefaults {\n\n    /**\n     * It creates tab control defaults.\n     */\n    constructor() {\n        super();\n    }\n\n    /**\n     * It returns the icon of the tab pane.\n     */\n    getIcon() {\n        return '<i class=\"fa fa-map-marker\"></i>';\n    }\n}\nexport default MarkerLayerToolTabControlDefaults;","import AbstractLayerToolTabControlState from \"../../abstract/sidebar/AbstractLayerToolTabControlState\";\n\n\n/**\n * This class manages the state of the sidebar tab.\n * It wraps the state since the sidebar tab can work with state objects which needs to be explicitly serialized.\n * \n * @author Jiri Hynek\n */\nclass MarkerLayerToolTabControlState extends AbstractLayerToolTabControlState {\n\n    /**\n     * It creates a tab control state.\n     */\n    constructor() {\n        super();\n    }\n}\nexport default MarkerLayerToolTabControlState;","import MarkerLayerToolTabControlDefaults from \"./MarkerLayerToolTabControlDefaults\";\nimport MarkerLayerToolTabControlState from \"./MarkerLayerToolTabControlState\";\nimport AbstractLayerToolTabControl from \"../../abstract/sidebar/AbstractLayerToolTabControl\";\nimport SidebarInputFactory from \"../../../../inputs/SidebarInputFactory\";\n\n/**\n * This class provides controls for management of the layer sidebar tab.\n * \n * @author Jiri Hynek\n */\nclass MarkerLayerToolTabControl extends AbstractLayerToolTabControl {\n\n    constructor(tool) {\n        super(tool);\n\n        this.tabContent = undefined;\n    }\n\n    /**\n     * It creates new defaults of the tab control.\n     */\n    createDefaults() {\n        return new MarkerLayerToolTabControlDefaults();\n    }\n\n    /**\n     * It creates new state of the tab control.\n     */\n    createState() {\n        return new MarkerLayerToolTabControlState();\n    }\n\n    /**\n     * It acquire selected data mapping from input values.\n     */\n    getInputValues() {\n        // get data mapping model\n        let model = this.getDefaults().getDataMappingModel();\n        \n        // create new selection\n        let dataMapping = {};\n\n        // get selected data domains values\n        dataMapping[model.country.name] = this.inputCountry.getValue();\n        dataMapping[model.value.name] = this.inputValue.getValue();\n        dataMapping[model.aggregation.name] = this.inputAggregation.getValue();\n        dataMapping[model.category.name] = this.inputCategory.getValue();\n\n        return dataMapping;\n    }\n\n    /**\n     * It updates selected input values according to the given data mapping.\n     * \n     * @param {*} dataMapping \n     */\n    setInputValues(dataMapping) {\n        // get data mapping model\n        let model = this.getDefaults().getDataMappingModel();\n\n        // update inputs\n        this.inputCountry.setValue(dataMapping[model.country.name]);\n        this.inputValue.setValue(dataMapping[model.value.name]);\n        this.inputAggregation.setValue(dataMapping[model.aggregation.name]);\n        this.inputCategory.setValue(dataMapping[model.category.name]);\n    }\n\n    /**\n     * It returns the sidebar tab pane.\n     */\n    getTabContent() {\n        var _this = this;\n\n        // event handler: change dimension action\n        let changeDimensionAction = function(e) {\n            // get selected values and update layer's data mapping\n            _this.getTool().updateDataMapping(_this.getInputValues());\n        }\n        \n        // tab content\n        let tab = document.createElement('div');\n        let elem = tab.appendChild(document.createElement('div'));\n\n        // get selection model\n        let model = this.getDefaults().getDataMappingModel();\n        let dataDomainLabels = this.getTool().getMap().getState().getMapData().getDataDomainLabels();\n\n        // select country\n        this.inputCountry = SidebarInputFactory.createSidebarInput(model.country.input, { label: model.country.label , options: dataDomainLabels, action: changeDimensionAction });\n        elem.appendChild(this.inputCountry.create());\n\n        // select value\n        this.inputValue = SidebarInputFactory.createSidebarInput(model.value.input, { label: model.value.label , options: dataDomainLabels, action: changeDimensionAction });\n        elem.appendChild(this.inputValue.create());\n\n        // select aggregation\n        this.inputAggregation = SidebarInputFactory.createSidebarInput(model.aggregation.input, { label: model.aggregation.label, options: model.aggregation.options, action: changeDimensionAction });\n        elem.appendChild(this.inputAggregation.create());\n\n        // select category\n        this.inputCategory = SidebarInputFactory.createSidebarInput(model.category.input, { label: model.category.label, options: dataDomainLabels, action: changeDimensionAction });\n        elem.appendChild(this.inputCategory.create());\n\n        this.setInputValues(this.getTool().getState().getDataMapping());\n        \n        return tab;\n    }\n\n}\nexport default MarkerLayerToolTabControl;","import MarkerLayerTool from \"./MarkerLayerTool\";\nimport AbstractLayerToolDefaults from \"../abstract/AbstractLayerToolDefaults\";\nimport AutocompleteSidebarInput from \"../../../inputs/input/AutocompleteSidebarInput\";\n\n/**\n * TODO: refactorization needed!\n */\nconst TYPE = 'marker';\n\nconst INPUT_ID_PREFIX = \"geovisto-input-\" + TYPE;\n\n/**\n * Data mapping model which can be used in the sidebar form.\n */\nconst MAPPING_MODEL = {\n    country: {\n        id: INPUT_ID_PREFIX + \"-input-country\",\n        name: \"country\",\n        label: \"Country\",\n        input: AutocompleteSidebarInput.ID()\n    },\n    value: {\n        id: INPUT_ID_PREFIX + \"-input-value\",\n        name: \"value\",\n        label: \"Value\",\n        input: AutocompleteSidebarInput.ID()\n    },\n    aggregation: {\n        id: INPUT_ID_PREFIX + \"-input-aggregation\",\n        name: \"aggregation\",\n        label: \"Agregation\",\n        options: [ \"count\", \"sum\" ],\n        input: AutocompleteSidebarInput.ID()\n    },\n    category: {\n        id: INPUT_ID_PREFIX + \"-input-category\",\n        name: \"category\",\n        label: \"Category\",\n        input: AutocompleteSidebarInput.ID()\n    }\n}\n\n/**\n * This class provide functions which return the default state values.\n * \n * @author Jiri Hynek\n */\nclass MarkerLayerToolDefaults extends AbstractLayerToolDefaults {\n\n    /**\n     * It initializes tool defaults.\n     */\n    constructor() {\n        super();\n    }\n\n    /**\n     * It returns a unique type string of the tool which is based on the layer it wraps.\n     */\n    getType() {\n        return MarkerLayerTool.TYPE();\n    }\n\n    /**\n     * It returns the layer name.\n     */\n    getLayerName() {\n        return \"Marker layer\";\n    }\n\n    /**\n     * It returns the default mapping of data domains to chart dimensions.\n     */\n    getDataMapping() {\n        let dataMapping = {};\n        \n        let dataMappingModel = this.getDataMappingModel();\n        let implicitDataDomainLabel = this.getMapObject().getMap().getState().getMapData().getDataDomainLabels()[0];\n        \n        dataMapping[dataMappingModel.country.name] = implicitDataDomainLabel;\n        dataMapping[dataMappingModel.value.name] = implicitDataDomainLabel;\n        dataMapping[dataMappingModel.aggregation.name] = dataMappingModel.aggregation.options[0];\n        dataMapping[dataMappingModel.category.name] = implicitDataDomainLabel;\n\n        return dataMapping;\n    }\n\n    /**\n     * It returns the data mapping model.\n     */\n    getDataMappingModel() {\n        return MAPPING_MODEL;\n    }\n    \n    /**\n     * It returns default centroids.\n     */\n    getCentroids() {\n        return JSON.parse(JSON.stringify(this.getMapObject().getMap().getState().getCentroids()));\n    }\n}\nexport default MarkerLayerToolDefaults;","import AbstractLayerToolState from \"../abstract/AbstractLayerToolState\";\nimport MarkerLayerToolDefaults from \"./MarkerLayerToolDefaults\";\n\n/**\n * This class provide functions for using the state of the layer tool.\n * \n * @author Jiri Hynek\n */\nclass MarkerLayerToolState extends AbstractLayerToolState {\n\n    /**\n     * It creates a tool state.\n     */\n    constructor() {\n        super();\n    }\n\n    /**\n     * It resets state with respect to initial props. Optionally, defaults can be set if property is undefined.\n     * \n     * @param {MarkerLayerToolDefaults} defaults \n     */\n    reset(defaults) {\n        super.reset(defaults);\n\n        // the layer tool properties\n        this.setMarkers([]);\n        // TODO\n    }\n\n    /**\n     * Help function which initialize state properties realated with map.\n     */\n    resetMapVariables(map, defaults) {\n        super.resetMapVariables(map, defaults);\n        \n        let props = this.getProps();\n        this.setCentroids(props.centroids == undefined && defaults && map ? defaults.getCentroids() : props.centroids);\n    }\n\n    /**\n     * The metod takes config and desrializes the values.\n     * \n     * @param {*} config \n     */\n    deserialize(config) {\n        super.deserialize(config);\n\n        // the layer tool config\n        // TODO\n    }\n\n    /**\n     * The method serializes the tool state. Optionally, defaults can be set if property is undefined.\n     * \n     * @param {MarkerLayerToolDefaults} defaults\n     */\n    serialize(defaults) {\n        let config = super.serialize(defaults);\n\n        // serialize the layer tool properties\n        // TODO\n\n        return config;\n    }\n\n    /**\n     * It returns a Leaflet layer group.\n     */\n    getLayer() {\n        return this.layer;\n    }\n\n    /**\n     * It sets a Leaflet layer group.\n     * \n     * @param {L.layerGroup} layer \n     */\n    setLayer(layer) {\n        this.layer = layer;\n    }\n\n    /**\n     * It returns the centroids.\n     */\n    getCentroids() {\n        return this.centroids;\n    }\n\n    /**\n     * It sets the centroids.\n     * \n     * @param {*} centroids \n     */\n    setCentroids(centroids) {\n        this.centroids = centroids;\n    }\n\n    /**\n     * It returns the markers.\n     */\n    getMarkers() {\n        return this.markers;\n    }\n\n    /**\n     * It sets the markers.\n     * \n     * @param {*} markers \n     */\n    setMarkers(markers) {\n        this.markers = markers;\n    }\n\n    // TODO\n}\nexport default MarkerLayerToolState;","import L from 'leaflet';\nimport LL from 'leaflet.markercluster';\nimport 'leaflet/dist/leaflet.css';\nimport 'leaflet.markercluster/dist/MarkerCluster.css';\nimport 'leaflet.markercluster/dist/MarkerCluster.Default.css';\nimport './style/markerLayer.scss'; \nimport * as d3 from \"d3\";\nimport MarkerLayerToolTabControl from './sidebar/MarkerLayerToolTabControl';\nimport MarkerLayerToolDefaults from './MarkerLayerToolDefaults';\nimport MarkerLayerToolState from './MarkerLayerToolState';\nimport SelectionTool from '../../selection/SelectionTool';\nimport AbstractLayerTool from '../abstract/AbstractLayerTool';\nimport ThemesToolEvent from '../../themes/model/event/ThemesToolEvent';\nimport SelectionToolEvent from '../../selection/model/event/SelectionToolEvent';\nimport DataChangeEvent from '../../../model/event/basic/DataChangeEvent';\n\n/**\n * This class represents custom div icon which is used to mark center of countries.\n * It overrides L.DivIcon.\n * \n * @author Jiri Hynek\n * @override {L.DivIcon}\n */\nvar CountryIcon = L.DivIcon.extend({\n\n    _LEVEL: 0,\n    _SUFFIX: 1,\n    _COLOR: 2,\n    levels: [\n        [-Infinity, \"N/A\", \"#CCCCCC\"],\n        [1, \"\", \"#CCCCCC\"],\n        [1e2, \"K\", \"#AAAAAA\"],\n        [1e5, \"M\", \"#555555\"],\n        [1e8, \"B\", \"#222222\"],\n        [1e11, \"t\", \"#111111\"],\n    ],\n\n    // moved to css\n    //donutColors: [\"darkred\", \"goldenrod\", \"gray\"],\n\n    options: {\n        sizeBasic: 32,\n        sizeGroup: 36,\n        sizeDonut: 48,\n\n        // It is derived\n        //iconSize: [32,32],\n        //iconAnchor: [32/2,32/2],\n\n        className: \"div-country-icon\",\n        values: {\n            id: \"\",\n            value: 0,\n            subvalues: {\n                active: 0,\n                mitigated: 0,\n                finished: 0,\n            }\n        },\n        isGroup: false,\n        useDonut: true\n    },\n\n    round: function(value, align) {\n        return Math.round(value*align)/align;\n    },\n\n    formatValue: function(value, level) {\n        if(level == undefined || level < 0) {\n            return this.levels[0][this._SUFFIX];\n        } else {\n            if(this.levels[level][this._LEVEL] == -Infinity) {\n                return this.levels[level][this._SUFFIX];\n            } else if(this.levels[level][this._LEVEL] == 1) {\n                return this.round(value, this.levels[level][this._LEVEL]);\n            } else {\n                value = value/(this.levels[level][this._LEVEL]*10);\n                var align = (value >= 10) ? 1 : 10;\n                return this.round(value, align) + this.levels[level][this._SUFFIX];\n            }\n        }\n    },\n\n    getColor: function(level) {\n        if(level == null || level < 0) {\n            return this.levels[0][this._COLOR];\n        } else {\n            return this.levels[level][this._COLOR];\n        }\n    },\n\n    getLevel: function(value) {\n        for(var i = this.levels.length-1; i >= 0; i--) {\n            if(value > this.levels[i][this._LEVEL]) {\n            return i;\n            }\n        }\n        return -1;\n    },\n\n    createIcon: function (oldIcon) {\n        var div = (oldIcon && oldIcon.tagName === 'DIV') ? oldIcon : document.createElement('div'),\n            options = this.options;\n\n        var size = options.useDonut ? options.sizeDonut : (options.isGroup ? options.sizeGroup : options.sizeBasic);\n        options.iconSize = [size,size];\n        options.iconAnchor = [size/2,size/2];\n        var rCircle = options.sizeBasic/2;\n        var center = size/2;\n        // moved to css\n        //var strokeWidth = options.isGroup ? ((options.sizeGroup-options.sizeBasic)/2) : 0;\n        var level = this.getLevel(options.values.value);\n\n        var divContent = div.appendChild(document.createElement('div'));\n        divContent.classList.value = \n            \"leaflet-marker-level\" + level // level\n            + (options.isGroup ? \" leaflet-marker-group\" : \"\") // group of several markers\n        ;\n\n\n        //console.log(size);\n        var element = d3.select(divContent);\n        //console.log(element)\n        var svg = element.append(\"svg\");\n        svg.attr(\"width\", size).attr(\"height\", size);\n        //svg.classList.add(\"leaflet-marker-item\");\n\n        // circle\n        svg.append(\"circle\")\n            .attr(\"cx\", center)\n            .attr(\"cy\", center)\n            .attr(\"r\", rCircle)\n            // moved to css\n            //.attr(\"fill\", this.getColor(level))\n            //.attr(\"fill-opacity\", 0.9)\n            //.attr(\"stroke-width\", strokeWidth)\n            //.attr(\"stroke\", \"black\");\n\n        // value label\n        svg.append(\"text\")\n            .html(this.formatValue(options.values.value, level))\n            .attr(\"x\", \"50%\")\n            .attr(\"y\", \"50%\")\n            .attr(\"text-anchor\", \"middle\")\n            .attr(\"font-size\", \"12px\")\n            .attr(\"dy\", \"0.3em\")\n            .attr(\"font-family\", \"Arial\");\n            // moved to css\n            //.attr(\"fill\", \"white\")\n\n        if(options.values.value != null && options.values.value != 0) {\n        //var values = { a: 0.5, b: 0.3, c: 0.2 };\n        // moved to css\n        //var color = d3.scaleOrdinal()\n        //    .domain(options.values.subvalues)\n        //    .range(this.donutColors);\n        var pie = d3.pie().value(function(d) { return d[1]; });\n        var values_ready = pie(Object.entries(options.values.subvalues));\n        // donut chart\n        svg.append(\"g\")\n            .attr(\"transform\", \"translate(\" + size / 2 + \",\" + size / 2 + \")\")\n            .selectAll(\"abc\")\n            .data(values_ready)\n            .enter()\n            .append(\"path\")\n            .attr(\"d\", d3.arc()\n            .innerRadius(size/4+6)\n            .outerRadius(size/2)\n            )\n            // moved to css\n            .attr('class', function(d, i) { return \"leaflet-marker-donut\" + (i % 3 + 1); })\n            //.attr('fill', function(d) { return(color(d.data.key)) })\n            //.attr(\"stroke-width\", \"0px\")\n            //.attr(\"opacity\", 0.8)\n            ;\n        }\n\n        /*const icon = <svg width={size} height={size}>\n            <circle cx={center} cy={center} r={rCircle} fill={this.getColor(level)} fillOpacity=\"0.8\" strokeWidth={strokeWidth} stroke=\"black\" />\n            <text x=\"50%\" y=\"50%\" textAnchor=\"middle\" fill=\"white\"\n                fontSize=\"12px\" dy=\"0.3em\" fontFamily=\"Arial\">{this.formatValue(options.countryValue, level)}</text>\n        </svg>;\n        //div.innerHTML = \"<b>1</b>\";\n        ReactDOM.render(icon, divContent);*/\n\n        if (options.bgPos) {\n            var bgPos = point(options.bgPos);\n            div.style.backgroundPosition = (-bgPos.x) + 'px ' + (-bgPos.y) + 'px';\n        }\n        this._setIconStyles(div, 'icon');\n\n        return div;\n    },\n});\n\n/**\n * This class represents Marker layer. It works with geojson polygons representing countries.\n * \n * @author Jiri Hynek\n */\nclass MarkerLayerTool extends AbstractLayerTool {\n\n    /**\n     * It creates a new tool with respect to the props.\n     * \n     * @param {*} props \n     */\n    constructor(props) {\n        super(props);\n    }\n\n    /**\n     * A unique string of the tool type.\n     */\n    static TYPE() {\n        return \"geovisto-tool-layer-marker\"; \n    }\n\n    /**\n     * It creates a copy of the uninitialized tool.\n     */\n    copy() {\n        return new MarkerLayerTool(this.getProps());\n    }\n\n    /**\n     * It creates new defaults of the tool.\n     */\n    createDefaults() {\n        return new MarkerLayerToolDefaults();\n    }\n\n    /**\n     * It returns default tool state.\n     */\n    createState() {\n        return new MarkerLayerToolState();\n    }\n\n    /**\n     * Help function which acquires and returns the selection tool if available.\n     */\n    getSelectionTool() {\n        if(this.selectionTool == undefined) {\n            let tools = this.getMap().getState().getTools().getByType(SelectionTool.TYPE());\n            if(tools.length > 0) {\n                this.selectionTool = tools[0];\n            }\n        }\n        return this.selectionTool;\n    }\n\n    /**\n     * It creates new tab control.\n     */\n    createSidebarTabControl() {\n        return new MarkerLayerToolTabControl({ tool: this });\n    }\n\n    /**\n     * It creates layer items.\n     */\n    createLayerItems() {\n        // create layer which clusters points\n        //let layer = L.layerGroup([]);\n        let layer = L.markerClusterGroup({\n\n            // create cluster icon\n            iconCreateFunction: function (cluster) {\n                var markers = cluster.getAllChildMarkers();\n                let data = { id: \"<Group>\", value: 0, subvalues: {} };\n                for (var i = 0; i < markers.length; i++) {\n                    data.value += markers[i].options.icon.options.values.value;\n                    for(let [key, value] of Object.entries(markers[i].options.icon.options.values.subvalues)) {\n                        if(data.subvalues[key] == undefined) {\n                            data.subvalues[key] = value;\n                        } else {\n                            data.subvalues[key] += value;\n                        }\n                    }\n                }\n                // create custom icon\n                return new CountryIcon( { \n                    countryName: \"<Group>\",\n                    values: data,\n                    isGroup: true,\n                } );\n            }\n        });\n\n        // update state\n        this.getState().setLayer(layer);\n\n        this.redraw();\n\n        return [ layer ];\n    }\n\n    /**\n     * It deletes layer items.\n     */\n    deleteLayerItems() {\n        //console.log(\"marker\");\n        let markers = this.getState().getMarkers();\n\n        // delete the 'value' property of every geo feature object if defined\n        let layer = this.getState().getLayer();\n        for(let i = 0; i < markers.length; i++) {\n            layer.removeLayer(markers[i]);\n        }\n        \n        this.getState().setMarkers([]);\n    }\n\n    /**\n     * It prepares data for markers.\n     */\n    prepareMapData() {\n        //console.log(\"updating map data\", this);\n\n        // prepare data\n        let workData = [];\n        let mapData = this.getMap().getState().getMapData();\n        let dataMappingModel = this.getDefaults().getDataMappingModel();\n        let dataMapping = this.getState().getDataMapping();\n        let countryDataDomain = mapData.getDataDomain(dataMapping[dataMappingModel.country.name]);\n        let valueDataDomain = mapData.getDataDomain(dataMapping[dataMappingModel.value.name]);\n        let categoryDataDomain = mapData.getDataDomain(dataMapping[dataMappingModel.category.name]);\n        let geoCountry, actResultItem;\n        let foundCountries, foundValues, foundCategories;\n        let highlightedIds = this.getSelectionTool() && this.getSelectionTool().getState().getSelection() ?\n                                this.getSelectionTool().getState().getSelection().getIds() : [];\n        let data = this.getMap().getState().getCurrentData();\n        let dataLen = data.length;\n        let centroids = this.getState().getCentroids();\n        for (let i = 0; i < dataLen; i++) {\n            // find the 'country' properties\n            foundCountries = mapData.getItemValues(countryDataDomain, data[i]);\n            //console.log(\"search country: \", foundCountries);\n\n            // find the 'value' properties\n            foundValues = mapData.getItemValues(valueDataDomain, data[i]);\n            //console.log(\"search values: \", foundValues);\n\n            // find the 'category' properties\n            foundCategories = mapData.getItemValues(categoryDataDomain, data[i]);\n            //console.log(\"search category: \", foundCategories);\n\n            // since the data are flattened we can expect max one found item\n            //console.log(\"abc\", highlightedIds);\n            if(foundCountries.length == 1 && (highlightedIds.length == 0 || highlightedIds.indexOf(foundCountries[0]) >= 0)) {\n                // test if country respects highlighting selection\n                /*if(highlightedIds != undefined) {\n                    console.log(highlightedIds.indexOf(foundCountries[0]) >= 0);\n                }*/\n\n                // test if country exists in the map\n                geoCountry = centroids.find(x => x.id == foundCountries[0]);\n                if(geoCountry != undefined) {\n                    // test if country exists in the results array\n                    actResultItem = workData.find(x => x.id == foundCountries[0]);\n                    if(actResultItem == undefined) {\n                        actResultItem = { id: foundCountries[0], value: 0, subvalues: {} };\n                        workData.push(actResultItem);\n                    }\n                    // initialize category if does not exists yet\n                    if(foundCategories.length == 1) {\n                        if(actResultItem.subvalues[foundCategories[0]] == undefined) {\n                            actResultItem.subvalues[foundCategories[0]] = 0;\n                        }\n                    }\n                    // set value with respect to the aggregation function\n                    if(dataMapping[dataMappingModel.aggregation.name] == \"sum\") {\n                        // test if value is valid\n                        if(foundValues.length == 1 && foundValues[0] != null && typeof foundValues[0] === 'number') {\n                            actResultItem.value += foundValues[0];\n                            // set category\n                            if(foundCategories.length == 1) {\n                                actResultItem.subvalues[foundCategories[0]] += foundValues[0];\n                            }\n                        }\n                    } else {\n                        // count\n                        actResultItem.value++;\n                        // incerement category value\n                        actResultItem.subvalues[foundCategories[0]]++;\n                    }\n                }\n            }\n        }\n        //console.log(\"result: \", preparedData);\n        return workData;\n    }\n\n    /**\n     * It creates markers using workData\n     */\n    createMarkers(workData) {\n        // create markers\n        let markers = [];\n\n        let geoCountry;\n        let layer = this.getState().getLayer();\n        let centroids = this.getState().getCentroids();\n        for(let i = 0; i < workData.length; i++) {\n            // get centroid\n            // note: the centroid exists since invalid countries has been filtered\n            geoCountry = centroids.find(x => x.id == workData[i].id);\n            // build message\n            let point = this.createMarker(geoCountry, workData[i]);\n            layer.addLayer(point);\n            markers.push(point);\n        }\n\n        return markers;\n    }\n\n    /**\n     * It creates one marker with respect to the given centroid and data.\n     * \n     * @param {*} centroid \n     * @param {*} data \n     */\n    createMarker(centroid, data) {\n        function thousands_separator(num)\n          {\n            var num_parts = num.toString().split(\".\");\n            num_parts[0] = num_parts[0].replace(/\\B(?=(\\d{3})+(?!\\d))/g, \" \");\n            return num_parts.join(\".\");\n          }\n\n        // build popup message\n        let popupMsg = \"<b>\" + centroid.name + \"</b><br>\";\n        popupMsg += (data.value != null ? thousands_separator(data.value) : \"N/A\") + \"<br>\";\n        for(let [key, value] of Object.entries(data.subvalues)) {\n            popupMsg += key + \": \" + thousands_separator(value) + \"<br>\";\n        }\n\n        // create marker\n        let point = L.marker([centroid.lat, centroid.long], {\n            // create basic icon \n            id: centroid.name,\n            icon: new CountryIcon( {\n                values: data\n            } ) \n        }).bindPopup(popupMsg);\n        return point;\n    }\n\n    /**\n     * It reloads data and redraw the layer.\n     */\n    redraw(onlyStyle) {\n        if(this.getState().getLayer()) {\n            // delete actual items\n            this.deleteLayerItems();\n\n            // prepare data\n            let workData = this.prepareMapData();\n\n            // update map\n            let markers = this.createMarkers(workData);\n\n            // update state\n            this.getState().setMarkers(markers);\n        }\n    }\n\n    /**\n     * This function is called when a custom event is invoked.\n     * \n     * @param {AbstractEvent} event \n     */\n    handleEvent(event) {\n        if(event.getType() == DataChangeEvent.TYPE()) {\n            // data change\n            this.redraw();\n        } else if(event.getType() == SelectionToolEvent.TYPE()) {\n            this.redraw();\n            // TODO\n        } else if(event.getType() == ThemesToolEvent.TYPE()) {\n            // theme change\n            // TODO\n        }\n    }\n}\n\nexport default MarkerLayerTool;","import AbstractLayerToolTabControlDefaults from \"../../abstract/sidebar/AbstractLayerToolTabControlDefaults\";\n\n\n/**\n * This class provide functions which return the default state values.\n * \n * @author Jiri Hynek\n */\nclass ConnectionLayerToolTabControlDefaults extends AbstractLayerToolTabControlDefaults {\n\n    /**\n     * It creates tab control defaults.\n     */\n    constructor() {\n        super();\n    }\n\n    /**\n     * It returns the icon of the tab pane.\n     */\n    getIcon() {\n        return '<i class=\"fa fa-road\"></i>';\n    }\n}\nexport default ConnectionLayerToolTabControlDefaults;","import AbstractLayerToolTabControlState from \"../../abstract/sidebar/AbstractLayerToolTabControlState\";\n\n\n/**\n * This class manages the state of the sidebar tab.\n * It wraps the state since the sidebar tab can work with state objects which needs to be explicitly serialized.\n * \n * @author Jiri Hynek\n */\nclass ConnectionLayerToolTabControlState extends AbstractLayerToolTabControlState {\n\n    /**\n     * It creates a tab control state.\n     */\n    constructor() {\n        super();\n    }\n}\nexport default ConnectionLayerToolTabControlState;","import ConnectionLayerToolTabControlDefaults from './ConnectionLayerToolTabControlDefaults';\nimport ConnectionLayerToolTabControlState from './ConnectionLayerToolTabControlState';\nimport AbstractLayerToolTabControl from '../../abstract/sidebar/AbstractLayerToolTabControl';\nimport SidebarInputFactory from '../../../../inputs/SidebarInputFactory';\n\n/**\n * This class provides controls for management of the layer sidebar tab.\n *\n * @author Jiri Hynek\n */\nclass ConnectionLayerToolTabControl extends AbstractLayerToolTabControl {\n  constructor(tool) {\n    super(tool);\n\n    this.tabContent = undefined;\n  }\n\n  /**\n   * It creates new defaults of the tab control.\n   */\n  createDefaults() {\n    return new ConnectionLayerToolTabControlDefaults();\n  }\n\n  /**\n   * It creates new state of the tab control.\n   */\n  createState() {\n    return new ConnectionLayerToolTabControlState();\n  }\n\n  /**\n   * It acquire selected data mapping from input values.\n   */\n  getInputValues() {\n    // get data mapping model\n    let model = this.getDefaults().getDataMappingModel();\n\n    // create new selection\n    let dataMapping = {};\n\n    // get selected data domains values\n    dataMapping[model.from.name] = this.inputFrom.getValue();\n    dataMapping[model.to.name] = this.inputTo.getValue();\n\n    return dataMapping;\n  }\n\n  /**\n   * It updates selected input values according to the given data mapping.\n   *\n   * @param {*} dataMapping\n   */\n  setInputValues(dataMapping) {\n    // get data mapping model\n    let model = this.getDefaults().getDataMappingModel();\n\n    // update inputs\n    this.inputFrom.setValue(dataMapping[model.from.name]);\n    this.inputTo.setValue(dataMapping[model.to.name]);\n  }\n\n  /**\n   * It returns the sidebar tab pane.\n   */\n  getTabContent() {\n    var _this = this;\n\n    // event handler: change dimension action\n    let changeDimensionAction = function (e) {\n      // get selected values and update layer's data mapping\n      _this.getTool().updateDataMapping(_this.getInputValues());\n    };\n\n    // tab content\n    let tab = document.createElement('div');\n    let elem = tab.appendChild(document.createElement('div'));\n\n    // get data mapping model\n    let model = this.getDefaults().getDataMappingModel();\n    let dataDomainLabels = this.getTool().getMap().getState().getMapData().getDataDomainLabels();\n    console.log({ model });\n    // select from\n    this.inputFrom = SidebarInputFactory.createSidebarInput(model.from.input, {\n      label: model.from.label,\n      options: dataDomainLabels,\n      action: changeDimensionAction,\n    });\n    elem.appendChild(this.inputFrom.create());\n\n    // select to\n    this.inputTo = SidebarInputFactory.createSidebarInput(model.from.input, {\n      label: model.to.label,\n      options: dataDomainLabels,\n      action: changeDimensionAction,\n    });\n    elem.appendChild(this.inputTo.create());\n\n    this.setInputValues(this.getTool().getState().getDataMapping());\n\n    return tab;\n  }\n}\nexport default ConnectionLayerToolTabControl;\n","import ConnectionLayerTool from \"./ConnectionLayerTool\";\nimport AbstractLayerToolDefaults from \"../abstract/AbstractLayerToolDefaults\";\nimport AutocompleteSidebarInput from \"../../../inputs/input/AutocompleteSidebarInput\";\n\n/**\n * TODO: refactorization needed!\n */\nconst TYPE = 'connection';\n\nconst INPUT_ID_PREFIX = \"geovisto-input-\" + TYPE;\n\n/**\n * Data mapping model which can be used in the sidebar form.\n */\nconst MAPPING_MODEL = {\n    from: {\n        id: INPUT_ID_PREFIX + \"-from\",\n        name: \"from\",\n        label: \"From\",\n        input: AutocompleteSidebarInput.ID()\n    },\n    to: {\n        id: INPUT_ID_PREFIX + \"-to\",\n        name: \"to\",\n        label: \"To\",\n        input: AutocompleteSidebarInput.ID()\n    }\n}\n\n\n/**\n * This class provide functions which return the default state values.\n * \n * @author Jiri Hynek\n */\nclass ConnectionLayerToolDefaults extends AbstractLayerToolDefaults {\n\n    /**\n     * It initializes tool defaults.\n     */\n    constructor() {\n        super();\n    }\n\n    /**\n     * It returns a unique type string of the tool which is based on the layer it wraps.\n     */\n    getType() {\n        return ConnectionLayerTool.TYPE();\n    }\n\n    /**\n     * It returns the layer name.\n     */\n    getLayerName() {\n        return \"Connection layer\";\n    }\n\n    /**\n     * It returns the default mapping of data domains to chart dimensions.\n     */\n    getDataMapping() {\n        let dataMapping = {};\n        \n        let dataMappingModel = this.getDataMappingModel();\n        let implicitDataDomainLabel = this.getMapObject().getMap().getState().getMapData().getDataDomainLabels()[0];\n        \n        dataMapping[dataMappingModel.from.name] = implicitDataDomainLabel;\n        dataMapping[dataMappingModel.to.name] = implicitDataDomainLabel;\n\n        return dataMapping;\n    }\n\n    /**\n     * It returns the data mapping model.\n     */\n    getDataMappingModel() {\n        return MAPPING_MODEL;\n    }\n    \n    /**\n     * It returns optiomal zoom for D3 projections.\n     */\n    getProjectionZoom() {\n        return 2;\n    }\n    \n    /**\n     * It returns default centroids.\n     */\n    getCentroids() {\n        return JSON.parse(JSON.stringify(this.getMapObject().getMap().getState().getCentroids()));\n    }\n}\nexport default ConnectionLayerToolDefaults;","import AbstractLayerToolState from \"../abstract/AbstractLayerToolState\";\nimport ConnectionLayerToolDefaults from \"./ConnectionLayerToolDefaults\";\n\n/**\n * This class provide functions for using the state of the layer tool.\n * \n * @author Jiri Hynek\n */\nclass ConnectionLayerToolState extends AbstractLayerToolState {\n\n    /**\n     * It creates a tool state.\n     */\n    constructor() {\n        super();\n    }\n\n    /**\n     * It initializes the state using the initial props. Optionally, defaults can be set if property is undefined.\n     * \n     * @param {*} props \n     * @param {*} defaults \n     */\n    initialize(props, defaults) {\n        super.initialize(props, defaults);\n    }\n\n    /**\n     * It resets state with respect to initial props. Optionally, defaults can be set if property is undefined.\n     * \n     * @param {ConnectionLayerToolDefaults} defaults \n     */\n    reset(defaults) {\n        super.reset(defaults);\n    }\n\n    /**\n     * Help function which resets the state properties realated with map if not defined.\n     */\n    resetMapVariables(map, defaults) {\n        super.resetMapVariables(map, defaults);\n        \n        let props = this.getProps();\n        this.setCentroids(props.centroids == undefined && defaults && map ? defaults.getCentroids() : props.centroids);\n    }\n\n    /**\n     * The metod takes config and desrializes the values.\n     * \n     * @param {*} config \n     */\n    deserialize(config) {\n        super.deserialize(config);\n\n        // the layer tool config\n        // TODO\n    }\n\n    /**\n     * The method serializes the tool state. Optionally, defaults can be set if property is undefined.\n     * \n     * @param {ConnectionLayerToolDefaults} defaults\n     */\n    serialize(defaults) {\n        let config = super.serialize(defaults);\n\n        // serialize the layer tool properties\n        // TODO\n\n        return config;\n    }\n\n    /**\n     * It returns a Leaflet svg layer.\n     */\n    getLayer() {\n        return this.layer;\n    }\n\n    /**\n     * It sets a Leaflet svg layer.\n     * \n     * @param {L.svg} layer \n     */\n    setLayer(layer) {\n        this.layer = layer;\n    }\n\n    /**\n     * It returns the centroids.\n     */\n    getCentroids() {\n        return this.centroids;\n    }\n\n    /**\n     * It sets the centroids.\n     * \n     * @param {*} centroids \n     */\n    setCentroids(centroids) {\n        this.centroids = centroids;\n    }\n\n    /**\n     * It returns work data for the force layout algorithm.\n     */\n    getWorkData() {\n        return this.workData;\n    }\n\n    /**\n     * It sets the work data for the force layout algorithm.\n     * \n     * @param {*} workData \n     */\n    setWorkData(workData) {\n        this.workData = workData;\n    }\n\n    // TODO\n}\nexport default ConnectionLayerToolState;","import * as d3 from \"d3\";\n\n/**\n * This class represents the force layout simulator powered by the d3-force library.\n * It takes the nodes and connections and prepares the list paths\n * which can be bent by the D3 force simulation.\n * \n * A former idea to split the lines into line segments and use the D3 force simulation can be found\n * in the prototype writen by S. Engle (https://gist.github.com/ericfischer/dafc36a3d212da4619dde2d392553c7a)\n * demonstarting force‐directed edge bundling for graph visualization (by Danny Holten and Jarke J. van Wijk).\n * Further ideas were found in the D3 docs and examples.\n * \n * Our approach implements a very simple segmentation of the connections\n * which works with the constant maximal length of segments.\n * This causes that short connections won't be segmented,\n * which improves the performance of the simulation.\n * The preferred maximal length of the line segments can be adjusted using props.\n * \n * @author Jiri Hynek\n */\nclass D3PathForceSimulator {\n\n    /**\n     * It initializes the object by setting the props.\n     */\n    constructor(props){\n        this.props = props;\n\n        // maximum number of path items\n        this.props.segmentLength = (props.segmentLength ? props.segmentLength : this.getDefaultSegmentLength());\n    }\n    \n    /**\n     * It returns default size of the segment\n     */\n    getDefaultSegmentLength() {\n        return 50;\n    }\n\n    /**\n     * It returns the paths.\n     */\n    getPaths() {\n        if(this.paths == undefined) {\n            this.paths = this.createPaths();\n        }\n        return this.paths;\n    }\n\n    /**\n     * It creates paths (split connections into segments).\n     */\n    createPaths() {\n        let paths = [];\n\n        // go through all map connections and create paths for every connection\n        // connections represented by a path can be bent\n        for(let i = 0; i < this.props.connections.length; i++) {\n            paths.push(this.createPath(this.props.connections[i]));\n        };\n\n        return paths;\n    }\n\n    /**\n     * Help function which takes a connection and split the connection into segments.\n     * The number of segments is based on the preferred maximal length of segment.\n     * \n     * @param {*} connection \n     */\n    createPath(connection) {\n        let path = [];\n\n        // get connection's nodes\n        let source = connection.source;\n        let target = connection.target;\n\n        // add the first point \n        path.push(source);\n\n        // length of the connection: sqrt((x2-x1)^2 + (y2-y1)^2)\n        let length = Math.sqrt((target.x - source.x) * (target.x - source.x)\n                                 + (target.y - source.y) * (target.y - source.y));\n        \n        // preferred number of segments\n        let numberOfSegments = Math.round(length/this.props.segmentLength);\n\n        // add points\n        if(numberOfSegments > 1) {\n            // calculate distance between the points\n            let dx = (target.x - source.x) / numberOfSegments;\n            let dy = (target.y - source.y) / numberOfSegments;\n\n            // add the middle points\n            let numberOfPoints = numberOfSegments-1;\n            let point = source;\n            for (let i = 0; i <= numberOfPoints; i++) {\n                point = {\n                    x: point.x + dx,\n                    y: point.y + dy\n                }\n                // add a middle point\n                path.push(point);\n            }\n        }\n\n        // add the last point\n        path.push(target);\n\n        return path;\n    }\n\n    /**\n     * It creates creates and runs the D3 force layout simulation.\n     * \n     * @param {*} onTickAction\n     * @param {*} onEndAction\n     */\n    run(onTickAction, onEndAction) {\n        // get D3 force layout simulator\n        let simulation = this.getSimulation();\n        \n        // set run properties to run the simulation\n        simulation\n            .on(\"tick\", onTickAction)\n            .on(\"end\", onEndAction);\n    }\n\n    /**\n     * It returns the definition of D3 force simulation.\n     */\n    getSimulation() {\n        // usage of D3 force layout simulation\n        let props = this.getForceProps();\n        // TODO use dynamic props based on current situation\n\n        return d3.forceSimulation(this.getNodes())\n            .force(\"charge\", d3.forceManyBody()\n                .strength(props.charge.strength)\n                .distanceMin(props.charge.distanceMin)\n                .distanceMax(props.charge.distanceMax)\n            )\n            .force(\"link\", d3.forceLink()\n                .links(this.getLinks())\n                .strength(props.link.strength)\n                .distance(props.link.distance)\n            )\n            .alphaDecay(props.alphaDecay)\n    }\n\n    /**\n     * It returns the D3 force simulation props.\n     */\n    getForceProps() {\n        if(this.forceProps == undefined) {\n            this.forceProps = this.createDefaultForceProps();\n        }\n        return this.forceProps;\n    }\n\n    /**\n     * It returns the default D3 force simulation props.\n     */\n    createDefaultForceProps() {\n        return {\n            charge: {\n                strength: 12,\n                distanceMin: 25,\n                distanceMax: 50\n            },\n            link: {\n                strength: 0.8,\n                distance: 0\n            },\n            // how quickly it gets to the alpha (stops the simulation)\n            alphaDecay: 0.15\n        }\n    }\n\n    /**\n     * It returns the nodes for D3 force layout simulator.\n     */\n    getNodes() {\n        if(this.nodes == undefined) {\n            this.nodes = this.createNodes();\n        }\n        return this.nodes;\n    }\n\n    /**\n     * It prepares the nodes for D3 force layout simulator.\n     */\n    createNodes() {\n        let nodes = []\n\n        // go through all end nodes add them to the list\n        let endNodes = this.props.nodes;\n        let node;\n        for(let i = 0; i < endNodes.length; i++) {\n            node = endNodes[i];\n\n            // setting the fx, fy fixed position\n            // -> these nodes should not be moved by the D3 force simulation\n            node.fx = node.x;\n            node.fy = node.y;\n\n            nodes.push(node);\n        };\n        \n        // go throught all paths and add the remaining points between the end nodes\n        let paths = this.getPaths();\n        let path;\n        for(let i = 0; i < paths.length; i++) {\n            path = paths[i];\n            // go through the middle points\n            // the first and the last points have already been added\n            for(let j = 1; j < path.length-1; j++) {\n                nodes.push(path[j]);\n            }\n        }\n        return nodes;\n    }\n\n    /**\n     * It returns the links for D3 force layout simulator.\n     */\n    getLinks() {\n        if(this.links == undefined) {\n            this.links = this.createLinks();\n        }\n        return this.links;\n    }\n\n    /**\n     * It creates the links for D3 force layout simulator.\n     */\n    createLinks() {\n        let links = [];\n\n        // go throught all paths and contruct links\n        let paths = this.getPaths();\n        let path;\n        for(let i = 0; i < paths.length; i++) {\n            path = paths[i];\n            // path is represented by the list of path points\n            for(let j = 1; j < path.length; j++) {\n                links.push({\n                    source: path[j-1],\n                    target: path[j]\n                });\n            }\n        }\n\n        return links;\n    }\n}\nexport default D3PathForceSimulator;","import * as d3 from \"d3\";\n\n/**\n * This class provides help functions for projections of points used in the Connection tool.\n * \n * @author Jiri Hynek\n */\nclass ProjectionUtil {\n\n    /**\n     * It provides the function which projects the given point to the given leaflet map with the given zoom.\n     * \n     * @param {*} d \n     */\n    static getDataProjectionFunction(map, zoom) {\n        return function(d) {\n            // project the [lat, lng] point to the map with the given zoom\n            let coords = map.project(new L.LatLng(d.lat, d.long), zoom);\n            d.x = coords.x;\n            d.y = coords.y;\n        }\n    }\n\n    /**\n     * It provides the the d3 line function which also:\n     * (1) unprojects the given point from the given leaflet map with given zoom\n     * (2) projects the point of (1) to the current map state\n     * \n     * @param {*} map \n     * @param {*} zoom \n     */\n    static getPathProjectionFunction(map, zoom) {\n        return d3.line()\n            .curve(d3.curveBundle)\n            //.x(function(d) { return d.x; })\n            //.y(function(d) { return d.y; });\n            //.x(function(d) { return map.latLngToLayerPoint(new L.LatLng(d.y, d.x)).x; })\n            //.y(function(d) { return map.latLngToLayerPoint(new L.LatLng(d.y, d.x)).y; });\n\n            // points need to be unprojected first\n            // then they need to be projected to the current map state\n            .x(function(d) {\n                // project [lat, lng] to the current map state\n                return map.latLngToLayerPoint(\n                    // unproject the point to [lat,lng]\n                    map.unproject(new L.Point(d.x, d.y), zoom)\n                ).x;\n            })\n            .y(function(d) {\n                // project [lat, lng] to the current map state\n                return map.latLngToLayerPoint(\n                    // unproject the point to [lat,lng]\n                    map.unproject(new L.Point(d.x, d.y), zoom)\n                ).y\n            });\n    }\n}\nexport default ProjectionUtil;","import L from 'leaflet';\nimport 'leaflet/dist/leaflet.css';\nimport * as d3 from \"d3\";\nimport rfdc from 'rfdc';\nimport './style/connectionLayer.scss';\nimport ConnectionLayerToolTabControl from './sidebar/ConnectionLayerToolTabControl';\nimport ConnectionLayerToolState from './ConnectionLayerToolState';\nimport ConnectionLayerToolDefaults from './ConnectionLayerToolDefaults';\nimport SelectionTool from '../../selection/SelectionTool';\nimport AbstractLayerTool from '../abstract/AbstractLayerTool';\nimport DataChangeEvent from '../../../model/event/basic/DataChangeEvent';\nimport SelectionToolEvent from '../../selection/model/event/SelectionToolEvent';\nimport ThemesToolEvent from '../../themes/model/event/ThemesToolEvent';\nimport D3PathForceSimulator from './util/D3PathForceSimulator';\nimport ProjectionUtil from './util/ProjectionUtil';\n\n/**\n * This class represents Connection layer tool. It uses SVG layer and D3 to draw the lines.\n *\n * @author Jiri Hynek\n */\nclass ConnectionLayerTool extends AbstractLayerTool {\n\n    /**\n     * It creates a new tool with respect to the props.\n     *\n     * @param {*} props\n     */\n    constructor(props) {\n        super(props);\n    }\n\n    /**\n     * A unique string of the tool type.\n     */\n    static TYPE() {\n        return \"geovisto-tool-layer-connection\";\n    }\n\n    /**\n     * It creates a copy of the uninitialized tool.\n     */\n    copy() {\n        return new ConnectionLayerTool(this.getProps());\n    }\n\n    /**\n     * It creates new defaults of the tool.\n     */\n    createDefaults() {\n        return new ConnectionLayerToolDefaults();\n    }\n\n    /**\n     * It returns default tool state.\n     */\n    createState() {\n        return new ConnectionLayerToolState();\n    }\n\n    /**\n     * It creates new tab control.\n     */\n    createSidebarTabControl() {\n        return new ConnectionLayerToolTabControl({ tool: this });\n    }\n\n    /**\n     * Help function which acquires and returns the selection tool if available.\n     */\n    getSelectionTool() {\n        if(this.selectionTool == undefined) {\n            let tools = this.getMap().getState().getTools().getByType(SelectionTool.TYPE());\n            if(tools.length > 0) {\n                this.selectionTool = tools[0];\n            }\n        }\n        return this.selectionTool;\n    }\n\n    /**\n     * It creates layer items.\n     */\n    createLayerItems() {\n        // create Leaflet SVG layer\n        let layer = L.svg();\n\n        // update state\n        this.getState().setLayer(layer);\n\n        // prepare data\n        this.prepareMapData(this);\n\n        return [ layer ];\n    }\n\n    /**\n     * It deletes layer items.\n     */\n    deleteLayerItems() {\n        let layer = this.getState().getLayer();\n\n        // get layer element\n        if(layer._container != undefined) {\n            let layerElement = layer._container.childNodes[0];\n            // delete layer element's children (connections)\n            while (layerElement.firstChild) {\n                layerElement.removeChild(layerElement.lastChild);\n            }\n        }\n    }\n\n    /**\n     * It prepares data for connections.\n     */\n    prepareMapData() {\n        //console.log(\"updating map data\", this);\n\n        //this.getState().getlayer()._container.remove();\n        let workData = {\n            nodes: [],\n            connections: []\n        };\n\n        var map = this.getMap().getState().getLeafletMap();\n        let projectPoint = ProjectionUtil.getDataProjectionFunction(map, this.getDefaults().getProjectionZoom());\n\n         // prepare data\n         let mapData = this.getMap().getState().getMapData();\n         let fromDataDomain = mapData.getDataDomain(this.getState().getDataMapping()[this.getDefaults().getDataMappingModel().from.name]);\n         let toDataDomain = mapData.getDataDomain(this.getState().getDataMapping()[this.getDefaults().getDataMappingModel().to.name]);\n         let geoFrom, geoTo, actFrom, actTo, actConnection;\n         let foundFrom, foundTo;\n         let data = this.getMap().getState().getCurrentData();\n         let dataLen = data.length;\n         let clone = new rfdc();\n         let centroids = this.getState().getCentroids();\n         for (let i = 0; i < dataLen; i++) {\n            //console.log(fromDataDomain, toDataDomain);\n\n            // find the 'from' properties\n            foundFrom = mapData.getItemValues(fromDataDomain, data[i]);\n            //console.log(\"search from: \", foundFrom);\n\n            // find the 'to' properties\n            foundTo = mapData.getItemValues(toDataDomain, data[i]);\n            //console.log(\"search to: \", foundTo);\n\n            // since the data are flattened we can expect max one found item\n            if(foundFrom.length == 1 && foundTo.length == 1) {\n                // test if country exists in the map\n                geoFrom = centroids.find(x => x.id == foundFrom[0]);\n                if(geoFrom != undefined) {\n                    // test if country exists in the map\n                    geoTo = centroids.find(x => x.id == foundTo[0]);\n                    if(geoTo != undefined) {\n                        // add 'from' country to node list\n                        actFrom = workData.nodes.find(x => x.id == foundFrom[0]);\n                        if(actFrom == undefined) {\n                            actFrom = clone(geoFrom);\n                            projectPoint(actFrom);\n                            workData.nodes.push(actFrom);\n                        }\n                        // add 'to' country to node list\n                        actTo = workData.nodes.find(x => x.id == foundTo[0]);\n                        if(actTo == undefined) {\n                            actTo = clone(geoTo);\n                            projectPoint(actTo);\n                            workData.nodes.push(actTo);\n                        }\n                        // add connection to connection list\n                        actConnection = workData.connections.find(x => x.source.id == foundFrom[0] && x.target.id == foundTo[0]);\n                        if(actConnection == undefined) {\n                            actConnection = {\n                                source: actFrom,\n                                target: actTo,\n                                count: 1\n                            }\n                            workData.connections.push(actConnection);\n                        } else {\n                            actConnection.count++;\n                        }\n                    }\n                }\n            }\n        }\n\n        // update work data\n        this.getState().setWorkData(workData);\n        //console.log(\"workData\", workData);\n    }\n\n    /**\n     * This function is called when layer items are rendered.\n     * It use the D3 force layout simulation to arrange the connections.\n     */\n    postCreateLayerItems() {\n        let layer = this.getState().getLayer();\n\n        if(layer != null) {\n            // get overleay pane\n            let overlayPane = d3.select(layer._map.getPanes().overlayPane);\n\n            // get <svg> element (expect L.svg() layer)\n            let svg = overlayPane.select(\"svg\");\n            let g = svg.select(\"g\")\n                // uncoment this in case of non-smooth zoom animation\n                //.attr(\"class\", \"leaflet-zoom-hide\")\n            ;\n            g.selectAll(\"*\").remove();\n\n            // create d3 force layout simulator\n            let workData = this.getState().getWorkData();\n            var d3ForceSimulator = new D3PathForceSimulator({\n                nodes: workData.nodes,\n                connections: workData.connections\n            });\n\n            // get projection path function\n            // geographic locations [lat, lng] of nodes needs to be projected to leaflet map\n            // we use the zoom preferred for the force layout simulation\n            var map = this.getMap().getState().getLeafletMap();\n            var projectionPathFunction = ProjectionUtil.getPathProjectionFunction(map, this.getDefaults().getProjectionZoom());\n\n            // draw paths\n            g.selectAll(\"path.abc\")\n                .data(d3ForceSimulator.getPaths())\n                .enter()\n                .append(\"path\")\n                .attr(\"d\", projectionPathFunction)\n                //.attr(\"data-countries\", function(d) { return d[0].id + \" \" + d[d.length-1].id; })\n                .attr(\"class\", \"leaflet-layer-connection\");\n\n            // update paths with respect to actual map state (zoom, move)\n            let updatePaths = function() {\n                g.selectAll(\"path\").attr(\"d\", projectionPathFunction);\n            }\n\n            // highlight connections with respect to the selection of the selection tool if available\n            if(this.getSelectionTool()) {\n                this.onSelectionUpdate(this.getSelectionTool().getState().getSelection());\n            }\n\n            // map move/zoom listener\n            map.on(\"moveend\", updatePaths);\n            // initial update\n            updatePaths();\n\n            // run force layout algorithm\n            d3ForceSimulator.run(\n                updatePaths,\n                function(d) {\n                    // print message when finishes\n                    console.log(\"Force layout algorithm completed!\");\n                }\n            );\n        }\n    }\n\n    /**\n     * It reloads data and redraw the layer.\n     */\n    redraw() {\n        let layer = this.getState().getLayer()\n        if(layer != undefined && layer._container != undefined) {\n            // delete actual items\n            this.deleteLayerItems();\n\n            // prepare data\n            this.prepareMapData();\n\n            // update map\n            this.postCreateLayerItems();\n        }\n    }\n\n    /**\n     * This function is called when a custom event is invoked.\n     *\n     * @param {AbstractEvent} event\n     */\n    handleEvent(event) {\n        if(event.getType() == DataChangeEvent.TYPE()) {\n            // data change\n            this.redraw();\n        } else if(event.getType() == SelectionToolEvent.TYPE()) {\n            // selection change\n            this.onSelectionUpdate(event.getObject())\n        } else if(event.getType() == ThemesToolEvent.TYPE()) {\n            // theme change\n            // TODO\n        }\n    }\n\n    /**\n     * It highlights connections with respect to the given selection.\n     */\n    onSelectionUpdate(selection) {\n        let layer = this.getState().getLayer();\n        if(layer != undefined && layer._container != undefined) {\n\n            // get overleay pane, svg g element and paths\n            let paths = d3.select(layer._map.getPanes().overlayPane)\n                            .select(\"svg\")\n                            .select(\"g\")\n                            .selectAll(\"path\");\n\n            if(selection && selection.getSrcIds().length > 0) {\n                let selectionSrcIds = selection.getSrcIds();\n\n                // process all paths and find the affected ones\n                let from, to;\n                let affectedIds = [];\n                paths.each(function(d) {\n                    // from\n                    from = d[0].id;\n                    to = d[d.length-1].id;\n                    if(selectionSrcIds.includes(from)) {\n                        // highlight\n                        this.setAttribute(\"class\", \"leaflet-layer-connection-highlight\");\n                        // check affected country\n                        if(!affectedIds.includes(to)) {\n                            affectedIds.push(to);\n                        }\n                    } else if(selectionSrcIds.includes(to)) {\n                        // highlight\n                        this.setAttribute(\"class\", \"leaflet-layer-connection-highlight\");\n                        // check affected country\n                        if(!affectedIds.includes(from)) {\n                            affectedIds.push(from);\n                        }\n                    } else {\n                        //if(this.getAttribute(\"class\") == \"leaflet-layer-connection\") {\n                            // deemphasize if it is not already highlighted\n                            this.setAttribute(\"class\", \"leaflet-layer-connection-other\");\n                        //}\n                    }\n                });\n\n                // update selection with respect to the affected countries\n                //console.log(\"affected\", affectedIds);\n                if(affectedIds.length > 0) {\n                    let selectionTool = this.getSelectionTool();\n                    if(selectionTool) {\n                        let length = selection.getIds().length;\n                        selection.addIds(affectedIds);\n                        // check if selection has changed\n                        // take only the paths which have not been already processed\n                        // this prevents cyclic processing\n                        if(length != selection.getIds().length) {\n                            selectionTool.setSelection(selection);\n                        }\n                    }\n                }\n            } else {\n                // set the default path style\n                paths.attr(\"class\", \"leaflet-layer-connection\");\n            }\n        }\n    }\n}\nexport default ConnectionLayerTool;\n","/**\n * This class wraps a filter operation.\n * \n * @author Jiri Hynek\n */\nclass AbstractTheme {\n\n    /**\n     * It initializes the theme.\n     */\n    constructor() {\n    }\n\n    /**\n     * It returns the theme type.\n     */\n    getType() {\n        return \"abstract\";\n    }\n\n    /**\n     * It returns the preferred base map.\n     * \n     * Override this function.\n     */\n    getBaseMap() {\n        return undefined;\n    }\n\n    /**\n     * It returns if the styles preferres inversed dark colors.\n     * \n     * Override this function.\n     */\n    isDark() {\n        return false;\n    }\n\n    // TODO define themes interface\n    \n}\nexport default AbstractTheme;","import AbstractThemesManager from \"../abstract/AbstractThemesManager\";\n\n/**\n * This class provide functions for using themes.\n * \n * @author Jiri Hynek\n */\nclass ThemesManager extends AbstractThemesManager {\n\n    constructor(themes) {\n        super();\n        this.themes = themes;\n    }\n\n    /**\n     * The function returns available themes.\n     */\n    getThemes() {\n        return this.themes;\n    }\n\n    /**\n     * The function returns the default theme.\n     */\n    getDefault() {\n        let objects = this.getThemes();\n        return objects && objects.length > 0 ? objects[0] : undefined;\n    }\n}\nexport default ThemesManager;","/**\n * This class provide functions for using themes.\n * \n * @author Jiri Hynek\n */\nclass AbstractThemesManager {\n\n    /**\n     * It initializes the theme manager.\n     */\n    constructor() {\n    }\n\n    /**\n     * It returns available filter operations\n     */\n    getThemes() {\n        return [];\n    }\n\n    /**\n     * It returns available filter operations\n     */\n    getTheme(label) {\n        let themes = this.getThemes();\n        let resultObjects = [];\n        if(themes != undefined) {\n            for(let i = 0; i < themes.length; i++) {\n                if(themes[i].getType() == label) {\n                    resultObjects.push(themes[i]);\n                }\n            }\n        }\n        return resultObjects;\n    }\n\n    /**\n     * The function returns available theme types.\n     */\n    getThemeLabels() {\n        let labels = [];\n        let themes = this.getThemes();\n        if(themes != undefined) {\n            for(let i = 0; i < themes.length; i++) {\n                labels.push(themes[i].getType());\n            }\n        }\n        return labels;\n    }\n\n    /**\n     * It returns the default theme.\n     */\n    getDefault() {\n        return undefined;\n    }\n    \n}\nexport default AbstractThemesManager;","import AbstractTheme from '../../abstract/AbstractTheme';\r\n\r\nimport './style.scss';\r\n\r\n/**\r\n * This class wraps a filter operation.\r\n * \r\n * @author Jiri Hynek\r\n */\r\nclass Light1Theme extends AbstractTheme {\r\n\r\n    /**\r\n     * It initializes the light theme.\r\n     */\r\n    constructor() {\r\n        super();\r\n    }\r\n\r\n    /**\r\n     * It returns the theme type.\r\n     */\r\n    getType() {\r\n        return \"light1\";\r\n    }\r\n\r\n    /**\r\n     * It returns the preferred base map.\r\n     */\r\n    getBaseMap() {\r\n        return 'https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png';\r\n    }\r\n}\r\nexport default Light1Theme;","import AbstractTheme from '../../abstract/AbstractTheme';\n\nimport './style.scss';\n\n/**\n * This class wraps a filter operation.\n * \n * @author Jiri Hynek\n */\nclass Light2Theme extends AbstractTheme {\n\n    /**\n     * It initializes the light theme.\n     */\n    constructor() {\n        super();\n    }\n\n    /**\n     * It returns the theme type.\n     */\n    getType() {\n        return \"light2\";\n    }\n\n    /**\n     * It returns the preferred base map.\n     */\n    getBaseMap() {\n        return 'https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png';\n    }\n}\nexport default Light2Theme;","import AbstractTheme from '../../abstract/AbstractTheme';\n\nimport './style.scss';\n\n/**\n * This class wraps a filter operation.\n * \n * @author Jiri Hynek\n */\nclass Light3Theme extends AbstractTheme {\n\n    /**\n     * It initializes the light theme.\n     */\n    constructor() {\n        super();\n    }\n\n    /**\n     * It returns the theme type.\n     */\n    getType() {\n        return \"light3\";\n    }\n\n    /**\n     * It returns the preferred base map.\n     */\n    getBaseMap() {\n        return 'https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png';\n    }\n}\nexport default Light3Theme;","import AbstractTheme from '../../abstract/AbstractTheme';\n\nimport './style.scss';\n\n/**\n * This class wraps a filter operation.\n * \n * @author Jiri Hynek\n */\nclass Dark1Theme extends AbstractTheme {\n\n    /**\n     * It initializes the dark theme.\n     */\n    constructor() {\n        super();\n    }\n\n    /**\n     * It returns the theme type.\n     */\n    getType() {\n        return \"dark1\";\n    }\n\n    /**\n     * This theme prefers dark colors.\n     */\n    isDark() {\n        return true;\n    }\n\n    /**\n     * It returns the preferred base map.\n     */\n    getBaseMap() {\n        return 'https://{s}.basemaps.cartocdn.com/rastertiles/dark_all/{z}/{x}/{y}.png';\n    }\n}\nexport default Dark1Theme;","import AbstractTheme from '../../abstract/AbstractTheme';\n\nimport './style.scss';\n\n/**\n * This class wraps a filter operation.\n * \n * @author Jiri Hynek\n */\nclass Dark2Theme extends AbstractTheme {\n\n    /**\n     * It initializes the dark theme.\n     */\n    constructor() {\n        super();\n    }\n\n    /**\n     * It returns the theme type.\n     */\n    getType() {\n        return \"dark2\";\n    }\n\n    /**\n     * This theme prefers dark colors.\n     */\n    isDark() {\n        return true;\n    }\n\n    /**\n     * It returns the preferred base map.\n     */\n    getBaseMap() {\n        return 'https://{s}.basemaps.cartocdn.com/rastertiles/dark_all/{z}/{x}/{y}.png';\n    }\n}\nexport default Dark2Theme;","import AbstractTheme from '../../abstract/AbstractTheme';\n\nimport './style.scss';\n\n/**\n * This class wraps a filter operation.\n * \n * @author Jiri Hynek\n */\nclass Dark3Theme extends AbstractTheme {\n\n    /**\n     * It initializes the dark theme.\n     */\n    constructor() {\n        super();\n    }\n\n    /**\n     * It returns the theme type.\n     */\n    getType() {\n        return \"dark3\";\n    }\n\n    /**\n     * This theme prefers dark colors.\n     */\n    isDark() {\n        return true;\n    }\n\n    /**\n     * It returns the preferred base map.\n     */\n    getBaseMap() {\n        return 'https://{s}.basemaps.cartocdn.com/rastertiles/dark_all/{z}/{x}/{y}.png';\n    }\n}\nexport default Dark3Theme;","import ThemesManager from \"./model/theme/generic/ThemesManager\";\nimport Light1Theme from \"./model/theme/basic/light1/Light1Theme\";\nimport Light2Theme from \"./model/theme/basic/light2/Light2Theme\";\nimport Light3Theme from \"./model/theme/basic/light3/Light3Theme\";\nimport Dark1Theme from \"./model/theme/basic/dark1/Dark1Theme\";\nimport Dark2Theme from \"./model/theme/basic/dark2/Dark2Theme\";\nimport Dark3Theme from \"./model/theme/basic/dark3/Dark3Theme\";\nimport ThemesTool from \"./ThemesTool\";\nimport AbstractToolDefaults from \"../../model/tool/abstract/AbstractToolDefaults\";\n\n/**\n * This class provide functions which return the default state values.\n * \n * @author Jiri Hynek\n */\nclass ThemesToolDefaults extends AbstractToolDefaults {\n\n    /**\n     * It creates tool defaults.\n     */\n    constructor() {\n        super();\n    }\n\n    /**\n     * Only one themes tool should be present in the Geovisto map.\n     */\n    isSingleton() {\n       return true; \n    }\n\n    /**\n     * It returns a unique string of the tool type.\n     */\n    getType() {\n        return ThemesTool.TYPE();\n    }\n\n    /**\n     * It returns default themes manager.\n     */\n    getThemesManager() {\n        return new ThemesManager([\n            new Light1Theme(),\n            new Light2Theme(),\n            new Light3Theme(),\n            new Dark1Theme(),\n            new Dark2Theme(),\n            new Dark3Theme()\n        ]);\n    }\n\n    /**\n     * It returns default theme.\n     */\n    getTheme() {\n        return this.getMapObject().getState().getThemesManager().getDefault();\n    }\n}\nexport default ThemesToolDefaults;","import AbstractToolState from \"../../model/tool/abstract/AbstractToolState\";\nimport AbstractTheme from \"./model/theme/abstract/AbstractTheme\";\nimport ThemesToolDefaults from \"./ThemesToolDefaults\";\n\n/**\n * This class provide functions for using themes.\n * \n * @author Jiri Hynek\n */\nclass ThemesToolState extends AbstractToolState {\n\n    /**\n     * It creates a tool state.\n     */\n    constructor() {\n        super();\n    }\n\n    /**\n     * It resets state with respect to initial props. Optionally, defaults can be set if property is undefined.\n     * \n     * @param {ThemesToolDefaults} defaults \n     */\n    reset(defaults) {\n        super.reset(defaults);\n\n        let props = this.getProps();\n\n        // set theme manager - needs to be set before the theme\n        this.setThemesManager(props.manager == undefined && defaults ? defaults.getThemesManager() : props.manager);\n\n        // set theme\n        this.setTheme(props.theme == undefined && defaults ? defaults.getTheme() : props.theme);\n    }\n\n    /**\n     * The metod takes config and desrializes the values.\n     * \n     * @param {*} config \n     */\n    deserialize(config) {\n        super.deserialize(config);\n\n        // deserialize theme id\n        if(config.theme != undefined) {\n            // get filter and data manegers which are need for proper deserialization of filter rules\n            let themesManager = this.getThemesManager();\n            if(themesManager != undefined) {\n                let theme = themesManager.getTheme(config.theme);\n                if(theme && theme.length > 0) {\n                    this.setTheme(theme[0]);\n                }\n            }\n        }\n    }\n\n    /**\n     * The method serializes the tool state. Optionally, defaults can be set if property is undefined.\n     * \n     * @param {ThemesToolDefaults} defaults\n     */\n    serialize(defaults) {\n        let config = super.serialize(defaults);\n\n        // serialize the theme\n        config.theme = defaults && this.getTheme() == undefined ? undefined : this.getTheme().getType();\n\n        return config;\n    }\n\n    /**\n     * It returns themes manager.\n     */\n    getThemesManager() {\n        return this.manager;\n    }\n\n    /**\n     * It sets themes manager.\n     * \n     * @param {AbstractThemesManager} manager \n     */\n    setThemesManager(manager) {\n        this.manager = manager;\n    }\n\n    /**\n     * It returns the theme property of the tool state.\n     */\n    getTheme() {\n        return this.theme;\n    }\n\n    /**\n     * It sets the theme property of the tool state.\n     * \n     * @param {AbstractTheme} theme \n     */\n    setTheme(theme) {\n       this.theme = theme;\n    }\n}\nexport default ThemesToolState;","import AbstractTabFragmentDefaults from \"../../sidebar/model/fragment/AbstractTabFragmentDefaults\";\n\n/**\n * This class provide functions which return the default state values.\n * \n * @author Jiri Hynek\n */\nclass ThemesToolTabFragmentDefaults extends AbstractTabFragmentDefaults {\n\n    /**\n     * It creates sidebar tab fragment defaults.\n     */\n    constructor() {\n        super();\n    }\n}\nexport default ThemesToolTabFragmentDefaults;","import AbstractTabFragmentState from \"../../sidebar/model/fragment/AbstractTabFragmentState\";\n\n/**\n * This class manages the state of the sidebar fragment.\n * It wraps the state since the sidebar fragment can work with state objects which needs to be explicitly serialized.\n * \n * @author Jiri Hynek\n */\nclass ThemesToolTabFragmentState extends AbstractTabFragmentState {\n\n    /**\n     * It creates a tab fragment state.\n     */\n    constructor() {\n        super();\n    }\n}\nexport default ThemesToolTabFragmentState;","import AbstractTabFragment from '../../sidebar/model/fragment/AbstractTabFragment';\nimport SettingsTool from '../../settings/SettingsTool';\nimport ThemesToolTabFragmentDefaults from './ThemesToolTabFragmentDefaults';\nimport ThemesToolTabFragmentState from './ThemesToolTabFragmentState';\nimport AutocompleteSidebarInput from '../../../inputs/input/AutocompleteSidebarInput';\nimport SidebarInputFactory from '../../../inputs/SidebarInputFactory';\n\n/**\n * This class represents tab fragment for Themes tool.\n * \n * TODO: exclude defaults and state variables\n * \n * @author Jiri Hynek\n */\nclass ThemesToolTabFragment extends AbstractTabFragment {\n\n    constructor(props) {\n        super(props);\n\n        // tab content\n        this.tabContent = undefined;\n    }\n\n    /**\n     * It creates new defaults of the tab fragment.\n     */\n    createDefaults() {\n        return new ThemesToolTabFragmentDefaults();\n    }\n\n    /**\n     * It creates new state of the tab fragment.\n     */\n    createState() {\n        return new ThemesToolTabFragmentState();\n    }\n\n    /**\n     * The function returns true if the tab fragment should be included in the tab control.\n     * \n     * @param {*} tabControl \n     */\n    isChild(tabControl) {\n        return tabControl.getState().getTool().getType() == SettingsTool.TYPE();\n    }\n\n    /**\n     * It returns fragment of tab pane which will be placed in sidebar tab.\n     * \n     * This function can be extended.\n     */\n    getTabContent() {\n        if(this.tabContent == undefined) {\n            this.createTabContent();\n        }\n        return this.tabContent;\n    }\n\n    /**\n     * Help function which creates tab content.\n     */\n    createTabContent() {\n        // tab pane\n        this.tabContent = document.createElement('div');\n\n        // theme input\n        var tool = this.getState().getTool();\n        var themesManager = tool.getState().getThemesManager();\n        let changeTheme = function(e) {\n            let newTheme = themesManager.getTheme(e.target.value);\n            if(newTheme && newTheme.length > 0) {\n                tool.setTheme(newTheme[0]);\n            }\n        }\n        let themeInput = SidebarInputFactory.createSidebarInput(AutocompleteSidebarInput.ID(), { label: \"Theme\", options: themesManager.getThemeLabels(), action: changeTheme });\n        this.tabContent.appendChild(themeInput.create());\n        themeInput.setValue(tool.getState().getTheme().getType());\n    }\n\n}\nexport default ThemesToolTabFragment;","import AbstractTool from \"../../model/tool/abstract/AbstractTool\";\nimport ThemesToolState from \"./ThemesToolState\";\nimport ThemesToolEvent from \"./model/event/ThemesToolEvent\";\nimport ThemesToolDefaults from \"./ThemesToolDefaults\";\nimport ThemesToolTabFragment from \"./sidebar/ThemesToolTabFragment\";\n\n/**\n * Attribute which is set to the map container.\n */\nconst THEME_ATTR_NAME = \"data-theme\";\n\n/**\n * This class provides the themes tool.\n * \n * @author Jiri Hynek\n */\nclass ThemesTool extends AbstractTool {\n\n    /**\n     * It creates a new tool with respect to the props.\n     * \n     * @param {*} props \n     */\n    constructor(props) {\n        super(props);\n\n        // the tab fragment for a sidebar tab will be created only if needed\n        this.tabFragment = undefined\n    }\n\n    /**\n     * A unique string of the tool type.\n     */\n    static TYPE() {\n        return \"geovisto-tool-themes\";\n    }\n\n    /**\n     * It creates a copy of the uninitialized tool.\n     */\n    copy() {\n        return new ThemesTool(this.getProps());\n    }\n\n    /**\n     * It creates new defaults of the tool.\n     */\n    createDefaults() {\n        return new ThemesToolDefaults();\n    }\n\n    /**\n     * It returns the tool state.\n     */\n    createState() {\n        return new ThemesToolState();\n    }\n\n    /**\n     * It creates new filter tool.\n     */\n    create() {\n        // set theme\n        this.setTheme(this.getState().getTheme());\n    }\n\n    /**\n     * \n     * @param {*} theme \n     */\n    setTheme(theme) {\n        if(theme != undefined) {\n            // if the theme tool is enabled, update map theme\n            if(this.isEnabled()) {\n                // update map container theme attribute (used by CSS selectors)\n                document.getElementById(this.getMap().getId()).setAttribute(THEME_ATTR_NAME, theme.getType());\n\n                // update tool state\n                this.getState().setTheme(theme);\n\n                // dispatch event\n                this.getMap().dispatchEvent(new ThemesToolEvent(this, theme));\n            }\n        }\n    }\n\n    /**\n     * It returns tab control with respect to the configuration\n     */\n    getSidebarTabFragment() {\n        if(this.tabFragment == undefined) {\n            this.tabFragment = this.createSidebarTabFragment();\n        }\n        return this.tabFragment;\n    }\n\n    /**\n     * It creates new tab fragment.\n     */\n    createSidebarTabFragment() {\n        return new ThemesToolTabFragment({ tool: this });\n    }\n}\nexport default ThemesTool;","import React from 'react';\r\nimport L from 'leaflet';\r\nimport 'leaflet/dist/leaflet.css';\r\n\r\nimport circle from '@turf/circle';\r\nimport union from '@turf/union';\r\nimport difference from '@turf/difference';\r\nimport * as turf from '@turf/turf';\r\n\r\nimport {\r\n  convertOptionsToProperties,\r\n  getGeoJSONFeatureFromLayer,\r\n  getSimplifiedPoly,\r\n  highlightStyles,\r\n  normalStyles,\r\n  simplifyFeature,\r\n} from '../util/Poly';\r\n\r\nimport { STROKES } from '../sidebar/DrawingLayerToolTabControlState';\r\n\r\nconst DEFAULT_COLOR = '#333333';\r\nconst DEFAULT_RADIUS = 30;\r\nconst ERASE_KEY = 'X';\r\nconst ERASER_COLOR = '#ee000055';\r\n\r\nclass PaintPoly {\r\n  constructor(props) {\r\n    this.tabState = props.tabState;\r\n    // this._map = window.map;\r\n\r\n    this._action = null;\r\n    this._circle = null;\r\n    this._mouseDown = false;\r\n    this._latlng = [0, 0];\r\n\r\n    this._maxCircleRadius = 100;\r\n    this._minCircleRadius = 10;\r\n    this._circleRadius = DEFAULT_RADIUS;\r\n\r\n    this.keyIndex = 0;\r\n\r\n    this._accumulatedShapes = {};\r\n    this._shapeLayers = {};\r\n\r\n    this._active = false;\r\n  }\r\n\r\n  getMouseDown = () => {\r\n    return this._mouseDown;\r\n  };\r\n\r\n  getBrushSize = () => {\r\n    return this._circleRadius;\r\n  };\r\n\r\n  getBrushSizeConstraints = () => {\r\n    return { maxBrushSize: this._maxCircleRadius, minBrushSize: this._minCircleRadius };\r\n  };\r\n\r\n  resizeBrush = (val) => {\r\n    if (val && val <= this._maxCircleRadius && val >= this._minCircleRadius) {\r\n      this._circleRadius = val;\r\n      this._circle.setRadius(val);\r\n    }\r\n  };\r\n\r\n  stop = () => {\r\n    this._action = null;\r\n    if (this._circle) {\r\n      this._circle.remove();\r\n    }\r\n    this._removeMouseListener();\r\n  };\r\n\r\n  startPaint = () => {\r\n    this.stop();\r\n    this._action = 'draw';\r\n    this._addMouseListener();\r\n    this._circle = L.circleMarker(this._latlng, {\r\n      color: DEFAULT_COLOR,\r\n    })\r\n      .setRadius(this._circleRadius)\r\n      .addTo(window.map);\r\n  };\r\n\r\n  startErase = () => {\r\n    this.stop();\r\n    this._action = 'erase';\r\n    this._addMouseListener();\r\n    this._circle = L.circleMarker(this._latlng, {\r\n      color: ERASER_COLOR,\r\n    })\r\n      .setRadius(this._circleRadius)\r\n      .addTo(window.map);\r\n  };\r\n\r\n  clearPaintedPolys = (kIdx) => {\r\n    if (kIdx === undefined) return;\r\n\r\n    if (this._shapeLayers[kIdx]) {\r\n      this._shapeLayers[kIdx].remove();\r\n      delete this._shapeLayers[kIdx];\r\n    }\r\n    delete this._accumulatedShapes[kIdx];\r\n  };\r\n\r\n  clearAllAccumulated = () => {\r\n    Object.keys(this._accumulatedShapes).forEach((key) => {\r\n      delete this._accumulatedShapes[key];\r\n    });\r\n  };\r\n\r\n  updatePaintedPolys = (kIdx, layer) => {\r\n    if (kIdx === undefined) return;\r\n\r\n    if (this._shapeLayers[kIdx]) {\r\n      this._shapeLayers[kIdx] = layer;\r\n    }\r\n    let feature = layer.toGeoJSON();\r\n    feature.properties = convertOptionsToProperties(layer.options);\r\n\r\n    this._accumulatedShapes[kIdx] = feature;\r\n  };\r\n\r\n  // taken from https://stackoverflow.com/questions/27545098/leaflet-calculating-meters-per-pixel-at-zoom-level\r\n  _pixelsToMeters = () => {\r\n    const metersPerPixel =\r\n      (40075016.686 * Math.abs(Math.cos((this._latlng.lat * Math.PI) / 180))) /\r\n      Math.pow(2, window.map.getZoom() + 8);\r\n\r\n    return this._circleRadius * metersPerPixel;\r\n  };\r\n\r\n  drawCircle = (erase) => {\r\n    const brushColor = this.tabState.getSelectedColor() || DEFAULT_COLOR;\r\n    const brushStroke = this.tabState.getSelectedStroke() || STROKES[1].value;\r\n    const turfCircle = circle([this._latlng.lng, this._latlng.lat], this._pixelsToMeters(), {\r\n      steps: 16,\r\n      units: 'meters',\r\n    });\r\n\r\n    const kIdx = erase ? ERASE_KEY : this.keyIndex;\r\n\r\n    if (!this._accumulatedShapes[kIdx]) {\r\n      this._accumulatedShapes[kIdx] = turfCircle;\r\n    } else {\r\n      this._accumulatedShapes[kIdx] = union(this._accumulatedShapes[kIdx], turfCircle);\r\n    }\r\n\r\n    this._accumulatedShapes[kIdx].properties = { fill: brushColor, 'stroke-width': brushStroke };\r\n    // console.log({\r\n    //   accShapes: this._accumulatedShapes,\r\n    //   shape: this._accumulatedShapes[kIdx],\r\n    //   kIdx: kIdx,\r\n    // });\r\n    this._redrawShapes();\r\n  };\r\n\r\n  _redrawShapes = () => {\r\n    const selectedLayer = this.tabState.getToolState().selectedLayer;\r\n    Object.keys(this._accumulatedShapes).forEach((key) => {\r\n      let simplified = simplifyFeature(this._accumulatedShapes[key]);\r\n      let coords = simplified.geometry.coordinates;\r\n      let isMultiPoly = this._accumulatedShapes[key].geometry.type === 'MultiPolygon';\r\n      let depth = isMultiPoly ? 2 : 1;\r\n      let latlngs = L.GeoJSON.coordsToLatLngs(coords, depth);\r\n      let color = this._accumulatedShapes[key]?.properties?.fill || DEFAULT_COLOR;\r\n      let weight = this._accumulatedShapes[key]?.properties['stroke-width'] || STROKES[1].value;\r\n\r\n      let styles = selectedLayer?.kIdx === key ? highlightStyles : normalStyles;\r\n\r\n      let opts =\r\n        key === ERASE_KEY\r\n          ? { color: ERASER_COLOR, draggable: false, transform: false }\r\n          : {\r\n              color,\r\n              weight,\r\n              draggable: true,\r\n              transform: true,\r\n            };\r\n\r\n      let result = new L.polygon(latlngs, { ...opts, ...styles });\r\n\r\n      result?.dragging?.disable();\r\n\r\n      if (this._shapeLayers[key] !== undefined) {\r\n        this._shapeLayers[key].remove();\r\n      }\r\n\r\n      this._shapeLayers[key] = result.addTo(window.map);\r\n    });\r\n  };\r\n\r\n  _fireCreatedShapes = () => {\r\n    // console.log('%cfired', 'color: #085f89');\r\n    const layerState = this.tabState.getToolState();\r\n    Object.keys(this._shapeLayers).forEach((key) => {\r\n      const found = layerState.getLayerByIdx(key);\r\n      if (found) {\r\n        layerState.removeLayer(found);\r\n        this._shapeLayers[key].kIdx = key;\r\n        this._shapeLayers[key].layerType = 'painted';\r\n        layerState.addLayer(this._shapeLayers[key]);\r\n      } else {\r\n        window.map.fire(L.Draw.Event.CREATED, {\r\n          layer: this._shapeLayers[key],\r\n          layerType: key === ERASE_KEY ? 'erased' : 'painted',\r\n          keyIndex: key,\r\n        });\r\n      }\r\n    });\r\n  };\r\n\r\n  // ================= EVENT LISTENERS =================\r\n  _addMouseListener = () => {\r\n    window.map.on('mousemove', this._onMouseMove);\r\n    window.map.on('mousedown', this._onMouseDown);\r\n    window.map.on('mouseup', this._onMouseUp);\r\n  };\r\n  _removeMouseListener = () => {\r\n    window.map.off('mousemove', this._onMouseMove);\r\n    window.map.off('mousedown', this._onMouseDown);\r\n    window.map.off('mouseup', this._onMouseUp);\r\n  };\r\n  _onMouseDown = (event) => {\r\n    window.map.dragging.disable();\r\n    this._mouseDown = true;\r\n    this._onMouseMove(event);\r\n  };\r\n  _onMouseUp = (event) => {\r\n    window.map.dragging.enable();\r\n    this._mouseDown = false;\r\n    this.keyIndex += 1;\r\n    this._fireCreatedShapes();\r\n  };\r\n  _onMouseMove = (event) => {\r\n    this._setLatLng(event.latlng);\r\n    if (this._mouseDown) {\r\n      this.drawCircle(this._action === 'erase');\r\n    }\r\n  };\r\n  // ================= EVENT LISTENERS END =================\r\n\r\n  _setLatLng = (latlng) => {\r\n    if (latlng !== undefined) {\r\n      this._latlng = latlng;\r\n    }\r\n    if (this._circle) {\r\n      this._circle.setLatLng(this._latlng);\r\n    }\r\n  };\r\n\r\n  clickDraw = (event) => {\r\n    if (event.type == 'mousedown') {\r\n      L.DomEvent.stop(event);\r\n      return;\r\n    }\r\n    if (this._action == 'draw') {\r\n      this.disable();\r\n    } else {\r\n      this.enablePaint();\r\n    }\r\n  };\r\n\r\n  erase = (event) => {\r\n    if (event.type == 'mousedown') {\r\n      L.DomEvent.stop(event);\r\n      return;\r\n    }\r\n    if (this._action == 'erase') {\r\n      this.disable();\r\n    } else {\r\n      this.startErase();\r\n      this._active = true;\r\n    }\r\n  };\r\n\r\n  enableErase = () => {\r\n    this.startErase();\r\n    this._active = true;\r\n  };\r\n\r\n  enablePaint = () => {\r\n    this.startPaint();\r\n    this._active = true;\r\n  };\r\n\r\n  disable = () => {\r\n    this.stop();\r\n    this._active = false;\r\n  };\r\n\r\n  isActive = () => {\r\n    return this._active;\r\n  };\r\n}\r\n\r\nexport default PaintPoly;\r\n","import React from 'react';\nimport L, { popup } from 'leaflet';\nimport 'leaflet-path-drag';\n\nimport 'leaflet/dist/leaflet.css';\nimport { ICON_SRCS } from '../sidebar/DrawingLayerToolTabControlState';\nimport { OpenStreetMapProvider } from 'leaflet-geosearch';\nimport { MapLayerTool } from '../../map';\n\nL.Draw.ExtendedMarker = L.Draw.Marker.extend({\n  setIconOptions: function (iconOpts) {\n    this.options.icon = iconOpts;\n  },\n});\n\nexport const iconStarter = {\n  shadowUrl: null,\n  iconAnchor: new L.Point(12, 12),\n  iconSize: new L.Point(24, 24),\n};\n\n// * opted for this approach instead of extending L.Icon\n// * it led to some bugs/errors and this way we have an access to icon options\nconst iconOptions = {\n  ...iconStarter,\n};\n\nexport const markerCreate = (map, sidebar, connectClick = false) => {\n  const additionalOpts = { iconUrl: sidebar.getState().getSelectedIcon(), connectClick };\n  const icon = new L.Icon({ ...iconOptions, ...additionalOpts });\n  const { guideLayers } = sidebar.getState();\n\n  const x = new L.Draw.ExtendedMarker(map, {\n    icon,\n    draggable: true,\n    transform: true,\n    repeatMode: true,\n    guideLayers,\n    snapVertices: false,\n  });\n  if (x) sidebar.getState().setEnabledEl(x);\n  x.enable();\n  return x;\n};\n\nexport const connectClick = (map, sidebar) => {\n  const marker = markerCreate(map, sidebar, true);\n};\n\nexport const putMarkerOnMap = (featureGroup, latlng, popup, iconUrl, connectClick = false) => {\n  const additionalOpts = { iconUrl: iconUrl || ICON_SRCS[0], connectClick };\n  const icon = new L.Icon({\n    ...iconOptions,\n    ...additionalOpts,\n  });\n\n  let marker = new L.Marker.Touch(latlng, { icon });\n  if (popup) {\n    marker.bindPopup(popup, { closeOnClick: false, autoClose: false });\n    marker.popupContent = popup;\n  }\n\n  marker.layerType = 'marker';\n  console.log({ marker });\n  featureGroup.addLayer(marker);\n  // map.fire(L.Draw.Event.CREATED, { layer: marker, layerType: 'marker' });\n  return marker;\n};\n\nexport const geoSearch = async (featureGroup, query = '') => {\n  if (!query) return;\n\n  // setup\n  const provider = new OpenStreetMapProvider();\n\n  // search\n  const results = await provider.search({ query });\n\n  return results;\n};\n","export function debounce(func, wait, immediate) {\r\n  var timeout;\r\n  return function () {\r\n    var context = this,\r\n      args = arguments;\r\n    clearTimeout(timeout);\r\n    timeout = setTimeout(function () {\r\n      timeout = null;\r\n      if (!immediate) func.apply(context, args);\r\n    }, wait);\r\n    if (immediate && !timeout) func.apply(context, args);\r\n  };\r\n}\r\n\r\n/**\r\n * @brief is array or object empty\r\n *\r\n * @param {Object | Array} obj\r\n * @returns {boolean}\r\n */\r\nexport const isEmpty = (obj) => {\r\n  return typeof obj === 'object' && obj !== null && Object.keys(obj).length === 0;\r\n};\r\n\r\nexport const sortReverseAlpha = (a, b) => {\r\n  if (a < b) return 1;\r\n  if (a > b) return -1;\r\n  return 0;\r\n};\r\n\r\nexport const sortAlpha = (a, b) => {\r\n  if (a < b) return -1;\r\n  if (a > b) return 1;\r\n  return 0;\r\n};\r\n\r\nexport const isInt = (n) => Number(n) === n && n % 1 === 0;\r\n\r\nexport const isFloat = (n) => Number(n) === n && n % 1 !== 0;\r\n\r\nexport const getIntervalStep = (n) => {\r\n  if (!n) return 0.0;\r\n  let split = String(n).split('.');\r\n  if (split.length === 2) {\r\n    let after = split[1];\r\n    let length = after.length - 1 < 0 ? 0 : after.length;\r\n    let allZeros = [...Array(length)].join('0');\r\n\r\n    if (length === 1) return 0.01;\r\n    else if (length === 0) return 0.1;\r\n    else return Number(`0.${allZeros}1`);\r\n  }\r\n\r\n  return 0.0;\r\n};\r\n","export const createIntervalInput = (label, min, max, onChange, value, step = 1) => {\r\n  const controlWrapper = document.createElement('div');\r\n  controlWrapper.style.display = 'flex';\r\n  controlWrapper.style.justifyContent = 'space-between';\r\n  controlWrapper.style.alignItems = 'center';\r\n\r\n  const inputWrapper = document.createElement('div');\r\n  inputWrapper.appendChild(document.createTextNode(label));\r\n  const control = document.createElement('input');\r\n  control.setAttribute('type', 'range');\r\n  control.setAttribute('min', min);\r\n  control.setAttribute('max', max);\r\n  control.setAttribute('step', step);\r\n  control.onchange = (e) => {\r\n    onChange(e.target.value);\r\n    displayAmount.innerText = e.target.value;\r\n  };\r\n  control.value = value;\r\n  inputWrapper.appendChild(control);\r\n\r\n  controlWrapper.appendChild(inputWrapper);\r\n\r\n  const displayAmount = document.createElement('span');\r\n  displayAmount.innerText = value;\r\n  controlWrapper.appendChild(displayAmount);\r\n\r\n  return controlWrapper;\r\n};\r\n\r\nexport const createCheck = (value, onCheck, prefix, label) => {\r\n  const onChange = (e) => {\r\n    const val = e.target.checked;\r\n    onCheck(val);\r\n  };\r\n  const ID = prefix + '-check-input';\r\n  const inputWrapper = document.createElement('div');\r\n  inputWrapper.className = `${ID}-wrapper check-wrapper`;\r\n  const check = document.createElement('input');\r\n  check.type = 'checkbox';\r\n  check.checked = value;\r\n  check.id = ID;\r\n  check.onchange = onChange;\r\n  const checkLabel = document.createElement('label');\r\n  checkLabel.for = ID;\r\n  checkLabel.innerText = label;\r\n  inputWrapper.appendChild(check);\r\n  inputWrapper.appendChild(checkLabel);\r\n  return inputWrapper;\r\n};\r\n","import AbstractLayerToolTabControlState from '../../abstract/sidebar/AbstractLayerToolTabControlState';\r\nimport PaintPoly from '../components/paintPoly';\r\n\r\nimport '../style/drawingLayerTabControl.scss';\r\nimport { geoSearch, iconStarter, putMarkerOnMap } from '../util/Marker';\r\nimport { highlightStyles, normalStyles, simplifyFeature } from '../util/Poly';\r\nimport { debounce } from '../util/functionUtils';\r\nimport { createIntervalInput, createCheck } from '../components/inputs';\r\n\r\nimport * as osmtogeojson from 'osmtogeojson';\r\nimport * as turf from '@turf/turf';\r\nimport { FIRST } from '../util/constants';\r\n\r\nexport const ICON_SRCS = [\r\n  'https://upload.wikimedia.org/wikipedia/commons/0/0a/Marker_location.png',\r\n  'https://icons.iconarchive.com/icons/icons-land/vista-map-markers/32/Map-Marker-Flag-1-Right-Azure-icon.png',\r\n];\r\nexport const COLORS = [\r\n  '#1ABC9C',\r\n  '#16A085',\r\n  '#2ECC71',\r\n  '#27AE60',\r\n  '#3498DB',\r\n  '#2980B9',\r\n  '#9B59B6',\r\n  '#8E44AD',\r\n  '#34495E',\r\n  '#2C3E50',\r\n  '#F1C40F',\r\n  '#F39C12',\r\n  '#E67E22',\r\n  '#D35400',\r\n  '#E74C3C',\r\n  '#C0392B',\r\n  '#ECF0F1',\r\n  '#BDC3C7',\r\n  '#95A5A6',\r\n  '#7F8C8D',\r\n];\r\nexport const STROKES = [\r\n  { label: 'thin', value: 3 },\r\n  { label: 'medium', value: 5, selected: true },\r\n  { label: 'bold', value: 7 },\r\n];\r\nexport const ADMIN_LEVELS = [\r\n  { label: 'State', value: 2 },\r\n  { label: 'Province', value: 4, selected: true },\r\n  { label: '5 (depends on country)', value: 5 },\r\n  { label: '6 (depends on country)', value: 6 },\r\n  { label: '7 (depends on country)', value: 7 },\r\n  { label: '8 (depends on country)', value: 8 },\r\n  { label: '9 (depends on country)', value: 9 },\r\n  { label: '10 (depends on country)', value: 10 },\r\n];\r\n\r\n/**\r\n * This class manages the state of the sidebar tab.\r\n * It wraps the state since the sidebar tab can work with state objects which needs to be explicitly serialized.\r\n *\r\n * @author Andrej Tlcina\r\n */\r\nclass DrawingLayerToolTabControlState extends AbstractLayerToolTabControlState {\r\n  /**\r\n   * It creates a tab control state.\r\n   */\r\n  constructor(tabControl) {\r\n    super();\r\n    this.tabControl = tabControl;\r\n\r\n    this.colors = COLORS;\r\n    this.selectedColor = COLORS[0];\r\n\r\n    this.strokes = STROKES;\r\n    this.selectedStroke = STROKES[1].value;\r\n\r\n    this.iconSrcs = new Set(ICON_SRCS);\r\n    this.selectedIcon = ICON_SRCS[0];\r\n\r\n    // * element/layer that was enabled and not created yet\r\n    this.enabledEl = null;\r\n\r\n    this.identifierType = '';\r\n\r\n    this.searchOpts = [];\r\n\r\n    this.guideLayers = [];\r\n\r\n    this.connectActivated = false;\r\n\r\n    this.intersectActivated = false;\r\n\r\n    this.paintPoly = new PaintPoly({\r\n      tabState: this,\r\n    });\r\n\r\n    this.pather = new L.Pather({\r\n      strokeWidth: 3,\r\n      smoothFactor: 5,\r\n      moduleClass: 'leaflet-pather',\r\n      pathColour: '#333',\r\n    });\r\n    this.patherActive = false;\r\n\r\n    this.countries = require('../../../../../static/geo/iso3166_countries.json');\r\n    this.countryCode = '';\r\n    this.adminLevel = ADMIN_LEVELS[1].value;\r\n    this.highQuality = false;\r\n\r\n    this.filtersAmount = 0;\r\n    this.filtersKeys = [];\r\n    this.filtersValues = [];\r\n  }\r\n\r\n  clearFilters() {\r\n    this.filtersAmount = 0;\r\n    this.filtersKeys = [];\r\n    this.filtersValues = [];\r\n  }\r\n\r\n  getFiltersKey(idx) {\r\n    const key = this.filtersKeys[idx];\r\n    return key;\r\n  }\r\n  getFiltersValue(idx) {\r\n    const value = this.filtersValues[idx];\r\n    return value;\r\n  }\r\n  setFiltersKey(idx, value) {\r\n    if (idx > this.filtersAmount) return;\r\n    this.filtersKeys[idx] = value;\r\n  }\r\n  setFiltersValue(idx, value) {\r\n    if (idx > this.filtersAmount) return;\r\n    this.filtersValues[idx] = value;\r\n  }\r\n\r\n  increaseFilters = () => {\r\n    this.filtersAmount += 1;\r\n    this.filtersKeys.push('');\r\n    this.filtersValues.push('');\r\n  };\r\n  decreaseFilters = () => {\r\n    if (this.filtersAmount === 0) return;\r\n    this.filtersAmount -= 1;\r\n    this.filtersKeys.pop();\r\n    this.filtersValues.pop();\r\n  };\r\n\r\n  setCountryCode(val) {\r\n    this.countryCode = val;\r\n  }\r\n  setAdminLevel(val) {\r\n    this.adminLevel = val;\r\n  }\r\n  setHighQuality(val) {\r\n    this.highQuality = val;\r\n  }\r\n\r\n  getToolState() {\r\n    return this.getTool().getState();\r\n  }\r\n\r\n  setPatherStatus(val) {\r\n    this.patherActive = val;\r\n  }\r\n\r\n  setConnectActivated(val) {\r\n    this.connectActivated = val;\r\n  }\r\n\r\n  setIntersectActivated(val) {\r\n    this.intersectActivated = val;\r\n  }\r\n\r\n  pushGuideLayer(layer) {\r\n    this.guideLayers.push(layer);\r\n  }\r\n\r\n  setEnabledEl(val) {\r\n    this.enabledEl?.disable();\r\n    this.enabledEl = val;\r\n    // this.tool.state.setSelectedLayer(null);\r\n  }\r\n\r\n  getIdentifierType() {\r\n    return this.identifierType;\r\n  }\r\n\r\n  setIdentifierType(val) {\r\n    this.identifierType = val;\r\n  }\r\n\r\n  getEnabledEl() {\r\n    return this.enabledEl;\r\n  }\r\n\r\n  getSelectedColor() {\r\n    return this.selectedColor;\r\n  }\r\n\r\n  getSelectedStroke() {\r\n    return this.selectedStroke;\r\n  }\r\n\r\n  getSelectedIcon() {\r\n    return this.selectedIcon;\r\n  }\r\n\r\n  setSelectedColor(value) {\r\n    this.selectedColor = value;\r\n  }\r\n\r\n  setSelectedStroke(value) {\r\n    this.selectedStroke = value;\r\n  }\r\n\r\n  setSelectedIcon(value) {\r\n    this.selectedIcon = value;\r\n  }\r\n\r\n  setSearchOpts(opts) {\r\n    this.searchOpts = opts;\r\n  }\r\n\r\n  appendToIconSrcs(iconUrl) {\r\n    this.iconSrcs.add(iconUrl);\r\n  }\r\n\r\n  getSelectCountries() {\r\n    const result = this.countries.map((c) => ({ value: c['alpha-2'], label: c['name'] }));\r\n    return [{ value: '', label: '' }, ...result];\r\n  }\r\n\r\n  changeColorAction = (color) => {\r\n    const selectedEl = this._getSelected();\r\n    this.setSelectedColor(color);\r\n    if (selectedEl?.setStyle) selectedEl.setStyle({ color });\r\n    this._getExtraSelected().forEach((layer) => {\r\n      layer?.setStyle({ color });\r\n    });\r\n  };\r\n\r\n  changeWeightAction = (e) => {\r\n    const weight = Number(e.target.value);\r\n    const selectedEl = this._getSelected();\r\n    this.setSelectedStroke(weight);\r\n    if (selectedEl?.setStyle) selectedEl.setStyle({ weight });\r\n    this._getExtraSelected().forEach((layer) => {\r\n      layer?.setStyle({ weight });\r\n    });\r\n  };\r\n\r\n  changeIconOpts = (iconOpt = {}) => {\r\n    const { enabledEl } = this;\r\n\r\n    let selectedEl = this._getSelected();\r\n    let marker = selectedEl;\r\n\r\n    if (enabledEl?.type === 'marker') {\r\n      selectedEl = enabledEl;\r\n      marker = enabledEl._marker;\r\n    }\r\n\r\n    let oldIconOptions = selectedEl?.options?.icon?.options || {};\r\n    let newIconOptions = {\r\n      ...oldIconOptions,\r\n      ...iconOpt,\r\n    };\r\n\r\n    const markerIcon = new L.Icon(newIconOptions);\r\n    if (marker) marker.setIcon(markerIcon);\r\n    this.tool.highlightElement(marker);\r\n    this._getExtraSelected().forEach((layer) => {\r\n      layer?.setIcon(markerIcon);\r\n      this.tool.highlightElement(layer);\r\n    });\r\n    if (enabledEl?.type === 'marker') enabledEl.setIconOptions(markerIcon);\r\n\r\n    return marker;\r\n  };\r\n\r\n  changeIconAction = (icon) => {\r\n    this.changeIconOpts({ iconUrl: icon });\r\n\r\n    this.setSelectedIcon(icon);\r\n    this.tabControl.redrawTabContent('marker');\r\n  };\r\n\r\n  changeIconAnchor = (val, coordinate) => {\r\n    const selectedEl = this.enabledEl || this._getSelected();\r\n    let iconOptions = selectedEl?.options?.icon?.options || {};\r\n    const iconAnchor = iconOptions.iconAnchor || iconStarter.iconAnchor;\r\n    iconAnchor[coordinate] = val;\r\n    this.changeIconOpts({ iconAnchor });\r\n  };\r\n\r\n  changeDescriptionAction = (e) => {\r\n    this.changeDesc(e.target.value);\r\n  };\r\n\r\n  changeDesc = (inputText) => {\r\n    const selectedEl = this._getSelected();\r\n    const modInputText = this.tabControl.convertDescToPopText(inputText);\r\n\r\n    let popup1 = selectedEl.getPopup();\r\n    if (popup1) {\r\n      popup1.setContent(modInputText);\r\n    } else {\r\n      selectedEl.bindPopup(modInputText, { closeOnClick: false, autoClose: false });\r\n    }\r\n    // store for import\r\n    console.log({ selectedEl });\r\n    if (selectedEl) selectedEl.popupContent = modInputText;\r\n    if (selectedEl?.setStyle) selectedEl.setStyle(modInputText);\r\n  };\r\n\r\n  callIdentifierChange = (haveToCheckFilters = false) => {\r\n    if (haveToCheckFilters && this.filtersAmount === 0) return;\r\n    const selectedEl = this._getSelected();\r\n    this.changeIdentifierAction(selectedEl?.identifier);\r\n  };\r\n\r\n  changeIdentifierAction = (id) => {\r\n    if (!id) return;\r\n    const selectedEl = this._getSelected();\r\n    if (selectedEl) selectedEl.identifier = id;\r\n\r\n    const data = this.getTool()?.getState()?.map?.state?.data;\r\n\r\n    let filteredData = data;\r\n    this.filtersKeys.forEach((key, idx) => {\r\n      filteredData = filteredData.filter((d) => String(d[key]) === this.filtersValues[idx]);\r\n    });\r\n\r\n    const idType = this.identifierType;\r\n    const found = filteredData.find((d) => String(d[idType]) === id);\r\n\r\n    let popupText = '';\r\n    if (found) {\r\n      Object.keys(found).forEach((key) => {\r\n        popupText += `${key}: ${found[key]}<br />`;\r\n      });\r\n    }\r\n\r\n    this.changeDesc(popupText);\r\n    this.tabControl.redrawTabContent(selectedEl?.layerType);\r\n  };\r\n\r\n  changeWhichIdUseAction = (e) => {\r\n    const id = e.target.value;\r\n    const selectedEl = this._getSelected();\r\n\r\n    this.setIdentifierType(id);\r\n\r\n    this.tabControl.redrawTabContent(selectedEl?.layerType);\r\n  };\r\n\r\n  searchAction = async (e) => {\r\n    const value = e.target.value;\r\n    const featureGroup = this.getTool()?.getState()?.featureGroup;\r\n\r\n    const opts = await geoSearch(featureGroup, value);\r\n\r\n    this.setSearchOpts(opts);\r\n    this.tabControl.inputSearch.changeOptions(opts ? opts.map((opt) => opt.label || '') : []);\r\n    // this.inputSearch.redrawMenu();\r\n  };\r\n\r\n  onInputOptClick = (value) => {\r\n    const featureGroup = this.getTool()?.getState().featureGroup;\r\n    const { searchOpts: opts, connectActivated } = this;\r\n\r\n    const found = opts.find((opt) => opt.label === value);\r\n\r\n    let latlng = L.latLng(0, 0);\r\n    latlng.lat = found?.y || 0;\r\n    latlng.lng = found?.x || 0;\r\n    const iconUrl = found?.raw?.icon || ICON_SRCS[0];\r\n    const marker = putMarkerOnMap(featureGroup, latlng, found?.label, iconUrl, connectActivated);\r\n    this.getTool().applyEventListeners(marker);\r\n    this.getTool().applyTopologyMarkerListeners(marker);\r\n    this.setSelectedIcon(iconUrl);\r\n    this.appendToIconSrcs(iconUrl);\r\n    if (connectActivated) {\r\n      this.getTool().plotTopology();\r\n    }\r\n    this.tabControl.redrawTabContent('search');\r\n  };\r\n\r\n  addIconAction = (e) => {\r\n    const iconUrl = e.target.value;\r\n    this.appendToIconSrcs(iconUrl);\r\n    this.tabControl.redrawTabContent('marker');\r\n  };\r\n\r\n  fetchAreas = async () => {\r\n    const { countryCode, adminLevel, highQuality } = this;\r\n\r\n    if (!countryCode || !adminLevel) return;\r\n\r\n    const toolState = this.getTool().getState();\r\n\r\n    const endPoint = 'https://overpass-api.de/api/interpreter?data=[out:json];';\r\n    const query = `area[\"ISO3166-1\"=\"${countryCode}\"]->.searchArea;(relation[\"admin_level\"=\"${adminLevel}\"](area.searchArea););out;>;out skel qt;`;\r\n\r\n    document.querySelector('.leaflet-container').style.cursor = 'wait';\r\n    this.tabControl.searchForAreasBtn.setAttribute('disabled', true);\r\n\r\n    fetch(endPoint + query)\r\n      .then((response) => response.json())\r\n      .then((data) => {\r\n        const gJSON = osmtogeojson(data);\r\n\r\n        const opts = {\r\n          color: this.selectedColor,\r\n          draggable: true,\r\n          transform: true,\r\n        };\r\n\r\n        toolState.featureGroup.eachLayer((layer) => {\r\n          if (layer.countryCode === countryCode) toolState.removeLayer(layer);\r\n        });\r\n\r\n        gJSON?.features\r\n          ?.filter((feat) => feat?.geometry?.type === 'Polygon')\r\n          ?.forEach((feat) => {\r\n            let coords = feat.geometry.coordinates;\r\n            if (!highQuality) {\r\n              let simplified = simplifyFeature(feat, 0.01);\r\n              coords = simplified.geometry.coordinates;\r\n            }\r\n            let latlngs = L.GeoJSON.coordsToLatLngs(coords, 1);\r\n            let result = new L.polygon(latlngs, { ...opts, ...normalStyles });\r\n            result?.dragging?.disable();\r\n            result.layerType = 'polygon';\r\n            result.countryCode = countryCode;\r\n            toolState.addLayer(result);\r\n          });\r\n        this.tabControl.errorMsg.innerText = '';\r\n      })\r\n      .catch((err) => {\r\n        this.tabControl.errorMsg.innerText = 'There was a problem, re-try later.';\r\n        console.error(err);\r\n      })\r\n      .finally(() => {\r\n        document.querySelector('.leaflet-container').style.cursor = '';\r\n        this.tabControl.searchForAreasBtn.removeAttribute('disabled');\r\n      });\r\n  };\r\n\r\n  searchForAreaAction = (e) => {\r\n    const val = e.target.value;\r\n    this.setCountryCode(val);\r\n  };\r\n\r\n  pickAdminLevelAction = (e) => {\r\n    const val = e.target.value;\r\n    this.setAdminLevel(val);\r\n  };\r\n\r\n  _getSelected() {\r\n    return this.getTool().getState().selectedLayer;\r\n  }\r\n\r\n  _getExtraSelected() {\r\n    return this.getTool().getState().extraSelected;\r\n  }\r\n}\r\nexport default DrawingLayerToolTabControlState;\r\n","import L from 'leaflet';\r\nimport 'leaflet-draw';\r\n\r\nL.Draw.Slice = L.Draw.Polyline.extend({\r\n  statics: {\r\n    TYPE: 'knife',\r\n  },\r\n  // @method initialize(): void\r\n  initialize: function (map, options) {\r\n    // if touch, switch to touch icon\r\n    if (L.Browser.touch) {\r\n      this.options.icon = this.options.touchIcon;\r\n    }\r\n\r\n    // Need to set this here to ensure the correct message is used.\r\n    this.options.drawError.message = L.drawLocal.draw.handlers.polyline.error;\r\n\r\n    // Merge default drawError options with custom options\r\n    if (options && options.drawError) {\r\n      options.drawError = L.Util.extend({}, this.options.drawError, options.drawError);\r\n    }\r\n\r\n    // Save the type so super can fire, need to do this as cannot do this.TYPE :(\r\n    this.type = L.Draw.Slice.TYPE;\r\n\r\n    L.Draw.Feature.prototype.initialize.call(this, map, options);\r\n  },\r\n  _calculateFinishDistance: function (potentialLatLng) {\r\n    var lastPtDistance;\r\n    if (this._markers.length > 0) {\r\n      var finishMarker;\r\n      if (this.type === L.Draw.Polyline.TYPE || this.type === L.Draw.Slice.TYPE) {\r\n        finishMarker = this._markers[this._markers.length - 1];\r\n      } else if (this.type === L.Draw.Polygon.TYPE) {\r\n        finishMarker = this._markers[0];\r\n      } else {\r\n        return Infinity;\r\n      }\r\n      var lastMarkerPoint = this._map.latLngToContainerPoint(finishMarker.getLatLng()),\r\n        potentialMarker = new L.Marker(potentialLatLng, {\r\n          icon: this.options.icon,\r\n          zIndexOffset: this.options.zIndexOffset * 2,\r\n        });\r\n      var potentialMarkerPint = this._map.latLngToContainerPoint(potentialMarker.getLatLng());\r\n      lastPtDistance = lastMarkerPoint.distanceTo(potentialMarkerPint);\r\n    } else {\r\n      lastPtDistance = Infinity;\r\n    }\r\n    return lastPtDistance;\r\n  },\r\n});\r\n","import L from 'leaflet';\nimport 'leaflet-path-drag';\nimport 'leaflet-path-transform';\nimport 'leaflet-draw';\n\nimport 'leaflet/dist/leaflet.css';\n\nimport { STROKES, COLORS } from '../sidebar/DrawingLayerToolTabControlState';\n\nimport '../components/Knife';\n\nimport * as turf from '@turf/turf';\n\nexport const highlightStyles = { fillOpacity: 0.5, opacity: 0.2 };\nexport const normalStyles = { fillOpacity: 0.2, opacity: 0.5 };\n\nexport const polygonCreate = (map, sidebar) => {\n  const x = new L.Draw.Polygon(map, {\n    allowIntersection: false,\n    drawError: {\n      color: '#e1e100',\n      message: '<strong>You cannot draw that!<strong>',\n    },\n    shapeOptions: {\n      color: sidebar.getState().getSelectedColor(),\n      weight: sidebar.getState().getSelectedStroke(),\n      draggable: true,\n      transform: true,\n    },\n    guideLayers: sidebar.getState().guideLayers,\n    snapDistance: 5,\n    repeatMode: true,\n  });\n  if (x) sidebar.getState().setEnabledEl(x);\n  x.enable();\n  return x;\n};\n\nexport const polylineCreate = (map, sidebar) => {\n  const x = new L.Draw.Polyline(map, {\n    shapeOptions: {\n      color: sidebar.getState().getSelectedColor(),\n      weight: sidebar.getState().getSelectedStroke(),\n      draggable: true,\n      transform: true,\n    },\n    guideLayers: sidebar.getState().guideLayers,\n    repeatMode: true,\n  });\n  if (x) sidebar.getState().setEnabledEl(x);\n  x.enable();\n  return x;\n};\n\nexport const slicePoly = (map, sidebar) => {\n  const pather = sidebar.getState().pather;\n  const patherStatus = sidebar.getState().patherActive;\n  if (!patherStatus) {\n    map.addLayer(pather);\n    sidebar.getState().setEnabledEl({\n      disable: () => {\n        map.removeLayer(pather);\n        sidebar.getState().setPatherStatus(false);\n      },\n    });\n  } else {\n    map.removeLayer(pather);\n    sidebar.getState().setEnabledEl(null);\n  }\n\n  sidebar.getState().setPatherStatus(!patherStatus);\n};\n\nexport const dividePoly = (map, sidebar) => {\n  const x = new L.Draw.Slice(map, {\n    shapeOptions: {\n      color: '#333',\n      weight: 3,\n      draggable: true,\n      transform: true,\n      guideLayers: sidebar.getState().guideLayers,\n    },\n  });\n  x.enable();\n  sidebar.getState().setEnabledEl(x);\n  return x;\n};\n\nexport const getGeoJSONFeatureFromLayer = (layer) => {\n  let geoFeature = layer.toGeoJSON();\n  let feature = geoFeature.type === 'FeatureCollection' ? geoFeature.features[0] : geoFeature;\n  return feature;\n};\n\nexport const featureToLeafletCoordinates = (featureCoordinates, type = 'Polygon') => {\n  let point;\n  if (type === 'Point') {\n    point = L.latLng(featureCoordinates.reverse());\n    if (point) {\n      featureCoordinates = [point.lng, point.lat];\n    }\n    return featureCoordinates;\n  } else if (type === 'LineString') {\n    for (let i = 0; i < featureCoordinates.length; i++) {\n      point = L.latLng(featureCoordinates[i]);\n      if (point) {\n        featureCoordinates[i] = [point.lng, point.lat];\n      }\n    }\n    return featureCoordinates;\n  } else if (type === 'Polygon') {\n    for (let i = 0; i < featureCoordinates.length; i++) {\n      for (let j = 0; j < featureCoordinates[i].length; j++) {\n        point = L.latLng(featureCoordinates[i][j]);\n        if (point) {\n          featureCoordinates[i][j] = [point.lng, point.lat];\n        }\n      }\n    }\n  }\n\n  return featureCoordinates;\n};\n\nexport const getLeafletTypeFromFeature = (feature) => {\n  switch (feature?.geometry?.type) {\n    case 'Polygon':\n      return 'polygon';\n    case 'LineString':\n      return 'polyline';\n    case 'Point':\n      return 'marker';\n    default:\n      return '';\n  }\n};\n\nexport const convertPropertiesToOptions = (properties) => {\n  let options = { draggable: true, transform: true };\n  if (!properties) return options;\n  options.weight = properties['stroke-width'] || STROKES[1].value;\n  options.color = properties['fill'] || COLORS[0];\n  options.fillOpacity = properties['fill-opacity'] || normalStyles.fillOpacity;\n  options.opacity = properties['stroke-opacity'] || normalStyles.opacity;\n\n  return options;\n};\n\nexport const convertOptionsToProperties = (options) => {\n  let properties = { draggable: true, transform: true };\n  properties['stroke-width'] = options.weight || STROKES[1].value;\n  properties['fill'] = options.color || COLORS[0];\n  // * so we don't save selected polygon\n  properties['fill-opacity'] = normalStyles.fillOpacity;\n  properties['stroke-opacity'] = normalStyles.opacity;\n\n  return properties;\n};\n\nexport const getFeatFromLayer = (layer) => {\n  if (!layer) return null;\n  let drawnGeoJSON = layer.toGeoJSON();\n  let feature;\n  feature = drawnGeoJSON.type === 'FeatureCollection' ? drawnGeoJSON.features : [drawnGeoJSON];\n  return feature;\n};\n\nexport const isFeaturePoly = (feature) => {\n  if (!feature) return false;\n  if (feature?.type === 'FeatureCollection') {\n    let f = feature.features[0];\n    return f?.geometry?.type === 'Polygon' || f?.geometry?.type === 'MultiPolygon';\n  }\n  return feature?.geometry?.type === 'Polygon' || feature?.geometry?.type === 'MultiPolygon';\n};\n\nexport const getSimplifiedPoly = (param_latlngs) => {\n  let latlngs = param_latlngs || [];\n  let points;\n  let simplified;\n  let tolerance = 0.505;\n\n  if (latlngs.length) {\n    // latlng to x/y\n    points = latlngs.map((a) => ({\n      x: a.lat,\n      y: a.lng,\n    }));\n\n    // simplified points (needs x/y keys)\n    simplified = L.LineUtil.simplify(points, tolerance);\n\n    // console.log({ latlngs, simplified, points });\n    try {\n      // x/y back to latlng\n      latlngs = simplified.map((a) => new L.LatLng(a.x, a.y));\n    } catch (error) {\n      console.error({ error, param_latlngs: [...param_latlngs], simplified, points });\n    }\n  }\n\n  return [latlngs];\n};\n\nexport const simplifyFeature = (feature, pixels) => {\n  const tolerance = pixels || window.customTolerance;\n\n  const result = turf.simplify(feature, { tolerance });\n  return result;\n};\n\nexport const isLayerPoly = (layer) => {\n  let feature = getGeoJSONFeatureFromLayer(layer);\n  return isFeaturePoly(feature);\n};\n\nexport const morphFeatureToPolygon = (feature, options = {}, simplify = true) => {\n  let depth = 1;\n  if (feature.geometry.type === 'MultiPolygon') {\n    depth = 2;\n  }\n  let simplified = simplify ? simplifyFeature(feature) : feature;\n  let coords = simplified.geometry.coordinates;\n  let latlngs = L.GeoJSON.coordsToLatLngs(coords, depth);\n  let result = new L.polygon(latlngs, {\n    ...options,\n    draggable: true,\n    transform: true,\n  });\n  result.layerType = 'polygon';\n  if (result.dragging) result.dragging.disable();\n  return result;\n};\n","import { AbstractLayerToolState } from '../abstract';\nimport L from 'leaflet';\nimport {\n  convertOptionsToProperties,\n  convertPropertiesToOptions,\n  featureToLeafletCoordinates,\n  getLeafletTypeFromFeature,\n  highlightStyles,\n  isLayerPoly,\n  normalStyles,\n} from './util/Poly';\nimport { isEmpty, sortReverseAlpha } from './util/functionUtils';\nimport { iconStarter } from './util/Marker';\nimport { FIRST, NOT_FOUND } from './util/constants';\n\nconst MAX_CHOSEN = 2;\n\n/**\n * This class provide functions for using the state of the layer tool.\n *\n * @author Andrej Tlcina\n */\nclass DrawingLayerToolState extends AbstractLayerToolState {\n  /**\n   * It creates a tool state.\n   */\n  constructor(tool) {\n    super();\n    // * element/layer that was created\n    this.currEl = null;\n\n    this.featureGroup = new L.FeatureGroup();\n    this.activeIndex = 0;\n    // * for knowing if we are using select tool\n    this.selecting = false;\n    // * for knowing if we already selected layer\n    this.selectedLayer = null;\n\n    this.tool = tool;\n\n    this.createdVertices = [];\n    this.mappedMarkersToVertices = {};\n\n    this.chosenLayers = [];\n\n    this.extraSelected = [];\n  }\n\n  clearExtraSelected = () => {\n    this.extraSelected.forEach((selected) => {\n      this.tool.normalizeElement(selected);\n    });\n    this.extraSelected = [];\n  };\n\n  /**\n   *\n   * @param {String} layerId\n   * @returns {Number} -1 and greater\n   */\n  isInExtraSelected = (layerId) => {\n    const found = this.extraSelected.map((el) => el._leaflet_id).indexOf(layerId);\n    return found;\n  };\n\n  areSameType = (layer) => {\n    if (isLayerPoly(this.selectedLayer)) {\n      return isLayerPoly(layer);\n    }\n\n    return this.selectedLayer.layerType === layer.layerType;\n  };\n\n  addExtraSelected = (layer) => {\n    // * have only one type of object in array\n    if (!this.areSameType(layer)) return;\n\n    const idx = this.isInExtraSelected(layer._leaflet_id);\n    if (idx > -1) {\n      this.tool.normalizeElement(layer);\n      this.extraSelected.splice(idx, 1);\n    } else {\n      this.tool.highlightElement(layer);\n      this.extraSelected.push(layer);\n    }\n  };\n\n  chosenLayersMaxed = () => {\n    return this.chosenLayers.length === MAX_CHOSEN;\n  };\n\n  pushChosenLayer = (layer) => {\n    if (this.chosenLayers.length >= MAX_CHOSEN) {\n      this.chosenLayers.shift();\n    }\n    this.tool.highlightElement(layer);\n    this.chosenLayers.push(layer);\n  };\n\n  deselectChosenLayers = () => {\n    this.chosenLayers.forEach((chosen) => this.tool.normalizeElement(chosen));\n    this.chosenLayers = [];\n  };\n\n  clearChosenLayers = () => {\n    this.chosenLayers.forEach((chosen) => this.removeLayer(chosen));\n    this.chosenLayers = [];\n  };\n\n  pushJoinedToChosenLayers = (joined) => {\n    this.clearChosenLayers();\n    this.tool.highlightElement(joined);\n    this.chosenLayers.push(joined);\n    this.addLayer(joined);\n  };\n\n  isConnectMarker = (marker) => {\n    return marker?.layerType === 'marker' && marker?.options?.icon?.options?.connectClick;\n  };\n\n  selectedLayerIsConnectMarker = () => {\n    return this.isConnectMarker(this.selectedLayer);\n  };\n\n  canPushToChosen = (layer) => {\n    const acceptableType = this.isConnectMarker(layer) || isLayerPoly(layer);\n    if (isEmpty(this.chosenLayers)) {\n      if (acceptableType) return true;\n    } else {\n      let firstChosen = this.chosenLayers[FIRST];\n      if (this.isConnectMarker(firstChosen) && this.isConnectMarker(layer)) return true;\n      if (isLayerPoly(firstChosen) && isLayerPoly(layer)) return true;\n    }\n\n    return false;\n  };\n\n  chosenLayersArePolys = () => {\n    let firstChosen = this.chosenLayers[FIRST];\n    return isLayerPoly(firstChosen);\n  };\n\n  chosenLayersAreMarkers = () => {\n    let firstChosen = this.chosenLayers[FIRST];\n    return this.isConnectMarker(firstChosen);\n  };\n\n  pushVertice = (vertice) => {\n    this.createdVertices.push(vertice);\n  };\n\n  removeGivenVertice = (lId) => {\n    const idsOfVerticesToRemove = new Set([lId]);\n\n    const result = this.removeMappedVertices(idsOfVerticesToRemove);\n\n    const index = this.createdVertices.map((v) => v._leaflet_id).indexOf(lId);\n    if (index !== NOT_FOUND) {\n      this.createdVertices.splice(index, 1);\n    }\n\n    this.mappedMarkersToVertices = result;\n  };\n\n  /**\n   *\n   * @param {Set} idsOfVerticesToRemove\n   * @returns {Object} mappedMarkersToVertices\n   */\n  removeMappedVertices = (idsOfVerticesToRemove) => {\n    // * copy object\n    const newMapped = { ...this.mappedMarkersToVertices };\n    console.log({ newMapped });\n\n    // *  go through each marker object containing { [index]: vertice } pairs\n    Object.values(newMapped).forEach((vertObj) => {\n      // * now go through each index\n      Object.keys(vertObj).forEach((key) => {\n        let vert = vertObj[key];\n        if (idsOfVerticesToRemove.has(vert._leaflet_id)) {\n          this.removeLayer(vert);\n          delete vertObj[key];\n        }\n      });\n    });\n\n    return newMapped;\n  };\n\n  removeMarkersMappedVertices = (lId) => {\n    const markerVertices = this.mappedMarkersToVertices[lId];\n    console.log({ markerVertices });\n    const idsOfVerticesToRemove = new Set();\n    // * save vertices' ids\n    Object.values(markerVertices)?.forEach((v) => idsOfVerticesToRemove.add(v._leaflet_id));\n    console.log({ idsOfVerticesToRemove });\n    // * remove vertices\n    const newMapped = this.removeMappedVertices(idsOfVerticesToRemove);\n\n    // * marker no longer has vertices, so remove it\n    delete newMapped[lId];\n\n    this.mappedMarkersToVertices = newMapped;\n  };\n\n  setActiveIndex(idx) {\n    this.activeIndex = idx;\n  }\n\n  increaseActiveIndex() {\n    this.activeIndex += 1;\n  }\n\n  getActiveIndex() {\n    return this.activeIndex;\n  }\n\n  getPrevLayer() {\n    let layersObj = this.featureGroup._layers;\n    let layersArr = [...Object.values(layersObj)];\n    return layersArr.pop();\n  }\n\n  setCurrEl(val) {\n    this.currEl = val;\n  }\n\n  setSelecting(is) {\n    this.selecting = is;\n  }\n\n  getSelecting() {\n    return this.selecting;\n  }\n\n  addLayer(layer) {\n    this.featureGroup.addLayer(layer);\n    this.tool.applyEventListeners(layer);\n    return layer;\n  }\n\n  removeLayer(layer) {\n    this.featureGroup.removeLayer(layer);\n  }\n\n  removeSelectedLayer(layer) {\n    this.featureGroup.removeLayer(layer || this.selectedLayer);\n    this.selectedLayer = null;\n  }\n\n  getLayerByIdx(idx) {\n    const found = Object.values(this.featureGroup._layers).find((l) => l.kIdx === idx);\n    return found;\n  }\n\n  removeLayerByIdx(idx) {\n    if (idx === undefined) return;\n    const found = Object.values(this.featureGroup._layers).find((l) => l.kIdx === idx);\n    if (found) this.removeLayer(found);\n  }\n\n  setSelectedLayer(layer) {\n    this.tool.normalizeElement(this.selectedLayer);\n    this.selectedLayer = layer;\n    this.tool.highlightElement(layer);\n    this.clearExtraSelected();\n  }\n\n  clearSelectedLayer() {\n    this.selectedLayer = null;\n  }\n\n  setVerticesToMarker(lId, val) {\n    this.mappedMarkersToVertices[lId] = val;\n  }\n\n  addMappedVertices = (layer, result) => {\n    let lId = layer._leaflet_id;\n    let mappedVertices = this.mappedMarkersToVertices[lId];\n    let mappedProperty = {};\n    Object.keys(mappedVertices).forEach((key) => {\n      mappedProperty[key] = mappedVertices[key]._leaflet_id;\n    });\n    if (!isEmpty(mappedProperty)) result.mappedVertices = mappedProperty;\n  };\n\n  initMappedMarkersToVertices = (lType, result, source) => {\n    if (lType === 'marker' && source.mappedVertices) {\n      this.mappedMarkersToVertices[result._leaflet_id] = source.mappedVertices;\n    }\n    if (lType === 'polyline' || lType === 'vertice') {\n      // * keys are marker leaflet ids\n      Object.keys(this.mappedMarkersToVertices).forEach((markerId) => {\n        // * values are index of vertice\n        let verticesKeyArr = Object.keys(this.mappedMarkersToVertices[markerId]);\n        // * leaflet id of vertice\n        let vertLeafId = source.mappedVerticeId;\n        let verticesObj = this.mappedMarkersToVertices[markerId];\n        verticesKeyArr.forEach((vertKey) => {\n          if (verticesObj[vertKey] === vertLeafId) {\n            let spreadable = this.mappedMarkersToVertices[markerId] || {};\n            this.mappedMarkersToVertices[markerId] = {\n              ...spreadable,\n              [vertKey]: result,\n            };\n          }\n        });\n      });\n    }\n  };\n\n  serializeToGeoJSON() {\n    const geo = {\n      type: 'FeatureCollection',\n      features: [],\n    };\n\n    this.featureGroup.eachLayer((l) => {\n      let feature = l.toGeoJSON();\n\n      let properties = convertOptionsToProperties(l.options);\n      feature.properties = properties;\n\n      if (l.popupContent) feature.properties.popupContent = l.popupContent;\n      if (l.identifier) feature.id = l.identifier;\n\n      let iconOptions = l?.options?.icon?.options;\n      if (iconOptions) feature.properties.iconOptions = iconOptions;\n\n      if (this.isConnectMarker(l)) {\n        this.addMappedVertices(l, feature.properties);\n      }\n      if (l.layerType === 'vertice') feature.properties.mappedVerticeId = l._leaflet_id;\n\n      geo.features.push(feature);\n    });\n\n    return geo;\n  }\n\n  deserializeGeoJSON(geojson) {\n    const sidebarState = this.tool.getSidebarTabControl().getState();\n    // console.log({ geojson });\n    if (geojson.type === 'FeatureCollection' && geojson.features) {\n      geojson.features\n        .sort((a, b) => sortReverseAlpha(a.geometry.type, b.geometry.type))\n        .forEach((f) => {\n          let opts = convertPropertiesToOptions(f.properties);\n          let lType = getLeafletTypeFromFeature(f);\n          featureToLeafletCoordinates(f.geometry.coordinates, f.geometry.type);\n          let result;\n          if (lType === 'polygon') {\n            result = new L.polygon(f.geometry.coordinates, opts);\n          } else if (lType === 'polyline') {\n            result = new L.polyline(f.geometry.coordinates, opts);\n          } else if (lType === 'marker') {\n            let spreadable = f?.properties?.iconOptions || {};\n            if (spreadable.iconUrl) sidebarState.appendToIconSrcs(spreadable.iconUrl);\n            let options = {\n              ...iconStarter,\n              iconUrl: sidebarState.getSelectedIcon(),\n              ...spreadable,\n            };\n\n            let icon = new L.Icon(options);\n            result = new L.Marker.Touch(f.geometry.coordinates, { icon });\n          }\n          if (result) {\n            result.layerType = lType;\n\n            result.snapediting = new L.Handler.MarkerSnap(map, result);\n            result.snapediting.enable();\n            this.tool.tabControl.state.pushGuideLayer(result);\n\n            if (f?.properties?.popupContent) {\n              result.popupContent = f.properties.popupContent;\n              result.bindPopup(f.properties.popupContent, {\n                closeOnClick: false,\n                autoClose: false,\n              });\n            }\n            if (f.id) {\n              result.identifier = f.id;\n            }\n            if (result.dragging) result.dragging.disable();\n            this.addLayer(result);\n          }\n          this.initMappedMarkersToVertices(lType, result, f.properties);\n        });\n    }\n\n    return;\n  }\n\n  serialize(defaults) {\n    let config = super.serialize(defaults);\n\n    const exportSettings = [];\n\n    const pushPolygon = (layer, layerType, extra = {}) => {\n      const { options, _latlngs: latlngs, popupContent = '' } = layer;\n      exportSettings.push({\n        layerType,\n        options: { ...options, ...normalStyles, draggable: true, transform: true },\n        latlngs,\n        popupContent,\n        ...extra,\n      });\n    };\n\n    const pushMarker = (layer, layerType) => {\n      const { popupContent = '' } = layer;\n      let extra = {};\n      if (this.isConnectMarker(layer)) {\n        this.addMappedVertices(layer, extra);\n      }\n      exportSettings.push({\n        layerType,\n        options: { ...layer?.options?.icon?.options, draggable: true, transform: true },\n        latlngs: layer._latlng,\n        popupContent,\n        ...extra,\n      });\n    };\n\n    this.featureGroup.eachLayer((layer) => {\n      const { layerType } = layer;\n      if (layerType === 'marker') {\n        pushMarker(layer, layerType);\n      } else {\n        if (layer._layers) {\n          layer.eachLayer((l) => {\n            pushPolygon(l, layerType);\n          });\n        } else {\n          let extra = layerType === 'vertice' ? { mappedVerticeId: layer._leaflet_id } : {};\n          pushPolygon(layer, layerType, extra);\n        }\n      }\n    });\n\n    config.data = exportSettings;\n    return config;\n  }\n\n  deserialize(config) {\n    super.deserialize(config);\n\n    const sidebarState = this.tool.getSidebarTabControl().getState();\n\n    const { data = [] } = config;\n\n    data.forEach((layer) => {\n      let layerToAdd;\n      // decide what type they are according to it render what is needed\n      if (layer.layerType === 'marker') {\n        let { latlngs } = layer;\n        let latlng = L.latLng(latlngs.lat, latlngs.lng);\n        if (layer?.options?.iconUrl) sidebarState.appendToIconSrcs(layer.options.iconUrl);\n        let options = {\n          ...layer.options,\n          iconAnchor: new L.Point(layer.options.iconAnchor.x, layer.options.iconAnchor.y),\n          iconSize: new L.Point(layer.options.iconSize.x, layer.options.iconSize.y),\n        };\n        let MyCustomMarker = L.Icon.extend({\n          options,\n        });\n\n        let icon = new MyCustomMarker();\n        icon.options = options;\n        let marker = new L.Marker.Touch(latlng, { icon });\n\n        layerToAdd = marker;\n      } else {\n        let _latlng;\n        let poly;\n        if (layer.layerType === 'polyline' || layer.layerType === 'vertice') {\n          _latlng = layer.latlngs.map((l) => L.latLng(l.lat, l.lng));\n          poly = new L.polyline(_latlng, layer.options);\n        }\n        if (layer.layerType === 'polygon' || layer.layerType === 'painted') {\n          _latlng = layer.latlngs[0].map((l) => L.latLng(l.lat, l.lng));\n          poly = new L.polygon(_latlng, layer.options);\n        }\n\n        layerToAdd = poly;\n      }\n\n      if (layer.popupContent) {\n        layerToAdd.bindPopup(layer.popupContent, { closeOnClick: false, autoClose: false });\n        layerToAdd.popupContent = layer.popupContent;\n      }\n      layer.snapediting = new L.Handler.MarkerSnap(map, layer);\n      layer.snapediting.enable();\n      this.tool.tabControl.state.pushGuideLayer(layer);\n\n      layerToAdd.layerType = layer.layerType;\n      if (layerToAdd.dragging) layerToAdd.dragging.disable();\n      this.addLayer(layerToAdd);\n      this.initMappedMarkersToVertices(layer.layerType, layerToAdd, layer);\n    });\n  }\n}\nexport default DrawingLayerToolState;\n","export const NOT_FOUND = -1;\r\n\r\nexport const FIRST = 0;\r\n\r\nexport const SPACE_BAR = 32;\r\n","import { AbstractLayerToolDefaults } from '../abstract';\r\nimport DrawingLayerTool from './DrawingLayerTool';\r\nimport LabeledTextSidebarInput from '../../../inputs/input/LabeledTextSidebarInput';\r\nimport LabeledTextAreaSidebarInput from '../../../inputs/input/LabeledTextAreaSidebarInput';\r\nimport LabeledSelectSidebarInput from '../../../inputs/select/LabeledSelectSidebarInput';\r\nimport AutocompleteSidebarInput from '../../../inputs/input/AutocompleteSidebarInput';\r\n\r\n/**\r\n * TODO: refactorization needed!\r\n */\r\nconst TYPE = 'drawing';\r\n\r\nconst INPUT_ID_PREFIX = 'geovisto-input-' + TYPE;\r\n\r\n/**\r\n * Data mapping model which can be used in the sidebar form.\r\n */\r\nconst MAPPING_MODEL = {\r\n  idKey: {\r\n    id: INPUT_ID_PREFIX + '-idKey',\r\n    name: 'idKey',\r\n    label: 'ID key',\r\n    input: LabeledSelectSidebarInput.ID(),\r\n  },\r\n  identifier: {\r\n    id: INPUT_ID_PREFIX + '-identifier',\r\n    name: 'identifier',\r\n    label: 'Identifier',\r\n    input: AutocompleteSidebarInput.ID(),\r\n  },\r\n  description: {\r\n    id: INPUT_ID_PREFIX + '-description',\r\n    name: 'description',\r\n    label: 'Description',\r\n    input: LabeledTextAreaSidebarInput.ID(),\r\n  },\r\n  strokeThickness: {\r\n    id: INPUT_ID_PREFIX + '-stroke-thickness',\r\n    name: 'stroke-thickness',\r\n    label: 'Stroke thickness',\r\n    input: LabeledSelectSidebarInput.ID(),\r\n  },\r\n  search: {\r\n    id: INPUT_ID_PREFIX + '-search',\r\n    name: 'search',\r\n    label: 'Search',\r\n    input: AutocompleteSidebarInput.ID(),\r\n  },\r\n  searchForArea: {\r\n    id: INPUT_ID_PREFIX + '-search-for-area',\r\n    name: 'search-for-area',\r\n    label: 'Search',\r\n    input: LabeledSelectSidebarInput.ID(),\r\n  },\r\n  adminLevel: {\r\n    id: INPUT_ID_PREFIX + '-admin-level',\r\n    name: 'admin-level',\r\n    label: 'Pick level of administration',\r\n    input: LabeledSelectSidebarInput.ID(),\r\n  },\r\n  iconUrl: {\r\n    id: INPUT_ID_PREFIX + '-iconUrl',\r\n    name: 'iconUrl',\r\n    label: 'Icon URL',\r\n    input: LabeledTextSidebarInput.ID(),\r\n  },\r\n  dataFilterKey: {\r\n    id: INPUT_ID_PREFIX + '-data-filter-key',\r\n    name: 'data-filter-key',\r\n    label: 'Pick column',\r\n    input: LabeledSelectSidebarInput.ID(),\r\n  },\r\n  dataFilterValue: {\r\n    id: INPUT_ID_PREFIX + '-data-filter-value',\r\n    name: 'data-filter-value',\r\n    label: 'Pick value',\r\n    input: LabeledSelectSidebarInput.ID(),\r\n  },\r\n};\r\n\r\n/**\r\n * This class provide functions which return the default state values.\r\n *\r\n * @author Andrej Tlcina\r\n */\r\nclass DrawingLayerToolDefaults extends AbstractLayerToolDefaults {\r\n  /**\r\n   * It initializes tool defaults.\r\n   */\r\n  constructor() {\r\n    super();\r\n  }\r\n\r\n  /**\r\n   * It returns a unique type string of the tool which is based on the layer it wraps.\r\n   */\r\n  getType() {\r\n    return DrawingLayerTool.TYPE();\r\n  }\r\n\r\n  /**\r\n   * It returns the layer name.\r\n   */\r\n  getName() {\r\n    return 'Drawing layer';\r\n  }\r\n\r\n  /**\r\n   * It returns the default mapping of data domains to chart dimensions.\r\n   */\r\n  getDataMapping() {\r\n    let dataMapping = {};\r\n\r\n    let dataMappingModel = this.getDataMappingModel();\r\n    let implicitDataDomainLabel = this.getMapObject()\r\n      .getMap()\r\n      .getState()\r\n      .getMapData()\r\n      .getDataDomainLabels()[0];\r\n    console.log({ implicitDataDomainLabel });\r\n\r\n    dataMapping[dataMappingModel.identifier.name] = implicitDataDomainLabel;\r\n    dataMapping[dataMappingModel.description.name] = implicitDataDomainLabel;\r\n\r\n    return dataMapping;\r\n  }\r\n\r\n  /**\r\n   * It returns the data mapping model.\r\n   */\r\n  getDataMappingModel() {\r\n    return MAPPING_MODEL;\r\n  }\r\n}\r\nexport default DrawingLayerToolDefaults;\r\n","import AbstractLayerToolTabControlDefaults from \"../../abstract/sidebar/AbstractLayerToolTabControlDefaults\";\r\n\r\n/**\r\n * This class provide functions which return the default state values.\r\n *\r\n * @author Andrej Tlcina\r\n */\r\nclass DrawingLayerToolTabControlDefaults extends AbstractLayerToolTabControlDefaults {\r\n  /**\r\n   * It creates tab control defaults.\r\n   */\r\n  constructor() {\r\n    super();\r\n  }\r\n\r\n  /**\r\n   * It returns the icon of the tab pane.\r\n   */\r\n  getIcon() {\r\n    return '<i class=\"fa fa-pencil\"></i>';\r\n  }\r\n}\r\nexport default DrawingLayerToolTabControlDefaults;\r\n","import DrawingLayerToolTabControlDefaults from './DrawingLayerToolTabControlDefaults';\nimport DrawingLayerToolTabControlState, { ADMIN_LEVELS } from './DrawingLayerToolTabControlState';\nimport AbstractLayerToolTabControl from '../../abstract/sidebar/AbstractLayerToolTabControl';\nimport SidebarInputFactory from '../../../../inputs/SidebarInputFactory';\n\nimport '../style/drawingLayerTabControl.scss';\nimport { geoSearch, iconStarter, putMarkerOnMap } from '../util/Marker';\nimport { highlightStyles, normalStyles, simplifyFeature } from '../util/Poly';\nimport { debounce, getIntervalStep, isFloat } from '../util/functionUtils';\nimport { createIntervalInput, createCheck } from '../components/inputs';\n\nimport * as osmtogeojson from 'osmtogeojson';\nimport * as turf from '@turf/turf';\nimport { FIRST } from '../util/constants';\n\nconst POLYS = ['polyline', 'polygon', 'painted', 'vertice'];\n\nconst C_sidebar_tab_content_class = 'leaflet-sidebar-tab-content';\n\n/**\n * This class provides controls for management of the layer sidebar tab.\n *\n * @author Andrej Tlcina\n */\nclass DrawingLayerToolTabControl extends AbstractLayerToolTabControl {\n  constructor(tool) {\n    super(tool);\n  }\n\n  /**\n   * It creates new defaults of the tab control.\n   */\n  createDefaults() {\n    return new DrawingLayerToolTabControlDefaults();\n  }\n\n  /**\n   * It creates new state of the tab control.\n   */\n  createState() {\n    return new DrawingLayerToolTabControlState(this);\n  }\n\n  createPalette(label, opts, activeIdx, changeAction, img = false) {\n    const inputPalette = document.createElement('div');\n    if (label) inputPalette.appendChild(document.createTextNode(label + ': '));\n    const wrapper = document.createElement('div');\n    wrapper.style.display = 'grid';\n    wrapper.style.width = '100%';\n    wrapper.style.gridTemplateColumns = 'repeat(4, 1fr)';\n    inputPalette.appendChild(wrapper);\n    opts.forEach((opt, idx) => {\n      let elem = document.createElement('div');\n      elem.style.boxSizing = 'border-box';\n      elem.style.background = img ? `url(${opt})` : opt;\n      elem.style.backgroundRepeat = 'no-repeat';\n      elem.style.backgroundPosition = 'center';\n      elem.style.backgroundSize = 'contain';\n      elem.style.height = '20px';\n      elem.style.display = 'inline-block';\n      elem.style.cursor = 'pointer';\n      if (idx === activeIdx) {\n        elem.style.border = '1px solid #333';\n      }\n      elem.addEventListener('click', () => changeAction(opt));\n      wrapper.appendChild(elem);\n    });\n    return inputPalette;\n  }\n\n  createColorPicker() {\n    const inputWrapper = document.createElement('div');\n    inputWrapper.appendChild(document.createTextNode('Pick color: '));\n    const colorPicker = document.createElement('input');\n    colorPicker.setAttribute('type', 'color');\n    colorPicker.onchange = (e) => this.getState().changeColorAction(e.target.value);\n    colorPicker.value = this._getSelected()?.options?.color || this.getState().getSelectedColor();\n    inputWrapper.appendChild(colorPicker);\n    return inputWrapper;\n  }\n\n  createColorPalette() {\n    const colors = this.getState().colors;\n    const activeColor = this.getState().getSelectedColor();\n    const activeIndex = colors.indexOf(activeColor);\n    const res = this.createPalette(\n      'Pick color',\n      colors,\n      activeIndex,\n      this.getState().changeColorAction,\n    );\n    return res;\n  }\n\n  createIconPalette() {\n    const iconsSet = this.getState().iconSrcs;\n    const iconUrl = this._getSelected()?.options?.icon?.options?.iconUrl;\n    if (iconUrl) iconsSet.add(iconUrl);\n    const activeIcon = this.getState().getSelectedIcon();\n    const iconsArr = Array.from(iconsSet);\n    const activeIndex = iconsArr.indexOf(activeIcon);\n    const res = this.createPalette(\n      'Pick icon',\n      iconsArr,\n      activeIndex,\n      this.getState().changeIconAction,\n      true,\n    );\n    return res;\n  }\n\n  /**\n   * It acquire selected data mapping from input values.\n   */\n  getInputValues() {\n    // get data mapping model\n    let model = this.getDefaults().getDataMappingModel();\n\n    // create new selection\n    let dataMapping = {};\n\n    // get selected data domains values\n    dataMapping[model.identifier.name] = this.inputId.getValue();\n\n    return dataMapping;\n  }\n\n  /**\n   * It updates selected input values according to the given data mapping.\n   *\n   * @param {*} dataMapping\n   */\n  setInputValues(dataMapping) {\n    // get data mapping model\n    let model = this.getDefaults().getDataMappingModel();\n\n    // update inputs\n    this.inputId.setValue(dataMapping[model.identifier.name]);\n  }\n\n  redrawTabContent(layerType, enabled = false) {\n    console.log('redrawing sidebar...');\n    // get rendered sidebar tab\n    let tabElement = document.getElementById(this.getState().getId());\n\n    // create sidebar tab content\n    let tabContent = tabElement.getElementsByClassName(C_sidebar_tab_content_class)[0];\n\n    while (tabContent.firstChild) {\n      tabContent.removeChild(tabContent.firstChild);\n    }\n\n    tabContent.appendChild(this.getTabContent(layerType, enabled));\n  }\n\n  _getSelected() {\n    return this.getTool().getState().selectedLayer;\n  }\n\n  createBrushSizeControl = () => {\n    let paintPoly = this.getState().paintPoly;\n\n    if (!paintPoly.isActive()) return null;\n\n    let { maxBrushSize, minBrushSize } = paintPoly.getBrushSizeConstraints();\n\n    const controlWrapper = document.createElement('div');\n    const brushControl = createIntervalInput(\n      'Brush size: ',\n      minBrushSize,\n      maxBrushSize,\n      paintPoly.resizeBrush,\n      paintPoly.getBrushSize(),\n    );\n    controlWrapper.appendChild(brushControl);\n\n    const customToleranceCheck = this.createCustomToleranceCheck();\n    controlWrapper.appendChild(customToleranceCheck);\n\n    this.customToleranceInput = document.createElement('div');\n    controlWrapper.appendChild(this.customToleranceInput);\n    return controlWrapper;\n  };\n\n  createIdentifierInput = (model) => {\n    const data = this.getTool()?.getState()?.map?.state?.data;\n\n    const idKey = this.state.getIdentifierType();\n\n    let idOpts = data && data[0][idKey] ? data.map((d) => d[idKey]) : [];\n    idOpts = Array.from(new Set(idOpts));\n\n    const result = SidebarInputFactory.createSidebarInput(model.identifier.input, {\n      label: model.identifier.label,\n      action: (e) => this.getState().changeIdentifierAction(e.target.value),\n      value: this._getSelected()?.identifier || '',\n      options: idOpts,\n      placeholder: 'e.g. CZ',\n    });\n\n    return result;\n  };\n\n  createPickIdentifier = (model) => {\n    const data = this.getTool()?.getState()?.map?.state?.data;\n\n    const idOpts = data[0] ? Object.keys(data[0]).map((k) => ({ value: k, label: k })) : [];\n\n    const result = SidebarInputFactory.createSidebarInput(model.idKey.input, {\n      label: model.idKey.label,\n      action: this.getState().changeWhichIdUseAction,\n      value: this.state.getIdentifierType(),\n      options: [{ value: '', label: '' }, ...idOpts],\n    });\n\n    return result;\n  };\n\n  convertDescToPopText = (descText) => {\n    if (!descText) return '';\n    return descText.replaceAll('\\n', '<br />');\n  };\n\n  convertDescfromPopText = (popText) => {\n    if (!popText) return '';\n    return popText.replaceAll('<br />', '\\n');\n  };\n\n  createConnectCheck = () => {\n    const onChange = (val) => this.getState().setConnectActivated(val);\n    const { connectActivated } = this.getState();\n\n    const result = createCheck(\n      connectActivated,\n      onChange,\n      'connect',\n      'By creating new marker while having this choice selected, you will create path between newly created marker and selected marker or last created marker via Topology tool',\n    );\n\n    return result;\n  };\n\n  createIntersectionCheck = () => {\n    const onChange = (val) => this.getState().setIntersectActivated(val);\n    const { intersectActivated } = this.getState();\n\n    const result = createCheck(\n      intersectActivated,\n      onChange,\n      'intersect',\n      'By selecting the option you can create intersects with selected polygon',\n    );\n    return result;\n  };\n\n  createHighQualityCheck = () => {\n    const onChange = (val) => this.getState().setHighQuality(val);\n    const { highQuality } = this.getState();\n\n    const result = createCheck(\n      highQuality,\n      onChange,\n      'high-quality',\n      'By selecting the option displayed polygons will be in higher quality, which however means that some operations will take longer to execute',\n    );\n    return result;\n  };\n\n  createChangeConnectCheck = () => {\n    const toolState = this.getTool().getState();\n    const onChange = (connectClick) => {\n      let selected = this.getState().changeIconOpts({ connectClick });\n\n      if (selected) {\n        this.getTool().highlightElement(selected);\n      }\n    };\n    const isConnect = toolState.selectedLayerIsConnectMarker();\n\n    const result = createCheck(\n      isConnect,\n      onChange,\n      'change-connect',\n      'By selecting the option marker will be able to create topology',\n    );\n    return result;\n  };\n\n  createCustomToleranceCheck = () => {\n    const { paintPoly } = this.getState();\n    const toleranceChange = (val) => {\n      window.customTolerance = val;\n      paintPoly.clearAllAccumulated();\n    };\n\n    window.map.on('zoomend', () => {\n      let firstChild = this.customToleranceInput.firstChild;\n      if (firstChild) {\n        let interval = firstChild.firstChild.lastChild;\n        let display = firstChild.lastChild;\n        let val = window.customTolerance;\n        if (display) display.innerText = val;\n        if (interval) {\n          interval.value = val;\n          let step = getIntervalStep(val);\n          interval.step = step;\n          interval.max = val * 2;\n        }\n      }\n    });\n\n    const onChange = (check) => {\n      if (check) {\n        let val = window.customTolerance;\n        let step = getIntervalStep(val);\n        const customTolerance = createIntervalInput(\n          'Custom tolerance',\n          0.0,\n          val * 2,\n          toleranceChange,\n          val || '',\n          step,\n        );\n        this.customToleranceInput.appendChild(customTolerance);\n      } else {\n        let firstChild = this.customToleranceInput.firstChild;\n        if (firstChild) this.customToleranceInput.removeChild(firstChild);\n        this.getTool().setGlobalSimplificationTolerance();\n      }\n    };\n\n    const result = createCheck(\n      '',\n      onChange,\n      'custom-tolerance',\n      'By selecting the option you can custom level of detail for brush strokes',\n    );\n    return result;\n  };\n\n  createIconAnchorSlider = (coordinate) => {\n    const selectedEl = this._getSelected();\n\n    let iconOptions = selectedEl?.options?.icon?.options || {};\n    const iconAnchor = iconOptions.iconAnchor || iconStarter.iconAnchor;\n    const value = iconAnchor[coordinate] || '';\n\n    const customAnchor = createIntervalInput(\n      `Icon '${coordinate.toUpperCase()}' anchor`,\n      0,\n      50,\n      (val) => this.getState().changeIconAnchor(val, coordinate),\n      value,\n      1,\n    );\n\n    return customAnchor;\n  };\n\n  createXAnchorSlider = () => this.createIconAnchorSlider('x');\n  createYAnchorSlider = () => this.createIconAnchorSlider('y');\n\n  addHeading = (title, elem) => {\n    let headingTag = document.createElement('h3');\n    headingTag.innerText = title;\n    elem.appendChild(headingTag);\n  };\n\n  renderSearchInputs = (elem, model) => {\n    this.addHeading('Search for place', elem);\n    // * labeled text Search\n    this.inputSearch = SidebarInputFactory.createSidebarInput(model.search.input, {\n      label: model.search.label,\n      action: this.getState().searchAction,\n      options: [],\n      placeholder: 'Press enter for search',\n      setData: this.getState().onInputOptClick,\n    });\n    elem.appendChild(this.inputSearch.create());\n\n    this.inputConnect = this.createConnectCheck();\n    elem.appendChild(this.inputConnect);\n    // * divider\n    elem.appendChild(document.createElement('hr'));\n\n    this.addHeading('Search for area', elem);\n    // * labeled text Search\n    this.inputSearchForArea = SidebarInputFactory.createSidebarInput(model.searchForArea.input, {\n      label: model.searchForArea.label,\n      options: this.getState().getSelectCountries(),\n      action: this.getState().searchForAreaAction,\n      value: this.getState().countryCode || '',\n    });\n    elem.appendChild(this.inputSearchForArea.create());\n\n    this.inputAdminLevel = SidebarInputFactory.createSidebarInput(model.adminLevel.input, {\n      label: model.adminLevel.label,\n      options: ADMIN_LEVELS,\n      action: this.getState().pickAdminLevelAction,\n      value: this.getState().adminLevel,\n    });\n    elem.appendChild(this.inputAdminLevel.create());\n\n    const hqCheck = this.createHighQualityCheck();\n    elem.appendChild(hqCheck);\n\n    this.errorMsg = document.createElement('div');\n    this.errorMsg.className = 'error-text';\n    this.errorMsg.innerText = '';\n    elem.appendChild(this.errorMsg);\n\n    this.searchForAreasBtn = document.createElement('button');\n    this.searchForAreasBtn.innerText = 'Submit';\n    this.searchForAreasBtn.addEventListener('click', this.getState().fetchAreas);\n    elem.appendChild(this.searchForAreasBtn);\n  };\n\n  renderDataInputs = (elem, model) => {\n    let disableTextFields = !Boolean(this._getSelected());\n    // Select Pick Identifier\n    this.inputPickIdentifier = this.createPickIdentifier(model);\n    elem.appendChild(this.inputPickIdentifier.create());\n    this.inputPickIdentifier.setDisabled(disableTextFields);\n    // textfield Identifier\n    this.inputId = this.createIdentifierInput(model);\n    elem.appendChild(this.inputId.create());\n    this.inputId.setDisabled(disableTextFields);\n    // textarea Description\n    this.inputDesc = SidebarInputFactory.createSidebarInput(model.description.input, {\n      label: model.description.label,\n      action: this.getState().changeDescriptionAction,\n      value: this.convertDescfromPopText(this._getSelected()?.getPopup()?.getContent()),\n    });\n    elem.appendChild(this.inputDesc.create());\n    this.inputDesc.setDisabled(disableTextFields);\n  };\n\n  renderDataFilters = (elem, model) => {\n    const data = this.getTool()?.getState()?.map?.state?.data;\n\n    const idOpts = data[0] ? Object.keys(data[0]).map((k) => ({ value: k, label: k })) : [];\n    const state = this.getState();\n\n    const setDataKey = (e, index) => {\n      let val = e.target.value;\n      state.setFiltersKey(index, val);\n      this.redrawTabContent(this._getSelected()?.layerType);\n    };\n    const setDataValue = (e, index) => {\n      let val = e.target.value;\n      state.setFiltersValue(index, val);\n      state.callIdentifierChange();\n      this.redrawTabContent(this._getSelected()?.layerType);\n    };\n\n    for (let index = 0; index < state.filtersAmount; index++) {\n      let filtersKey = state.getFiltersKey(index);\n      let inputKey = SidebarInputFactory.createSidebarInput(model.dataFilterKey.input, {\n        label: model.dataFilterKey.label,\n        action: (e) => setDataKey(e, index),\n        value: filtersKey,\n        options: [{ value: '', label: '' }, ...idOpts],\n      });\n      let keyEl = inputKey.create();\n      elem.appendChild(keyEl);\n      // ***********************************************************\n      let valueOpts = data && data[0][filtersKey] ? data.map((d) => d[filtersKey]) : [];\n      valueOpts = Array.from(new Set(valueOpts));\n\n      let inputValue = SidebarInputFactory.createSidebarInput(model.dataFilterValue.input, {\n        label: model.dataFilterValue.label,\n        action: (e) => setDataValue(e, index),\n        value: state.getFiltersValue(index),\n        options: ['', ...valueOpts],\n      });\n      let valueEl = inputValue.create();\n      elem.appendChild(valueEl);\n\n      elem.appendChild(document.createElement('hr'));\n    }\n  };\n\n  renderFilterInputs = (elem, model) => {\n    let disabled = !Boolean(this._getSelected());\n\n    const addFilter = () => {\n      this.getState().increaseFilters();\n      this.redrawTabContent(this._getSelected().layerType);\n    };\n    const removeFilter = () => {\n      this.getState().decreaseFilters();\n      this.getState().callIdentifierChange();\n      this.redrawTabContent(this._getSelected().layerType);\n    };\n\n    const wrapper = document.createElement('div');\n    wrapper.style.width = '100%';\n    const addFilterBtn = document.createElement('button');\n    addFilterBtn.innerText = 'Add Filter';\n    addFilterBtn.addEventListener('click', addFilter);\n    if (disabled) addFilterBtn.setAttribute('disabled', disabled);\n    else addFilterBtn.removeAttribute('disabled');\n    const removeFilterBtn = document.createElement('button');\n    removeFilterBtn.innerText = 'Remove Filter';\n    removeFilterBtn.addEventListener('click', removeFilter);\n    if (disabled) removeFilterBtn.setAttribute('disabled', disabled);\n    else removeFilterBtn.removeAttribute('disabled');\n    wrapper.appendChild(addFilterBtn);\n    wrapper.appendChild(removeFilterBtn);\n    elem.appendChild(wrapper);\n  };\n\n  renderPolyInputs = (elem, model) => {\n    // select stroke thickness\n    const thicknessOpts = this.getState().strokes;\n    this.inputThickness = SidebarInputFactory.createSidebarInput(model.strokeThickness.input, {\n      label: model.strokeThickness.label,\n      options: thicknessOpts,\n      action: this.getState().changeWeightAction,\n      value: this._getSelected()?.options?.weight || this.getState().getSelectedStroke(),\n    });\n    elem.appendChild(this.inputThickness.create());\n\n    // palette Colors\n    this.inputColor = this.createColorPicker();\n    elem.appendChild(this.inputColor);\n  };\n\n  renderIconInputs = (elem, model) => {\n    // palette Icons\n    this.inputIcon = this.createIconPalette();\n    elem.appendChild(this.inputIcon);\n\n    this.inputUrl = SidebarInputFactory.createSidebarInput(model.iconUrl.input, {\n      label: model.iconUrl.label,\n      action: this.getState().addIconAction,\n      value: '',\n    });\n\n    elem.appendChild(this.inputUrl.create());\n\n    const changeConnect = this.createChangeConnectCheck();\n    elem.appendChild(changeConnect);\n\n    elem.appendChild(this.createXAnchorSlider());\n    elem.appendChild(this.createYAnchorSlider());\n  };\n\n  /**\n   * It returns the sidebar tab pane.\n   *\n   * @param {string} layerType\n   * @param {boolean} enabled\n   * @returns\n   */\n  getTabContent(layerType = null, enabled = false) {\n    // tab content\n    let tab = document.createElement('div');\n    let elem = tab.appendChild(document.createElement('div'));\n    elem.classList.add('drawing-sidebar');\n\n    // get data mapping model\n    let model = this.getDefaults().getDataMappingModel();\n\n    let paintPolyControl = this.createBrushSizeControl();\n    if (paintPolyControl) elem.appendChild(paintPolyControl);\n\n    if (!layerType) {\n      this.getState().clearFilters();\n      return tab;\n    }\n\n    if (layerType === 'search') {\n      this.renderSearchInputs(elem, model);\n      this.getState().clearFilters();\n      return tab;\n    }\n\n    this.renderDataInputs(elem, model);\n    this.renderDataFilters(elem, model);\n    this.renderFilterInputs(elem, model);\n\n    if (layerType === 'painted' || layerType === 'polygon') {\n      this.inputIntersect = this.createIntersectionCheck();\n      elem.appendChild(this.inputIntersect);\n    }\n\n    if (POLYS.includes(layerType)) {\n      this.renderPolyInputs(elem, model);\n    }\n\n    if (layerType === 'marker') {\n      this.renderIconInputs(elem, model);\n    }\n\n    // this.setInputValues(this.getTool().getState().getDataMapping());\n\n    return tab;\n  }\n}\nexport default DrawingLayerToolTabControl;\n","import React from 'react';\n\nimport L from 'leaflet';\nimport 'leaflet/dist/leaflet.css';\n\nimport 'leaflet-draw';\nimport 'leaflet-draw/dist/leaflet.draw.css';\nimport { dividePoly, normalStyles, polygonCreate, polylineCreate, slicePoly } from '../util/Poly';\nimport { connectClick, markerCreate } from '../util/Marker';\n\nimport '../style/drawingLayer.scss';\nimport paintPoly from './paintPoly';\n\nimport * as turf from '@turf/turf';\n\nconst UNABLE_TO_CLICK_DISABLE = ['lineBtn', 'markerBtn', 'polygonBtn'];\n\nexport default function useDrawingToolbar() {\n  L.Control.DrawingToolbar = L.Control.extend({\n    options: {\n      position: 'topleft',\n      drawingBtns: {},\n    },\n    initialize: function (options) {\n      if (options) {\n        L.setOptions(this, options);\n      }\n    },\n    onAdd: function (map) {\n      this.options.map = map;\n      return this.createUi();\n    },\n    createUi: function (map) {\n      const topContainer = L.DomUtil.create('div', 'drawingtoolbar');\n      const toolContainer = L.DomUtil.create('div', 'leaflet-bar leaflet-control', topContainer);\n      toolContainer.style.cursor = 'pointer';\n\n      this.options.drawingBtns.lineBtn = this.createToolbarBtn(\n        'lineBtn',\n        toolContainer,\n        'Line',\n        'fa fa-minus',\n        true,\n      );\n      this.options.drawingBtns.markerBtn = this.createToolbarBtn(\n        'markerBtn',\n        toolContainer,\n        'Marker',\n        'fa fa-map-marker',\n        true,\n      );\n      this.options.drawingBtns.polygonBtn = this.createToolbarBtn(\n        'polygonBtn',\n        toolContainer,\n        'Polygon',\n        'fa fa-star',\n        true,\n      );\n\n      this.options.drawingBtns.deselectBtn = this.createToolbarBtn(\n        'deselectBtn',\n        toolContainer,\n        'Deselect',\n        'fa fa-star-half-o',\n      );\n\n      this.options.drawingBtns.transformBtn = this.createToolbarBtn(\n        'transformBtn',\n        toolContainer,\n        'Transform',\n        'fa fa-arrows-alt',\n      );\n\n      this.options.drawingBtns.editBtn = this.createToolbarBtn(\n        'editBtn',\n        toolContainer,\n        'Edit',\n        'fa fa-square',\n      );\n\n      this.options.drawingBtns.joinBtn = this.createToolbarBtn(\n        'joinBtn',\n        toolContainer,\n        'Join',\n        'fa fa-plus-circle',\n        true,\n      );\n\n      this.options.drawingBtns.sliceBtn = this.createToolbarBtn(\n        'sliceBtn',\n        toolContainer,\n        'Slice polygon',\n        'fa fa-cutlery',\n        true,\n      );\n\n      this.options.drawingBtns.divideBtn = this.createToolbarBtn(\n        'divideBtn',\n        toolContainer,\n        'Divide polygon',\n        'fa fa-scissors',\n        true,\n      );\n\n      this.options.drawingBtns.connectBtn = this.createToolbarBtn(\n        'connectBtn',\n        toolContainer,\n        'Connect',\n        'fa fa-sitemap',\n        true,\n      );\n\n      this.options.drawingBtns.searchBtn = this.createToolbarBtn(\n        'searchBtn',\n        toolContainer,\n        'Search',\n        'fa fa-search',\n      );\n\n      this.options.drawingBtns.paintBtn = this.createToolbarBtn(\n        'paintBtn',\n        toolContainer,\n        'Paint',\n        'fa fa-paint-brush',\n        true,\n      );\n\n      this.options.drawingBtns.eraserBtn = this.createToolbarBtn(\n        'eraseBtn',\n        toolContainer,\n        'Erase',\n        'fa fa-eraser',\n        true,\n      );\n\n      this.options.drawingBtns.removeBtn = this.createToolbarBtn(\n        'removeBtn',\n        toolContainer,\n        'Remove',\n        'fa fa-times',\n      );\n\n      this.addEventListeners();\n      L.DomEvent.disableClickPropagation(topContainer);\n      return topContainer;\n    },\n\n    onRemove: function (map) {},\n\n    addEventListeners: function () {\n      const {\n        lineBtn,\n        markerBtn,\n        polygonBtn,\n        transformBtn,\n        editBtn,\n        sliceBtn,\n        joinBtn,\n        deselectBtn,\n        connectBtn,\n        searchBtn,\n        paintBtn,\n        eraserBtn,\n        removeBtn,\n        divideBtn,\n      } = this.options.drawingBtns;\n      const map = this.options.map;\n      const sidebar = this.getSidebar();\n\n      const btnsArr = Object.values(this.options.drawingBtns);\n      btnsArr.forEach((btn) => {\n        if (!btn.className.includes('transformBtn')) {\n          L.DomEvent.on(btn, 'click', this._disableTransform, this);\n        }\n        if (!btn.className.includes('editBtn')) {\n          L.DomEvent.on(btn, 'click', this._disableNodeEdit, this);\n        }\n      });\n\n      const toggleExtra = (e) => {\n        withExtra.forEach((btn) => btn.lastChild.classList.add('hide'));\n        let extraBtn = e.target.lastChild;\n        if (!extraBtn) extraBtn = e.target.nextSibling;\n        extraBtn.classList.toggle('hide');\n        L.DomEvent.on(extraBtn, 'click', this._disableDrawing, this);\n      };\n      const withExtra = [\n        lineBtn,\n        markerBtn,\n        polygonBtn,\n        connectBtn,\n        sliceBtn,\n        divideBtn,\n        paintBtn,\n        eraserBtn,\n        joinBtn,\n      ];\n      withExtra.forEach((btn) => {\n        L.DomEvent.on(btn, 'click', toggleExtra, this);\n      });\n\n      L.DomEvent.on(lineBtn, 'click', () => this.initCreatePolyline(map, sidebar), this);\n      L.DomEvent.on(markerBtn, 'click', L.DomEvent.stopPropagation)\n        .on(markerBtn, 'click', L.DomEvent.preventDefault)\n        .on(markerBtn, 'click', () => this.initCreateMarker(map, sidebar), this);\n      L.DomEvent.on(polygonBtn, 'click', () => this.initCreatePolygon(map, sidebar), this);\n      L.DomEvent.on(transformBtn, 'click', this.initTransform, this);\n      L.DomEvent.on(editBtn, 'click', this.initNodeEdit, this);\n      L.DomEvent.on(sliceBtn, 'click', () => this.initSlicePoly(map, sidebar), this);\n      L.DomEvent.on(divideBtn, 'click', () => this.initDividePoly(map, sidebar), this);\n      L.DomEvent.on(deselectBtn, 'click', this.deselect, this);\n      L.DomEvent.on(joinBtn, 'click', this.initJoin, this);\n      L.DomEvent.on(connectBtn, 'click', L.DomEvent.stopPropagation)\n        .on(connectBtn, 'click', L.DomEvent.preventDefault)\n        .on(connectBtn, 'click', () => this.initConnect(map, sidebar), this);\n      L.DomEvent.on(searchBtn, 'click', this.initSearch, this);\n      L.DomEvent.on(paintBtn, 'click', this.initPainting, this);\n      L.DomEvent.on(eraserBtn, 'click', this.initErasing, this);\n      L.DomEvent.on(removeBtn, 'click', this.initRemove, this);\n    },\n\n    initJoin: function (evt) {\n      const sidebar = this.getSidebar();\n      const init = this.options.tool.initSelecting;\n      init();\n      sidebar.getState().setEnabledEl({\n        enable: init,\n        disable: () => {\n          init();\n          this.options.tool.getState().deselectChosenLayers();\n        },\n      });\n    },\n\n    initConnect: function (map, sidebar) {\n      this.redrawSidebar('marker', true);\n      connectClick(map, sidebar);\n    },\n\n    initRemove: function (evt) {\n      this.options.tool.removeElement();\n    },\n\n    initErasing: function (evt) {\n      let sidebar = this.getSidebar();\n      let paintPoly = sidebar.getState().paintPoly;\n      sidebar.getState().paintPoly.erase(evt);\n\n      sidebar\n        .getState()\n        .setEnabledEl({ enable: paintPoly.enableErase, disable: paintPoly.disable });\n      this.redrawSidebar(null);\n    },\n\n    initPainting: function (e) {\n      let sidebar = this.getSidebar();\n      let paintPoly = sidebar.getState().paintPoly;\n      sidebar.getState().paintPoly.clickDraw(e);\n\n      sidebar\n        .getState()\n        .setEnabledEl({ enable: paintPoly.enablePaint, disable: paintPoly.disable });\n      this.redrawSidebar('painted');\n    },\n\n    initSearch: function () {\n      this.options.tool.search();\n    },\n\n    initCreatePolyline: function (map, sidebar) {\n      this.redrawSidebar('polyline');\n      polylineCreate(map, sidebar);\n    },\n    initCreatePolygon: function (map, sidebar) {\n      this.redrawSidebar('polygon');\n      polygonCreate(map, sidebar);\n    },\n    initCreateMarker: function (map, sidebar) {\n      this.redrawSidebar('marker', true);\n      markerCreate(map, sidebar);\n    },\n    initSlicePoly: function (map, sidebar) {\n      this.redrawSidebar(null);\n      slicePoly(map, sidebar);\n    },\n    initDividePoly: function (map, sidebar) {\n      this.redrawSidebar(null);\n      dividePoly(map, sidebar);\n    },\n\n    deselect: function () {\n      const selected = this.getSelectedEl();\n\n      if (selected?.editing?._enabled) {\n        selected.editing.disable();\n      }\n      if (selected) {\n        this.options.tool.normalizeElement(selected);\n        this.options.tool.initNodeEdit(true);\n        this.options.tool.getState().clearSelectedLayer();\n        this.redrawSidebar();\n        document.querySelector('.leaflet-container').style.cursor = '';\n      }\n    },\n\n    _disableDrawing: function (e) {\n      e.stopPropagation();\n      e?.target?.classList?.toggle('hide');\n      const sidebar = this.getSidebar();\n      let enabled = sidebar.getState().getEnabledEl();\n      if (enabled) {\n        sidebar.getState().setEnabledEl(null);\n        this.redrawSidebar();\n      }\n    },\n\n    _disableTransform: function () {\n      const layer = this.getSelectedEl();\n\n      if (layer?.transform?._enabled) {\n        layer.transform.disable();\n        layer.dragging.disable();\n        let paintPoly = this.getSidebar().getState().paintPoly;\n        paintPoly.updatePaintedPolys(layer.kIdx, layer);\n      }\n    },\n\n    initNodeEdit: function () {\n      console.log('edit');\n      this.options.tool.initNodeEdit();\n    },\n\n    _disableNodeEdit: function () {\n      console.log('disabled');\n      this.options.tool.initNodeEdit(true);\n    },\n\n    initTransform: function () {\n      const selected = this.getSelectedEl();\n\n      this.options.tool.initTransform(selected);\n    },\n\n    createToolbarBtn: function (className, btnContainer, title, icon, extra = false) {\n      const returnBtn = L.DomUtil.create('a', `${className} d-side-button`, btnContainer);\n      returnBtn.title = title;\n      returnBtn.innerHTML = `<i class=\"${icon}\" aria-hidden=\"true\"></i>`;\n      returnBtn.role = 'button';\n      if (extra) {\n        const extraBtn = L.DomUtil.create('a', 'extra-btn hide', returnBtn);\n        extraBtn.innerHTML = `Cancel`;\n        extraBtn.role = 'button';\n      }\n      return returnBtn;\n    },\n\n    getSelectedEl: function () {\n      return this.options.tool.getState().selectedLayer;\n    },\n\n    redrawSidebar: function (val, enabled = false) {\n      this.options.tool.redrawSidebarTabControl(val, enabled);\n    },\n\n    getSidebar: function () {\n      return this.options.tool.getSidebarTabControl();\n    },\n  });\n\n  L.control.drawingToolbar = function (options) {\n    if (!options) {\n      options = {};\n    }\n    return new L.Control.DrawingToolbar(options);\n  };\n}\n","import L from 'leaflet';\nimport AbstractLayerTool from '../abstract/AbstractLayerTool';\nimport DrawingLayerToolState from './DrawingLayerToolState';\nimport DrawingLayerToolDefaults from './DrawingLayerToolDefaults';\nimport DrawingLayerToolTabControl from './sidebar/DrawingLayerToolTabControl';\nimport useDrawingToolbar from './components/useDrawingToolbar';\nimport union from '@turf/union';\nimport {\n  convertOptionsToProperties,\n  convertPropertiesToOptions,\n  featureToLeafletCoordinates,\n  getGeoJSONFeatureFromLayer,\n  getLeafletTypeFromFeature,\n  highlightStyles,\n  normalStyles,\n  getFeatFromLayer,\n  isFeaturePoly,\n  getSimplifiedPoly,\n  isLayerPoly,\n  simplifyFeature,\n  morphFeatureToPolygon,\n} from './util/Poly';\n\nimport 'leaflet/dist/leaflet.css';\nimport './style/drawingLayer.scss';\nimport difference from '@turf/difference';\nimport MapCreatedEvent from '../../../model/event/basic/MapCreatedEvent';\nimport { iconStarter } from './util/Marker';\nimport { filter } from 'd3-array';\nimport lineToPolygon from '@turf/line-to-polygon';\nimport * as turf from '@turf/turf';\nimport * as martinez from 'martinez-polygon-clipping';\nimport * as polyClipping from 'polygon-clipping';\nimport 'leaflet-snap';\nimport 'leaflet-geometryutil';\nimport 'leaflet-draw';\nimport 'proj4leaflet';\nimport proj4 from 'proj4';\n\nimport * as d33 from 'd3-3-5-5';\nimport Pather from 'leaflet-pather';\nimport { isEmpty, sortReverseAlpha, sortAlpha } from './util/functionUtils';\nimport { FIRST, NOT_FOUND, SPACE_BAR } from './util/constants';\nimport { getCoords } from '@turf/turf';\n\n// ! pather throws errors without this line\nwindow.d3 = d33;\n\n// * as advised in https://github.com/makinacorpus/Leaflet.Snap/issues/52\nL.Draw.Feature.include(L.Evented.prototype);\nL.Draw.Feature.include(L.Draw.Feature.SnapMixin);\nL.Draw.Feature.addInitHook(L.Draw.Feature.SnapMixin._snap_initialize);\n\nexport const DRAWING_TOOL_LAYER_TYPE = 'geovisto-tool-layer-drawing';\n\n// proj4.defs('urn:ogc:def:crs:EPSG::3857', '+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs ');\n\n/**\n * This class represents Drawing layer tool.\n *\n * @author Andrej Tlcina\n */\nclass DrawingLayerTool extends AbstractLayerTool {\n  /**\n   * It creates a new tool with respect to the props.\n   *\n   * @param {*} props\n   */\n  constructor(props) {\n    super(props);\n    useDrawingToolbar();\n  }\n\n  /**\n   * A unique string of the tool type.\n   */\n  static TYPE() {\n    return DRAWING_TOOL_LAYER_TYPE;\n  }\n\n  /**\n   * It creates a copy of the uninitialized tool.\n   */\n  copy() {\n    return new DrawingLayerTool(this.getProps());\n  }\n\n  /**\n   * It creates new defaults of the tool.\n   */\n  createDefaults() {\n    return new DrawingLayerToolDefaults();\n  }\n\n  /**\n   * It returns default tool state.\n   */\n  createState() {\n    return new DrawingLayerToolState(this);\n  }\n\n  /**\n   * It returns a tab control.\n   */\n  getSidebarTabControl() {\n    if (this.tabControl == undefined) {\n      this.tabControl = this.createSidebarTabControl();\n    }\n    return this.tabControl;\n  }\n\n  redrawSidebarTabControl(layerType, enabled = false) {\n    if (this.tabControl == undefined) return;\n    this.tabControl.redrawTabContent(layerType, enabled);\n  }\n\n  /**\n   * It creates new tab control.\n   */\n  createSidebarTabControl() {\n    return new DrawingLayerToolTabControl({ tool: this });\n  }\n\n  search() {\n    this.redrawSidebarTabControl('search');\n  }\n\n  applyEventListeners(layer) {\n    layer.on('click', L.DomEvent.stopPropagation).on('click', this.initChangeStyle, this);\n    layer.on('mouseover', this.hightlightOnHover, this);\n    layer.on('mouseout', this.normalizeOnHover, this);\n    if (layer.layerType === 'marker') this.applyTopologyMarkerListeners(layer);\n  }\n\n  polyDiff(layer, intersect = false) {\n    let selectedLayer = this.getState().selectedLayer;\n    let paintPoly = this.getSidebarTabControl().getState().paintPoly;\n    let fgLayers = this.getState().featureGroup._layers;\n\n    let layerFeature = getGeoJSONFeatureFromLayer(layer);\n    let isCurrentLayerPoly = isLayerPoly(layer);\n\n    // let createdIsNotEraser = layer.layerType !== 'erased';\n    let createdIsEraser = layer.layerType === 'erased';\n\n    const replaceLayer = (replacement, replacedLayer, replacementCoords) => {\n      replacement?.dragging?.disable();\n      replacement.layerType = 'polygon';\n      if (replacementCoords) replacement._latlngs = replacementCoords;\n      replacement.identifier = replacedLayer.identifier;\n      replacement.setStyle({ ...replacement.options, ...normalStyles });\n      let content = replacedLayer.popupContent;\n      if (content) {\n        replacement.bindPopup(content, {\n          closeOnClick: false,\n          autoClose: false,\n        });\n        replacement.popupContent = content;\n      }\n      this.getState().addLayer(replacement);\n      this.getState().removeLayer(replacedLayer);\n      paintPoly.clearPaintedPolys(replacedLayer.kIdx);\n    };\n\n    const diffLayers = (l) => {\n      if (!l) return;\n      let feature = getGeoJSONFeatureFromLayer(l);\n\n      let layerIsNotSelected = l?._leaflet_id !== selectedLayer?._leaflet_id;\n      let canDiff = !createdIsEraser ? true : layerIsNotSelected;\n      if (canDiff || intersect) {\n        let diffFeature = difference(feature, layerFeature);\n\n        if (diffFeature) {\n          let coords;\n          let latlngs;\n          coords = diffFeature.geometry.coordinates;\n          let isMultiPoly = diffFeature.geometry.type === 'MultiPolygon';\n          let isJustPoly = diffFeature.geometry.type === 'Polygon';\n          // * when substracting you can basically slice polygon into more parts\n          // * then we have to increase depth by one because we have an array within array\n          let depth = isMultiPoly ? 2 : 1;\n          try {\n            // * this conditional asks if created polygon is polygon with hole punched in it\n            // * for the rest of cases i.e. when polygon is split into multiple parts or not we use loop\n            // * otherwise we create polygon where hole should be\n            if (isJustPoly && coords.length !== 1) {\n              latlngs = L.GeoJSON.coordsToLatLngs(coords, 1);\n              let result = new L.polygon(latlngs, {\n                ...l.options,\n              });\n              replaceLayer(result, l);\n            } else {\n              coords.forEach((coord) => {\n                latlngs = L.GeoJSON.coordsToLatLngs([coord], depth);\n                let result = new L.polygon(latlngs, {\n                  ...l.options,\n                });\n                let newLatLngs = depth === 1 ? result._latlngs : result._latlngs[FIRST];\n                replaceLayer(result, l, newLatLngs);\n              });\n            }\n          } catch (error) {\n            console.error({ coords, latlngs, error, depth });\n          }\n        } else {\n          this.getState().removeLayer(l);\n          paintPoly.clearPaintedPolys(l.kIdx);\n        }\n      }\n    };\n\n    if (isCurrentLayerPoly) {\n      if (intersect && !createdIsEraser) {\n        diffLayers(selectedLayer, true);\n      } else {\n        Object.values(fgLayers)\n          .filter((l) => isLayerPoly(l))\n          .forEach((l) => {\n            diffLayers(l);\n          });\n      }\n    }\n  }\n\n  operateOnSelectedAndCurrectLayer = (layer, eKeyIndex, operation, selectNew = false) => {\n    let paintPoly = this.getSidebarTabControl().getState().paintPoly;\n\n    let feature = getFeatFromLayer(layer);\n    // * gets only first one because MultiPolygon is not expected to be created\n    feature = Array.isArray(feature) ? feature[0] : feature;\n    let isFeatPoly = isFeaturePoly(feature);\n    if (!isFeatPoly) return layer;\n\n    let summedFeature = feature;\n\n    let selectedLayer = this.getState().selectedLayer;\n    // * this can be multipolygon whenever user joins 2 unconnected polygons\n    let selectedFeatures = getFeatFromLayer(selectedLayer);\n    if (!selectedFeatures) return layer;\n\n    selectedFeatures.forEach((selectedFeature) => {\n      let isSelectedFeaturePoly = isFeaturePoly(selectedFeature);\n\n      if (isSelectedFeaturePoly) {\n        summedFeature = operation(selectedFeature, summedFeature);\n      }\n    });\n\n    layer = morphFeatureToPolygon(summedFeature, layer.options, false);\n    paintPoly.clearPaintedPolys(eKeyIndex);\n    if (selectNew) {\n      this.getState().removeSelectedLayer();\n      this.getState().setSelectedLayer(layer);\n    }\n    return layer;\n  };\n\n  polyIntersect(layer, eKeyIndex) {\n    const updatedLayer = this.operateOnSelectedAndCurrectLayer(layer, eKeyIndex, turf.intersect);\n\n    return updatedLayer;\n  }\n\n  polyJoin(layer, eKeyIndex) {\n    const updatedLayer = this.operateOnSelectedAndCurrectLayer(layer, eKeyIndex, union, true);\n    return updatedLayer;\n  }\n\n  // inspired by https://gis.stackexchange.com/questions/344068/splitting-a-polygon-by-multiple-linestrings-leaflet-and-turf-js\n  polySlice(layer) {\n    let lineFeat = getGeoJSONFeatureFromLayer(layer);\n    let selectedLayer = this.getState().selectedLayer;\n\n    if (selectedLayer) {\n      const THICK_LINE_WIDTH = 0.00001;\n      const THICK_LINE_UNITS = 'kilometers';\n      let offsetLine;\n      let selectedFeature = getGeoJSONFeatureFromLayer(selectedLayer);\n\n      let isFeatPoly = isFeaturePoly(selectedFeature);\n\n      if (isFeatPoly) {\n        let coords;\n        let latlngs;\n        try {\n          offsetLine = turf.lineOffset(lineFeat, THICK_LINE_WIDTH, {\n            units: THICK_LINE_UNITS,\n          });\n\n          let polyCoords = [];\n          // * push all of the coordinates of original line\n          for (let j = 0; j < lineFeat.geometry.coordinates.length; j++) {\n            polyCoords.push(lineFeat.geometry.coordinates[j]);\n          }\n          // * push all of the coordinates of offset line\n          for (let j = offsetLine.geometry.coordinates.length - 1; j >= 0; j--) {\n            polyCoords.push(offsetLine.geometry.coordinates[j]);\n          }\n          // * to create linear ring\n          polyCoords.push(lineFeat.geometry.coordinates[0]);\n\n          let thickLineString = turf.lineString(polyCoords);\n          let thickLinePolygon = turf.lineToPolygon(thickLineString);\n          let clipped = turf.difference(selectedFeature, thickLinePolygon);\n          // clipped = simplifyFeature(clipped);\n\n          coords = clipped.geometry.coordinates;\n          this.getState().removeSelectedLayer(selectedLayer);\n          coords.forEach((coord) => {\n            latlngs = L.GeoJSON.coordsToLatLngs(coord, 1);\n            let result = new L.polygon(latlngs, {\n              ...selectedLayer.options,\n              ...normalStyles,\n            });\n            result.layerType = 'polygon';\n            this.getState().addLayer(result);\n          });\n        } catch (error) {\n          console.error({ coords, latlngs, error });\n        }\n      }\n    }\n  }\n\n  haveSameVertice(current) {\n    const found = this.state.createdVertices.find((vertice) => {\n      return (\n        (vertice.getLatLngs()[0].equals(current.getLatLngs()[0]) &&\n          vertice.getLatLngs()[1].equals(current.getLatLngs()[1])) ||\n        (vertice.getLatLngs()[0].equals(current.getLatLngs()[1]) &&\n          vertice.getLatLngs()[1].equals(current.getLatLngs()[0]))\n      );\n    });\n\n    return Boolean(found);\n  }\n\n  plotTopology(chosen = null) {\n    const selectedLayer = this.getState().selectedLayer;\n\n    const layersObj = this.state.featureGroup._layers;\n    const layerArr = [...Object.values(layersObj)];\n    const allConnected = layerArr.filter((_) => this.getState().isConnectMarker(_)).reverse();\n    const _markers = chosen || allConnected;\n    // console.log({ _markers });\n    const index = 0;\n    const firstMarker = _markers[index];\n\n    const selectedLayerIsConnectMarker = this.getState().selectedLayerIsConnectMarker();\n\n    const secondMarker =\n      selectedLayerIsConnectMarker && !chosen ? selectedLayer : _markers[index + 1];\n    if (secondMarker) {\n      const { lat: fLat, lng: fLng } = firstMarker.getLatLng();\n      const { lat: sLat, lng: sLng } = secondMarker.getLatLng();\n\n      let _latlng = [L.latLng(fLat, fLng), L.latLng(sLat, sLng)];\n      let poly = new L.polyline(_latlng, {\n        color: '#563412',\n        weight: 3,\n        ...normalStyles,\n      });\n      poly.layerType = 'vertice';\n      if (!this.haveSameVertice(poly)) {\n        this.state.pushVertice(poly);\n        this.getState().addLayer(poly);\n      }\n    }\n\n    this.mapMarkersToVertices(_markers);\n  }\n\n  mapMarkersToVertices(_markers) {\n    console.log({ _markers, mapped: this.state.mappedMarkersToVertices });\n    _markers\n      .map((marker) => ({ latlng: marker.getLatLng(), lId: marker._leaflet_id, marker }))\n      .forEach(({ latlng, lId, marker }) => {\n        this.state.createdVertices.forEach((vertice, index) => {\n          // * used indexing instead of another loop (vertices have only 2 points)\n\n          let spread = this.state.mappedMarkersToVertices[lId] || {};\n          if (vertice.getLatLngs()[0].equals(latlng)) {\n            this.getState().setVerticesToMarker(lId, { ...spread, [`${index}-0`]: vertice });\n          } else if (vertice.getLatLngs()[1].equals(latlng)) {\n            this.getState().setVerticesToMarker(lId, { ...spread, [`${index}-1`]: vertice });\n          }\n        });\n      });\n  }\n\n  changeVerticesLocation(latlng, oldlatlng, markerID) {\n    console.log({ m: this.state.mappedMarkersToVertices });\n    const markerVertices = this.state.mappedMarkersToVertices[markerID];\n    if (!markerVertices) return;\n\n    this.setVerticesCoordinates(markerVertices, latlng);\n  }\n\n  setVerticesCoordinates(markerVertices, latlng) {\n    Object.keys(markerVertices).forEach((key) => {\n      let vertice = markerVertices[key];\n      let splitKey = key?.split('-');\n      let idx = splitKey ? splitKey[1] : undefined;\n      if (idx === undefined) return;\n      let latLngs = L.LatLngUtil.cloneLatLngs(vertice.getLatLngs());\n      latLngs[idx] = latlng;\n      vertice.setLatLngs(latLngs);\n    });\n  }\n\n  createdListener = (e) => {\n    let layer = e.layer;\n    layer.layerType = e.layerType;\n    if (e.keyIndex) layer.kIdx = e.keyIndex;\n    const sidebarState = this.getSidebarTabControl().getState();\n\n    const { intersectActivated } = sidebarState;\n\n    if (e.layerType === 'polygon' || e.layerType === 'painted') {\n      // * JOIN\n      if (intersectActivated) layer = this.polyIntersect(layer, e.keyIndex);\n      else layer = this.polyJoin(layer, e.keyIndex);\n    }\n\n    if (e.layerType === 'polygon' || e.layerType === 'painted' || e.layerType === 'erased') {\n      // * DIFFERENCE\n      this.polyDiff(layer, intersectActivated);\n    }\n\n    if (layer.dragging) layer.dragging.disable();\n\n    // * SLICE\n    if (e.layerType === 'knife') {\n      this.polySlice(layer);\n      // * restore state\n      let enabled = sidebarState.getEnabledEl();\n      if (enabled) {\n        sidebarState.setEnabledEl(null);\n        this.redrawSidebarTabControl();\n      }\n      const divideBtn = document.querySelector('.drawingtoolbar .divideBtn .extra-btn');\n      if (divideBtn) divideBtn.classList.add('hide');\n    }\n\n    if (e.layerType !== 'knife' && e.layerType !== 'erased') {\n      this.getState().addLayer(layer);\n      sidebarState.pushGuideLayer(layer);\n    }\n\n    if (e.layerType === 'erased') {\n      const map = this.getMap().getState().getLeafletMap();\n      map.removeLayer(layer);\n      let paintPoly = sidebarState.paintPoly;\n      paintPoly.clearPaintedPolys(e.keyIndex);\n    }\n\n    // * MARKER\n    if (this.getState().isConnectMarker(layer)) {\n      this.plotTopology();\n    }\n  };\n\n  applyTopologyMarkerListeners(layer) {\n    layer.on('drag', (event) => {\n      const { latlng, oldLatLng, target } = event;\n\n      // console.log({ lat: latlng.lat, lng: latlng.lng, oldlat: oldLatLng.lat, oldlng: oldLatLng.lng });\n\n      this.changeVerticesLocation(latlng, oldLatLng, target._leaflet_id);\n    });\n  }\n\n  createdPath = (e) => {\n    // * get polyline object\n    const layer = e.polyline.polyline;\n\n    // * get Leaflet map\n    const combinedMap = this.getMap();\n    const map = combinedMap.state.map;\n\n    // * get sidebar state and pather object\n    const sidebarState = this.getSidebarTabControl().getState();\n    const pather = sidebarState.pather;\n    // * SLICE\n    this.polySlice(layer);\n\n    // * we do not want path to stay\n    pather.removePath(layer);\n    // * we do not want to keep cutting (drawing)\n    map.removeLayer(pather);\n    sidebarState.setPatherStatus(false);\n    // * restore state\n    let enabled = sidebarState.getEnabledEl();\n    if (enabled) {\n      sidebarState.setEnabledEl(null);\n      this.redrawSidebarTabControl();\n    }\n    const knifeBtn = document.querySelector('.drawingtoolbar .sliceBtn .extra-btn');\n    if (knifeBtn) knifeBtn.classList.add('hide');\n  };\n\n  /**\n   * It creates layer items.\n   */\n  createLayerItems() {\n    console.log('%c ...creating', 'color: #ff5108');\n    const map = this.getMap().getState().getLeafletMap();\n\n    this.setGlobalSimplificationTolerance();\n\n    map.addControl(L.control.drawingToolbar({ tool: this }));\n    // * eventlistener for when object is created\n    map.on('draw:created', this.createdListener);\n\n    map.on('zoomend', () => this.setGlobalSimplificationTolerance());\n\n    map.on('click', () => {\n      const sidebar = this.getSidebarTabControl();\n      if (Boolean(sidebar.getState().enabledEl)) return;\n      if (document.querySelector('.leaflet-container').style.cursor === 'wait') return;\n      let selected = this.getState().selectedLayer;\n      if (selected) {\n        this.normalizeElement(selected);\n        this.initNodeEdit(true);\n        this.redrawSidebarTabControl();\n        this.initTransform(selected, true);\n        this.getState().clearSelectedLayer();\n        document.querySelector('.leaflet-container').style.cursor = '';\n      }\n      this.getState().clearExtraSelected();\n    });\n\n    document.addEventListener('keydown', (e) => {\n      if (e.keyCode === SPACE_BAR) {\n        let enabledEl = this.getSidebarTabControl().getState().enabledEl;\n        if (enabledEl) {\n          enabledEl.disable();\n          // map.dragging.enable(); // we do not have to do this, it is already on always\n        }\n      }\n    });\n    document.addEventListener('keyup', (e) => {\n      if (e.keyCode === SPACE_BAR) {\n        let enabledEl = this.getSidebarTabControl().getState().enabledEl;\n        if (enabledEl) {\n          enabledEl.enable();\n          // map.dragging.disable(); // we do not have to do this, it is already on always\n        }\n      }\n    });\n\n    const { pather, guideLayers } = this.getSidebarTabControl().getState();\n    pather.on('created', this.createdPath);\n\n    const { featureGroup } = this.getState();\n    featureGroup.eachLayer((layer) => {\n      layer.addTo(map);\n      this.applyEventListeners(layer);\n    });\n    return [featureGroup];\n  }\n\n  setGlobalSimplificationTolerance() {\n    const map = window.map;\n    const metersPerPixel =\n      (40075016.686 * Math.abs(Math.cos((map.getCenter().lat * Math.PI) / 180))) /\n      Math.pow(2, map.getZoom() + 8);\n    const zoom = map.getZoom();\n\n    // ! this is tried out, so no real calculation\n    window.customTolerance = zoom >= 4 ? 0.0001 * metersPerPixel : 1.5;\n  }\n\n  highlightElement(el) {\n    if (el?._icon) {\n      L.DomUtil.addClass(el._icon, 'highlight-marker');\n    } else {\n      if (el?.setStyle) el.setStyle(highlightStyles);\n    }\n  }\n\n  hightlightOnHover(e) {\n    if (!this.getState().getSelecting()) return;\n    this.highlightElement(e.target);\n  }\n\n  normalizeElement(el) {\n    if (el?._icon) {\n      L.DomUtil.removeClass(el._icon, 'highlight-marker');\n    } else {\n      if (el?.setStyle) el.setStyle(normalStyles);\n    }\n  }\n\n  normalizeOnHover(e) {\n    if (!this.getState().getSelecting()) return;\n    const { chosenLayers } = this.getState();\n    const isChosen = chosenLayers.map((x) => x._leaflet_id).includes(e.target._leaflet_id);\n    if (isChosen) return;\n    this.normalizeElement(e.target);\n  }\n\n  getSummedFeature = (features) => {\n    if (!features || !Array.isArray(features)) return null;\n\n    let summedFeature = features[0];\n    for (let index = 1; index < features.length; index++) {\n      const feature = features[index];\n      let isfeaturePoly = isFeaturePoly(feature);\n\n      if (isfeaturePoly) {\n        summedFeature = union(feature, summedFeature);\n      }\n    }\n\n    return summedFeature;\n  };\n\n  joinChosen = (drawObject) => {\n    const layerState = this.getState();\n    const unfit = !layerState.canPushToChosen(drawObject);\n    if (unfit) return;\n    layerState.pushChosenLayer(drawObject);\n    if (layerState.chosenLayersMaxed()) {\n      if (layerState.chosenLayersArePolys()) {\n        const { chosenLayers } = layerState;\n        const chosenFeatures = chosenLayers\n          .filter((c) => isLayerPoly(c))\n          .map((chosen) => getFeatFromLayer(chosen));\n\n        if (chosenFeatures.length !== chosenLayers.length) return;\n\n        const first = this.getSummedFeature(chosenFeatures[0]);\n        const second = this.getSummedFeature(chosenFeatures[1]);\n\n        const resultFeature = union(first, second);\n        const opts = { ...chosenLayers[0].options, ...chosenLayers[1].options };\n        const result = morphFeatureToPolygon(resultFeature, opts, false);\n        layerState.pushJoinedToChosenLayers(result);\n\n        this.redrawSidebarTabControl(drawObject.layerType);\n      }\n      if (layerState.chosenLayersAreMarkers()) {\n        const { chosenLayers } = layerState;\n\n        this.plotTopology(chosenLayers);\n\n        layerState.deselectChosenLayers();\n        layerState.clearChosenLayers();\n\n        this.redrawSidebarTabControl(null);\n      }\n    }\n  };\n\n  initChangeStyle = (e) => {\n    const drawObject = e.target;\n    const state = this.getState();\n\n    const selecting = state.getSelecting();\n    if (selecting) {\n      this.joinChosen(drawObject);\n      return;\n    }\n\n    if (e?.originalEvent?.ctrlKey && state.selectedLayer) {\n      state.addExtraSelected(drawObject);\n      return;\n    }\n\n    let fgLayers = state.featureGroup._layers;\n    Object.values(fgLayers).forEach((_) => {\n      this.normalizeElement(_);\n      _?.dragging?.disable();\n      if (_?.transform?._enabled) {\n        _.transform.disable();\n        let paintPoly = this.getSidebarTabControl().getState().paintPoly;\n        paintPoly.updatePaintedPolys(_.kIdx, _);\n      }\n    });\n    state.setSelectedLayer(drawObject);\n    this.initTransform(drawObject);\n    this.redrawSidebarTabControl(drawObject.layerType);\n    // TODO:\n    this.tabControl.state.callIdentifierChange(true);\n\n    document.querySelector('.leaflet-container').style.cursor = '';\n    // * at this point user clicked without holdin 'CTRL' key\n    // state.clearExtraSelected();\n  };\n\n  initTransform(drawObject, disable = false) {\n    const layer = drawObject;\n    if (layer?.transform) {\n      if (layer.transform._enabled || disable) {\n        layer.transform.disable();\n        layer.dragging.disable();\n        let paintPoly = this.getSidebarTabControl().getState().paintPoly;\n        paintPoly.updatePaintedPolys(layer.kIdx, layer);\n      } else {\n        layer.transform.enable({ rotation: true, scaling: true });\n        layer.dragging.enable();\n      }\n    } else if (layer.layerType === 'marker') {\n      if (layer.dragging._enabled || disable) {\n        layer.dragging.disable();\n      } else {\n        layer.dragging.enable();\n      }\n    }\n  }\n\n  initNodeEdit(disable = false) {\n    const selectedLayer = this.getState().selectedLayer;\n\n    if (selectedLayer?.editing) {\n      if (selectedLayer.editing._enabled || disable) {\n        selectedLayer.editing.disable();\n        // let paintPoly = this.options.tool.getSidebarTabControl().getState().paintPoly;\n        // paintPoly.updatePaintedPolys(layer.kIdx, layer);\n      } else {\n        selectedLayer.editing.enable();\n      }\n    }\n  }\n\n  removeElement() {\n    const selectedLayer = this.getState().selectedLayer;\n    if (this.getState().selectedLayerIsConnectMarker()) {\n      this.getState().removeMarkersMappedVertices(selectedLayer._leaflet_id);\n    }\n    if (selectedLayer.layerType === 'vertice') {\n      this.getState().removeGivenVertice(selectedLayer._leaflet_id);\n    }\n    let paintPoly = this.getSidebarTabControl().getState().paintPoly;\n    paintPoly.clearPaintedPolys(selectedLayer.kIdx);\n    this.getState().removeSelectedLayer();\n    this.redrawSidebarTabControl(null);\n  }\n\n  initSelecting = () => {\n    const selecting = this.getState().getSelecting();\n    this.getState().setSelecting(!selecting);\n    if (!selecting) document.querySelector('.leaflet-container').style.cursor = 'crosshair';\n    else document.querySelector('.leaflet-container').style.cursor = '';\n  };\n\n  divideEqual = () => {\n    const { selectedLayer } = this.getState();\n    if (!selectedLayer) return;\n    if (!isLayerPoly(selectedLayer)) return;\n\n    const polygonFeat = selectedLayer.toGeoJSON();\n    const polygonBbox = turf.bbox(polygonFeat);\n    const area = turf.area(polygonFeat);\n    const options = { units: 'meters' };\n    var from = turf.point([polygonBbox[0], polygonBbox[1]]);\n    var to = turf.point([polygonBbox[2], polygonBbox[3]]);\n\n    var distance = turf.distance(from, to, options);\n    console.log({ distance });\n    const cellSide = 50;\n\n    const squareGrid = turf.squareGrid(polygonBbox, cellSide, options);\n    // squareGrid.features.forEach((feat) => {\n    //   let latlngs = L.GeoJSON.coordsToLatLngs(feat.geometry.coordinates, 1);\n    //   let newPoly = new L.polygon(latlngs);\n    //   this.getState().addLayer(newPoly);\n    // });\n  };\n\n  /**\n   * This function is called when layer items are rendered.\n   */\n  postCreateLayerItems() {}\n\n  /**\n   * It reloads data and redraw the layer.\n   */\n  redraw(onlyStyle) {\n    console.log('%c ...redrawing', 'color: #08ff51');\n  }\n\n  /**\n   * This function is called when a custom event is invoked.\n   *\n   * @param {AbstractEvent} event\n   */\n  handleEvent(event) {}\n}\n\nexport default DrawingLayerTool;\n","import AbstractMapObjectDefaults from '../model/object/abstract/AbstractMapObjectDefaults';\nimport ToolsManager from '../model/tool/generic/ToolsManager';\nimport SidebarTool from '../tools/sidebar/SidebarTool';\nimport FiltersTool from '../tools/filters/FiltersTool';\nimport SettingsTool from '../tools/settings/SettingsTool';\nimport BasicMapConfig from '../model/config/basic/BasicMapConfig';\nimport MapLayerTool from '../tools/layers/map/MapLayerTool';\nimport ChoroplethLayerTool from '../tools/layers/choropleth/ChoroplethLayerTool';\nimport MarkerLayerTool from '../tools/layers/marker/MarkerLayerTool';\nimport ConnectionLayerTool from '../tools/layers/connection/ConnectionLayerTool';\nimport ThemesTool from '../tools/themes/ThemesTool';\nimport SelectionTool from '../tools/selection/SelectionTool';\nimport GeovistoMap from './GeovistoMap';\n\nimport countryCentroids from '../../static/geo/country_centroids.json';\nimport countryPolygons from '../../static/geo/country_polygons.json';\nimport { DrawingLayerTool } from '../tools/layers/drawing';\n\n/**\n * This class provide functions which return the default state values.\n *\n * @author Jiri Hynek\n */\nclass GeovistoMapDefaults extends AbstractMapObjectDefaults {\n  /**\n   * It creates map defaults.\n   */\n  constructor() {\n    super();\n  }\n\n  /**\n   * It returns a unique type string of the object.\n   */\n  getType() {\n    return GeovistoMap.TYPE();\n  }\n\n  /**\n   * It returns default managers.\n   *\n   * This function can be overriden;\n   */\n  getTemplates() {\n    return {\n      tools: this.getToolTemplates(),\n    };\n  }\n\n  /**\n   * It returns default tools manager.\n   *\n   * This function can be overriden;\n   */\n  getToolTemplates() {\n    return new ToolsManager([\n      new SidebarTool(),\n      new SettingsTool(),\n      new FiltersTool(),\n      new ThemesTool(),\n      new SelectionTool(),\n      new MapLayerTool(),\n      new ChoroplethLayerTool({ zindex: 350 }),\n      new MarkerLayerTool(),\n      new ConnectionLayerTool(),\n      new DrawingLayerTool(),\n    ]);\n  }\n\n  /**\n   * It returns a default tools manager.\n   */\n  getTools() {\n    return new ToolsManager([]);\n  }\n\n  /**\n   * It returns default map config.\n   */\n  getMapData() {\n    return new FlattenedMapData([]);\n  }\n\n  /**\n   * It returns default geo polygons.\n   */\n  getPolygons() {\n    if (!this.polygons) {\n      this.polygons = countryPolygons;\n    }\n    return this.polygons;\n  }\n\n  /**\n   * It returns default geo centroids.\n   */\n  getCentroids() {\n    if (!this.centroids) {\n      this.centroids = countryCentroids;\n    }\n    return this.centroids;\n  }\n\n  /**\n   * It returns default global state variables.\n   */\n  getGlobals() {\n    return {\n      zoom: this.getZoom(),\n      mapCenter: this.getMapCenter(),\n      mapStructure: this.getMapStructure(),\n    };\n  }\n\n  /**\n   * It returns default zoom level.\n   */\n  getZoom() {\n    return 2;\n  }\n\n  /**\n   * It returns default center coordinates in Leaflet map.\n   */\n  getMapCenter() {\n    return {\n      lat: 50,\n      lng: -0.1,\n    };\n  }\n\n  /**\n   * It returns the map structure defined with respect to the leaflet library.\n   */\n  getMapStructure() {\n    return {\n      maxZoom: 10,\n      maxBounds: [\n        [-100, -400],\n        [2000, 400],\n      ],\n    };\n  }\n\n  /**\n   * It returns default map config.\n   */\n  getConfig() {\n    return new BasicMapConfig({});\n  }\n}\nexport default GeovistoMapDefaults;\n","import AbstractToolsManager from '../model/tool/abstract/AbstractToolsManager';\nimport AbstractMapData from '../model/data/AbstractMapData';\nimport AbstractMapObjectState from '../model/object/abstract/AbstractMapObjectState';\nimport AbstractMapConfig from '../model/config/AbstractMapConfig';\nimport { DRAWING_TOOL_LAYER_TYPE } from '../tools/layers/drawing/DrawingLayerTool';\n\n/**\n * This class manages state of the map.\n * It wraps the state since the map can work with state objects which needs to be explicitly serialized.\n *\n * @author Jiri Hynek\n */\nclass GeovistoMapState extends AbstractMapObjectState {\n  /**\n   * It initializes a map state.\n   */\n  constructor() {\n    super();\n  }\n\n  /**\n   * It resets state with respect to initial props. Optionally, defaults can be set if property is undefined.\n   *\n   * @param {*} defaults\n   */\n  reset(defaults) {\n    super.reset(defaults);\n\n    let props = this.getProps();\n\n    // templates\n    let templates =\n      props.templates == undefined && defaults ? defaults.getTemplates() : props.templates;\n    this.setToolTemplates(\n      templates.tools == undefined && defaults ? defaults.getToolTemplates() : templates.tools,\n    );\n\n    // tools\n    this.setTools(props.tools == undefined && defaults ? defaults.getTools() : props.tools);\n\n    // data\n    this.setMapData(props.data == undefined && defaults ? defaults.getMapData() : props.data);\n\n    // geo data - TODO convert to generic geo data\n    this.setPolygons(\n      props.polygons == undefined && defaults ? defaults.getPolygons() : props.polygons,\n    );\n    this.setCentroids(\n      props.centroids == undefined && defaults ? defaults.getCentroids() : props.centroids,\n    );\n\n    // globals (state variables which are common for all geovisto tools) - can be undefined and set by initialize function\n    let globals = props.globals == undefined && defaults ? defaults.getGlobals() : props.globals;\n    this.setInitialZoom(globals.zoom == undefined && defaults ? defaults.getZoom() : globals.zoom);\n    this.setInitialMapCenter(\n      globals.mapCenter == undefined && defaults ? defaults.getMapCenter() : globals.mapCenter,\n    );\n    this.setInitialMapStructure(\n      globals.mapStructure == undefined && defaults\n        ? defaults.getMapStructure()\n        : globals.mapStructure,\n    );\n  }\n\n  /**\n   * It takes config and desrializes the values.\n   *\n   * @param {*} config\n   */\n  deserialize(config, geojson) {\n    super.deserialize(config);\n\n    if (config.zoom != undefined) this.setInitialZoom(config.zoom);\n    if (config.mapCenter != undefined) this.setInitialMapCenter(config.mapCenter);\n    if (config.mapStructure != undefined) this.setInitialMapStructure(config.mapStructure);\n\n    this.deserializeGeoJSON(geojson);\n  }\n\n  deserializeGeoJSON(geojson) {\n    if (!geojson) return;\n    // tools\n    let tools = this.getTools().getObjects();\n    // get drawing tool\n    let found = tools.find((t) => t.getState().type === DRAWING_TOOL_LAYER_TYPE);\n    if (found) {\n      found.getState().deserializeGeoJSON(geojson);\n    }\n  }\n\n  /**\n   * It serializes the map state. Optionally, a serialed value can be let undefined if it equals the default value.\n   *\n   * @param {*} defaults\n   */\n  serialize(defaults) {\n    // do not serialize the id and type for map\n    //let config = super.serialize(defaults);\n    let config = {};\n\n    // initialize config\n    let map = this.getLeafletMap();\n    config.zoom = defaults && map.getZoom() == defaults.getZoom() ? undefined : map.getZoom();\n    config.mapCenter =\n      defaults && map.getCenter() == defaults.getMapCenter() ? undefined : map.getCenter();\n    // TODO map structure\n    config.tools = [];\n\n    // tools\n    let tools = this.getTools().getObjects();\n    for (let i = 0; i < tools.length; i++) {\n      config.tools.push(tools[i].getState().serialize());\n    }\n\n    return config;\n  }\n\n  serializeGeoJSON() {\n    // tools\n    let tools = this.getTools().getObjects();\n    // get drawing tool\n    let found = tools.find((t) => t.getState().type === DRAWING_TOOL_LAYER_TYPE);\n    if (found) {\n      const config = found.getState().serializeToGeoJSON();\n      return config;\n    }\n    return {};\n  }\n\n  /**\n   * It returns the Leaflet map.\n   */\n  getLeafletMap() {\n    return this.map;\n  }\n\n  /**\n   * It returns the Leaflet map.\n   *\n   * @param {L.Map} map\n   */\n  setLeafletMap(map) {\n    return (this.map = map);\n  }\n\n  /**\n   * It returns tool templates.\n   */\n  getToolTemplates() {\n    return this.toolTemplates;\n  }\n\n  /**\n   * It sets tool templates.\n   *\n   * @param {AbstractToolsManager} toolTemplates\n   */\n  setToolTemplates(toolTemplates) {\n    this.toolTemplates = toolTemplates;\n  }\n\n  /**\n   * It returns tools.\n   */\n  getTools() {\n    return this.tools;\n  }\n\n  /**\n   * It sets tools.\n   *\n   * @param {AbstractToolsManager} tools\n   */\n  setTools(tools) {\n    // we use copies of predefined tools due to later multiple imports of configs\n    this.tools = tools.copy();\n  }\n\n  /**\n   * It returns the MapData object.\n   */\n  getMapData() {\n    return this.mapData;\n  }\n\n  /**\n   * It sets the MapData object.\n   * note: It also updates the current data.\n   *\n   * @param {AbstractMapData} mapData\n   */\n  setMapData(mapData) {\n    this.mapData = mapData;\n    this.setCurrentData(mapData.getData());\n  }\n\n  /**\n   * It returns current data (might be filtered).\n   */\n  getCurrentData() {\n    return this.data;\n  }\n\n  /**\n   * It sets current data.\n   *\n   * @param {[any]} data\n   */\n  setCurrentData(data) {\n    return (this.data = data);\n  }\n\n  /**\n   * It returns the MapConfig object.\n   */\n  getMapConfig() {\n    return this.mapConfig;\n  }\n\n  /**\n   * It sets the MapConfig object.\n   *\n   * @param {AbstractMapConfig} mapData\n   */\n  setMapConfig(mapConfig) {\n    this.mapConfig = mapConfig;\n  }\n\n  /**\n   * It returns polygons.\n   */\n  getPolygons() {\n    return this.polygons;\n  }\n\n  /**\n   * It sets polygons.\n   *\n   * @param {[any]} polygons\n   */\n  setPolygons(polygons) {\n    let polys = [];\n    if (Array.isArray(polygons)) polys = polygons\n    if (polygons?.features) polys = polygons.features;\n    return (this.polygons = polys);\n  }\n\n  /**\n   * It returns centroids.\n   */\n  getCentroids() {\n    return this.centroids;\n  }\n\n  /**\n   * It sets centroids.\n   *\n   * @param {[any]} centroids\n   */\n  setCentroids(centroids) {\n    return (this.centroids = centroids);\n  }\n\n  /**\n   * It returns the initial zoom level.\n   */\n  getInitialZoom() {\n    return this.zoom;\n  }\n\n  /**\n   * It sets initial zoom level.\n   *\n   * @param {number} zoom\n   */\n  setInitialZoom(zoom) {\n    return (this.zoom = zoom);\n  }\n\n  /**\n   * It returns the initial map center.\n   */\n  getInitialMapCenter() {\n    return this.mapCenter;\n  }\n\n  /**\n   * It sets initial map center.\n   *\n   * @param {*} mapCenter\n   */\n  setInitialMapCenter(mapCenter) {\n    return (this.mapCenter = mapCenter);\n  }\n\n  /**\n   * It returns the initial structure.\n   */\n  getInitialMapStructure() {\n    return this.mapCenter;\n  }\n\n  /**\n   * It sets initial map structure.\n   *\n   * @param {*} mapStructure\n   */\n  setInitialMapStructure(mapStructure) {\n    return (this.mapStructure = mapStructure);\n  }\n}\nexport default GeovistoMapState;\n","import L from 'leaflet';\nimport 'leaflet/dist/leaflet.css';\nimport '../styles/common.scss';\nimport AbstractMapObject from '../model/object/abstract/AbstractMapObject';\nimport AbstractEvent from '../model/event/abstract/AbstractEvent';\nimport DataChangeEvent from '../model/event/basic/DataChangeEvent';\nimport GeovistoMapDefaults from './GeovistoMapDefaults';\nimport GeovistoMapState from './GeovistoMapState';\nimport MapCreatedEvent from '../model/event/basic/MapCreatedEvent';\n\n/**\n * Representation of map wrapper which handles map layers, sidebar and other tools\n *\n * @author Jiri Hynek\n */\nclass GeovistoMap extends AbstractMapObject {\n  /**\n   * Initializes object.\n   *\n   * @param {*} props\n   */\n  constructor(props) {\n    super(props);\n  }\n\n  /**\n   * It creates new defaults of the object.\n   */\n  createDefaults() {\n    return new GeovistoMapDefaults();\n  }\n\n  /**\n   * It creates new state if the object.\n   */\n  createState() {\n    return new GeovistoMapState();\n  }\n\n  /**\n   * The function draws a new map.\n   */\n  draw(mapConfig, geojson) {\n    // reset variables, use defaults\n    this.getState().reset(this.getDefaults());\n\n    // initialize map and tools\n    this.initialize(mapConfig, geojson);\n\n    // render map and tools\n    this.create();\n  }\n\n  /**\n   * This function redraws the current map.\n   */\n  redraw(mapConfig, props, geojson) {\n    // get map and remove map children\n    let mapContainer = document.getElementById(this.getState().getId());\n    if (mapContainer && mapContainer.childNodes.length > 0) {\n      mapContainer.childNodes[0].remove();\n    }\n\n    // creates a new state with a new props\n    if (props) {\n      this.state = this.createState();\n      this.state.initialize(props, this.getDefaults());\n    } else {\n      this.state.reset(this.getDefaults());\n    }\n\n    // initialize map and tools\n    this.initialize(mapConfig, geojson);\n\n    // render map and tools\n    this.create();\n  }\n\n  /**\n   * Resets variables.\n   */\n  initialize(mapConfig, geojson) {\n    mapConfig = mapConfig == undefined ? this.getDefaults().getConfig() : mapConfig;\n    this.getState().setMapConfig(mapConfig);\n\n    // override state by Geovisto config if specified in argument\n    // this also initializes child map objects - e.g., tools\n    this.getState().deserialize(mapConfig.getConfig(), geojson);\n\n    // initialize existing tools\n    let toolsManager = this.getState().getTools();\n    if (!toolsManager.isEmpty()) {\n      // a) tool is already created, initialize them and try to find their config\n      let tools = toolsManager.getObjects();\n      for (let i = 0; i < tools.length; i++) {\n        // initialize tool (provide map and config)\n        tools[i].initialize(this, mapConfig.getToolConfig(tools[i].getId()));\n      }\n    }\n\n    // deserialize remaining tools with respect to the config\n    let toolsConfigs = mapConfig.getToolsConfigs();\n    if (toolsConfigs != undefined) {\n      let toolTemplatesManager = this.getState().getToolTemplates();\n      let tool;\n      let toolConfig;\n      for (let i = 0; i < toolsConfigs.length; i++) {\n        toolConfig = toolsConfigs[i];\n\n        // filter already initialized tools\n        if (toolConfig.id != undefined) {\n          tool = toolsManager.getById(toolConfig.id);\n          if (tool != undefined) {\n            continue;\n          }\n        }\n\n        // b) tool has not been created yet, use config and tool template to create the tool\n        let toolTemplates = toolTemplatesManager.getByType(toolConfig.type);\n        if (toolTemplates.length > 0) {\n          // filter singleton duplicates\n          if (\n            toolTemplates[0].isSingleton() &&\n            toolsManager.getByType(toolConfig.type).length > 0\n          ) {\n            continue;\n          }\n          // create copy of the tool template\n          tool = toolTemplates[0].copy();\n          // initialize tool\n          tool.initialize(this, toolConfig);\n          // add to the list of tools\n          toolsManager.add(tool);\n        }\n\n        // if there is no template, the tool config is ignored\n      }\n    }\n  }\n\n  /**\n   * It exports the serialized representation of the current state of the map.\n   */\n  export() {\n    return this.getState().getMapConfig().export(this.getState().serialize(this.getDefaults()));\n  }\n\n  exportGeoJSON() {\n    return this.getState().serializeGeoJSON();\n  }\n\n  /**\n   * This function creates Geovisto map - it creates map container, leaflet map and tools.\n   */\n  create() {\n    // create new map container (DOM element)\n    this.createMapContainer();\n\n    // create Leaflet map\n    this.createMap();\n\n    // create tools\n    this.createTools();\n  }\n\n  /**\n   * This function creates the map container.\n   */\n  createMapContainer() {\n    let mapContainer = document\n      .getElementById(this.getState().getId())\n      .appendChild(document.createElement('div'));\n    mapContainer.setAttribute('id', this.getContainerId());\n    mapContainer.setAttribute('class', this.getContainerClass());\n\n    return mapContainer;\n  }\n\n  /**\n   * The type of the object.\n   */\n  static TYPE() {\n    // important! CSS styles use this name!\n    return 'geovisto-map';\n  }\n\n  /**\n   * It returns ID of the map container.\n   */\n  getContainerId() {\n    return this.getId() + '-container';\n  }\n\n  /**\n   * It returns class of the map container.\n   */\n  getContainerClass() {\n    return this.getType() + '-container';\n  }\n\n  /**\n   * Creates the leaflet-based map with respect to the configuration.\n   */\n  createMap() {\n    let state = this.getState();\n    let map = L.map(this.getContainerId(), state.getInitialMapStructure()).setView(\n      state.getInitialMapCenter(),\n      state.getInitialZoom(),\n    );\n\n    // add attribution\n    map.attributionControl.addAttribution(this.getMapAttribution());\n\n    this.getState().setLeafletMap(map);\n    window.map = map;\n\n    return this.map;\n  }\n\n  /**\n   * It returns the map attribution.\n   *\n   * This function can be overriden;\n   */\n  getMapAttribution() {\n    return '<a href=\"https://raw.githubusercontent.com/holtzy/D3-graph-gallery/master/DATA/world.geojson\">GeoJSON</a>';\n  }\n\n  /**\n   * This function creates map tools.\n   */\n  createTools() {\n    // create tools\n    let tools = this.getState().getTools().getObjects();\n    for (let i = 0; i < tools.length; i++) {\n      // create tool\n      tools[i].create();\n    }\n  }\n\n  /**\n   * It updates data and invokes listeners.\n   *\n   * @param {[any]} data\n   * @param {*} source of the change\n   */\n  updateData(data, source) {\n    // update state\n    this.getState().setCurrentData(data);\n\n    // create and dispatch event\n    this.dispatchEvent(new DataChangeEvent(source, data));\n  }\n\n  /**\n   * It sends custom event to all listeners (tools)\n   *\n   * @param {AbstractEvent} event\n   */\n  dispatchEvent(event) {\n    console.log('event: ' + event.getType(), event);\n    // notify listeners\n    let tools = this.getState().getTools().getObjects();\n    for (let i = 0; i < tools.length; i++) {\n      tools[i].handleEvent(event);\n    }\n  }\n}\n\nexport default GeovistoMap;\n","import React, { Component } from 'react';\nimport '../styles/common.scss';\nimport GeovistoMap from '../map/GeovistoMap';\n\n/**\n * React component which wraps Geovisto map.\n *\n * @author Jiri Hynek\n */\nclass ReactGeovistoMap extends Component {\n  /**\n   * Initializes object.\n   *\n   * @param {*} props\n   */\n  constructor(props) {\n    super(props);\n\n    if (props.id == undefined) props.id = this.getDefaultId();\n\n    // create new Geovisto map\n    this.m = new GeovistoMap(props);\n  }\n\n  /**\n   * It returns Geovisto map.\n   */\n  getMap() {\n    return this.m;\n  }\n\n  /**\n   * It returns a default id used for Geovisto map container.\n   */\n  getDefaultId() {\n    return 'my-geovisto-map';\n  }\n\n  /**\n   * It returns a default class name used for Geovisto map container.\n   */\n  getDefaultClass() {\n    return 'geovisto-map';\n  }\n\n  /**\n   * Draw map after component is rendered\n   */\n  componentDidMount() {\n    // draw map with the current config\n    this.m.draw(this.props.config, this.props.geojson);\n  }\n\n  /**\n   * Redraw map after component is updated\n   */\n  componentDidUpdate() {\n    // redraw map with a new config and new props\n    this.m.redraw(this.props.config, this.props, this.props.geojson);\n  }\n\n  /**\n   * The render function prepares a wrapper which will be used by Geovisto/Leaflet to render the map.\n   */\n  render() {\n    return <div id={this.props.id} className={this.getDefaultClass()} />;\n  }\n}\n\nexport default ReactGeovistoMap;\n","import AbstractMapDataDomain from '../AbstractMapDataDomain';\n\n/**\n * The class wraps meta data path used to find data.\n * \n * @author Jiri Hynek\n */\nclass FlattenedMapDataDomain extends AbstractMapDataDomain {\n\n    constructor(domainDescription) {\n        super(domainDescription);\n        this.label = domainDescription.join().replace(/,/g, \".\");\n    }\n\n    /**\n     * The function returns the string representation of the map data domain\n     * which is *unique* among the labels of other data domains.\n     * \n     * It is uses dots to delimiter the array items.\n     * \n     * @returns {string}\n     */\n    toString() {\n        return this.label;\n    }\n}\nexport default FlattenedMapDataDomain;","import rfdc from 'rfdc';\nimport FlattenedMapDataDomain from './FlattenedMapDataDomain';\nimport AbstractMapData from '../AbstractMapData';\n\n/**\n * Example of a data wrapper which provides a basic flattening.\n * \n * @author Jiri Hynek\n */\nclass FlattenedMapData extends AbstractMapData {\n\n    constructor(data) {\n        super(data);\n        this.flattenedData = undefined;\n        this.dataDomains = undefined;\n    }\n\n    /**\n     * It returns the original input data.\n     */\n    getOriginalData() {\n        return super.getOriginalData();\n    }\n\n    /**\n     * It returns list of data domains (FlattenedMapDataDomain) representing data dimensions e. g.:\n     * [\n     *   [ 'value' ],\n     *   [ 'source', 'ip' ],\n     *   [ 'source', 'country' ],\n     *   [ 'target', 'ip' ],\n     *   [ 'target', 'country' ]\n     * ]\n     * \n     */\n    getDataDomains() {\n        if(this.dataDomains == undefined) {\n            this.createDataDomains();\n        }\n\n        return this.dataDomains;\n    }\n\n    /**\n     * It returns the data domain which corresponds to the given string.\n     * \n     * @param {string} label \n     */\n    getDataDomain(label) {\n        let dataDomains = this.getDataDomains();\n        for(let i = 0; i < dataDomains.size; i++) {\n            if(dataDomains[i].toString == label) {\n                return dataDomains[i];\n            }\n        }\n        return new FlattenedMapDataDomain(label.split('.'));\n    }\n\n    /**\n     * It returns preprocessed flattened data.\n     */\n    getData() {\n        if(this.flattenedData == undefined) {\n            this.flattenArrays();\n        }\n        return this.flattenedData;\n    }\n\n    /**\n     * It returns list of all values of the selected data domain.\n     * \n     * @param {AbstractMapDataDomain} dataDomain \n     * @returns {[String]}\n     */\n    getValues(dataDomain) {\n        return this.getDataValues(dataDomain, this.getData());\n    }\n\n    /**\n     * It returns list of all values of the selected data domain\n     * for the given subset of data.\n     * \n     * @param {AbstractMapDataDomain} dataDomain \n     * @param {any} data \n     * @returns {[String]}\n     */\n    getDataValues(dataDomain, data) {\n        let result = [];\n\n        if(data != undefined) {\n            for(let i = 0; i < data.length; i++) {\n                let actResult = [];\n                FlattenedMapData.processDataDomainDescription(actResult, data[i], dataDomain.getDomainDescription(), 0);\n                // add only unique results\n                for(let j = 0; j < actResult.length; j++) {\n                    if(!result.includes(actResult[j])) {\n                        result.push(actResult[j]);\n                    }\n                }\n            }\n        }\n\n        return result;\n    }\n\n    /**\n     * It returns values stored in the given item of the selected data domain.\n     * \n     * @param {AbstractMapDataDomain} dataDomain \n     * @param {any} item \n     * @returns {[String]}\n     */\n    getItemValues(dataDomain, item) {\n        let result = [];\n\n        if(item != undefined) {\n            FlattenedMapData.processDataDomainDescription(result, item, dataDomain.getDomainDescription(), 0);\n        }\n\n        return result;\n    }\n\n    /**\n     * Help function which analyzes data and creates its metedata description.\n     */\n    createDataDomains() {\n        /*\n         * Tests if an array contains an item\n         */\n        let contains = function(dataDomains, dataDomain) {\n            let dataDomainLabel = dataDomain.toString()\n            for(let i = 0; i < dataDomains.length; i++) {\n                if(dataDomains[i].toString() == dataDomainLabel) {\n                    return true;\n                }\n            }\n            return false;\n        }\n\n        /*\n         * *Recursive* build of data domains\n         *\n         * TODO: optimize\n         */\n        let processDataDomain = function(dataDomains, dataDomain, actValue) {\n            if(typeof actValue == \"object\" && actValue != null) {\n                // object\n                if(Array.isArray(actValue)) {\n                    // array - in the case that the data are not flattened\n                    dataDomain.push(\"[]\");\n                    for(let i = 0; i < actValue.length; i++) {\n                        processDataDomain(dataDomains, dataDomain, actValue[i]);\n                    }\n                } else {\n                    // structure (key, value)\n                    let actKeys = Object.keys(actValue);\n                    for(let j = 0; j < actKeys.length; j++) {\n                        let dataDomainCopy = [...dataDomain];\n                        dataDomainCopy.push(actKeys[j]);\n                        processDataDomain(dataDomains, dataDomainCopy, actValue[actKeys[j]]);\n                    }\n                }\n            } else {\n                // simple value\n                let newMapDataDomain = new FlattenedMapDataDomain(dataDomain);\n                if(!contains(dataDomains, newMapDataDomain)) {\n                    dataDomains.push(newMapDataDomain);\n                }\n            }\n        }\n\n        // process data -> builing list of data domains (simplified scheme)\n        this.dataDomains = [];\n        let dataDomain;\n        let actKeys;\n        let data = this.getData(); // get flattened data\n        for (var i = 0; i < data.length; i++) {\n            actKeys = Object.keys(data[i]);\n            for(let j = 0; j < actKeys.length; j++) {\n                dataDomain = [ actKeys[j] ];\n                processDataDomain(this.dataDomains, dataDomain, data[i][actKeys[j]]);\n            }\n        }\n        console.log(\"data domains:\", this.dataDomains);\n    }\n\n    /**\n     * Help function which converts data to the flat structure.\n     */\n    flattenArrays() { \n\n        /*\n         * *Recursive* flattening of data\n         *\n         * TODO: optimize\n         */\n        let transformObject = function(actValue) {\n            let result;\n            let clone = new rfdc();\n            if(typeof actValue == \"object\") {\n                // object\n                if(Array.isArray(actValue)) {\n                    // array\n                    let transformedChildren = [];\n                    let transformedChild;\n                    for(let i = 0; i < actValue.length; i++) {\n                        transformedChild = transformObject(actValue[i]);\n                        if(Array.isArray(transformedChild)) {\n                            transformedChildren = transformedChildren.concat(transformedChild);\n                        } else {\n                            transformedChildren.push(transformedChild);\n                        }\n                    }\n                    result = transformedChildren;\n                } else {\n                    // structure (key, value)\n                    let transformedChild;\n                    let actKeys = Object.keys(actValue);\n                    result = [{}];\n                    for(let i = 0; i < actKeys.length; i++) {\n                        transformedChild = transformObject(actValue[actKeys[i]]);\n                        if(Array.isArray(transformedChild)) {\n                            // wee need to duplicate actual results\n                            let newResults = [];\n                            let copy;\n                            for(let j = 0; j < result.length; j++) {\n                                for(let k = 0; k < transformedChild.length; k++) {\n                                    copy = clone(result[j]);\n                                    copy[actKeys[i]] = transformedChild[k];\n                                    newResults.push(copy);\n                                }\n                            }\n                            result = newResults;\n                        } else {\n                            for(let j = 0; j < result.length; j++) {\n                                result[j][actKeys[i]] = transformedChild;\n                            }\n                        }\n                    }\n                }\n\n                // optimization\n                if(result.length == 0) {\n                    result = null;\n                } else if(result.length == 1) {\n                    result = result[0];\n                }\n            } else {\n                 result = actValue;\n            }\n            return result;\n        }\n        \n        this.flattenedData = transformObject(this.data);\n        console.log(\"flattened data: \", this.data);\n    }\n\n    /**\n     * Static help function represenets a step of recursive data processing searching data items.\n     * \n     * @param {*} result \n     * @param {*} actValue \n     * @param {*} dataDomain \n     * @param {*} i \n     */\n    static processDataDomainDescription(result, actValue, domainDescription, i) {\n\n        if(actValue != undefined && actValue != null) {\n            if(i == domainDescription.length) {\n                // reached the value\n                if(typeof actValue != \"object\") {\n                    result.push(actValue);\n                } else {\n                    result.push(null);\n                }\n            } else {\n                // act value needs to be type of object\n                if(typeof actValue == \"object\") {\n                    let dataDomainPart = domainDescription[i];\n                    if(dataDomainPart == \"[]\") {\n                        // act value needs to be type of array\n                        if(Array.isArray(actValue)) {\n                            for(let j = 0; j < actValue.length; j++) {\n                                FlattenedMapData.processDataDomainDescription(result, actValue[j], domainDescription, i+1);\n                            }\n                        }\n                    } else {\n                        // act value is structure\n                        FlattenedMapData.processDataDomainDescription(result, actValue[dataDomainPart], domainDescription, i+1);\n                    }\n                }\n            }\n        }\n    }\n}\nexport default FlattenedMapData\n","import React, { Component } from 'react';\r\nimport ReactGeovistoMap from '../react/ReactGeovistoMap';\r\nimport FlattenedMapData from '../model/data/basic/FlattenedMapData';\r\n\r\nimport SettingsTool from '../tools/settings/SettingsTool';\r\nimport FiltersTool from '../tools/filters/FiltersTool';\r\nimport BasicMapConfig from '../model/config/basic/BasicMapConfig';\r\nimport SidebarTool from '../tools/sidebar/SidebarTool';\r\nimport ToolsManager from '../model/tool/generic/ToolsManager';\r\nimport ThemesManager from '../tools/themes/model/theme/generic/ThemesManager';\r\nimport ThemesTool from '../tools/themes/ThemesTool';\r\nimport SelectionTool from '../tools/selection/SelectionTool';\r\nimport MapLayerTool from '../tools/layers/map/MapLayerTool';\r\nimport ChoroplethLayerTool from '../tools/layers/choropleth/ChoroplethLayerTool';\r\nimport MarkerLayerTool from '../tools/layers/marker/MarkerLayerTool';\r\nimport ConnectionLayerTool from '../tools/layers/connection/ConnectionLayerTool';\r\nimport DrawingLayerTool from '../tools/layers/drawing/DrawingLayerTool';\r\nimport Dark1Theme from '../tools/themes/model/theme/basic/dark1/Dark1Theme';\r\nimport Dark2Theme from '../tools/themes/model/theme/basic/dark2/Dark2Theme';\r\nimport Dark3Theme from '../tools/themes/model/theme/basic/dark3/Dark3Theme';\r\nimport Light1Theme from '../tools/themes/model/theme/basic/light1/Light1Theme';\r\nimport Light2Theme from '../tools/themes/model/theme/basic/light2/Light2Theme';\r\nimport Light3Theme from '../tools/themes/model/theme/basic/light3/Light3Theme';\r\nimport EqFilterOperation from '../tools/filters/model/basic/EqFilterOperation';\r\nimport NeqFilterOperation from '../tools/filters/model/basic/NeqFilterOperation';\r\nimport RegFilterOperation from '../tools/filters/model/basic/RegFilterOperation';\r\nimport FiltersManager from '../tools/filters/model/generic/FiltersManager';\r\n\r\nimport 'font-awesome/css/font-awesome.min.css';\r\nimport './Demo.scss';\r\n\r\nimport Polygons from '../../static/geo/country_polygons.json';\r\nimport Centroids from '../../static/geo/country_centroids.json';\r\nimport JsonConfig from '../../static/config/config.json';\r\nimport GeojsonConfig from '../../static/geo/map.json';\r\n\r\nimport JsonDataDemo1 from '../../static/data/demo1.json';\r\nimport JsonDataDemo2 from '../../static/data/demo2.json';\r\nimport VaccinationData from '../../static/data/covidSlovakRegions.json';\r\nimport FloorPlanData from '../../static/data/floor-plan-data.json';\r\nimport NetworkData from '../../static/data/network-data.json';\r\n\r\n/* example of screen component with grid layout and card wrapper usage */\r\n\r\nconst C_ID_select_data = 'leaflet-combined-map-select-data';\r\nconst C_ID_check_data = 'leaflet-combined-map-check-data';\r\nconst C_ID_input_data = 'leaflet-combined-map-input-data';\r\nconst C_ID_check_config = 'leaflet-combined-map-check-config';\r\nconst C_ID_input_config = 'leaflet-combined-map-input-config';\r\nconst C_ID_check_geojson = 'leaflet-combined-map-check-geojson';\r\nconst C_ID_input_geojson = 'leaflet-combined-map-input-geojson';\r\nconst C_ID_check_choropleth = 'leaflet-combined-map-check-choropleth';\r\nconst C_ID_input_choropleth = 'leaflet-combined-map-input-choropleth';\r\nconst C_ID_input_import = 'leaflet-combined-map-input-import';\r\nconst C_ID_input_export = 'leaflet-combined-map-input-export';\r\n\r\nclass Demo extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    // initialize geo objects\r\n    this.polygons = Polygons;\r\n    this.centroids = Centroids;\r\n\r\n    // // implicit file\r\n    const jsonData = JsonDataDemo1;\r\n\r\n    // // implicit config\r\n    const jsonConfig = JsonConfig;\r\n\r\n    // // implicitgeojson\r\n    const geojsonConfig = GeojsonConfig;\r\n\r\n    // reference to the rendered map\r\n    this.map = React.createRef();\r\n\r\n    // data and config can be changed\r\n    this.state = {\r\n      data: jsonData,\r\n      config: jsonConfig,\r\n      geo: geojsonConfig,\r\n    };\r\n  }\r\n\r\n  componentDidMount() {\r\n    const _this = this;\r\n\r\n    // ------ enable check boxes ------ //\r\n\r\n    const enableInput = function (checked, id) {\r\n      if (checked) {\r\n        document.getElementById(id).removeAttribute('disabled');\r\n      } else {\r\n        document.getElementById(id).setAttribute('disabled', 'disabled');\r\n      }\r\n    };\r\n\r\n    // enable data check box\r\n    const enableDataInput = function (e) {\r\n      enableInput(e.target.checked, C_ID_input_data);\r\n    };\r\n    document.getElementById(C_ID_input_data).setAttribute('disabled', 'disabled');\r\n    document.getElementById(C_ID_check_data).onchange = enableDataInput;\r\n\r\n    // enable config check box\r\n    const enableConfigInput = function (e) {\r\n      enableInput(e.target.checked, C_ID_input_config);\r\n    };\r\n    document.getElementById(C_ID_input_config).setAttribute('disabled', 'disabled');\r\n    document.getElementById(C_ID_check_config).onchange = enableConfigInput;\r\n\r\n    // enable geojson check box\r\n    const enableGeojsonInput = function (e) {\r\n      enableInput(e.target.checked, C_ID_input_geojson);\r\n    };\r\n    document.getElementById(C_ID_input_geojson).setAttribute('disabled', 'disabled');\r\n    document.getElementById(C_ID_check_geojson).onchange = enableGeojsonInput;\r\n\r\n    // enable choropleth check box\r\n    const enableChoroplethInput = function (e) {\r\n      enableInput(e.target.checked, C_ID_input_choropleth);\r\n    };\r\n    document.getElementById(C_ID_input_choropleth).setAttribute('disabled', 'disabled');\r\n    document.getElementById(C_ID_check_choropleth).onchange = enableChoroplethInput;\r\n\r\n    // ------ process files ------ //\r\n\r\n    // process path\r\n    const pathSubmitted = function (file, result) {\r\n      const reader = new FileReader();\r\n      const onLoadAction = function (e) {\r\n        try {\r\n          console.log(e);\r\n          //console.log(reader.result);\r\n          result.json = JSON.parse(reader.result);\r\n        } catch (ex) {\r\n          console.log('unable to read file');\r\n          // TODO: notify user\r\n        }\r\n      };\r\n      reader.onload = onLoadAction;\r\n      reader.readAsText(file);\r\n    };\r\n\r\n    // process data path\r\n    const data = {\r\n      json: undefined,\r\n    };\r\n    const dataPathSubmitted = function (e) {\r\n      console.log(this.files);\r\n      pathSubmitted(this.files[0], data);\r\n    };\r\n    document.getElementById(C_ID_input_data).addEventListener('change', dataPathSubmitted, false);\r\n\r\n    // process config path\r\n    const config = {\r\n      json: undefined,\r\n    };\r\n    const configPathSubmitted = function (e) {\r\n      console.log(this.files);\r\n      pathSubmitted(this.files[0], config);\r\n    };\r\n    document\r\n      .getElementById(C_ID_input_config)\r\n      .addEventListener('change', configPathSubmitted, false);\r\n\r\n    // process geojson path\r\n    const geo = {\r\n      json: undefined,\r\n    };\r\n    const geoPathSubmitted = function (e) {\r\n      console.log(this.files);\r\n      pathSubmitted(this.files[0], geo);\r\n    };\r\n    document.getElementById(C_ID_input_geojson).addEventListener('change', geoPathSubmitted, false);\r\n\r\n    // process choropleth polygons\r\n    const choroplethPathSubmitted = function (e) {\r\n      console.log(this.files);\r\n      const reader = new FileReader();\r\n      const onLoadAction = function (e) {\r\n        try {\r\n          console.log(e);\r\n          //console.log(reader.result);\r\n          _this.polygons = JSON.parse(reader.result);\r\n        } catch (ex) {\r\n          console.log('unable to read file');\r\n          // TODO: notify user\r\n        }\r\n      };\r\n      reader.onload = onLoadAction;\r\n      reader.readAsText(this.files[0]);\r\n    };\r\n    document\r\n      .getElementById(C_ID_input_choropleth)\r\n      .addEventListener('change', choroplethPathSubmitted, false);\r\n\r\n    // ------ import ------ //\r\n\r\n    // import action\r\n    const importAction = function (e) {\r\n      console.log(e);\r\n      console.log('data: ', data);\r\n      console.log('config: ', config);\r\n      console.log('geo: ', geo);\r\n\r\n      // process data json\r\n      if (!document.getElementById(C_ID_check_data).checked || data.json == undefined) {\r\n        const fileName = document.getElementById(C_ID_select_data).value;\r\n        console.log(fileName);\r\n        if (fileName === 'demo1.json') data.json = JsonDataDemo1;\r\n        if (fileName === 'demo2.json') data.json = JsonDataDemo2;\r\n        if (fileName === 'covidSlovakRegions.json') data.json = VaccinationData;\r\n        if (fileName === 'floor-plan-data.json') data.json = FloorPlanData;\r\n        if (fileName === 'network-data.json') data.json = NetworkData;\r\n      }\r\n\r\n      // process config json\r\n      if (!document.getElementById(C_ID_check_config).checked || config.json == undefined) {\r\n        config.json = JsonConfig;\r\n      }\r\n\r\n      // process geojson\r\n      if (!document.getElementById(C_ID_check_geojson).checked || geo.json == undefined) {\r\n        geo.json = GeojsonConfig;\r\n      }\r\n\r\n      // process choropleth objects\r\n      if (!document.getElementById(C_ID_check_choropleth).checked) {\r\n        this.polygons = Polygons;\r\n      }\r\n\r\n      // update state\r\n      _this.setState({\r\n        data: data.json,\r\n        config: config.json,\r\n        geo: geo.json,\r\n      });\r\n    };\r\n    document.getElementById(C_ID_input_import).addEventListener('click', importAction);\r\n\r\n    // ------ export ------ //\r\n\r\n    // export action\r\n    const exportAction = function (e) {\r\n      console.log(e);\r\n\r\n      // expert map configuration\r\n      const config = JSON.stringify(_this.map.current.getMap().export(), null, 2);\r\n\r\n      // download file\r\n      const element = document.createElement('a');\r\n      element.setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(config));\r\n      element.setAttribute('download', 'config.json');\r\n      element.style.display = 'none';\r\n      document.body.appendChild(element);\r\n      element.click();\r\n      document.body.removeChild(element);\r\n\r\n      console.log('rendered map:');\r\n    };\r\n    document.getElementById(C_ID_input_export).addEventListener('click', exportAction);\r\n  }\r\n\r\n  exportGeoJSON = (evt) => {\r\n    const config = JSON.stringify(this.map.current.getMap().exportGeoJSON(), null, 2);\r\n    // download file\r\n    const element = document.createElement('a');\r\n    element.setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(config));\r\n    element.setAttribute('download', 'map.json');\r\n    element.style.display = 'none';\r\n    document.body.appendChild(element);\r\n    element.click();\r\n    document.body.removeChild(element);\r\n  };\r\n\r\n  render() {\r\n    console.log('rendering...');\r\n    return (\r\n      <div className=\"demo-container\">\r\n        <div className=\"demo-toolbar\">\r\n          <div className=\"center f-column\">\r\n            <div>\r\n              <span>Data file: </span>\r\n              <select id={C_ID_select_data}>\r\n                <option value=\"demo1.json\">demo1.json</option>\r\n                <option value=\"demo2.json\">demo2.json</option>\r\n                <option value=\"covidSlovakRegions.json\">covidSlovakRegions.json</option>\r\n                <option value=\"floor-plan-data.json\">floor-plan-data.json</option>\r\n                <option value=\"network-data.json\">network-data.json</option>\r\n                <option disabled></option>\r\n              </select>\r\n            </div>\r\n            <div>\r\n              <span>\r\n                {' '}\r\n                or <input id={C_ID_check_data} type=\"checkbox\" /> custom file:{' '}\r\n              </span>\r\n              <input id={C_ID_input_data} type=\"file\" accept=\".json\" size=\"3\" />\r\n            </div>\r\n          </div>\r\n          <div className=\"center\">\r\n            <input id={C_ID_check_config} type=\"checkbox\" />\r\n            <span> Configuration file: </span>\r\n            <input id={C_ID_input_config} type=\"file\" accept=\".json\" size=\"3\" />\r\n          </div>\r\n          <div></div>\r\n\r\n          <div className=\"center\">\r\n            <input id={C_ID_check_geojson} type=\"checkbox\" />\r\n            <span> GeoJSON file: </span>\r\n            <input id={C_ID_input_geojson} type=\"file\" accept=\".json\" size=\"3\" />\r\n          </div>\r\n\r\n          <div className=\"center\">\r\n            <input id={C_ID_check_choropleth} type=\"checkbox\" />\r\n            <span> Choropleth objects: </span>\r\n            <input id={C_ID_input_choropleth} type=\"file\" accept=\".json\" size=\"3\" />\r\n          </div>\r\n\r\n          <div className=\"center\">\r\n            <input id={C_ID_input_import} type=\"submit\" value=\"import\" />\r\n            <input id={C_ID_input_export} type=\"submit\" value=\"export\" />\r\n\r\n            <input type=\"submit\" value=\"geoExport\" onClick={this.exportGeoJSON} />\r\n          </div>\r\n        </div>\r\n        <div className=\"demo-map\">\r\n          <ReactGeovistoMap\r\n            ref={this.map}\r\n            id=\"my-geovisto-map\"\r\n            polygons={this.polygons}\r\n            centroids={this.centroids}\r\n            data={new FlattenedMapData(this.state.data)}\r\n            config={new BasicMapConfig(this.state.config)}\r\n            geojson={this.state.geo}\r\n            globals={undefined}\r\n            tools={\r\n              new ToolsManager([\r\n                new SidebarTool({ id: 'geovisto-tool-sidebar' }),\r\n                new SettingsTool({ id: 'geovisto-tool-settings' }),\r\n                new FiltersTool({\r\n                  // filter operations\r\n                  id: 'geovisto-tool-filters',\r\n                  manager: new FiltersManager([\r\n                    new EqFilterOperation(),\r\n                    new NeqFilterOperation(),\r\n                    new RegFilterOperation(),\r\n                  ]),\r\n                }),\r\n                new ThemesTool({\r\n                  // style themes\r\n                  id: 'geovisto-tool-themes',\r\n                  manager: new ThemesManager([\r\n                    new Light1Theme(),\r\n                    new Light2Theme(),\r\n                    new Light3Theme(),\r\n                    new Dark1Theme(),\r\n                    new Dark2Theme(),\r\n                    new Dark3Theme(),\r\n                  ]),\r\n                }),\r\n                new SelectionTool({ id: 'geovisto-tool-selection' }),\r\n                new MapLayerTool({ id: 'geovisto-tool-layer-map' }),\r\n                new ChoroplethLayerTool({ id: 'geovisto-tool-layer-choropleth' }),\r\n                new MarkerLayerTool({ id: 'geovisto-tool-layer-marker' }),\r\n                new ConnectionLayerTool({ id: 'geovisto-tool-layer-connection' }),\r\n                new DrawingLayerTool({ id: 'geovisto-tool-layer-drawing' }),\r\n              ])\r\n            }\r\n          />\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nexport default Demo;\r\n","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\n\r\nimport Demo from './demo/Demo';\r\n\r\nReactDOM.render(<Demo />, document.getElementById('root'));\r\n"],"sourceRoot":""}